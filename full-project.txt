### BEGIN Ionic-project\src\global.scss ###
@import "@ionic/angular/css/core.css";

/* Basic CSS for apps built with Ionic */
@import "@ionic/angular/css/normalize.css";
@import "@ionic/angular/css/structure.css";
@import "@ionic/angular/css/typography.css";
@import '@ionic/angular/css/display.css';

/* Optional CSS utils that can be commented out */
@import "@ionic/angular/css/padding.css";
@import "@ionic/angular/css/float-elements.css";
@import "@ionic/angular/css/text-alignment.css";
@import "@ionic/angular/css/text-transformation.css";
@import "@ionic/angular/css/flex-utils.css";


@import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&family=Tajawal:wght@400;500&family=Poppins:wght@200;300;400&display=swap");

@tailwind base;
@tailwind components;
@tailwind utilities;

* {
  font-family: "Montserrat";
  font-weight: 600;
  font-style: normal;
}


.center-v {
  display: flex;
  align-items: center;
  justify-content: center;
}

.selectStyle {
  border: 1px solid #4c4c4c;
  color: #303132;
  border-radius: 3px;
  font-size: 14px;
  height: 35px;
  background: #efefef;
  min-height: 35px;
  padding-left: 10%;
  display: grid;
  justify-content: center;
}

ion-button {
  height: 35px;
  --border-radius: 5px;
}

.selectedPageBackgroundColor {
  --background: #4CAF50;
}

.NoConnectionBtnOkOrReload {
  color: white;
  text-decoration: underline;
  border-radius: 3px;
  padding: 3px;
  background: #849423;
}

.NoConnectionBtnDetails {
  color: #2b2b2b;
  text-decoration: underline;
  background: #adadad;
  border-radius: 3px;
  padding: 3px;
}

.NoConxPopUp {
  position: absolute;
  color: #474747;
  background: #ffffff;
  font-size: 12px;
  padding: 5px;
  top: 30vh;
  width: 90vw;
  left: 5vw;
  height: 20vh;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 5px;
  flex-direction: column;
  z-index: 99;
}

.versionStyle {
  position: absolute;
  right: 10px;
  bottom: 10px;
  font-size: 8px;
  color: #000000;
}

.btn-reset {
  position: absolute;
  top: 3%;
  font-size: 15px;
  right: 15px;
  color: #177ccd;
  background: #efefef;
  padding: 5px;
  border-radius: 3px;
}

.btn-reset:active {
  background: #c5c5c5;
  transition: ease-in;
}

.my-10 {
  margin: 10px 0px;
}

.fz-15 {
  font-size: 15px;
}

.fz-20 {
  font-size: 20px;
}

.m-5-10 {
  margin: 5px 10px;
}

.px-5 {
  padding: 0px 5px;
}

.br-5 {
  border-radius: 5px;
}

.textToLong {
  white-space: nowrap;
  width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
}
 

### END Ionic-project\src\global.scss ###

### BEGIN Ionic-project\src\index.html ###
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>CABSUL</title>

  <base href="/" />

  <meta name="color-scheme" content="light" />
  <meta name="viewport"
    content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />

  <link rel="icon" type="image/png" href="assets/images_lesieur/iconTiny.png" />
  <link rel="stylesheet" href="assets/css/animate.min.css" />
  
  <!-- Leaflet CSS and JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Mapbox GL JS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>


  <!-- add to homescreen for ios -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="preconnect" href="https://fonts.gstatic.com">

  <!-- MapLibre GL JS -->
  <script src='https://unpkg.com/maplibre-gl@4.1.2/dist/maplibre-gl.js'></script>
  <link href='https://unpkg.com/maplibre-gl@4.1.2/dist/maplibre-gl.css' rel='stylesheet' />

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>
  <app-root></app-root>
  <script>
  </script>
</body>

</html>

### END Ionic-project\src\index.html ###

### BEGIN Ionic-project\src\main.ts ###
import { enableProdMode } from '@angular/core';
import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';

import { AppModule } from './app/app.module';
import { environment } from './environments/environment';

if (environment.production) {
  enableProdMode();
} 

platformBrowserDynamic().bootstrapModule(AppModule)
  .catch(err => console.log(err));
  
### END Ionic-project\src\main.ts ###

### BEGIN Ionic-project\src\polyfills.ts ###
/**
 * This file includes polyfills needed by Angular and is loaded before the app.
 * You can add your own extra polyfills to this file.
 *
 * This file is divided into 2 sections:
 *   1. Browser polyfills. These are applied before loading ZoneJS and are sorted by browsers.
 *   2. Application imports. Files imported after ZoneJS that should be loaded before your main
 *      file.
 *
 * The current setup is for so-called "evergreen" browsers; the last versions of browsers that
 * automatically update themselves. This includes recent versions of Safari, Chrome (including
 * Opera), Edge on the desktop, and iOS and Chrome on mobile.
 *
 * Learn more in https://angular.io/guide/browser-support
 */

/***************************************************************************************************
 * BROWSER POLYFILLS
 */

/**
 * By default, zone.js will patch all possible macroTask and DomEvents
 * user can disable parts of macroTask/DomEvents patch by setting following flags
 * because those flags need to be set before `zone.js` being loaded, and webpack
 * will put import in the top of bundle, so user need to create a separate file
 * in this directory (for example: zone-flags.ts), and put the following flags
 * into that file, and then add the following code before importing zone.js.
 * import './zone-flags';
 *
 * The flags allowed in zone-flags.ts are listed here.
 *
 * The following flags will work for all browsers.
 *
 * (window as any).__Zone_disable_requestAnimationFrame = true; // disable patch requestAnimationFrame
 * (window as any).__Zone_disable_on_property = true; // disable patch onProperty such as onclick
 * (window as any).__zone_symbol__UNPATCHED_EVENTS = ['scroll', 'mousemove']; // disable patch specified eventNames
 *
 *  in IE/Edge developer tools, the addEventListener will also be wrapped by zone.js
 *  with the following flag, it will bypass `zone.js` patch for IE/Edge
 *
 *  (window as any).__Zone_enable_cross_context_check = true;
 *
 */
 
import './zone-flags';

/***************************************************************************************************
 * Zone JS is required by default for Angular itself.
 */
import 'zone.js';  // Included with Angular CLI.


/***************************************************************************************************
 * APPLICATION IMPORTS
 */

### END Ionic-project\src\polyfills.ts ###

### BEGIN Ionic-project\src\test.ts ###
// This file is required by karma.conf.js and loads recursively all the .spec and framework files

import 'zone.js/testing';
import { getTestBed } from '@angular/core/testing';
import {
  BrowserDynamicTestingModule,
  platformBrowserDynamicTesting
} from '@angular/platform-browser-dynamic/testing';

// First, initialize the Angular testing environment.
getTestBed().initTestEnvironment(
  BrowserDynamicTestingModule,
  platformBrowserDynamicTesting(),
);

### END Ionic-project\src\test.ts ###

### BEGIN Ionic-project\src\zone-flags.ts ###
/**
 * Prevents Angular change detection from
 * running with certain Web Component callbacks
 */
// eslint-disable-next-line no-underscore-dangle
(window as any).__Zone_disable_customElements = true;

### END Ionic-project\src\zone-flags.ts ###

### BEGIN Ionic-project\src\app\app-routing.module.ts ###
import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';
import { PreloadAllModules } from '@angular/router';

const routes: Routes = [
  {
    path: '',
    loadChildren: () => import('./auth/sign-in/sign-in.module').then(m => m.SignInPageModule)
  },
  {
    path: 'onboarding',
    loadChildren: () => import('./onboarding/onboarding.module').then(m => m.OnboardingPageModule)
  },
  {
    path: 'sign-up',
    loadChildren: () => import('./auth/sign-up/sign-up.module').then(m => m.SignUpPageModule)
  },
  {
    path: 'sign-in',
    loadChildren: () => import('./auth/sign-in/sign-in.module').then(m => m.SignInPageModule)
  },
  {
    path: 'pub',
    loadChildren: () => import('./pub/pub.module').then(m => m.PubPageModule)
  },
  {
    path: 'gpsaccess',
    loadChildren: () => import('./gpsaccess/gpsaccess.module').then(m => m.GPSAccessPageModule)
  },
  {
    path: 'map',
    loadChildren: () => import('./map/map.module').then(m => m.MapPageModule)
  },

  {
    path: 'profil',
    loadChildren: () => import('./profile/profil/profil.module').then(m => m.ProfilPageModule)
  },
  {
    path: 'gestion-amis',
    loadChildren: () => import('./profile/gestion-amis/gestion-amis.module').then(m => m.GestionAmisPageModule)
  },
  {
    path: 'avis',
    loadChildren: () => import('./feedback/avis/avis.module').then(m => m.AvisPageModule)
  },
  {
    path: 'aide',
    loadChildren: () => import('./feedback/aide/aide.module').then(m => m.AidePageModule)
  },
  {
    path: 'premium',
    loadChildren: () => import('./premum/premium/premium.module').then(m => m.PremiumPageModule)
  },
  {
    path: 'premium-confirmation',
    loadChildren: () => import('./premum/premium-confirmation/premium-confirmation.module').then(m => m.PremiumConfirmationPageModule)
  },
  {
    path: 'faq',
    loadChildren: () => import('./feedback/faq/faq.module').then(m => m.FaqPageModule)
  },
  {
    path: 'setting',
    loadChildren: () => import('./setting/setting.module').then(m => m.SettingPageModule)
  },
  {
    path: 'splash-screen',
    loadChildren: () => import('./splash-screen/splash-screen.module').then(m => m.SplashScreenPageModule)
  },
  {
    path: 'update-evenement/:id',
    loadChildren: () => import('./update-evenement/update-evenement.module').then(m => m.UpdateEvenementPageModule)
  },
  {
    path:"update-sos/:id",
    loadChildren:() => import("./update-sos/update-sos.module").then(m => m.UpdateSosPageModule)
  },
  {
    path: 'update-note/:id',
    loadChildren: () => import('./update-note/update-note.module').then( m => m.UpdateNotePageModule)
  },

  {
    path: 'update-profil',
    loadChildren: () => import('./profile/update-profil/update-profil.module').then(m => m.UpdateProfilPageModule)
  },
  {
    path: 'thanks-page',
    loadChildren: () => import('./premum/thanks-page/thanks-page.module').then(m => m.ThanksPagePageModule)
  },
  {
    path: 'password-forgotten',
    loadChildren: () => import('./auth/password-forgotten/password-forgotten.module').then(m => m.PasswordForgottenPageModule)
  },
  {
    path: 'new-password',
    loadChildren: () => import('./auth/new-password/new-password.module').then(m => m.NewPasswordPageModule)
  },
  {
    path: 'mention-legal',
    loadChildren: () => import('./mention-legal/mention-legal.module').then(m => m.MentionLegalPageModule)
  },

  {
    path: 'sos',
    loadChildren: () => import('./sos/sos.module').then(m => m.SosPageModule)
  },
  {
    path: 'info',
    loadChildren: () => import('./info/info.module').then(m => m.InfoPageModule)
  },
  { path: '', redirectTo: 'menu', pathMatch: 'full' },
  { path: 'aeroports', loadChildren: () => import('./aeroport/aeroport.module').then(m => m.AeroportPageModule) },
  {
    path: 'aeroport-modal',
    loadChildren: () => import('./aeroport-modal/aeroport-modal.module').then(m => m.AeroportModalPageModule)
  },
  {
    path: 'aeroport-details',
    loadChildren: () =>
      import('./aeroport-details/aeroport-details.module').then(
        (m) => m.AeroportDetailsModule
      ),
  },
  {
    path: 'aeroport-attente',
    loadChildren: () =>
      import('./aeroport-ifram-modal/aeroport-ifram-route.module').then(
        (m) => m.AeroportIframRouteModule
      ),
  }
  ,
  {
    path: 'list-evenement',
    loadChildren: () =>
      import('./list-evenement/list-evenement.module').then(
        (m) => m.ListEvenementPageModule
      ),
  },
  {
    path: 'list-notes',
    loadChildren: () => import('./list-notes/list-notes.module').then( m => m.ListNotesPageModule)
  },
  



];
@NgModule({
  imports: [
    RouterModule.forRoot(routes, { preloadingStrategy: PreloadAllModules })
  ],
  exports: [RouterModule]
})
export class AppRoutingModule { }

### END Ionic-project\src\app\app-routing.module.ts ###

### BEGIN Ionic-project\src\app\app.component.html ###
<ion-app>
  <ion-router-outlet></ion-router-outlet>
</ion-app>

### END Ionic-project\src\app\app.component.html ###

### BEGIN Ionic-project\src\app\app.component.scss ###
### END Ionic-project\src\app\app.component.scss ###

### BEGIN Ionic-project\src\app\app.component.spec.ts ###
import { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { TestBed } from '@angular/core/testing';

import { AppComponent } from './app.component';

describe('AppComponent', () => {

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [AppComponent],
      schemas: [CUSTOM_ELEMENTS_SCHEMA],
    }).compileComponents();
  });

  it('should create the app', () => {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.componentInstance;
    expect(app).toBeTruthy();
  });

});

### END Ionic-project\src\app\app.component.spec.ts ###

### BEGIN Ionic-project\src\app\app.component.ts ###
import { Component } from '@angular/core';

@Component({
  selector: 'app-root',
  templateUrl: 'app.component.html',
  styleUrls: ['app.component.scss'],
})
export class AppComponent {
  constructor() {}
}

### END Ionic-project\src\app\app.component.ts ###

### BEGIN Ionic-project\src\app\app.module.ts ###
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { RouteReuseStrategy } from '@angular/router';
import { IonicModule, IonicRouteStrategy } from '@ionic/angular';
import { AppRoutingModule } from './app-routing.module';
import { AppComponent } from './app.component';
import { HttpClientModule, HTTP_INTERCEPTORS } from '@angular/common/http';
import { ShareModule } from './utiles/share/share.module';
import { DirectivesDirective } from './src/app/utiles/directives.directive';
import { MenuModule } from './utiles/component/menu/menu.module';
import { BrowserAnimationsModule } from '@angular/platform-browser/animations';
import { EditPostModalComponent } from './edit-post-modal/edit-post-modal.component';
import { LoggingInterceptor } from './interceptors/logging.interceptor';

@NgModule({
  declarations: [AppComponent, DirectivesDirective,EditPostModalComponent],
  imports: [
    BrowserModule,
    IonicModule.forRoot(),
    AppRoutingModule,
    HttpClientModule,
    ShareModule,
    BrowserModule,
    BrowserAnimationsModule,
  ],
  providers: [
    { provide: RouteReuseStrategy, useClass: IonicRouteStrategy },
    { provide: HTTP_INTERCEPTORS, useClass: LoggingInterceptor, multi: true },
  ],
  bootstrap: [AppComponent],
})
export class AppModule {}

### END Ionic-project\src\app\app.module.ts ###

### BEGIN Ionic-project\src\app\aeroport\aeroport-routing.module.ts ###
import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';
import { AeroportPage } from './aeroport.page';

const routes: Routes = [
  {
    path: '',
    component: AeroportPage,
  },
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AeroportPageRoutingModule {}

### END Ionic-project\src\app\aeroport\aeroport-routing.module.ts ###

### BEGIN Ionic-project\src\app\aeroport\aeroport.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { IonicModule } from '@ionic/angular';
import { SafeUrlPipe } from './safe-url.pipe';
import { AeroportPageRoutingModule } from './aeroport-routing.module';
import { AeroportPage } from './aeroport.page';



@NgModule({
  declarations: [AeroportPage],
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    AeroportPageRoutingModule
  ]
  
})
export class AeroportPageModule {}

### END Ionic-project\src\app\aeroport\aeroport.module.ts ###

### BEGIN Ionic-project\src\app\aeroport\aeroport.page.html ###
<!-- airport-list.page.html -->
<ion-header class="ion-no-border">
  <ion-toolbar class="bg-white shadow-sm">
    <div class="flex items-center px-4 h-16">
      <ion-buttons slot="start">
        <ion-button (click)="goBack()" class="p-2 hover:bg-gray-100 rounded-full mr-3">
          <ion-icon name="chevron-back-outline" class="h-5 w-5 text-gray-600"></ion-icon>
        </ion-button>
      </ion-buttons>
      <ion-title class="text-lg font-semibold text-gray-900">AÃ©roports</ion-title>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="bg-gray-50">
  <div class="max-w-3xl mx-auto px-4 pb-8">
    <ion-list class="bg-transparent" [inset]="true">
      <ion-item *ngFor="let aeroport of aeroports" lines="none" class="bg-white rounded-xl shadow-sm overflow-hidden mb-6 transition-all hover:shadow-md ion-no-padding">
        <!-- Airport Code Banner -->
        <div class="w-full">
          <div class="bg-gradient-to-r from-blue-50 to-indigo-50 py-14" (click)="openDetailsNew(aeroport)">
            <h2 class="text-4xl font-bold text-center text-gray-900 hover:text-blue-600 transition-colors cursor-pointer">
              {{ aeroport.abbreviation }}
            </h2>
          </div>

          <div class="p-6">
            <!-- Airport Name -->
            <h3 class="text-lg font-medium text-gray-900 mb-6 pb-2 border-b">{{ aeroport.name }}</h3>

            <!-- Details Grid -->
            <div class="space-y-4">
              <!-- File Number (For airports other than ORLY) -->
              <div *ngIf="aeroport.abbreviation !== 'ORLY'" class="flex items-center justify-between">
                <span class="text-gray-600">Nb file:</span>
                <div class="flex items-center space-x-2">
                  <span class="font-medium">{{ aeroport.nbFile }}</span>
                </div>
              </div>
              
              <!-- Orly-specific Queue Fields -->
              <div *ngIf="aeroport.abbreviation === 'ORLY'">
                <div class="flex items-center justify-between">
                  <span class="text-gray-600">Grande file:</span>
                  <div class="flex items-center space-x-2">
                    <span class="font-medium">{{ aeroport.nbGrandeFile }}</span>
                  </div>
                </div>
                <div class="flex items-center justify-between mt-2">
                  <span class="text-gray-600">Petite file:</span>
                  <div class="flex items-center space-x-2">
                    <span class="font-medium">{{ aeroport.nbPetiteFile }}</span>
                  </div>
                </div>
              </div>

              <!-- Van Number -->
              <div class="flex items-center justify-between">
                <span class="text-gray-600">Nb de Van:</span>
                <div class="flex items-center space-x-2">
                  <span class="font-medium">{{ aeroport.nbVan }}</span>
                </div>
              </div>

              <!-- Attente BAT -->
              <div class="flex items-center justify-between">
                <span class="text-gray-600">Attente Bat:</span>
                <div class="flex items-center space-x-2">
                  <span class="font-medium">{{ aeroport.attenteBAT }}</span>
                </div>
              </div>
            </div>

            <!-- Modify Button -->
            <ion-button 
              expand="block"
              fill="outline"
              (click)="openModal(aeroport)"
              class="h-10 mt-6 font-medium"
              color="primary">
              Modifier
            </ion-button>
          </div>
        </div>
      </ion-item>
    </ion-list>
  </div>
</ion-content>

### END Ionic-project\src\app\aeroport\aeroport.page.html ###

### BEGIN Ionic-project\src\app\aeroport\aeroport.page.scss ###
.aeroport-card {
    background-color: white;
    border-radius: 12px;
    margin: 20px 10px;
    padding: 0;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }
  
  .aeroport-header {
    background-color: #e0e0e0;
    text-align: center;
    padding: 15px 0;
  }
  
  .aeroport-header h2 {
    font-size: 22px;
    font-weight: bold;
    color: black;
  }
  
  .aeroport-body {
    padding: 15px;
  }
  
  .aeroport-title {
    font-size: 18px;
    margin-bottom: 10px;
    color: #333;
  }
  
  .details p {
    font-size: 16px;
    margin: 5px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .details span {
    font-weight: bold;
  }
  
  .tendance {
    color: red; /* Red for down trend */
  }
  
  ion-button {
    margin-top: 15px;
    --border-radius: 8px;
  }
  
### END Ionic-project\src\app\aeroport\aeroport.page.scss ###

### BEGIN Ionic-project\src\app\aeroport\aeroport.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AeroportPage } from './aeroport.page';

describe('AeroportPage', () => {
  let component: AeroportPage;
  let fixture: ComponentFixture<AeroportPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(AeroportPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\aeroport\aeroport.page.spec.ts ###

### BEGIN Ionic-project\src\app\aeroport\aeroport.page.ts ###
import { ApiService } from './../services/api.service';
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';
import { LoadingController, ModalController } from '@ionic/angular';
import { AeroportModalPage } from '../aeroport-modal/aeroport-modal.page';
import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';

@Component({
  selector: 'app-aeroport',
  templateUrl: './aeroport.page.html',
  styleUrls: ['./aeroport.page.scss'],
})
export class AeroportPage implements OnInit {
  aeroports: any = [];
  selectedAeroport: { name: string; url: SafeResourceUrl } | null = null;
  private loading: HTMLIonLoadingElement | null = null;

  constructor(
    private router: Router,
    private modalController: ModalController,
    private apiService: ApiService,
    private loadingCtrl: LoadingController
  ) { }

  ngOnInit() {
    // ngOnInit is fine for one-time setup, but data fetching that depends
    // on auth state is better in ionViewWillEnter.
  }

  async ionViewWillEnter() {
    // This hook runs every time the page is about to be viewed.
    await this.loadAirports();
  }

  async loadAirports() {
    this.loading = await this.loadingCtrl.create({ message: 'Chargement...' });
    await this.loading.present();
    
    this.apiService.getAirports().subscribe({
      next: (data) => {
        this.aeroports = data;
        this.loading?.dismiss();
      },
      error: (err) => {
        // If the page is blank, check the browser console for a 401/403 error. This indicates an authentication problem.
        console.error("Error fetching airports", err);
        this.loading?.dismiss();
      }
    });
  }

  // Navigation vers les dÃ©tails
  // Renamed to match the function call in the HTML template `(click)="openDetailsNew(aeroport)"`.
  openDetailsNew(aeroport: any) {
    this.router.navigate(['/aeroport-details'], {
      queryParams: { aeroport: JSON.stringify(aeroport) },
    });
  }

  // Ouvrir la modal de modification
  async openModal(aeroport: any) {
    const modal = await this.modalController.create({
      component: AeroportModalPage,
      componentProps: { aeroport: { ...aeroport } }, // Pass a copy
    });
    
    modal.onDidDismiss().then((result) => {
      if (result.data && result.role === 'confirm') {
        const index = this.aeroports.findIndex(
          (a: any) => a.id === result.data.id
        );
        if (index !== -1) {
          this.aeroports[index] = result.data;
        }
      }
    });
    return modal.present();
  }
  
  goBack() {
    this.router.navigate(['/map']);
  }
}

### END Ionic-project\src\app\aeroport\aeroport.page.ts ###

### BEGIN Ionic-project\src\app\aeroport\safe-url.pipe.ts ###
import { Pipe, PipeTransform } from '@angular/core';
import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';

@Pipe({
  name: 'safeUrl',
})
export class SafeUrlPipe implements PipeTransform {
  constructor(private sanitizer: DomSanitizer) {}

  transform(url: string): SafeResourceUrl {
    return this.sanitizer.bypassSecurityTrustResourceUrl(url);
  }
}

### END Ionic-project\src\app\aeroport\safe-url.pipe.ts ###

### BEGIN Ionic-project\src\app\aeroport-details\aeroport-details-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { AeroportDetailsPage } from './aeroport-details.page';

const routes: Routes = [
  {
    path: '',
    component: AeroportDetailsPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AeroportDetailsPageRoutingModule {}

### END Ionic-project\src\app\aeroport-details\aeroport-details-routing.module.ts ###

### BEGIN Ionic-project\src\app\aeroport-details\aeroport-details.module.ts ###
/*
import { Component, OnInit } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import {
  IonContent,
  IonHeader,
  IonTitle,
  IonToolbar,
  IonButtons,
  IonBackButton,
} from '@ionic/angular/standalone';
import { CommonModule } from '@angular/common';
import { RouterModule } from '@angular/router'; 

@Component({
  selector: 'app-aeroport-details',
  templateUrl: './aeroport-details.page.html',
  styleUrls: ['./aeroport-details.page.scss'],
  standalone:true,
  imports: [
    CommonModule,
    RouterModule,
    IonContent,
    IonHeader,
    IonTitle,
    IonToolbar,
    IonButtons,
    IonBackButton,
    
  ],
})
export class AeroportDetailsPage implements OnInit {
  aeroport: any;

  constructor(private route: ActivatedRoute) {}
  
  ngOnInit() {
    const data = this.route.snapshot.paramMap.get('data');
    if (data) {
      this.aeroport = JSON.parse(data);
    }
    this.route.queryParams.subscribe((params) => {
      if (params['aeroport']) {
        this.aeroport = JSON.parse(params['aeroport']);
      }
    });
  }
  
}
*/
import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';
import { AeroportDetailsPage } from './aeroport-details.page';
import { CommonModule } from '@angular/common';
import {
  IonContent,
  IonHeader,
  IonTitle,
  IonToolbar,
  IonButtons,
  IonBackButton,
} from '@ionic/angular/standalone';

const routes: Routes = [
  {
    path: '',
    component: AeroportDetailsPage, 
  },
];

@NgModule({
  declarations: [AeroportDetailsPage], 
  imports: [
    CommonModule,
    RouterModule.forChild(routes),
    IonContent,
    IonHeader,
    IonTitle,
    IonToolbar,
    IonButtons,
    IonBackButton,
  ],
  exports: [RouterModule], 
})
export class AeroportDetailsModule {}




### END Ionic-project\src\app\aeroport-details\aeroport-details.module.ts ###

### BEGIN Ionic-project\src\app\aeroport-details\aeroport-details.page.html ###
<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/aeroports"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ aeroport?.abbreviation }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="details-card">
    <h2>{{ aeroport?.name }}</h2>
    <!-- Conditional display for ORLY airport -->
    <div *ngIf="aeroport?.abbreviation === 'ORLY'">
      <p>Grande file: <span>{{ aeroport?.nbGrandeFile }}</span></p>
      <p>Petite file: <span>{{ aeroport?.nbPetiteFile }}</span></p>
    </div>
    <!-- Display for other airports -->
    <div *ngIf="aeroport?.abbreviation !== 'ORLY'">
      <p>Nb file: <span>{{ aeroport?.nbFile }}</span></p>
    </div>
    <p>Nb de Van: <span>{{ aeroport?.nbVan }}</span></p>
    <p>Attente BAT: <span>{{ aeroport?.attenteBAT }}</span></p>
    <p>Sortie en: <span>{{ aeroport?.sortie30Min }}</span></p>
    <p>EntrÃ©e en: <span>{{ aeroport?.entree30Min }}</span></p>
  </div>
</ion-content>

### END Ionic-project\src\app\aeroport-details\aeroport-details.page.html ###

### BEGIN Ionic-project\src\app\aeroport-details\aeroport-details.page.scss ###
.details-card {
    background-color: white;
    border-radius: 12px;
    padding: 20px;
    margin: 20px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }
  
  .details-card h2 {
    text-align: center;
    margin-bottom: 20px;
  }
  
  .details-card p {
    font-size: 16px;
    margin: 10px 0;
  }
  
  .details-card span {
    font-weight: bold;
  }
  
### END Ionic-project\src\app\aeroport-details\aeroport-details.page.scss ###

### BEGIN Ionic-project\src\app\aeroport-details\aeroport-details.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AeroportDetailsPage } from './aeroport-details.page';

describe('AeroportDetailsPage', () => {
  let component: AeroportDetailsPage;
  let fixture: ComponentFixture<AeroportDetailsPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(AeroportDetailsPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\aeroport-details\aeroport-details.page.spec.ts ###

### BEGIN Ionic-project\src\app\aeroport-details\aeroport-details.page.ts ###
import { CommonModule } from '@angular/common';
import { Component, Input, OnInit } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { ModalController } from '@ionic/angular';
import { IonHeader, IonToolbar, IonBackButton, IonButtons, IonTitle, IonContent } from "@ionic/angular/standalone";

@Component({    
  selector: 'app-aeroport-details',
  templateUrl: './aeroport-details.page.html',
  styleUrls: ['./aeroport-details.page.scss'],

})
export class AeroportDetailsPage implements OnInit {
  aeroport: any;
  constructor(private route: ActivatedRoute,private modalController: ModalController) {}

  ngOnInit() {
    this.route.queryParams.subscribe((params) => {
      if (params['aeroport']) {
        this.aeroport = JSON.parse(params['aeroport']);
      }
    });
  }
  closeModal() {
    this.modalController.dismiss();
  }
  
}

### END Ionic-project\src\app\aeroport-details\aeroport-details.page.ts ###

### BEGIN Ionic-project\src\app\aeroport-ifram-modal\aeroport-ifram-modal.component.html ###
<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="navigateToRoot()">
        <ion-icon slot="icon-only" name="arrow-back">Back</ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Aeroport Attente</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <iframe
    [src]="safeUrl"
    width="100%"
    height="500px"
    frameborder="0"
  ></iframe>
</ion-content>

### END Ionic-project\src\app\aeroport-ifram-modal\aeroport-ifram-modal.component.html ###

### BEGIN Ionic-project\src\app\aeroport-ifram-modal\aeroport-ifram-modal.component.scss ###
### END Ionic-project\src\app\aeroport-ifram-modal\aeroport-ifram-modal.component.scss ###

### BEGIN Ionic-project\src\app\aeroport-ifram-modal\aeroport-ifram-modal.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { AeroportIframModalComponent } from './aeroport-ifram-modal.component';

describe('AeroportIframModalComponent', () => {
  let component: AeroportIframModalComponent;
  let fixture: ComponentFixture<AeroportIframModalComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ AeroportIframModalComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(AeroportIframModalComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\aeroport-ifram-modal\aeroport-ifram-modal.component.spec.ts ###

### BEGIN Ionic-project\src\app\aeroport-ifram-modal\aeroport-ifram-modal.component.ts ###

import { Component, Input, OnInit } from '@angular/core';
import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';
import { ActivatedRoute, Router } from '@angular/router';
import { ModalController } from '@ionic/angular';

@Component({
  selector: 'app-aeroport-ifram-modal',
  templateUrl: './aeroport-ifram-modal.component.html',
  styleUrls: ['./aeroport-ifram-modal.component.scss'],
  
})
export class AeroportIframModalComponent implements OnInit {
  safeUrl!: SafeResourceUrl;
  private url: string = 'https://infotaxi.parisaeroport.fr';

  constructor(private router: Router,private modalController: ModalController, private sanitizer: DomSanitizer) {}

  ngOnInit(): void {
    this.safeUrl = this.sanitizer.bypassSecurityTrustResourceUrl(this.url);
  }
  navigateToRoot() {
    this.router.navigate(['/map']);
  }
}

### END Ionic-project\src\app\aeroport-ifram-modal\aeroport-ifram-modal.component.ts ###

### BEGIN Ionic-project\src\app\aeroport-ifram-modal\aeroport-ifram-route.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';
import { AeroportIframModalComponent } from './aeroport-ifram-modal.component';



const routes: Routes = [
  {
    path: '',
    component: AeroportIframModalComponent
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AeroportIframRouteModule { }

### END Ionic-project\src\app\aeroport-ifram-modal\aeroport-ifram-route.module.ts ###

### BEGIN Ionic-project\src\app\aeroport-ifram-modal\aeroport-ifram.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { AeroportIframModalComponent } from './aeroport-ifram-modal.component';
import { IonicModule } from '@ionic/angular';
import { AeroportIframRouteModule } from './aeroport-ifram-route.module';
import {
  IonContent,
  IonHeader,
  IonTitle,
  IonToolbar,
  IonButtons,
  IonBackButton,
} from '@ionic/angular/standalone';
import { Routes } from '@angular/router';

const routes: Routes = [
  {
    path: '',
    component: AeroportIframModalComponent , 
  },
];

@NgModule({
  declarations: [AeroportIframModalComponent],
  imports: [
    CommonModule,
    IonicModule,
    AeroportIframRouteModule,
    IonContent,
    IonHeader,
    IonTitle,
    IonToolbar,
    IonButtons,
    IonBackButton,
  ],
  exports: [AeroportIframModalComponent]

})
export class AeroportIframModule { }

### END Ionic-project\src\app\aeroport-ifram-modal\aeroport-ifram.module.ts ###

### BEGIN Ionic-project\src\app\aeroport-modal\aeroport-modal-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { AeroportModalPage } from './aeroport-modal.page';

const routes: Routes = [
  {
    path: '',
    component: AeroportModalPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AeroportModalPageRoutingModule {}

### END Ionic-project\src\app\aeroport-modal\aeroport-modal-routing.module.ts ###

### BEGIN Ionic-project\src\app\aeroport-modal\aeroport-modal.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { AeroportModalPageRoutingModule } from './aeroport-modal-routing.module';

import { AeroportModalPage } from './aeroport-modal.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    AeroportModalPageRoutingModule
  ],
  declarations: [AeroportModalPage]
})
export class AeroportModalPageModule {}

### END Ionic-project\src\app\aeroport-modal\aeroport-modal.module.ts ###

### BEGIN Ionic-project\src\app\aeroport-modal\aeroport-modal.page.html ###
<div class="min-h-screen bg-gray-50 p-4">
  <!-- Header -->
  <div class="bg-white shadow-sm rounded-t-lg p-4">
    <div class="flex items-center justify-between">
      <h1 class="text-xl font-semibold text-gray-900">Modifier AÃ©roport</h1>
      <button 
        (click)="closeModal()"
        class="px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors"
      >
        Fermer
      </button>
    </div>
  </div>

  <!-- Main Form -->
  <div class="bg-white shadow-sm rounded-b-lg p-6 space-y-6">
    <!-- Airport Name -->
    <div class="space-y-2">
      <label class="block text-sm font-medium text-gray-700">
        Nom d'aÃ©roport
      </label>
      <input
        type="text"
        [value]="aeroport.name"
        readonly
        class="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
      >
    </div>

    <!-- Abbreviation -->
    <div class="space-y-2">
      <label class="block text-sm font-medium text-gray-700">
        AbrÃ©viation
      </label>
      <input
        type="text"
        [value]="aeroport.abbreviation"
        readonly
        class="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
      >
    </div>

    <!-- File Number (For airports other than ORLY) -->
    <div *ngIf="aeroport.abbreviation !== 'ORLY'" class="space-y-2">
      <label class="block text-sm font-medium text-gray-700">
        Nb file
      </label>
      <input
        type="text"
        [(ngModel)]="aeroport.nbFile"
        class="w-full px-3 py-2 border border-gray-200 rounded-md text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
      >
    </div>

    <!-- Orly-specific Fields -->
    <div *ngIf="aeroport.abbreviation === 'ORLY'">
      <div class="space-y-2">
        <label class="block text-sm font-medium text-gray-700">
          Nb de grande file
        </label>
        <input
          type="text"
          [(ngModel)]="aeroport.nbGrandeFile"
          class="w-full px-3 py-2 border border-gray-200 rounded-md text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
      </div>
      <div class="space-y-2 mt-6">
        <label class="block text-sm font-medium text-gray-700">
          Nb de petite file
        </label>
        <input
          type="text"
          [(ngModel)]="aeroport.nbPetiteFile"
          class="w-full px-3 py-2 border border-gray-200 rounded-md text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
      </div>
    </div>

    <!-- Van Number -->
    <div class="space-y-2">
      <label class="block text-sm font-medium text-gray-700">
        Nb de Van
      </label>
      <input
        type="number"
        [(ngModel)]="aeroport.nbVan"
        class="w-full px-3 py-2 border border-gray-200 rounded-md text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
      >
    </div>

    <!-- BAT Wait Time -->
    <div class="space-y-2">
      <label class="block text-sm font-medium text-gray-700">
        Attente BAT
      </label>
      <div class="flex items-center space-x-4">
        <div class="flex items-center">
          <input
            type="number"
            [(ngModel)]="aeroport.attenteBAT.split('h')[0]"
            class="w-20 px-3 py-2 border border-gray-200 rounded-md text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
          <span class="ml-2 text-gray-600">H</span>
        </div>
        <div class="flex items-center">
          <input
            type="number"
            [(ngModel)]="aeroport.attenteBAT.split(' ')[1]"
            class="w-20 px-3 py-2 border border-gray-200 rounded-md text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
          <span class="ml-2 text-gray-600">Min</span>
        </div>
      </div>
    </div>

    <!-- Save Button -->
    <button
      (click)="saveChanges()"
      class="w-full mt-6 px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
    >
      Enregistrer
    </button>
  </div>
</div>

### END Ionic-project\src\app\aeroport-modal\aeroport-modal.page.html ###

### BEGIN Ionic-project\src\app\aeroport-modal\aeroport-modal.page.scss ###
ion-list {
    padding: 10px;
    background-color: #f9f9f9;
    border-radius: 10px;
  }
  
  ion-item {
    --background: transparent;
    margin-bottom: 10px;
    border-radius: 5px;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
  }
  
  ion-label {
    font-size: 14px;
    font-weight: bold;
    color: #444;
  }
  
  ion-input {
    font-size: 14px;
  }
  
  ion-button {
    margin-top: 15px;
    border-radius: 8px;
    font-size: 16px;
  }
  
### END Ionic-project\src\app\aeroport-modal\aeroport-modal.page.scss ###

### BEGIN Ionic-project\src\app\aeroport-modal\aeroport-modal.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AeroportModalPage } from './aeroport-modal.page';

describe('AeroportModalPage', () => {
  let component: AeroportModalPage;
  let fixture: ComponentFixture<AeroportModalPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(AeroportModalPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\aeroport-modal\aeroport-modal.page.spec.ts ###

### BEGIN Ionic-project\src\app\aeroport-modal\aeroport-modal.page.ts ###
import { Component, Input } from '@angular/core';
import { LoadingController, ModalController } from '@ionic/angular';
import { ApiService } from '../services/api.service';
import { presentToast } from '../utiles/component/notification';

@Component({
  selector: 'app-aeroport-modal',
  templateUrl: './aeroport-modal.page.html',
  styleUrls: ['./aeroport-modal.page.scss'],
})
export class AeroportModalPage {
  @Input() aeroport: any;

  constructor(
    private modalController: ModalController,
    private apiService: ApiService,
    private loadingCtrl: LoadingController
  ) { }

  closeModal() {
    this.modalController.dismiss(null, 'cancel');
  }

  async saveChanges() {
    const loading = await this.loadingCtrl.create({ message: 'Sauvegarde...' });
    await loading.present();

    // The ngModel has already updated the `this.aeroport` object
    this.apiService.updateAirport(this.aeroport.id, this.aeroport).subscribe({
      next: (updatedAirport) => {
        loading.dismiss();
        presentToast('Modifications enregistrÃ©es avec succÃ¨s', 'bottom', 'success');
        this.modalController.dismiss(updatedAirport, 'confirm');
      },
      error: (err) => {
        loading.dismiss();
        presentToast('Erreur lors de la sauvegarde', 'bottom', 'danger');
        console.error('Error updating airport', err);
      }
    });
  }
}

### END Ionic-project\src\app\aeroport-modal\aeroport-modal.page.ts ###

### BEGIN Ionic-project\src\app\auth\new-password\new-password-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { NewPasswordPage } from './new-password.page';

const routes: Routes = [
  {
    path: '',
    component: NewPasswordPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class NewPasswordPageRoutingModule {}

### END Ionic-project\src\app\auth\new-password\new-password-routing.module.ts ###

### BEGIN Ionic-project\src\app\auth\new-password\new-password.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { NewPasswordPageRoutingModule } from './new-password-routing.module';

import { NewPasswordPage } from './new-password.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    NewPasswordPageRoutingModule
  ],
  declarations: [NewPasswordPage]
})
export class NewPasswordPageModule {}

### END Ionic-project\src\app\auth\new-password\new-password.module.ts ###

### BEGIN Ionic-project\src\app\auth\new-password\new-password.page.html ###
<div class="w-full h-[100vh] bg-[#F3F4F7] p-6 overflow-auto">
  <!-- head -->
  <div class="flex h-20 w-full py-5">
    <div (click)="signUp()" class="pt-1">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
    <div class=" px-4 text-[20px] font-bold leading-6 montserrat-700">CrÃ©er un nouveau mot de passe</div>
  </div>
  <!-- end head -->

    <div class="mt-2">
      <label class="pt-1 text-[13px] montserrat-600">Mot de passe <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Mot de passe</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
                    <img src="../../assets/icon/lock.svg" class="pr-1" alt="">
        </span>
        <input id="password" class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Mot de passe" type="password" name="password" />
        <span (click)="showPassword('password')" class="absolute inset-y-0 right-0 flex items-center pr-3 text-[#879EA4]">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
          </svg>
        </span>
      </label>
    </div>

    <div class="mt-2">
      <label class="pt-1 text-[13px] montserrat-600">Confirmation de mot de passe <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Confirmation de mot de passe</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
                    <img src="../../assets/icon/lock.svg" class="pr-1" alt="">
        </span>
        <input id="confirmation" class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Mot de passe" type="password" name="password" />
        <span (click)="showPassword('confirmation')" class="absolute inset-y-0 right-0 flex items-center pr-3 text-[#879EA4]">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
          </svg>
        </span>
      </label>
    </div>


    <div class="flex items-center py-10">
      <button (click)="createPassword()" class="h-9 w-full rounded-xl bg-[#1D4999] text-[13px] montserrat-600 tracking-wide text-white">Valider</button>
    </div>
   

  <!-- end inputs -->
</div>
### END Ionic-project\src\app\auth\new-password\new-password.page.html ###

### BEGIN Ionic-project\src\app\auth\new-password\new-password.page.scss ###
### END Ionic-project\src\app\auth\new-password\new-password.page.scss ###

### BEGIN Ionic-project\src\app\auth\new-password\new-password.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { NewPasswordPage } from './new-password.page';

describe('NewPasswordPage', () => {
  let component: NewPasswordPage;
  let fixture: ComponentFixture<NewPasswordPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(NewPasswordPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\auth\new-password\new-password.page.spec.ts ###

### BEGIN Ionic-project\src\app\auth\new-password\new-password.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';

@Component({
  selector: 'app-new-password',
  templateUrl: './new-password.page.html',
  styleUrls: ['./new-password.page.scss'],
})
export class NewPasswordPage implements OnInit {

  constructor(private router:Router) { }

  ngOnInit() {
  }

  createPassword(){
    
  }

  showPassword(id:string){
    const input = document.getElementById(id);
    
    if (input?.attributes.getNamedItem('type')?.value == "password"){
      input.setAttribute("type", "text");
      return;
    }
    input!.setAttribute("type", "password");
    
  }

  signUp(){
    this.router.navigate(['/sign-up'])
  }
}

### END Ionic-project\src\app\auth\new-password\new-password.page.ts ###

### BEGIN Ionic-project\src\app\auth\password-forgotten\password-forgotten-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { PasswordForgottenPage } from './password-forgotten.page';

const routes: Routes = [
  {
    path: '',
    component: PasswordForgottenPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class PasswordForgottenPageRoutingModule {}

### END Ionic-project\src\app\auth\password-forgotten\password-forgotten-routing.module.ts ###

### BEGIN Ionic-project\src\app\auth\password-forgotten\password-forgotten.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { PasswordForgottenPageRoutingModule } from './password-forgotten-routing.module';

import { PasswordForgottenPage } from './password-forgotten.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    PasswordForgottenPageRoutingModule
  ],
  declarations: [PasswordForgottenPage]
})
export class PasswordForgottenPageModule {}

### END Ionic-project\src\app\auth\password-forgotten\password-forgotten.module.ts ###

### BEGIN Ionic-project\src\app\auth\password-forgotten\password-forgotten.page.html ###
<div class="w-full h-[100vh] bg-[#F3F4F7] p-6 overflow-auto">
  <!-- head -->
  <div class="flex h-20 w-full py-5">
    <div (click)="signUp()" class="pt-1">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
    <div class=" px-4 text-[20px] font-bold leading-6 montserrat-700">Mot de passe oubliÃ©</div>
  </div>
  <!-- end head -->

    <div class="mt-2 text-center leading-[13px]">
      <span class="text-[12px] montserrat-400 ">Saisissez votre adresse Ã©lectronique et nous vous enverrons le lien de rÃ©cupÃ©ration.</span>
    </div>

    <div class="mt-2">
      <label class="text-[13px] montserrat-600">Email <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Email</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/email.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Email" type="text" name="username" />
      </label>
    </div>


    <div class="flex items-center py-10">
      <button (click)="sendMail()" class="h-9 w-full rounded-xl bg-[#1D4999] text-[13px] montserrat-600 tracking-wide text-white">Envoyer</button>
    </div>
   

  <!-- end inputs -->
</div>
### END Ionic-project\src\app\auth\password-forgotten\password-forgotten.page.html ###

### BEGIN Ionic-project\src\app\auth\password-forgotten\password-forgotten.page.scss ###
### END Ionic-project\src\app\auth\password-forgotten\password-forgotten.page.scss ###

### BEGIN Ionic-project\src\app\auth\password-forgotten\password-forgotten.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { PasswordForgottenPage } from './password-forgotten.page';

describe('PasswordForgottenPage', () => {
  let component: PasswordForgottenPage;
  let fixture: ComponentFixture<PasswordForgottenPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(PasswordForgottenPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\auth\password-forgotten\password-forgotten.page.spec.ts ###

### BEGIN Ionic-project\src\app\auth\password-forgotten\password-forgotten.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';

@Component({
  selector: 'app-password-forgotten',
  templateUrl: './password-forgotten.page.html',
  styleUrls: ['./password-forgotten.page.scss'],
})
export class PasswordForgottenPage implements OnInit {

  constructor(private router:Router) { }

  ngOnInit() {
  }

  

  signUp(){
    this.router.navigate(['/sign-up'])
  }

  sendMail(){
    this.router.navigate(['/new-password'])
  }
}

### END Ionic-project\src\app\auth\password-forgotten\password-forgotten.page.ts ###

### BEGIN Ionic-project\src\app\auth\sign-in\sign-in-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { SignInPage } from './sign-in.page';

const routes: Routes = [
  {
    path: '',
    component: SignInPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class SignInPageRoutingModule {}

### END Ionic-project\src\app\auth\sign-in\sign-in-routing.module.ts ###

### BEGIN Ionic-project\src\app\auth\sign-in\sign-in.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { SignInPageRoutingModule } from './sign-in-routing.module';

import { SignInPage } from './sign-in.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    SignInPageRoutingModule,
    FormsModule
  ],
  declarations: [SignInPage]
})
export class SignInPageModule {}

### END Ionic-project\src\app\auth\sign-in\sign-in.module.ts ###

### BEGIN Ionic-project\src\app\auth\sign-in\sign-in.page.html ###
<div class="h-[100vh] w-full bg-[#F3F4F7] p-8">
  <!-- head -->
  <ion-row class="flex h-20 w-full mt-10 mb-5">
    <!-- <div (click)="back()" class="pt-1.5">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div> -->
    <div class=" pl-4 text-[24px] montserrat-700 leading-9">AccÃ©der Ã  mon <br/>compte</div>
  </ion-row>
  <!-- end head -->

  <!-- inputs -->
  <div class="my-4">
    <ion-label class="relative block text-[14px]" [ngClass]="{'mt-3': error_messages[0].display || error_messages[2].display, 'py-3': !error_messages[0].display && !error_messages[2].display}">
      <span class="sr-only">username</span>
      <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
       <img src="../../assets/icon/user.svg" alt="">
      </span>
      <input class="raleway-500 block w-full rounded border border-[#00396542] raleway-500 bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Email" type="email" name="username" [(ngModel)]="email" />
    </ion-label>
    <div class="flex flex-col">
      <span  *ngIf="error_messages[0].display" class="text-red-600 font-bold text-[10px]">{{error_messages[0].message}}</span>
      <span *ngIf="error_messages[2].display" class="text-red-600 font-bold text-[10px]">{{error_messages[2].message}}</span>
    </div>

    <label class="relative block text-[14px]" [ngClass]="{'mt-3': error_messages[1].display, 'py-3': !error_messages[1].display}">
      <span class="sr-only">password</span>
      <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
        <img src="../../assets/icon/lock.svg" alt="">
      </span>
      <input id="passwordLogin" class="block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] raleway-500 focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Mot de passe" type="password" name="password" [(ngModel)]="password"/>
       <span (click)="showPassword()" class="absolute inset-y-0 right-0 flex items-center pr-4 text-[#879EA4]">
        <img src="../../assets/icon/eye.svg" alt="">
      </span>
    </label>
    <div *ngIf="error_messages[1].display" class="flex flex-col">
      <span class="text-red-600 font-bold text-[10px]">{{error_messages[1].message}}</span>
    </div>
    <div class="mx-1 flex items-center my-4">
      <input class="h-5 w-5" type="checkbox" name="" id="" />
      <label class="px-2 text-[12px] raleway-700 text-[#02263D]">Me connecter automatiquement</label>
    </div>

    <div class="flex items-center py-2">
      <button (click)="login()" class="h-11 w-full rounded-xl bg-[#1D4999] active:bg-[#193d81] text-[14px] montserrat-700 tracking-wide text-white">Se connecter</button>
    </div>
    <div class="py-2 text-center">
      <a routerLink="/password-forgotten" class="px-2 text-[12px] raleway-700 text-[#02263D]"><u>Mot de passe oubliÃ© ?</u></a>
    </div>
  </div>
  <!-- end inputs -->

  <!-- ou separation -->
  <div class="flex items-center justify-center py-5">
    <div class="w-[33vw] border"></div>
    <label class="font-semibold px-4 text-[14px] text-[#879EA4] font-[Montserrat]">OU</label>
    <div class="w-[33vw] border"></div>
  </div>
  <!-- end separation -->

  <!-- register -->
  <div class="flex flex-col items-center py-5">
    <label class="px-2 text-[#02263D] text-[12px] raleway-600">Vous n'avez pas de compte ?</label>
    <ion-button color="to-transparent" style=" text-transform: none;" (click)="regester()" class="h-11 w-full rounded-xl bg-[#1d489920] active:bg-[#1d48993d] border-2 border-[#1D4999] text-[14px] montserrat-700 tracking-wide text-[#1D4999] my-6">S'inscrire</ion-button>
  </div>
  <!-- end register -->
</div>

### END Ionic-project\src\app\auth\sign-in\sign-in.page.html ###

### BEGIN Ionic-project\src\app\auth\sign-in\sign-in.page.scss ###
### END Ionic-project\src\app\auth\sign-in\sign-in.page.scss ###

### BEGIN Ionic-project\src\app\auth\sign-in\sign-in.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { SignInPage } from './sign-in.page';

describe('SignInPage', () => {
  let component: SignInPage;
  let fixture: ComponentFixture<SignInPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(SignInPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\auth\sign-in\sign-in.page.spec.ts ###

### BEGIN Ionic-project\src\app\auth\sign-in\sign-in.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';
import { ProfilService } from 'src/app/utiles/services/profil/profil.service';
import { presentToast } from 'src/app/utiles/component/notification';

@Component({
  selector: 'app-sign-in',
  templateUrl: './sign-in.page.html',
  styleUrls: ['./sign-in.page.scss'],
})
export class SignInPage implements OnInit {
  email:string = '';
  password:string = '';

  error_messages:any = [
    {message:"Email est Obligatoire.", display:false},
    {message:"Pssword est Obligatoire.", display:false},
    {message:"please enter the correct email format!", display:false},
  ]

  constructor(private router:Router, private authService:ProfilService) { }

  ngOnInit() {
  }

  showPassword(){
    const input = document.getElementById("passwordLogin");

    if (input?.attributes.getNamedItem('type')?.value == "password"){
      input.setAttribute("type", "text");
      return;
    }
    input!.setAttribute("type", "password");

  }

  async login (){
    this.validation();
    
    // Test network connectivity first
    console.log('ðŸŒ Testing network connectivity...');
    try {
      const testResponse = await fetch('https://www.google.com', { mode: 'no-cors' });
      console.log('âœ… Network test successful');
      
      // Test if our server is reachable
      console.log('ðŸŒ Testing server connectivity...');
      try {
        const serverTest = await fetch('https://alik144.sg-host.com', { mode: 'no-cors' });
        console.log('âœ… Server test successful');
      } catch (serverError) {
        console.error('âŒ Server test failed:', serverError);
        presentToast('âŒ Cannot reach server', 'bottom', 'danger');
        return;
      }
    } catch (error) {
      console.error('âŒ Network test failed:', error);
      presentToast('âŒ No internet connection detected', 'bottom', 'danger');
      return;
    }
    
    this.authService.$login(this.email, this.password).subscribe(
      (data:any) => {
        console.log("data " + JSON.stringify(data));

        if(data.message == 'ok'){
          localStorage.setItem('apiToken', data.token);
          if(!localStorage.getItem('onpoarding')){
            localStorage.setItem('onpoarding', '0');
            localStorage.setItem('skipPub', '0');
          }

          if(!localStorage.getItem('skipPub')){
            localStorage.setItem('skipPub', '0');
          }

          this.authService.$userinfo = data.user_info
          this.authService.$friendsList = data.user_info?.friends;
          this.email = ''
          this.password = ''
          this.router.navigate(["/gpsaccess"]);
        }else{
          presentToast('user or password incorrect', 'bottom', 'danger')
        }
      },

      err =>  {
        console.error('Login error details:', err);
        if (err.status == 403) {
          presentToast('erreur : \n ' + (err.error?.message || 'No message'), 'bottom', 'danger')
        }else if(err.status == 401){
          presentToast('user or password incorrect \n '+(err.error?.message || 'No message'), 'bottom', 'danger')
        }else{
          presentToast(`erreur depuis le serveur \nStatus: ${err.status}\nError: ${JSON.stringify(err.error)}\nMessage: ${err.message}`, 'bottom', 'danger')
        }
      })
  }

  validation(){
   this.error_messages.map((el:any) => el.display = false);

    if(this.email == ""){
      this.error_messages[0].display = true;
    }

    if(this.email != "" && this.isNotEmail(this.email)){
      this.error_messages[2].display = true;
    }

    if(this.password == ""){
      this.error_messages[1].display = true;
    }
  }

  regester(){
    this.router.navigate(["/sign-up"])
  }

  isNotEmail(email: string): boolean {
    const pattern: RegExp = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    console.log(!pattern.test(email));
    return !pattern.test(email);
  }
}

### END Ionic-project\src\app\auth\sign-in\sign-in.page.ts ###

### BEGIN Ionic-project\src\app\auth\sign-up\sign-up-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { SignUpPage } from './sign-up.page';

const routes: Routes = [
  {
    path: '',
    component: SignUpPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class SignUpPageRoutingModule {}

### END Ionic-project\src\app\auth\sign-up\sign-up-routing.module.ts ###

### BEGIN Ionic-project\src\app\auth\sign-up\sign-up.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { SignUpPageRoutingModule } from './sign-up-routing.module';

import { SignUpPage } from './sign-up.page';
import { ShareModule } from 'src/app/utiles/share/share.module';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    SignUpPageRoutingModule,
    ShareModule
  ],
  declarations: [SignUpPage]
})
export class SignUpPageModule {}

### END Ionic-project\src\app\auth\sign-up\sign-up.module.ts ###

### BEGIN Ionic-project\src\app\auth\sign-up\sign-up.page.html ###
<div class="w-full h-[100vh] bg-[#F3F4F7] p-6 overflow-auto">
  <!-- head -->
  <div class="flex h-20 w-full py-5">
    <div (click)="back()" class="pt-1">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
    <div class=" px-4 text-[24px] font-bold leading-6 montserrat-700">CrÃ©er un compte</div>
  </div>
  <!-- end head -->

  <!-- radiobox div -->
  <div>
    <label class="text-[13px] montserrat-600">Sâ€™inscrire en tant que <span class="text-red-600">*</span></label>
    <div class="mt-1 flex h-10 w-full justify-center rounded-3xl">
      <div class="flex w-[47%] items-center justify-center rounded-l-3xl " [ngClass]="{'bg-[#02263d2d] ': registerAs != registerAs1.value, 'bg-[#1D4999] text-white':  registerAs == registerAs1.value}">
        <input  type="radio" name="inscrire" value="organisateur" class="h-4 w-4" #registerAs1 (change)="changeRegisterAs(registerAs1)" />
        <span  class="pl-1 text-[11px] poppins-regular ">Organisateur</span>
      </div>
      <div class="flex w-[53%] items-center justify-center rounded-r-3xl" [ngClass]="{'bg-[#02263d2d] ': registerAs != registerAs2.value, 'bg-[#1D4999] text-white':  registerAs == registerAs2.value}">
        <input checked type="radio" name="inscrire" value="chauffeur" class="h-4 w-4" #registerAs2 (change)="changeRegisterAs(registerAs2)" />
        <label class="pl-1 text-[11px] poppins-regular">Chauffeur de taxi</label>
      </div>
    </div>
  </div>
  <!-- radiobox div -->

  <!-- image div -->

  <div class="mt-1 w-full">
    <label class="text-[13px] montserrat-600">Photo de profil</label>
    <div class="mt-1 flex items-center">
      <div class="w-[18vw]">
        <img class="rounded-2xl" [src]="error_messages_global[0].input || 'https://media.istockphoto.com/id/1327592506/vector/default-avatar-photo-placeholder-icon-grey-profile-picture-business-man.jpg?s=612x612&w=0&k=20&c=BpR0FVaEa5F24GIw7K8nMWiiGmbb8qmhfkpXcp1dhQg=' " />
      </div>
      <div class="px-3">
        <div>
          <button (click)="getPhoto('profil')" class="flex h-9 w-[40vw] items-center justify-center rounded-md bg-[#808E9B1A] active:bg-[#808e9b37] text-[13px] montserrat-700 tracking-wide text-[#808E9B]">
            <span class="px-1">
              <img src="../../assets/icon/load.svg" class="pr-1" alt="">
            </span>Changer
          </button>
        </div>
        <div>
          <span class="montserrat-400 text-[10px] font-light text-[#2D3748]">Largeur 300px â˜“ Hauteur 300px</span>
        </div>
      </div>
    </div>
    <div class="flex flex-col">
      <span  *ngIf="error_messages_global[0].display" class="text-red-600 font-bold text-[10px]">{{error_messages_global[0].message}}</span>
    </div>
  </div>
  <!-- image div -->

  <!-- inputs -->
  <div class="my-4 ">
    <div *ngIf="registerAs != 'chauffeur'" >
      <label class="text-[13px] montserrat-600">Nom de lâ€™Ã©tablissement <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Nom de lâ€™Ã©tablissement</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/user.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Nom de lâ€™Ã©tablissement" type="text" name="etablissement" [(ngModel)]="error_messages_organizateur[0].input" />
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_organizateur[0].display" class="text-red-600 font-bold text-[10px]">{{error_messages_organizateur[0].message}}</span>
      </div>
    </div>

    <div *ngIf="registerAs == 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">Pseudo <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Pseudo</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/user.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Pseudo" type="text" name="pseudo" [(ngModel)]="error_messages_chauffeur[0].input" />
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_chauffeur[0].display" class="text-red-600 font-bold text-[10px]">{{error_messages_chauffeur[0].message}}</span>
      </div>
    </div>

    <div class="mt-2">
      <label class="text-[13px] montserrat-600">Nom <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Nom</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/user.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Nom" type="text" name="nom" [(ngModel)]="error_messages_global[1].input" />
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_global[1].display" class="text-red-600 font-bold text-[10px]">{{error_messages_global[1].message}}</span>
      </div>
    </div>

    <div class="mt-2">
      <label class="text-[13px] montserrat-600">PrÃ©nom <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">PrÃ©nom</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/user.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="PrÃ©nom" type="text" name="prenom" [(ngModel)]="error_messages_global[2].input" />
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_global[2].display" class="text-red-600 font-bold text-[10px]">{{error_messages_global[2].message}}</span>
      </div>
    </div>

    <div *ngIf="registerAs == 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">VÃ©hicule <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">VÃ©hicule</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/car.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Marque, modÃ¨le" type="text" name="vehicule" [(ngModel)]="error_messages_chauffeur[1].input" />
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_chauffeur[1].display" class="text-red-600 font-bold text-[10px]">{{error_messages_chauffeur[1].message}}</span>
      </div>
    </div>

    <div *ngIf="registerAs == 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">CatÃ©gories <span class="text-red-600">*</span></label>
      <div class="mt-1 flex h-10 w-full">
        <div class="mr-2 flex w-[45%] items-center rounded-3xl px-5" [ngClass]="{'bg-[#1D4999] text-white' : categorie == cat1.value, 'bg-[#02263d2d]': categorie != cat1.value}">
          <input type="radio" name="operator" value="van" class="h-4 w-4" #cat1 (change)="changeCategorie(cat1)" />
          <label class="pl-1 text-[11px]  poppins-regular">Van</label>
        </div>
        <div class="flex w-[45%] items-center rounded-3xl px-5" [ngClass]="{'bg-[#1D4999] text-white' :this.categorie == cat2.value, 'bg-[#02263d2d]': categorie != cat2.value}">
          <input checked type="radio" name="operator" value="berline" class="h-4 w-4" #cat2 (change)="changeCategorie(cat2)" />
          <span class="pl-1 text-[11px] poppins-regular">berline</span>
        </div>
      </div>
    </div>

    <div *ngIf="registerAs != 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">Adresse <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Adresse</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/mark.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Adresse" type="text" name="address" [(ngModel)]="error_messages_organizateur[1].input" />
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_organizateur[1].display" class="text-red-600 font-bold text-[10px]">{{error_messages_organizateur[1].message}}</span>
      </div>
    </div>

    <div *ngIf="registerAs == 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">NumÃ©ro de la carte professionnelle <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">NumÃ©ro de la carte professionnelle</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/car.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="NÂ° de carte professionnelle" type="text" name="card" [(ngModel)]="error_messages_chauffeur[4].input"/>
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_chauffeur[4].display" class="text-red-600 font-bold text-[10px]">{{error_messages_chauffeur[4].message}}</span>
      </div>
    </div>

    <div *ngIf="registerAs == 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">Photo recto de carte professionnelle <span class="text-red-600">*</span></label>
      <div *ngIf="imagePreviewRecto">
        <img [src]="imagePreviewRecto" alt="Recto Preview" class=" mx-auto my-2 w-2/3 object-cover " style="height: 80px;">
      </div>

       <button (click)="choiceModal('recto')" class="h-11 w-[65vw] rounded-xl bg-[#1d48991d] text-[13px]  montserrat-700 tracking-wide text-[#1D4999] flex items-center justify-center">
        <span class="px-2">
          <img src="../../assets/icon/upload.svg" class="pr-1" alt="">
          </span>Charger une photo recto
        </button>
        <div class="flex flex-col">
          <span  *ngIf="error_messages_chauffeur[2].display" class="text-red-600 font-bold text-[10px]">{{error_messages_chauffeur[2].message}}</span>
        </div>
    </div>

    <div *ngIf="registerAs == 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">Photo verso de carte professionnelle <span class="text-red-600">*</span></label>
      <div *ngIf="imagePreviewVerso">
        <img [src]="imagePreviewVerso" alt="Verso Preview" class=" mx-auto my-2 w-2/3 object-cover " style="height: 80px;">
      </div>
      <button (click)="choiceModal('verso')" class="h-11 w-[65vw] rounded-xl bg-[#1d48991d] text-[13px] tracking-wide text-[#1D4999] flex items-center justify-center">
        <span class="px-2">
          <img src="../../assets/icon/upload.svg" class="pr-1" alt="">

        </span>Charger une photo verso
        </button>
        <div class="flex flex-col">
          <span  *ngIf="error_messages_chauffeur[3].display" class="text-red-600 font-bold text-[10px]">{{error_messages_chauffeur[3].message}}</span>
        </div>
    </div>

    <div class="mt-2">
      <label class="text-[13px] montserrat-600">Email <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Email</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/email.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Email" type="text" name="email" [(ngModel)]="error_messages_global[3].input" />
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_global[3].display" class="text-red-600 font-bold text-[10px]">{{error_messages_global[3].message}}</span>
        <span *ngIf="error_messages_global[4].display" class="text-red-600 font-bold text-[10px]">{{error_messages_global[4].message}}</span>
      </div>
    </div>

    <div class="mt-2">
      <label class="pt-1 text-[13px] montserrat-600">Mot de passe <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Mot de passe</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
                    <img src="../../assets/icon/lock.svg" class="pr-1" alt="">
        </span>
        <input id="password" class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Mot de passe" type="password" name="password" [(ngModel)]="error_messages_global[5].input" />
        <span (click)="showPassword('password')" class="absolute inset-y-0 right-0 flex items-center pr-3 text-[#879EA4]">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
          </svg>
        </span>
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_global[5].display" class="text-red-600 font-bold text-[10px]">{{error_messages_global[5].message}}</span>
      </div>
    </div>

    <div class="mt-2">
      <label class="pt-1 text-[13px] montserrat-600">Confirmation de mot de passe <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Confirmation de mot de passe</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/lock.svg" class="pr-1" alt="">
        </span>
        <input id="confirm" class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Mot de passe" type="password" name="password" [(ngModel)]="error_messages_global[6].input"/>
        <span (click)="showPassword('confirm')" class="absolute inset-y-0 right-0 flex items-center pr-3 text-[#879EA4]">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
          </svg>
        </span>
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_global[6].display" class="text-red-600 font-bold text-[10px]">{{error_messages_global[6].message}}</span>
        <span  *ngIf="error_messages_global[7].display" class="text-red-600 font-bold text-[10px]">{{error_messages_global[7].message}}</span>
      </div>
    </div>

    <div class="mx-1 flex items-center py-3">
      <input class="h-4 w-4" type="checkbox" name="" #condition  (change)="accepteCondition(condition)"/>
      <label class="px-2 text-[10px] montserrat-600 text-[#02263D]">Jâ€™accepte <span (click)="error_messages_global[8].input = 'accepted'" class="text-[#1D4999]"><u>les conditions gÃ©nÃ©rale</u></span>.</label>
    </div>
    <div class="flex flex-col">
      <span  *ngIf="error_messages_global[8].display" class="text-red-600 font-bold text-[10px]">{{error_messages_global[8].message}}</span>
    </div>

    <div class="flex flex-col">
      <span  *ngIf="messageErroshow != ''" class="text-red-600 font-bold text-[10px]">{{messageErroshow}}</span>
    </div>

    <div class="flex items-center py-2">
      <button (click)="saveUser()" class="h-9 w-full rounded-xl bg-[#1D4999] text-[13px] montserrat-600 tracking-wide text-white">Sâ€™inscrire</button>
    </div>
    <div class="py-2 text-center">
      <a (click)="back()" class="ju px-2 text-[10px] montserrat-600 text-[#02263D]">Vous avez dÃ©jÃ  un compte ? <u class="text-[#1D4999]">Se connecter</u></a>
    </div>
  </div>
  <!-- end inputs -->

  <app-image-source-modal *ngIf="sourceModal" (choice)="choiceMethod($event)" (closeModal)="choiceModal('')"></app-image-source-modal>
</div>

### END Ionic-project\src\app\auth\sign-up\sign-up.page.html ###

### BEGIN Ionic-project\src\app\auth\sign-up\sign-up.page.scss ###
### END Ionic-project\src\app\auth\sign-up\sign-up.page.scss ###

### BEGIN Ionic-project\src\app\auth\sign-up\sign-up.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { SignUpPage } from './sign-up.page';

describe('SignUpPage', () => {
  let component: SignUpPage;
  let fixture: ComponentFixture<SignUpPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(SignUpPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\auth\sign-up\sign-up.page.spec.ts ###

### BEGIN Ionic-project\src\app\auth\sign-up\sign-up.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';
import { Camera, CameraOptions } from '@awesome-cordova-plugins/camera/ngx';
import { Camera as CapacitorCamera, CameraResultType, CameraSource } from '@capacitor/camera';
import { Platform } from '@ionic/angular';
import { presentToast } from 'src/app/utiles/component/notification';
import { ProfilService } from 'src/app/utiles/services/profil/profil.service';


@Component({
  selector: 'app-sign-up',
  templateUrl: './sign-up.page.html',
  styleUrls: ['./sign-up.page.scss'],
})
export class SignUpPage implements OnInit {
  accepteCondition(value:any) {
    if(value.checked){
      this.error_messages_global[8].display = false;
      this.error_messages_global[8].input = 'accepted';
      console.log('');
    }else if(!value.checked){
      this.error_messages_global[8].display = true;
      this.error_messages_global[8].input = '';
    }
  }

    imagePreviewRecto: string | ArrayBuffer | null = null;
    imagePreviewVerso: string | ArrayBuffer | null = null;


    registerAs:string = "chauffeur";
    categorie:string = 'berline';
    messageErroshow:string = "";

    imageProfile:string = ''
    imageRecto:string = ''
    imageVerso:string = ''

    error_messages_chauffeur:any = [
      /*0*/ {name: "pseudo",message:"Pseudo est obligatoire.", display:false, input:''},
      /*1*/ {name: "brand",message:"La vehicule information est obligatoire.", display:false, input:''},
      /*2*/ {name: "recto",message:"La photo recto de la carte est obligatoire.", display:false, input:''},
      /*3*/ {name: "verso",message:"La photo verso de la carte est obligatoire.", display:false, input:''},
      /*4*/ {name: "carte",message:"Numero de la carte est obligatoire.", display:false, input:''},
    ];

    error_messages_organizateur:any = [
      /*0*/ {name: "organization",message:"Le nom d'Ã©tablissement est obligatoire.", display:false, input:''},
      /*1*/ {name: "address",message:"L'adresse d'Ã©tablissement est obligatoire.", display:false, input:''},
    ];

    error_messages_global = [
      /*0*/ {name: "image",message:"La taille d'image doit avoir 300px X 300px.", display:false, input:'https://media.istockphoto.com/id/1327592506/vector/default-avatar-photo-placeholder-icon-grey-profile-picture-business-man.jpg?s=612x612&w=0&k=20&c=BpR0FVaEa5F24GIw7K8nMWiiGmbb8qmhfkpXcp1dhQg='},
      /*1*/ {name: "lastname",message:"Le nom est obligatoire.", display:false, input:''},
      /*2*/ {name: "firstname",message:"Le prenom est obligatoire.", display:false, input:''},
      /*3*/ {name: "email",message:"L'email est obligatoire", display:false, input:''},
      /*4*/ {name: "emailformat",message:"veuillez entrer le format d'e-mail correct !", display:false, input:'email format'},
      /*5*/ {name: "password",message:"Le mot de passe est obligatoire.", display:false, input:''},
      /*6*/ {name: "passConfirm",message:"Confirmation du mot de passe est obligatoire.", display:false, input:''},
      /*7*/ {name: "passMatching",message:"les mots de passe ne correspondent pas ! ", display:false, input:'mating password'},
      /*8*/ {name: "condition",message:"l'acceptation des conditions du contrat est requise", display:false, input:''},
    ]

    sourceModal:boolean= false
    sourceChoice:string=''

    constructor(
      private router:Router,
      private camera:Camera,
      private platform:Platform,
      private authService:ProfilService
    ) { }

    ngOnInit() {
    }

    choiceModal(choice:string){
      this.sourceModal = !this.sourceModal;
      if(this.sourceModal){
        this.sourceChoice = choice
      }else{
        this.sourceChoice = ''
      }

      console.log('from : ' + this.sourceChoice);

    }

    choiceMethod(choice:any){
      console.log(choice + ' ------> ' + this.sourceChoice);

      switch (choice) {
        case 'takePic':
          this.takePhoto(this.sourceChoice);
          break;

        case 'getPic':
          this.getPhoto(this.sourceChoice);
          break;
        default:
          break;
      }
    }

    async takePhoto(document:string) {
      if (this.platform.is('capacitor') || this.platform.is('cordova')) {
        try {
          const image = await CapacitorCamera.getPhoto({
            quality: 30,
            allowEditing: false,
            resultType: CameraResultType.DataUrl,
            source: CameraSource.Camera, // This opens camera
          });
          
          console.log('Capacitor camera data received');
          this.handlePhotoResult(image.dataUrl!, document);
        } catch (error) {
          console.log('Capacitor camera error:', error);
          presentToast('Erreur lors de la prise de photo', 'bottom', 'danger');
        }
      } else {
        this.takePhotoWeb(document);
      }
    }

    takePhotoWeb(document: string) {
      const input = (window.document as Document).createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.capture = 'environment';
      
      input.onchange = (event: any) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e: any) => {
            this.handlePhotoResult(e.target.result, document);
          };
          reader.readAsDataURL(file);
        }
      };
      
      input.click();
    }


    async getPhoto(document:string) {
      if (this.platform.is('capacitor') || this.platform.is('cordova')) {
        try {
          const image = await CapacitorCamera.getPhoto({
            quality: 30,
            allowEditing: false,
            resultType: CameraResultType.DataUrl,
            source: CameraSource.Photos, // This opens gallery
          });
          
          console.log('Capacitor image data received');
          this.handlePhotoResult(image.dataUrl!, document);
        } catch (error) {
          console.log('Capacitor camera error:', error);
          presentToast('Erreur lors de la sÃ©lection de l\'image', 'bottom', 'danger');
        }
      } else {
        this.getPhotoWeb(document);
      }
    }

    getPhotoWeb(document: string) {
      const input = (window.document as Document).createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      
      input.onchange = (event: any) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e: any) => {
            this.handlePhotoResult(e.target.result, document);
          };
          reader.readAsDataURL(file);
        }
      };
      
      input.click();
    }

    handlePhotoResult(base64Image: string, document: string) {
      if(document == 'recto'){
        this.imagePreviewRecto = base64Image;
        this.error_messages_chauffeur[2].input = base64Image;
      }else if(document == 'verso'){
        this.imagePreviewVerso = base64Image;
        this.error_messages_chauffeur[3].input = base64Image;
      }else if(document == 'profil'){
        this.error_messages_global[0].input = base64Image;
      }
      
      this.sourceModal = false;
    }


    back(){
      this.router.navigate(["/sign-in"])
    }

    validation(){
      this.error_messages_chauffeur.map((el:any) => el.display = false);
      this.error_messages_global.map((el:any) => el.display = false);
      this.error_messages_organizateur.map((el:any) => el.display = false);
      if(this.registerAs == "chauffeur"){
        console.log('i\'m in chauffeur condition. array length is :' + this.error_messages_chauffeur.length);

        for(let i=0; i < this.error_messages_chauffeur.length; i++){
          console.log('this '+this.error_messages_chauffeur[i].name+' value : '+ this.error_messages_chauffeur[i].input);
          if(i == 1) continue; // Skip brand validation for now
          
          if(this.error_messages_chauffeur[i].input == "") {
            this.error_messages_chauffeur[i].display = true;
          }
        }

      }else if(this.registerAs == 'organisateur'){
        console.log('i\'m in organisateur condition. array length is :' + this.error_messages_organizateur.length);

        for(let i=0; i < this.error_messages_organizateur.length; i++){
          console.log('this '+this.error_messages_organizateur[i].name+' value : '+ this.error_messages_organizateur[i].input);
          if(this.error_messages_organizateur[i].input == ""){
            this.error_messages_organizateur[i].display = true;
          }
        }
      }

      for(let i=0; i<=this.error_messages_global.length-1;i++){
        if(i==3){
          if(this.error_messages_global[i].input != "" && this.isNotEmail(this.error_messages_global[i].input)){
            this.error_messages_global[i+1].display = true;
          }
        }if(i==5){
          if(this.error_messages_global[i].input == ''){
            this.error_messages_global[i].display = true;
          }

          if(this.error_messages_global[i].input !== this.error_messages_global[i+1].input){
            this.error_messages_global[i+2].display = true;
          }
        }else {
          if(this.error_messages_global[i].input == "" ){
            this.error_messages_global[i].display = true;
          }
        }
      }
      const allEqual = (arr:any) => arr.every((error:any) => error.input !== "");
      
      // Custom validation for chauffeur images
      const chauffeurValid = () => {
        const basicFieldsValid = this.error_messages_chauffeur.every((error:any, index:number) => {
          if(index == 1) return true; // Skip brand validation
          return error.input !== "";
        });
        return basicFieldsValid;
      };
      
      console.log(this.error_messages_global);

      if(this.registerAs == "chauffeur"){
        console.log(this.error_messages_chauffeur);
        console.log('imageRecto:', this.imageRecto, 'imageVerso:', this.imageVerso);

        return chauffeurValid() && allEqual(this.error_messages_global);
      }else if(this.registerAs == 'organisateur'){
        console.log(this.error_messages_organizateur);
        return allEqual(this.error_messages_organizateur) && allEqual(this.error_messages_global);
      }

    }

    changeRegisterAs(value:any){
      console.log("this is the value Role : " + value.value)
      this.clearInputs()
      this.registerAs = value.value;
    }

    changeCategorie(value:any){
      // console.log("this is the value of Categorie : " + value.value)
      this.categorie = value.value;
    }

    isNotEmail(email: string): boolean {
      const pattern: RegExp = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      console.log(!pattern.test(email));
      return !pattern.test(email);
    }

    clearInputs(){
      this.error_messages_chauffeur.map((el:any) => el.display = false);
      this.error_messages_organizateur.map((el:any) => el.display = false);
      this.error_messages_global.map((el:any) => el.display = false);

    }

    showPassword(id:string){
      const input = document.getElementById(id);

      if (input?.attributes.getNamedItem('type')?.value == 'password'){
        input.setAttribute("type", "text");
        return;
      }else if(input?.attributes.getNamedItem('type')?.value == 'confirm'){
        input.setAttribute("type", "text");
        return;
      }
      input!.setAttribute("type", 'password');

    }

    saveUser(){
      console.log("is all validate ? : "+this.validation());
      if(this.validation()){
        let content = {};

        if(this.registerAs == 'chauffeur'){
          content = {
            "pseudo" : this.error_messages_chauffeur[0].input,
            "carBrind" : this.error_messages_chauffeur[1].input,
            "imageRecto" : this.error_messages_chauffeur[2].input,
            "imageVerso" : this.error_messages_chauffeur[3].input,
            "numCardPro" : this.error_messages_chauffeur[4].input,
            "categorie" : this.categorie,
            "image": this.error_messages_global[0].input.startsWith('data:image') ? this.error_messages_global[0].input : null,
            "lastname": this.error_messages_global[1].input,
            "firstname": this.error_messages_global[2].input,
            "email": this.error_messages_global[3].input,
            "emailformat": this.error_messages_global[4].input,
            "password": this.error_messages_global[5].input,
            "passwordConfirmed": this.error_messages_global[6].input,
            "passMatching": this.error_messages_global[7].input,
            "condition": this.error_messages_global[8].input,
            "role": this.registerAs,
          };
        }else if(this.registerAs == 'organisateur'){
          content = {
            "organization": this.error_messages_organizateur[0].input,
            "address": this.error_messages_organizateur[1].input,
            "image": this.error_messages_global[0].input.startsWith('data:image') ? this.error_messages_global[0].input : null,
            "lastname": this.error_messages_global[1].input,
            "firstname": this.error_messages_global[2].input,
            "email": this.error_messages_global[3].input,
            "emailformat": this.error_messages_global[4].input,
            "password": this.error_messages_global[5].input,
            "passwordConfirmed": this.error_messages_global[6].input,
            "passMatching": this.error_messages_global[7].input,
            "condition": this.error_messages_global[8].input,
            "role": this.registerAs,
          };
        }
        // console.log(JSON.parse(content));

        this.authService.$register(content).subscribe(
          data => {
            console.log("this is the result of api register : " + data);
            presentToast('votre compte a ete cree !', 'bottom', 'success');
            this.clearInputs();
            this.router.navigate(["/map"]);
          },
          err => {
            console.error("you have and exception : " + JSON.stringify(err));
            this.messageErroshow = JSON.stringify(err.error.message);
          }
        );
      }
    }


}

### END Ionic-project\src\app\auth\sign-up\sign-up.page.ts ###

### BEGIN Ionic-project\src\app\edit-post-modal\edit-post-modal.component.html ###
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Modifier la publication</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cancel()">FERMER</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>

  <!-- Modifier la description -->
  <ion-item>
    <ion-label position="floating">Description</ion-label>
    <ion-input 
      [(value)]="updatedDescription"
      (ionInput)="onDescriptionInput($event)"
    ></ion-input>
  </ion-item>
  <!-- Modifier la catÃ©gorie -->
  <ion-item>
    <ion-label>CatÃ©gorie</ion-label>
    <ion-select
      placeholder="SÃ©lectionner"
      [(value)]="updatedCategory"
      (ionChange)="onCategoryChange($event)"
      >
      <ion-select-option *ngFor="let category of categories" [value]="category">
        {{ category }}
      </ion-select-option>
    </ion-select>
  </ion-item>

  <!-- AperÃ§u de l'image -->
  <div class="image-preview" *ngIf="updatedImage">
    <img [src]="updatedImage" alt="Image preview" />
  </div>

  <!-- Bouton pour modifier l'image -->
  <ion-button expand="block" fill="outline" (click)="openFileSelector()">
    <ion-icon slot="start" name="image-outline"></ion-icon>
    MODIFIER L'IMAGE
  </ion-button>
  <input type="file" id="modalFileInput" hidden (change)="onFileSelected($event)" />

  <!-- Bouton pour sauvegarder -->
  <ion-button expand="block" color="success" (click)="saveChanges()">
    <ion-icon slot="start" name="checkmark-done-outline"></ion-icon>
    SAUVEGARDER
  </ion-button>
</ion-content>

### END Ionic-project\src\app\edit-post-modal\edit-post-modal.component.html ###

### BEGIN Ionic-project\src\app\edit-post-modal\edit-post-modal.component.scss ###
.image-preview {
    text-align: center;
    margin: 20px 0;
  }
  
  .image-preview img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 8px;
  }
  
  ion-item {
    margin-bottom: 16px;
  }
  
### END Ionic-project\src\app\edit-post-modal\edit-post-modal.component.scss ###

### BEGIN Ionic-project\src\app\edit-post-modal\edit-post-modal.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { EditPostModalComponent } from './edit-post-modal.component';

describe('EditPostModalComponent', () => {
  let component: EditPostModalComponent;
  let fixture: ComponentFixture<EditPostModalComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ EditPostModalComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(EditPostModalComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\edit-post-modal\edit-post-modal.component.spec.ts ###

### BEGIN Ionic-project\src\app\edit-post-modal\edit-post-modal.component.ts ###
import { Component , Input } from '@angular/core';
import { ModalController } from '@ionic/angular';

@Component({
  selector: 'app-edit-post-modal',
  templateUrl: './edit-post-modal.component.html',
  styleUrls: ['./edit-post-modal.component.scss'],
})
export class EditPostModalComponent {
  @Input() post: any;
  updatedDescription!: string;
  updatedCategory!: string;
  updatedImage: string | null = null;
  categories: string[] = ['Circulation', 'Administratif', 'Info MÃ©tier' , 'Plan charge/dÃ©pose ' , 'Ã‰vÃ©nement client' , 'Autres'];

  ngOnInit() {
    this.updatedDescription = this.post.description;
    this.updatedCategory = this.post.category;
    this.updatedImage = this.post.image;
  }

  constructor(private modalCtrl: ModalController) {}

  cancel() {
    this.modalCtrl.dismiss();
  }
  onDescriptionInput(event: any): void {
    this.updatedDescription = event.target.value;
  }
  onCategoryChange(event: any): void {
    this.updatedCategory = event.detail.value;
  }
  saveChanges() {
    this.modalCtrl.dismiss({
      description: this.updatedDescription,
      category: this.updatedCategory,
      image: this.updatedImage
    });
  }

  openFileSelector() {
    const fileInput = document.getElementById('modalFileInput') as HTMLInputElement;
    fileInput.click();
  }

  onFileSelected(event: Event) {
    const input = event.target as HTMLInputElement;
    if (input?.files?.length) {
      const file = input.files[0];
      const reader = new FileReader();

      reader.onload = () => {
        this.updatedImage = reader.result as string;
      };

      reader.readAsDataURL(file);
    }
  }
}

### END Ionic-project\src\app\edit-post-modal\edit-post-modal.component.ts ###

### BEGIN Ionic-project\src\app\feedback\aide\aide-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { AidePage } from './aide.page';

const routes: Routes = [
  {
    path: '',
    component: AidePage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AidePageRoutingModule {}

### END Ionic-project\src\app\feedback\aide\aide-routing.module.ts ###

### BEGIN Ionic-project\src\app\feedback\aide\aide.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { AidePageRoutingModule } from './aide-routing.module';

import { AidePage } from './aide.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    AidePageRoutingModule
  ],
  declarations: [AidePage]
})
export class AidePageModule {}

### END Ionic-project\src\app\feedback\aide\aide.module.ts ###

### BEGIN Ionic-project\src\app\feedback\aide\aide.page.html ###
<!-- pub -->
<div class="w-full">
  <div class="h-[13vh] w-full" style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%"></div>
  <div class="w-full h-[87vh] bg-[#F3F4F7] px-6 overflow-auto">
    <!-- end pub -->
    <!-- head -->
    <div class="flex w-full py-5">
      <div (click)="back()" class="pt-1.5">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
        </svg>
      </div>
      <div class="px-4 text-[15pt] font-bold leading-6">Aide</div>
    </div>
    <!-- end head -->

    <!-- info -->
    <div class="w-full">
      <div class="mb-1">
        <div class="mt-4">
          <div class="text-[12px] pb-2 montserrat-600" style="line-height: normal;">Si vous nâ€™avez pas trouvÃ© de rÃ©ponse,vous pouvez nous envoyer un message : <span class="text-red-600">*</span></div>
          <label class="relative pb-2 text-[13px]">
            <textarea class="w-full h-[200px] rounded border border-[#00396542] bg-white px-3 py-2 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Ã©crire.." type="text" name="content" [(ngModel)]="content"></textarea>
          </label>
          <div class="flex flex-col">
            <span  *ngIf="error_messages.display" class="text-red-600 font-bold text-[10px]">{{error_messages.content}}</span>
          </div>
        </div>
      </div>
      <div class="pb-5">
        <ion-button (click)="sendMail()" style="text-transform: none;" color="transparent" class="h-[40px] w-full rounded-xl border-2 bg-[#1D4999] active:bg-transparent border-[#1D4999] text-[13px] montaserrat-700 tracking-wide text-white active:text-[#1D4999] mr-2">Envoyer</ion-button>
      </div>
    <!-- end info -->
  </div>
</div>
### END Ionic-project\src\app\feedback\aide\aide.page.html ###

### BEGIN Ionic-project\src\app\feedback\aide\aide.page.scss ###
### END Ionic-project\src\app\feedback\aide\aide.page.scss ###

### BEGIN Ionic-project\src\app\feedback\aide\aide.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AidePage } from './aide.page';

describe('AidePage', () => {
  let component: AidePage;
  let fixture: ComponentFixture<AidePage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(AidePage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\feedback\aide\aide.page.spec.ts ###

### BEGIN Ionic-project\src\app\feedback\aide\aide.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';
import { presentToast } from 'src/app/utiles/component/notification';
import { FeedbackService } from 'src/app/utiles/services/feedback/feedback.service';
import { ProfilService } from 'src/app/utiles/services/profil/profil.service';
import { SuperiseurEmail } from 'src/environments/environment';

@Component({
  selector: 'app-aide',
  templateUrl: './aide.page.html',
  styleUrls: ['./aide.page.scss'],
})
export class AidePage implements OnInit {

  content:string = '';
  error_messages = {
    content: 'No content to send !', display:false
  };

  user:any = this.profilService.$userinfo
  
  constructor(
    private router:Router,
    private mailsender:FeedbackService,
    private profilService:ProfilService
  ) { }

  ngOnInit() {
  }

  sendMail(){
    console.log(this.user);
    
    if(this.validation()){
      

      let content = {
        sender: SuperiseurEmail,
        subject: "Aide email depuis : "+ this.user.email,
        content: this.content
      }
      

      this.mailsender.$sendMail(content).subscribe(
        data => {
          console.log('result of send email');
          presentToast('votre email a Ã©tÃ© envoyÃ© avec succÃ¨s !','bottom', 'success');
          this.content = "";
        },
        err => {
          console.error("this is a error from sending email : " + err.error.message);
        }
      )
    
    }
  }

  validation(){
    this.error_messages.display = false;
    if(this.content == ''){
      this.error_messages.display = true;
      return false;
    }
    return true;
  }

  back() {
    this.router.navigate(["/faq"])
  }
}

### END Ionic-project\src\app\feedback\aide\aide.page.ts ###

### BEGIN Ionic-project\src\app\feedback\avis\avis-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { AvisPage } from './avis.page';

const routes: Routes = [
  {
    path: '',
    component: AvisPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class AvisPageRoutingModule {}

### END Ionic-project\src\app\feedback\avis\avis-routing.module.ts ###

### BEGIN Ionic-project\src\app\feedback\avis\avis.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { AvisPageRoutingModule } from './avis-routing.module';

import { AvisPage } from './avis.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    AvisPageRoutingModule
  ],
  declarations: [AvisPage]
})
export class AvisPageModule {}

### END Ionic-project\src\app\feedback\avis\avis.module.ts ###

### BEGIN Ionic-project\src\app\feedback\avis\avis.page.html ###
<!-- pub -->
<div class="w-full">
  <div class="h-[13vh] w-full" style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%"></div>
  <div class="w-full h-[87vh] bg-[#F3F4F7] px-6 overflow-auto">
    <!-- end pub -->
    <!-- head -->
    <div class="flex w-full py-5">
      <div (click)="goMap()" class="pt-1.5">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
        </svg>
      </div>
      <div class="px-4 text-[15pt] font-bold leading-6">Suggestions et avis</div>
    </div>
    <!-- end head -->

  <div class="w-full">
    <div class="mb-1">
      <label class=" montserrat-700 ">Suggestions et avis</label>
      <div class="mt-4">
        <div class="text-[12px] pb-2 montserrat-600" style="line-height: normal;">Vos avis sont importants<br/> pourlâ€™amÃ©lioration du service. Vous pouveznous les faires parvenir ci dessous : <span class="text-red-600">*</span></div>
        <label class="relative pb-2 text-[13px]">
          <textarea class="w-full h-[200px] rounded border border-[#00396542] bg-white px-3 py-2 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Ã©crire.." type="text" name="content" [(ngModel)]="content"></textarea>
        </label>
        <div class="flex flex-col">
          <span  *ngIf="error_messages.display" class="text-red-600 font-bold text-[10px]">{{error_messages.content}}</span>
        </div>
      </div>
    </div>
    <div class="pb-5">
      <ion-button (click)="sendMail()" style="text-transform: none;" color="transparent" class="h-[40px] w-full rounded-xl border-2 bg-[#1D4999] active:bg-transparent border-[#1D4999] text-[13px] montaserrat-700 tracking-wide text-white active:text-[#1D4999] mr-2">Envoyer</ion-button>
    </div>
  </div>
</div>
### END Ionic-project\src\app\feedback\avis\avis.page.html ###

### BEGIN Ionic-project\src\app\feedback\avis\avis.page.scss ###
### END Ionic-project\src\app\feedback\avis\avis.page.scss ###

### BEGIN Ionic-project\src\app\feedback\avis\avis.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { AvisPage } from './avis.page';

describe('AvisPage', () => {
  let component: AvisPage;
  let fixture: ComponentFixture<AvisPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(AvisPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\feedback\avis\avis.page.spec.ts ###

### BEGIN Ionic-project\src\app\feedback\avis\avis.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';
import { presentToast } from 'src/app/utiles/component/notification';
import { FeedbackService } from 'src/app/utiles/services/feedback/feedback.service';
import { ProfilService } from 'src/app/utiles/services/profil/profil.service';
import { SuperiseurEmail } from 'src/environments/environment';

@Component({
  selector: 'app-avis',
  templateUrl: './avis.page.html',
  styleUrls: ['./avis.page.scss'],
})
export class AvisPage implements OnInit {
  content:string = '';
  error_messages = {
    content: 'No content to send !', display:false
  };

  user:any = this.profilService.$userinfo
  
  constructor(
    private router:Router,
    private mailsender:FeedbackService,
    private profilService:ProfilService
  ) { }

  ngOnInit() {
  }

  goMap() {
    this.router.navigate(["/map"])
  }

  sendMail(){
    if(this.validation()){


      let content = {
        sender: SuperiseurEmail,
        subject: "Suggestions / Avis email depuis : "+ this.user.email,
        content: this.content
      }
      

      this.mailsender.$sendMail(content).subscribe(
        data => {
          presentToast('votre email a Ã©tÃ© envoyÃ© avec succÃ¨s !','bottom', 'success');
          this.content = "";
        },
        err => {
          console.error("this is a error from sending email : " + err.error.message);
        }
      )
    
    }
  }

  validation(){
    this.error_messages.display = false;
    if(this.content == ''){
      this.error_messages.display = true;
      return false;
    }
    return true;
  }
}

### END Ionic-project\src\app\feedback\avis\avis.page.ts ###

### BEGIN Ionic-project\src\app\feedback\faq\faq-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { FaqPage } from './faq.page';

const routes: Routes = [
  {
    path: '',
    component: FaqPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class FaqPageRoutingModule {}

### END Ionic-project\src\app\feedback\faq\faq-routing.module.ts ###

### BEGIN Ionic-project\src\app\feedback\faq\faq.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { FaqPageRoutingModule } from './faq-routing.module';

import { FaqPage } from './faq.page';
import { AccordionComponent } from '../../utiles/component/accordion/accordion.component';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    FaqPageRoutingModule
  ],
  declarations: [FaqPage, AccordionComponent]
})
export class FaqPageModule {}

### END Ionic-project\src\app\feedback\faq\faq.module.ts ###

### BEGIN Ionic-project\src\app\feedback\faq\faq.page.html ###
<div class="h-[13vh] w-full" style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%"></div>

<div class="h-[100vh] w-full overflow-auto bg-[#F3F4F7] px-6">
  <!-- head -->
  <div class="flex w-full py-5">
    <div (click)="goTo('map')" class="pt-1.5">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
    <div class="px-4 text-[15pt] font-bold leading-6">aide et FAQ</div>
  </div>
  <!-- end head -->

  <span class="montserrat-600 text-[18px]">Foire aux questions :</span>
  
  <!-- content -->
  <div class="w-full">
    <app-accordion *ngFor="let faq of listFaq" [content]="faq" ></app-accordion>
  </div>
  <!-- end content -->
  
  <div class="py-5">
    <span class="text-[13px]">Si vous nâ€™avez pas trouvÃ© de rÃ©ponse</span>
    <ion-button (click)="goTo('aide')" color="transparent" style="--border-radius:0.75rem; text-transform: none;" class="montserrat-700 my-1 h-10 w-full rounded-xl border-2 border-[#1D4999] text-[13px] tracking-wide text-[#1D4999]">Aide</ion-button>
  </div>


</div>

### END Ionic-project\src\app\feedback\faq\faq.page.html ###

### BEGIN Ionic-project\src\app\feedback\faq\faq.page.scss ###
### END Ionic-project\src\app\feedback\faq\faq.page.scss ###

### BEGIN Ionic-project\src\app\feedback\faq\faq.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { FaqPage } from './faq.page';

describe('FaqPage', () => {
  let component: FaqPage;
  let fixture: ComponentFixture<FaqPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(FaqPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\feedback\faq\faq.page.spec.ts ###

### BEGIN Ionic-project\src\app\feedback\faq\faq.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';

@Component({
  selector: 'app-faq',
  templateUrl: './faq.page.html',
  styleUrls: ['./faq.page.scss'],
})
export class FaqPage implements OnInit {

  listFaq:Array<{
    title:string,message:string}> = [
    {
      title:"Qu'est-ce que cette application ?",
      message:"Cette application permet aux utilisateurs de partager des informations gÃ©olocalisÃ©es entre eux, avec des fonctionnalitÃ©s avancÃ©es et un systÃ¨me d'abonnement payant.      "
    },
    {
      title:"Qui peut utiliser cette application ?",
      message:"Cette application permet aux utilisateurs de partager des informations gÃ©olocalisÃ©es entre eux, avec des fonctionnalitÃ©s avancÃ©es et un systÃ¨me d'abonnement payant.      "
    },
    {
      title:"L'application est-elle gratuite ?",
      message:"Cette application permet aux utilisateurs de partager des informations gÃ©olocalisÃ©es entre eux, avec des fonctionnalitÃ©s avancÃ©es et un systÃ¨me d'abonnement payant.      "
    },
    {
      title:"Quelles sont les fonctionnalitÃ©s avancÃ©es avec l'abonnement payant ?",
      message:"Cette application permet aux utilisateurs de partager des informations gÃ©olocalisÃ©es entre eux, avec des fonctionnalitÃ©s avancÃ©es et un systÃ¨me d'abonnement payant.      "
    },
    {
      title:"Combien coÃ»te l'abonnement payant ?",
      message:"Cette application permet aux utilisateurs de partager des informations gÃ©olocalisÃ©es entre eux, avec des fonctionnalitÃ©s avancÃ©es et un systÃ¨me d'abonnement payant.      "
    }
  ]

  constructor(private router:Router) { }

  ngOnInit() {
  }

  accordion(){
    
  }

  goTo(destination: string){
    switch (destination) {
      case 'map':
        this.router.navigate(['/map']);
        break;

      case 'aide':
        this.router.navigate(['/aide']);
        break;
    
      default:
        break;
    }
  }

}

### END Ionic-project\src\app\feedback\faq\faq.page.ts ###

### BEGIN Ionic-project\src\app\gpsaccess\gpsaccess-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { GPSAccessPage } from './gpsaccess.page';

const routes: Routes = [
  {
    path: '',
    component: GPSAccessPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class GPSAccessPageRoutingModule {}

### END Ionic-project\src\app\gpsaccess\gpsaccess-routing.module.ts ###

### BEGIN Ionic-project\src\app\gpsaccess\gpsaccess.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { GPSAccessPageRoutingModule } from './gpsaccess-routing.module';

import { GPSAccessPage } from './gpsaccess.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    GPSAccessPageRoutingModule
  ],
  declarations: [GPSAccessPage]
})
export class GPSAccessPageModule {}

### END Ionic-project\src\app\gpsaccess\gpsaccess.module.ts ###

### BEGIN Ionic-project\src\app\gpsaccess\gpsaccess.page.html ###
<div class="h-[100vh] w-full p-6" style="background-image:url(../../assets/images/75cc21e4ed9812d19d358ea01026f59d.png); background-repeat:no-repeat; background-size:cover; background-position:90% 50%;">
  <div class="absolute px-9 bottom-0 left-0 right-0 top-0 bg-gradient-to-b from-white via-white to-transparent">
    <!-- head -->
    <div class="mt-10 mb-8 flex h-20 w-full">
      <div class=" text-[24px] font-bold montserrat-700 leading-9">Partager ma <br/>Localisation</div>
    </div>
    <!-- end head -->

    <!-- image div -->
    <div class=" w-full">
      <div class="flex items-center justify-center">
        <div class="flex w-full items-center justify-center px-5">
          <img src="../../assets/images/accessPosition.png" width="150" />
        </div>
      </div>
      <p class="mb-20 mt-8 text-center text-[14px] text-[#222222] montserrat-500">Veuillez accepter la localisation de votre tÃ©lÃ©phone pour offrir une bonne expÃ©rience.<br />Pour une meilleure efficacitÃ© du service, la localisation en arriÃ¨re plan est recommandÃ©e.</p>
    </div>
    <!-- image div -->

    <!-- inputs -->
    <div class="my-4 font-[Montserrat]">
      <div class="flex items-center">
        <button (click)="getGeolocalisation()" class="h-11 w-full rounded-xl bg-[#1D4999] text-[13px] montserrat-700 tracking-wide text-white">Accorder partage de localisation</button>
      </div>
      <div class="text-center py-2">
        <a routerLink="/map" class=" px-2 text-[14px] raleway-600 text-[#02263D]"><u>pas maintenant</u></a>
      </div>
    </div>
    <!-- end inputs -->
  </div>
</div>
### END Ionic-project\src\app\gpsaccess\gpsaccess.page.html ###

### BEGIN Ionic-project\src\app\gpsaccess\gpsaccess.page.scss ###
### END Ionic-project\src\app\gpsaccess\gpsaccess.page.scss ###

### BEGIN Ionic-project\src\app\gpsaccess\gpsaccess.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { GPSAccessPage } from './gpsaccess.page';

describe('GPSAccessPage', () => {
  let component: GPSAccessPage;
  let fixture: ComponentFixture<GPSAccessPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(GPSAccessPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\gpsaccess\gpsaccess.page.spec.ts ###

### BEGIN Ionic-project\src\app\gpsaccess\gpsaccess.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';
import { presentToast } from '../utiles/component/notification';
// import { getGeolocalisation, position } from '../utiles/getLocalisation';

@Component({
  selector: 'app-gpsaccess',
  templateUrl: './gpsaccess.page.html',
  styleUrls: ['./gpsaccess.page.scss'],
})
export class GPSAccessPage implements OnInit {

  position:{lat:string, long:string} = {
    lat:'',
    long:''
  }

  getPossitionStatus:boolean = false
  constructor(private router:Router) {

  }

  ngOnInit() { }

  ionViewWillEnter(){
    this.fillPosition();
    this.checkPosition();

  }



  goMap(){
    this.router.navigate(["/map"])
  }

  checkPosition(){

    if( this.position.lat != '' && this.position.long !=  ''){
      this.goMap();
    }
  }

  getGeolocalisation(){
    console.log('start the get geolocalisation method');

    var onSuccess = async (position:any) => {
      console.log('starting on success');

      // alert('Latitude: '          + position.coords.latitude          + '\n' +
      //       'Longitude: '         + position.coords.longitude         + '\n' +
      //       'Altitude: '          + position.coords.altitude          + '\n' +
      //       'Accuracy: '          + position.coords.accuracy          + '\n' +
      //       'Altitude Accuracy: ' + position.coords.altitudeAccuracy  + '\n' +
      //       'Heading: '           + position.coords.heading           + '\n' +
      //       'Speed: '             + position.coords.speed             + '\n' +
      //       'Timestamp: '         + position.timestamp                + '\n');

      localStorage.setItem('lat', position.coords.latitude)
      localStorage.setItem('long', position.coords.longitude)
      console.log("stocked data in local storage");

      this.position.lat = await localStorage.getItem('lat')!;
      this.position.long = await localStorage.getItem('long')!;


      // console.log("stocked data in position variable lat : "+this.position.lat+' long : '+ this.position.long);
      presentToast("stocked data in position variable lat : "+this.position.lat+' long : '+ this.position.long, 'bottom', 'success')

      if(this.position.lat != '' && this.position.long != ''){
        this.getPossitionStatus = true
        this.checkPosition();

      }
     console.log('end of onSuccess!');

  };

  // onError Callback receives a PositionError object
  //
  var onError = (error:any) => {
            presentToast('code: '    + error.code    + '\n' +
            'message: ' + error.message + '\n', 'bottom', 'danger')
  }

  console.log('start get current position method!');
    navigator.geolocation.getCurrentPosition(onSuccess, onError)
    console.log('end of get current position method !!!');

    if(this.getPossitionStatus){
      this.goMap();
      this.getPossitionStatus = false
    }

    // presentToast('the end of the process !!', 'bottom', 'danger')

  }

  fillPosition(){
    this.position.lat = localStorage.getItem('lat') || '';
    this.position.long = localStorage.getItem('long') || '';
  }

}

### END Ionic-project\src\app\gpsaccess\gpsaccess.page.ts ###

### BEGIN Ionic-project\src\app\info\info-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';
import { InfoPage } from './info.page';

const routes: Routes = [
  {
    path: '',
    component: InfoPage,
  },
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class InfoPageRoutingModule {}

### END Ionic-project\src\app\info\info-routing.module.ts ###

### BEGIN Ionic-project\src\app\info\info.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { IonicModule } from '@ionic/angular';
import { InfoPageRoutingModule } from './info-routing.module';
import { InfoPage } from './info.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    InfoPageRoutingModule,
  ],
  declarations: [InfoPage],
})
export class InfoPageModule {}

### END Ionic-project\src\app\info\info.module.ts ###

### BEGIN Ionic-project\src\app\info\info.page.html ###
<ion-header>
  <ion-toolbar>
    <ion-title>Fil d'actualitÃ©</ion-title>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/map"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Zone de publication -->
  <div class="new-post-container">
    <ion-item>
      <ion-input
        placeholder="Quoi de neuf, {{ user?.firstName }} ?"
        [(ngModel)]="newPost.description">
      </ion-input>
    </ion-item>

    <div class="image-preview" *ngIf="newPost.image">
      <img [src]="newPost.image" alt="Image preview" />
    </div>

    <!-- CatÃ©gories -->
    <ion-item>
      <ion-label>CatÃ©gorie</ion-label>
      <ion-select
        placeholder="SÃ©lectionner"
        [(ngModel)]="newPost.category">
        <ion-select-option *ngFor="let category of categories" [value]="category">
          {{ category }}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <!-- Boutons -->
    <ion-button (click)="openFileSelector()" fill="clear">
      <ion-icon name="image-outline" slot="start"></ion-icon>
      Photo / VidÃ©o
    </ion-button>
    <input type="file" id="fileInput" hidden (change)="onFileSelected($event)" />
    <ion-button expand="block" (click)="addPost()">Publier</ion-button>
  </div>

  <!-- Liste des publications -->
  <ion-list>
    <ion-card *ngFor="let post of posts; let i = index">
      <ion-card-header>
        <ion-label>
          <h2>{{ user?.firstName }}</h2>  
          <p>{{ post?.date | date: 'medium' }}</p>
          <p><strong>CatÃ©gorie :</strong> {{ post?.category }}</p>
        </ion-label>
      </ion-card-header>

      <img *ngIf="post.image" [src]="post.image" alt="Post Image" />
      <ion-card-content>
        <p>{{ post?.description }}</p>

        <!-- Boutons de publication -->
        <div class="post-actions">
          <ion-button fill="clear" color="danger" (click)="likePost(post)">
            <ion-icon [name]="post.liked ? 'heart' : 'heart-outline'"></ion-icon>
            {{ post.likes }}
          </ion-button>
          <ion-button fill="clear" color="warning" (click)="editPost(i)">
            <ion-icon name="create-outline"></ion-icon>
          </ion-button>
          <ion-button fill="clear" color="danger" (click)="confirmDeletePost(i)">
            <ion-icon name="trash-outline"></ion-icon>
          </ion-button>
        </div>

        <!-- Section des commentaires -->
        <div class="comment-section">
          <p><strong>Commentaires :</strong> {{ post?.comments?.length || 0 }}</p>
          <div *ngFor="let comment of post?.comments; let j = index">
            <div class="comment">
              <p><strong>{{ comment?.user }}</strong>: {{ comment?.text }}</p>
              <ion-button fill="clear" color="warning" (click)="editComment(post, j)">
                <ion-icon name="create-outline"></ion-icon>
              </ion-button>
              <ion-button fill="clear" color="danger" (click)="confirmDeleteComment(post, j)">
                <ion-icon name="trash-outline"></ion-icon>
              </ion-button>
            </div>
          </div>
          <ion-item>
            <ion-input
              placeholder="Ajouter un commentaire..."
              [(ngModel)]="post.newComment">
            </ion-input>
            <ion-button fill="clear" (click)="addComment(post)">
              <ion-icon name="send-outline"></ion-icon>
            </ion-button>
          </ion-item>
        </div>
      </ion-card-content>
    </ion-card>
  </ion-list>
</ion-content>

### END Ionic-project\src\app\info\info.page.html ###

### BEGIN Ionic-project\src\app\info\info.page.scss ###
.new-post-container {
    display: flex;
    flex-direction: column;
    margin: 16px;
    padding: 16px;
    background-color: #f9f9f9;
    border-radius: 8px;
  }
  
  .post-input {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .actions {
    display: flex;
    justify-content: space-between;
    margin-top: 8px;
  }
  
  .post-card {
    margin: 16px;
  }
  
  .post-image {
    width: 100%;
    max-height: 300px;
    object-fit: cover;
    border-radius: 8px;
  }
  
  .comment-section {
    margin-top: 10px;
    border-top: 1px solid #ddd;
    padding-top: 10px;
  }
  
  .comment {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 8px 0;
  }
  
### END Ionic-project\src\app\info\info.page.scss ###

### BEGIN Ionic-project\src\app\info\info.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { InfoPage } from './info.page';

describe('InfoPage', () => {
  let component: InfoPage;
  let fixture: ComponentFixture<InfoPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(InfoPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\info\info.page.spec.ts ###

### BEGIN Ionic-project\src\app\info\info.page.ts ###
import { Component } from '@angular/core';
import { AlertController, ModalController } from '@ionic/angular';
import { EditPostModalComponent } from '../edit-post-modal/edit-post-modal.component';
import { ProfilService } from '../utiles/services/profil/profil.service';

@Component({
  selector: 'app-info',
  templateUrl: './info.page.html',
  styleUrls: ['./info.page.scss'],
})
export class InfoPage {
  user!: any;
  newPost: { description: string; image?: string; category?: string } = { description: '', category: '' };
  posts: Array<{
    description: string;
    image?: string;
    date: Date;
    comments: { text: string; user: any }[];
    newComment?: string;
    likes: number;
    liked: boolean;
    category?: string;
  }> = [];

  // Liste des catÃ©gories
  categories: string[] = ['Circulation', 'Administratif', 'Info MÃ©tier' , 'Plan charge/dÃ©pose ' , 'Ã‰vÃ©nement client'  , 'Autres'];

  constructor(
    private alertCtrl: AlertController,
    private modalCtrl: ModalController,
    private userProfile: ProfilService
  ) {}

  ngOnInit(): void {
    this.loadPostsFromLocalStorage();
    console.log(this.posts)
  }

  // Charger les publications depuis le stockage local
  loadPostsFromLocalStorage(): void {
    const storedPosts = localStorage.getItem('posts');
    if (storedPosts) {
      this.posts = JSON.parse(storedPosts);
    }
  }

  // Sauvegarder les publications dans le stockage local
  savePostsToLocalStorage(): void {
    localStorage.setItem('posts', JSON.stringify(this.posts));
  }

  // RÃ©cupÃ©rer les informations utilisateur
  profil() {
    this.userProfile.$profil().subscribe(
      (data: any) => {
        this.userProfile.$userinfo = data;
        this.user = data;
        console.log('Auth user => ', this.user);
      },
      (err) => {
        console.error('Error: ', err);
      }
    );
  }

  async ionViewWillEnter(): Promise<void> {
    await this.profil();
  }

  // Ajouter une nouvelle publication
  addPost(): void {
    if ((this.newPost.description.trim() || this.newPost.image) && this.newPost.category) {
      this.posts.unshift({
        description: this.newPost.description,
        image: this.newPost.image,
        date: new Date(),
        comments: [],
        likes: 0,
        liked: false,
        category: this.newPost.category,
      });
      console.log('Publication ajoutÃ©e : ', this.newPost);

      // RÃ©initialisation
      this.newPost = { description: '', category: '' };
      this.savePostsToLocalStorage();
    } else {
      console.error('Veuillez ajouter une description et sÃ©lectionner une catÃ©gorie avant de publier.');
    }
  }

  // Modifier une publication
  async editPost(postIndex: number): Promise<void> {
    const modal = await this.modalCtrl.create({
      component: EditPostModalComponent,
      componentProps: {
        post: this.posts[postIndex],
      },
    });
    modal.onDidDismiss().then((result) => {
      if (result.data) {
        console.log("test 1 : ",result)
        this.posts[postIndex] = { ...this.posts[postIndex], ...result.data };
        this.savePostsToLocalStorage();
      }
    });
    await modal.present();
  }

  // Confirmer la suppression d'une publication
  async confirmDeletePost(postIndex: number): Promise<void> {
    const alert = await this.alertCtrl.create({
      header: 'Confirmation',
      message: 'ÃŠtes-vous sÃ»r de vouloir supprimer cette publication ?',
      buttons: [
        {
          text: 'Annuler',
          role: 'cancel',
        },
        {
          text: 'Supprimer',
          role: 'destructive',
          handler: () => {
            this.posts.splice(postIndex, 1);
            this.savePostsToLocalStorage();
          },
        },
      ],
    });

    await alert.present();
  }

  // Ouvrir le sÃ©lecteur de fichiers
  openFileSelector() {
    const fileInput = document.getElementById('fileInput') as HTMLInputElement;
    fileInput.click();
  }

  // GÃ©rer le fichier sÃ©lectionnÃ©
  onFileSelected(event: any) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        this.newPost.image = reader.result as string;
      };
      reader.readAsDataURL(file);
    }
  }

  // Ajouter un commentaire
  addComment(post: any): void {
    if (post.newComment?.trim()) {
      post.comments.push({ text: post.newComment, user: this.user?.firstName });
      post.newComment = '';
      this.savePostsToLocalStorage();
    }
  }

  // Modifier un commentaire
  async editComment(post: any, commentIndex: number): Promise<void> {
    const alert = await this.alertCtrl.create({
      header: 'Modifier le commentaire',
      inputs: [
        {
          name: 'updatedText',
          type: 'text',
          value: post.comments[commentIndex]?.text || '',
          placeholder: 'Votre commentaire...',
        },
      ],
      buttons: [
        {
          text: 'Annuler',
          role: 'cancel',
        },
        {
          text: 'Modifier',
          handler: (data) => {
            if (data.updatedText.trim()) {
              post.comments[commentIndex].text = data.updatedText.trim();
              this.savePostsToLocalStorage();
            }
          },
        },
      ],
    });

    await alert.present();
  }

  // Confirmer la suppression d'un commentaire
  async confirmDeleteComment(post: any, commentIndex: number): Promise<void> {
    const alert = await this.alertCtrl.create({
      header: 'Confirmation',
      message: 'ÃŠtes-vous sÃ»r de vouloir supprimer ce commentaire ?',
      buttons: [
        {
          text: 'Annuler',
          role: 'cancel',
        },
        {
          text: 'Supprimer',
          role: 'destructive',
          handler: () => {
            post.comments.splice(commentIndex, 1);
            this.savePostsToLocalStorage();
          },
        },
      ],
    });

    await alert.present();
  }

  // Aimer ou ne plus aimer une publication
  likePost(post: any): void {
    post.liked = !post.liked;
    post.likes += post.liked ? 1 : -1;
    this.savePostsToLocalStorage();
  }
}

### END Ionic-project\src\app\info\info.page.ts ###

### BEGIN Ionic-project\src\app\interceptors\logging.interceptor.ts ###
import { Injectable } from '@angular/core';
import { HttpInterceptor, HttpRequest, HttpHandler, HttpResponse, HttpErrorResponse } from '@angular/common/http';
import { tap } from 'rxjs/operators';

@Injectable()
export class LoggingInterceptor implements HttpInterceptor {

  intercept(req: HttpRequest<any>, next: HttpHandler) {
    console.log('ðŸš€ HTTP Request:', {
      method: req.method,
      url: req.url,
      headers: req.headers.keys().reduce((acc: any, key) => {
        acc[key] = req.headers.get(key);
        return acc;
      }, {}),
      body: req.body
    });

    return next.handle(req).pipe(
      tap(
        event => {
          if (event instanceof HttpResponse) {
            console.log('âœ… HTTP Response:', {
              status: event.status,
              url: event.url,
              body: event.body
            });
          }
        },
        error => {
          if (error instanceof HttpErrorResponse) {
            console.error('âŒ HTTP Error:', {
              status: error.status,
              statusText: error.statusText,
              url: error.url,
              message: error.message,
              error: error.error
            });
          }
        }
      )
    );
  }
}
### END Ionic-project\src\app\interceptors\logging.interceptor.ts ###

### BEGIN Ionic-project\src\app\list-evenement\list-evenement-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { ListEvenementPage } from './list-evenement.page';

const routes: Routes = [
  {
    path: '',
    component: ListEvenementPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class ListEvenementPageRoutingModule {}

### END Ionic-project\src\app\list-evenement\list-evenement-routing.module.ts ###

### BEGIN Ionic-project\src\app\list-evenement\list-evenement.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { ListEvenementPageRoutingModule } from './list-evenement-routing.module';

import { ListEvenementPage } from './list-evenement.page';
import { ShareModule } from '../utiles/share/share.module';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    ListEvenementPageRoutingModule,
    ShareModule
  ],
  declarations: [ListEvenementPage]
})
export class ListEvenementPageModule {}

### END Ionic-project\src\app\list-evenement\list-evenement.module.ts ###

### BEGIN Ionic-project\src\app\list-evenement\list-evenement.page.html ###
<!-- pub -->
<div class="w-full h-[11vh]" style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%"></div>
<!-- end pub -->
<div class="h-[89vh] w-full bg-[#F3F4F7] px-6 overflow-auto" >
  <!-- head -->
  <div class="flex w-full py-5">
    <div (click)="goMap()">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
    <div class="px-4 text-[15pt] font-bold leading-6">Liste des Ã©vÃ©nements</div>
  </div>
  <!-- end head -->


    <!-- event -->
    <div *ngFor="let event of listEvents" class="bg-white flex flex-col text-[15px] border-[#1d48993b] border rounded-lg px-6 py-4 mb-2">
      <label class="w-full font-semibold">NÂ° {{event.id}}</label>
      <table class="font-[Montserrat] text-[13px]">
        <tr>
          <td class="">Adresse :</td>
          <td class="font-bold pl-1">{{event.lieu}}</td>
        </tr>
        <tr>
          <td>Nom :</td>
          <td class="font-bold pl-1">{{event.name}}</td>
        </tr>
        <tr>
          <td>Type :</td>
          <td class="font-bold pl-1">{{event.type}}</td>
        </tr>
        <tr>
          <td>CrÃ©Ã© le :</td>
          <td class="font-bold pl-1">{{dateStructor(event.created_at)}}</td>
        </tr>
      </table>

      <div class="flex mt-2">
        <button (click)="updateEvent(event.id)" class="h-9 m-0.5 rounded-lg bg-[#D4D4D4] active:bg-[#b9b7b7] text-[12px] font-semibold tracking-wide text-[#292929] flex justify-center items-center px-3">
          <span class="px-1">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
            </svg>
          </span>Modifier</button>
        <button (click)="showConfirmation(event.id)" class="h-9 m-0.5 rounded-lg bg-[#FBD5CD] active:bg-[#dfb4ac] text-[12px] font-semibold tracking-wide text-[#EB2F06] flex justify-center items-center px-3">
          <span class="px-1">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
            </svg>
          </span>Supprimer</button>
      </div>
    </div>
    <!-- end event -->
    <!-- end list events -->
     <app-delete-confirmation *ngIf="displayDeleteConfirmation" [content]="content" [selectedPointId]="selectedEvent" (closeConfirmation)="displayDeleteConfirmation = false" (closeConfirmation)="displayDeleteConfirmation = false" (deleteItem)="deletePoint($event)"></app-delete-confirmation>
</div>




### END Ionic-project\src\app\list-evenement\list-evenement.page.html ###

### BEGIN Ionic-project\src\app\list-evenement\list-evenement.page.scss ###
### END Ionic-project\src\app\list-evenement\list-evenement.page.scss ###

### BEGIN Ionic-project\src\app\list-evenement\list-evenement.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ListEvenementPage } from './list-evenement.page';

describe('ListEvenementPage', () => {
  let component: ListEvenementPage;
  let fixture: ComponentFixture<ListEvenementPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(ListEvenementPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\list-evenement\list-evenement.page.spec.ts ###

### BEGIN Ionic-project\src\app\list-evenement\list-evenement.page.ts ###
import { Component, OnDestroy, OnInit } from '@angular/core';
import { Router } from '@angular/router';
import { ListPointsService } from '../utiles/services/points/list-points.service';
import { presentToast } from '../utiles/component/notification';

@Component({
  selector: 'app-list-evenement',
  templateUrl: './list-evenement.page.html',
  styleUrls: ['./list-evenement.page.scss'],
})
export class ListEvenementPage {

  listEvents:any = [];
  isDeleting: boolean = false; 
  displayDeleteConfirmation:boolean = false;
  content:string = "Ãªtes-vous sÃ»r de vouloir supprimer ce point ?";
  selectedEvent:number|undefined;
  constructor(
    private router:Router,
    private pointsService:ListPointsService
  ) { }

  ionViewWillEnter() {
    this.getEventPoints();
  }

  ionViewdidLeave(): void {
      this.listEvents = []
      console.log('you left the page !!!');

  }

  getEventPoints(){
    this.pointsService.$getMyPoints().subscribe((data:any) => {
      this.listEvents = data.event;
      console.log("all events", this.listEvents);
    });
  }

  goMap() {
    this.router.navigate(["/map"])
  }

  updateEvent(id:number){
    this.router.navigate(['/update-evenement/'+id])
  }


  showConfirmation(id:number){
    this.selectedEvent = id;
    this.displayDeleteConfirmation = true;
  }


deletePoint(id: number) {
  if (this.isDeleting) return; // EmpÃªcher plusieurs suppressions simultanÃ©es

  this.isDeleting = true; // DÃ©but du processus de suppression

  let json = {
    "pointId": id,
    "type": "event"
  };

  this.pointsService.$deletePoint(json).subscribe({
    next: (data: any) => {
      presentToast("L'Ã©vÃ©nement a Ã©tÃ© supprimÃ© avec succÃ¨s!", "bottom", "success");
      this.getEventPoints();
    },
    error: (err) => {
      presentToast("Erreur lors de la suppression!", "bottom", "danger");
    },
    complete: () => {
      this.isDeleting = false; // RÃ©activer aprÃ¨s la suppression
    }
  });
}

  dateStructor(date: string): string {
    const d = new Date(date);
    const day = d.getDate().toString().padStart(2, '0');
    const month = (d.getMonth() + 1).toString().padStart(2, '0');
    const year = d.getFullYear();
    const hours = d.getHours().toString().padStart(2, '0');
    const minutes = d.getMinutes().toString().padStart(2, '0');

    return `${day}/${month}/${year} Ã  ${hours}h${minutes}`;
  }

}

### END Ionic-project\src\app\list-evenement\list-evenement.page.ts ###

### BEGIN Ionic-project\src\app\list-notes\list-notes-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { ListNotesPage } from './list-notes.page';

const routes: Routes = [
  {
    path: '',
    component: ListNotesPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class ListNotesPageRoutingModule {}
### END Ionic-project\src\app\list-notes\list-notes-routing.module.ts ###

### BEGIN Ionic-project\src\app\list-notes\list-notes.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { ListNotesPageRoutingModule } from './list-notes-routing.module';

import { ListNotesPage } from './list-notes.page';
import { ShareModule } from '../utiles/share/share.module';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    ListNotesPageRoutingModule,
    ShareModule
  ],
  declarations: [ListNotesPage]
})
export class ListNotesPageModule {}
### END Ionic-project\src\app\list-notes\list-notes.module.ts ###

### BEGIN Ionic-project\src\app\list-notes\list-notes.page.html ###
<!-- pub -->
<div class="w-full h-[11vh]" style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%"></div>
<div class="h-[89vh] w-full bg-[#F3F4F7] px-6 overflow-auto" >
  <!-- head -->
  <div class="flex w-full py-5">
    <div (click)="goMap()">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
    <div class="px-4 text-[15pt] font-bold leading-6">Liste des Notes</div>
  </div>
  <!-- end head -->

  <!-- note -->
  <div *ngFor="let note of listNotes" class="bg-white flex flex-col text-[15px] border-[#1d48993b] border rounded-lg px-6 py-4 mb-2">
    <label class="w-full font-semibold">Note NÂ° {{note.id}}</label>
    <table class="font-[Montserrat] text-[13px]">
      <tr>
        <td class="pr-2">Destination :</td>
        <td class="font-bold pl-1">{{note.name}}</td>
      </tr>
      <tr>
        <td>Lieu :</td>
        <td class="font-bold pl-1">{{note.lieu}}</td>
      </tr>
      <tr>
        <td>Type :</td>
        <td class="font-bold pl-1">{{note.type}}</td>
      </tr>
      <tr>
        <td>Heure :</td>
        <td class="font-bold pl-1">{{note.heureDebut}}</td>
      </tr>
      <tr>
        <td>CrÃ©Ã© le :</td>
        <td class="font-bold pl-1">{{dateStructor(note.created_at)}}</td>
      </tr>
    </table>

    <div class="flex mt-2">
      <button (click)="updateNote(note.id)" class="h-9 m-0.5 rounded-lg bg-[#D4D4D4] active:bg-[#b9b7b7] text-[12px] font-semibold tracking-wide text-[#292929] flex justify-center items-center px-3">
        <span class="px-1">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
          </svg>
        </span>Modifier
      </button>
      <button (click)="showConfirmation(note.id)" class="h-9 m-0.5 rounded-lg bg-[#FBD5CD] active:bg-[#dfb4ac] text-[12px] font-semibold tracking-wide text-[#EB2F06] flex justify-center items-center px-3">
        <span class="px-1">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
          </svg>
        </span>Supprimer
      </button>
    </div>
  </div>
  <!-- end note -->
  
  <!-- Empty State -->
  <div *ngIf="listNotes.length === 0" class="text-center mt-10 text-gray-500">
    <p>Vous n'avez crÃ©Ã© aucune note pour le moment.</p>
  </div>
  
  <app-delete-confirmation *ngIf="displayDeleteConfirmation" [content]="content" [selectedPointId]="selectedNoteId" (closeConfirmation)="displayDeleteConfirmation = false" (deleteItem)="deletePoint($event)"></app-delete-confirmation>
</div>
### END Ionic-project\src\app\list-notes\list-notes.page.html ###

### BEGIN Ionic-project\src\app\list-notes\list-notes.page.scss ###
ion-content {
  --background: #F3F4F7;
}

.notes-container {
  padding: 0 1.5rem;
}

.note-item {
  background: white;
  border: 1px solid rgba(29, 72, 153, 0.23);
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 0.5rem;
  font-size: 15px;
}

.note-title {
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.note-table {
  font-family: 'Montserrat', sans-serif;
  font-size: 13px;
  width: 100%;
}

.note-table td {
  padding: 0.125rem 0;
  vertical-align: top;
}

.note-table td:first-child {
  padding-right: 0.5rem;
}

.note-table td:last-child {
  font-weight: bold;
  padding-left: 0.25rem;
}

.action-buttons {
  display: flex;
  margin-top: 0.5rem;
  gap: 0.25rem;
}

.btn-edit {
  height: 2.25rem;
  border-radius: 8px;
  background-color: #D4D4D4;
  color: #292929;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.025em;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 0.75rem;
  border: none;
  
  &:active {
    background-color: #b9b7b7;
  }
}

.btn-delete {
  height: 2.25rem;
  border-radius: 8px;
  background-color: #FBD5CD;
  color: #EB2F06;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.025em;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 0.75rem;
  border: none;
  
  &:active {
    background-color: #dfb4ac;
  }
}

.btn-icon {
  margin-right: 0.25rem;
  width: 1rem;
  height: 1rem;
}

.empty-state {
  text-align: center;
  margin-top: 2.5rem;
  color: #6b7280;
}
### END Ionic-project\src\app\list-notes\list-notes.page.scss ###

### BEGIN Ionic-project\src\app\list-notes\list-notes.page.ts ###
import { Component } from '@angular/core';
import { Router } from '@angular/router';
import { ListPointsService } from '../utiles/services/points/list-points.service';
import { presentToast } from '../utiles/component/notification';
import { NavController } from '@ionic/angular';

@Component({
  selector: 'app-list-notes',
  templateUrl: './list-notes.page.html',
  styleUrls: ['./list-notes.page.scss'],
})
export class ListNotesPage {

  listNotes: any = [];
  isDeleting: boolean = false;
  displayDeleteConfirmation: boolean = false;
  content: string = "Ãªtes-vous sÃ»r de vouloir supprimer cette note ?";
  selectedNoteId: number | undefined;

  constructor(
    private router: Router,
    private pointsService: ListPointsService,
    private navController: NavController
  ) { }

  ionViewWillEnter() {
    this.getNotePoints();
  }

  getNotePoints() {
    this.pointsService.$getMyPoints().subscribe({
      next: (data: any) => {
        this.listNotes = data.note;
        console.log("All my notes", this.listNotes);
      },
      error: (err: any) => {
        presentToast("Erreur lors du chargement des notes.", "bottom", "danger");
        console.error(err);
      }
    });
  }

  goMap() {
    this.navController.back();
  }

  updateNote(id: number) {
    this.router.navigate(['/update-note/' + id]);
  }

  showConfirmation(id: number) {
    this.selectedNoteId = id;
    this.displayDeleteConfirmation = true;
  }

  deletePoint(id: number) {
    if (this.isDeleting) return;
    this.isDeleting = true;

    let json = {
      "pointId": id,
      "type": "note"
    };

    this.pointsService.$deletePoint(json).subscribe({
      next: (data: any) => {
        presentToast("La note a Ã©tÃ© supprimÃ©e avec succÃ¨s!", "bottom", "success");
        this.getNotePoints(); // Refresh the list
      },
      error: (err: any) => {
        presentToast("Erreur lors de la suppression!", "bottom", "danger");
      },
      complete: () => {
        this.isDeleting = false;
      }
    });
  }

  dateStructor(date: string): string {
    if (!date) return '';
    const d = new Date(date);
    const day = d.getDate().toString().padStart(2, '0');
    const month = (d.getMonth() + 1).toString().padStart(2, '0');
    const year = d.getFullYear();
    const hours = d.getHours().toString().padStart(2, '0');
    const minutes = d.getMinutes().toString().padStart(2, '0');
    return `${day}/${month}/${year} Ã  ${hours}h${minutes}`;
  }
}
### END Ionic-project\src\app\list-notes\list-notes.page.ts ###

### BEGIN Ionic-project\src\app\map\map-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { MapPage } from './map.page';

const routes: Routes = [
  {
    path: '',
    component: MapPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class MapPageRoutingModule {}

### END Ionic-project\src\app\map\map-routing.module.ts ###

### BEGIN Ionic-project\src\app\map\map.module.ts ###
import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { MapPageRoutingModule } from './map-routing.module';

import { MapPage } from './map.page';
import { MenuComponent } from '../utiles/component/menu/menu.component';
import { HorlogeComponent } from '../utiles/component/horloge/horloge.component';
import { AffluenceComponent } from '../utiles/component/affluence/affluence.component';

import { EvenementsComponent } from '../utiles/component/evenements/evenements.component';
import { StatusComponent } from '../utiles/component/status/status.component';
import { NoteComponent } from '../utiles/component/note/note.component';
import { ListPointsComponent } from '../utiles/component/list-points/list-points.component';
import { AddressInputComponent } from '../utiles/component/address-input/address-input.component';
import { ShareModule } from '../utiles/share/share.module';
import { OnboardingComponent } from '../utiles/component/onboarding/onboarding.component';
import { HAMMER_GESTURE_CONFIG } from '@angular/platform-browser';
import { IonicGestureConfig } from '../utiles/IonicGestureConfig';
import { SosComponent } from '../utiles/component/sos/sos.component';
import { MenuModule } from '../utiles/component/menu/menu.module';




@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    MapPageRoutingModule,
    ShareModule,
    MenuModule
  ],
  declarations: [
    MapPage,
    HorlogeComponent,
    AffluenceComponent,
    EvenementsComponent,
    StatusComponent,
    NoteComponent,
    ListPointsComponent,
    AddressInputComponent,
    OnboardingComponent,
    SosComponent

  ],
  providers:[{provide: HAMMER_GESTURE_CONFIG, useClass: IonicGestureConfig}],
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
  exports:[]
})
export class MapPageModule {}

### END Ionic-project\src\app\map\map.module.ts ###

### BEGIN Ionic-project\src\app\map\map.page.html ###
<ion-content>

  <div class="h-full w-full overflow-y-auto">

    <!-- head -->
    <div class="absolute top-0 flex flex-col w-full  bg-gradient-to-b from-white to-[#fff0]">

      <!-- pub -->
      <div *ngIf="skipedPub === '1'" class="w-full h-[80px]" (click)="pubClick()"
        style="z-index: 1;background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover; background-position:100% 50%;">
      </div>
      <!-- end pub -->

      <!-- navbar -->
      <div *ngIf="skipedPub === '1'" class="w-full h-[45px] flex relative my-2" style="z-index: 1;">
        <div (click)="displayToggle('menu')" class=" w-[20vw] flex justify-center items-center">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
            <path fill-rule="evenodd"
              d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z"
              clip-rule="evenodd" />
          </svg>
        </div>

        <div class="w-full">
          <div class=" w-full flex justify-center items-center">
            <label class="relative block text-[13px] w-full">
              <span class="sr-only">search</span>
              <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#000000]">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4">
                  <path fill-rule="evenodd"
                    d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z"
                    clip-rule="evenodd" />
                </svg>
              </span>
              <input type="text"
                                 name="search"
                                 [(ngModel)]="searchinput"
                                 (input)="onAddressInput()"
                                 placeholder="Rechercher une adresse..."
                                 class="block w-full rounded-md border-0 py-1.5 pl-10 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
              <!-- <input id="pac-input" type="text" class="block w-[65vw] rounded-xl border bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Recherche..." /> -->
            </label>
          </div>
          <!-- openStreetMap autocomplete -->
          <!-- This block was missing. It will now display the suggestions fetched from the API. -->
          <ul *ngIf="suggestions.length > 0" class="absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 shadow-lg max-h-60 overflow-auto">
              <li *ngFor="let suggestion of suggestions" (click)="goToLocation(suggestion)"
                  class="p-2 cursor-pointer hover:bg-gray-100 text-sm text-gray-800 border-b border-gray-200">
                  {{suggestion.display_name}}
              </li>
          </ul>
          <!-- openStreetMap autocomplete -->

        </div>

        <div class="navbar-button w-[25vw] flex justify-center items-center relative">
          <!-- Clock button (shows when overlay is closed) -->
          <span *ngIf="!displayer.horlogDisplay" (click)="displayToggle('horloge'); $event.stopPropagation()" class="w-10 h-10 bg-white flex justify-center items-center rounded-3xl drop-shadow-md border transition-all duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
          </span>
          <!-- Close button (shows when overlay is open) -->
          <div *ngIf="displayer.horlogDisplay" (click)="displayToggle('horloge'); $event.stopPropagation()" class="w-10 h-10 bg-white flex justify-center items-center rounded-3xl drop-shadow-md border cursor-pointer transition-all duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6 text-black">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
            </svg>
          </div>
          <!-- horloge overlay -->
          <div *ngIf="displayer.horlogDisplay && !showTimePickerModal" class="absolute top-12 right-2 z-30">
            <div class="bg-white rounded-2xl shadow-xl border p-4 min-w-[180px]">
              <div class="flex items-center justify-between mb-3">
                <h3 class="text-sm font-medium text-gray-700">Set Time</h3>
              </div>
              <div (click)="showTimePicker(); $event.stopPropagation()" class="flex items-center justify-center space-x-4 cursor-pointer hover:bg-gray-50 rounded-lg p-2 transition-colors relative">
                <div class="text-center">
                  <div class="text-2xl font-bold text-gray-800 bg-gray-50 rounded-lg px-3 py-2 min-w-[50px]">{{timeValue.hour || '07'}}</div>
                  <div class="text-xs text-gray-500 mt-1">Hours</div>
                </div>
                <div class="text-2xl font-bold text-gray-400">:</div>
                <div class="text-center">
                  <div class="text-2xl font-bold text-gray-800 bg-gray-50 rounded-lg px-3 py-2 min-w-[50px]">{{timeValue.min || '00'}}</div>
                  <div class="text-xs text-gray-500 mt-1">Minutes</div>
                </div>
              </div>
              <div class="absolute -top-2 right-5 w-4 h-4 bg-white border-l border-t transform rotate-45"></div>
            </div>
          </div>
          <!-- end horloge overlay -->
        </div>
        <!-- horloge backdrop -->
        <div (click)="displayToggle('horloge'); $event.stopPropagation()" *ngIf="displayer.horlogDisplay"
          class="fixed inset-0 bg-black/20 z-10"></div>
        <!-- end horloge backdrop -->
        
        <!-- time picker modal -->
        <div *ngIf="showTimePickerModal" class="fixed inset-0 flex justify-center items-center z-50">
          <div class="p-5 w-[100vw] bg-[#F4F5F8] rounded-lg z-30 mx-4 max-w-sm">
            <ion-datetime presentation="time" (ngModelChange)="updateTimeValue($event)" [(ngModel)]="currentTime"></ion-datetime>
            <ion-button (click)="submitTime()" style="--background:#1D4999;--background-activated:#173d84; text-transform: none;" class="mt-5 h-[40px] w-full border-2 border-[#1D4999] rounded-xl bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white">Valider</ion-button>
          </div>
          <div (click)="closeTimePicker()" class="absolute inset-0 bg-black/50 -z-10"></div>
        </div>
        <!-- end time picker modal -->
      </div>
      <!-- end navbar -->
    </div>
    <!-- end head -->


    <!-- on boarding -->
    <app-onboarding *ngIf="displayer.onboarding && showOnboarding === '0'"
      (displayer)="displayToggle('onboarding')"></app-onboarding>
    <!-- end on boarding -->

    <!-- Finish Polyline Drawing Button -->
    <div *ngIf="isDrawingPolyline" class="absolute bottom-24 left-1/2 -translate-x-1/2 z-20">
      <button (click)="finishPolylineDrawing()" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg shadow-lg active:bg-red-700">
        Terminer la modification
      </button>
    </div>

    <!-- Pub -->
    <div *ngIf="skipedPub === '0'" class="w-[100vw] h-[100vh] relative z-10 "
      style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat;  background-size: cover; background-position:55% 100%">
    </div>
    <!-- end Pub -->



    <!-- map OpenStreetMap -->
    <!-- <div #map id="map" class=" z-0 fixed" [ngClass]="{'w-[100vw] h-[100vh]': skipedPub == '1'}" ></div> -->
    <div #map id="map" class=" z-0 fixed" class="z-0 fixed w-[100vw] h-[100vh]"
      [style.visibility]="skipedPub === '1' ? 'visible' : 'hidden'"></div>

    <!-- end map -->

    <!-- buttons -->

    <div
      class="absolute z-10 w-full h-5/12 bg-gradient-to-t from-white via-[#ffffffbc] to-[#fff0] flex items-end bottom-0 text-[12px] font-[Montserrat] font-bold">
      <div class="flex flex-col justify-end w-full h-[25vh] px-4 pt-4 pb-10 text-white">
        <!-- ignore pub -->
        <div *ngIf=" skipedPub ==='0'" class=" w-full h-[20vh] flex justify-end items-center my-8">
          <div *ngIf="conteurPub > 0 " class="bg-[#0000009a] px-7 py-2">
            <span>{{conteurPub}} secondes</span>
          </div>
          <div *ngIf="conteurPub === 0 && skipedPub === '0'" (click)="ignorePub()" class="bg-[#0000009a] px-7 py-2">
            <span>ignorer lâ€™annonce</span>
          </div>
        </div>
        <!-- ignore pub -->
        <!-- GPS -->
        <div *ngIf="!displayer.showPub && !selectedBtn.note"
          class="fixed right-4 top-[620px] transform -translate-y-1/2 z-50 flex flex-col space-y-1">
          <!-- Refresh Map Button -->
          <div (click)="forceMapRefresh()"
            class="w-[45px] h-[45px] text-black bg-white flex justify-center items-center rounded-full drop-shadow-md border">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
            </svg>
          </div>
          <div (click)="locateCurrentPosition()"
            class="w-[45px] h-[45px] text-black bg-white flex justify-center items-center rounded-full drop-shadow-md border">
            <img src="../../assets/icon/gps.svg" class="w-7 h-7" alt="Locate">
          </div>
        </div>
        <!-- end GPS -->

        <div class="flex justify-around relative">
          <div *ngIf="displayer.showPub || (!displayer.showPub && !displayer.autreDisplay)"
            class="w-[40vw] h-[45px] m-1 flex items-center justify-center rounded-lg">
            <span class="px-2"></span>
          </div>

          <!-- list points -->
          <div (click)="displayToggle('list-points')" *ngIf="selectedBtn.note"
            class="w-[42vw] flex justify-end px-1 mb-5">
            <div
              class="w-[60px] h-[60px] bg-[#1D4999] flex justify-center items-center rounded-md drop-shadow-md border">
              <img src="../../assets/icon/treeBarWhite.svg" class="w-6 h-6" alt="">
            </div>
          </div>
          <!-- end list points -->

        </div>

        <div class="flex flex-col">

          <div *ngIf="displayer.autreDisplay" longPress (executeLongClick)="handlingLongClick('station')"
  class="bg-[#6A89CC] w-[40vw] h-[45px] m-1 ml-3 flex items-center justify-center rounded-lg transition-all duration-300"
  (click)="displayToggle('status')"
  [ngClass]="{
    'opacity-40': transparent.station,
    'scale-105 ring-2 ring-indigo-300': selectedBtn.station && !transparent.station,
    'opacity-50 pointer-events-none': isTrialExpired || !heldMarker
  }"
  [ngStyle]="{
    'box-shadow': selectedBtn.station ? '0px 4px 12px rgba(106, 137, 204, 0.5)' : '',
    'border': selectedBtn.station ? '2px solid #6A89CC' : '2px solid transparent'
  }">
  <div *ngIf="transparent.station" (click)="handlingLongClick('')" class="absolute w-[40vw] h-10"></div>
  <span class="px-2">
    <img src="../../assets/icon/station.svg" class="pr-1 w-6 h-6" 
         [style.filter]="selectedBtn.station && !transparent.station ? 'brightness(1.2)' : ''" alt="">
  </span>
  <label class="text-[13px]" [ngClass]="{'font-bold': selectedBtn.station && !transparent.station}">Station</label>
</div>

          
          <div *ngIf="displayer.showPub || (!displayer.showPub && !displayer.autreDisplay)"
            class="w-[40vw] h-[45px] m-1 flex items-center justify-center rounded-lg">
            <span class="px-2 ">
            </span>
          </div>
          <!-- list points -->
          <div (click)="displayToggle('list-points')" *ngIf="selectedBtn.note" class=" w-[42vw] flex justify-end mb-5">
            <div
              class="w-[60px] h-[60px] bg-[#1D4999] flex justify-center items-center rounded-md drop-shadow-md border">
              <img src="../../assets/icon/treeBarWhite.svg" class="w-6 h-6" alt="">
            </div>
          </div>
          <div>
            <div>
              <div *ngIf="displayer.autreDisplay" longPress (executeLongClick)="handlingLongClick('sos')"
  class="bg-yellow-400 w-[40vw] h-[45px] m-1 ml-3 flex items-center justify-center rounded-lg relative transition-all duration-300"
  [ngClass]="{
    'opacity-40': transparent.sos,
    'scale-105 ring-2 ring-yellow-300': selectedBtn.sos && !transparent.sos,
    'pointer-events-none': isTrialExpired,
    'cursor-not-allowed': isTrialExpired
  }"
  [ngStyle]="{
    'box-shadow': selectedBtn.sos ? '0px 4px 12px rgba(250, 204, 21, 0.5)' : '',
    'border': selectedBtn.sos ? '2px solid #facc15' : '2px solid transparent'
  }">
  <div *ngIf="transparent.sos" (click)="handlingLongClick('')" class="absolute w-[40vw] h-10"></div>
  <div (click)="displayToggle('sos')" class="flex items-center justify-center">
    <span class="px-1">
      <img src="../../assets/icon/sos.png" class="pr-1 w-6 h-6" 
           [style.filter]="selectedBtn.sos && !transparent.sos ? 'brightness(1.2)' : ''" alt="">
    </span>
    <label class="text-sm" [ngClass]="{'font-bold': selectedBtn.sos && !transparent.sos}">SOS</label>
  </div>
</div>

              
            </div>
          </div>
        </div>

        <div class="flex justify-around">
          <div longPress (executeLongClick)="handlingLongClick('event')"
  class="bg-purple-500 w-[40vw] h-[45px] m-1 flex items-center justify-center rounded-lg transition-all duration-300"
  [ngClass]="{
    'opacity-40': transparent.event,
    'scale-105 ring-2 ring-purple-300': selectedBtn.event && !transparent.event
  }"
  [ngStyle]="{
    'box-shadow': selectedBtn.event ? '0px 4px 12px rgba(147, 51, 234, 0.5)' : '',
    'border': selectedBtn.event ? '2px solid #9333ea' : '2px solid transparent'
  }">
  <div *ngIf="transparent.event" (click)="handlingLongClick('')" class="absolute w-[40vw] h-10"></div>
  <div (click)="displayToggle('evenements')" class="flex items-center justify-center">
    <span class="px-1">
      <img src="../../assets/icon/tickette.svg" class="pr-1 w-6 h-6" 
           [style.filter]="selectedBtn.event && !transparent.event ? 'brightness(1.2)' : ''" alt="">
    </span>
    <label class="text-[13px]" [ngClass]="{'font-bold': selectedBtn.event && !transparent.event}">Ã‰vÃ¨nement</label>
  </div>
</div>

          <div longPress (executeLongClick)="handlingLongClick('autre')"
  class="bg-[#1ABCFE] w-[40vw] h-[45px] m-1 flex items-center justify-center rounded-lg drop-shadow-md transition-all duration-300"
  [ngClass]="{
    'opacity-40': transparent.autre
  }">
  <div *ngIf="transparent.autre" (click)="handlingLongClick('')" class="absolute w-[40vw] h-10"></div>
  <div (click)="displayToggle('autre')">
    <span></span><label class="text-[13px]">Autre</label>
  </div>
</div>
        </div>
        <div class="flex justify-around">
          <div longPress (executeLongClick)="handlingLongClick('affluence')"
  class="bg-[#EB2F06] w-[40vw] h-[45px] m-1 flex items-center justify-center rounded-lg transition-all duration-300"
  [ngClass]="{
    'opacity-40': transparent.affluence,
    'scale-105 ring-2 ring-red-300': selectedBtn.affluence && !transparent.affluence
  }"
  [ngStyle]="{
    'box-shadow': selectedBtn.affluence ? '0px 4px 12px rgba(235, 47, 6, 0.5)' : '',
    'border': selectedBtn.affluence ? '2px solid #EB2F06' : '2px solid transparent'
  }">
  <div *ngIf="transparent.affluence" (click)="handlingLongClick('')" class="absolute w-[40vw] h-10"></div>
  <div (click)="displayToggle('affluence')" class="flex items-center justify-center">
    <span class="px-1">
      <img src="../../assets/icon/groupPub.svg" class="pr-1 w-6 h-6" 
           [style.filter]="selectedBtn.affluence && !transparent.affluence ? 'brightness(1.2)' : ''" alt="">
    </span>
    <label class="text-[13px]" [ngClass]="{'font-bold': selectedBtn.affluence && !transparent.affluence}">Affluence</label>
  </div>
</div>

         <div longPress (executeLongClick)="handlingLongClick('note')"
  class="relative bg-[#1D4999] w-[40vw] h-[45px] m-1 flex items-center justify-center rounded-lg transition-all duration-300" 
  [ngClass]="{
    'opacity-40': transparent.note,
    'scale-105 ring-2 ring-blue-300': selectedBtn.note && !transparent.note
  }" 
  [ngStyle]="{
    'box-shadow': selectedBtn.note ? '0px 4px 12px rgba(29, 73, 153, 0.5)' : '',
    'border': selectedBtn.note ? '2px solid #1D4999' : '2px solid transparent'
  }">
  <div *ngIf="transparent.note" (click)="handlingLongClick('')" class="absolute w-[40vw] h-10"></div>
  <div (click)="displayToggle('note')" class="flex items-center justify-center">
    <span class="px-1">
      <img src="../../assets/icon/note.svg" class="pr-1 w-4 h-4" 
           [style.filter]="selectedBtn.note && !transparent.note ? 'brightness(1.2)' : ''" alt="">
    </span>
    <label [ngClass]="{'font-bold': selectedBtn.note && !transparent.note}">Note</label>
  </div>
</div>

        </div>
      </div>
    </div>
    <!-- end buttons -->


    <!-- ------------------------ models ---------------------- -->
    <!-- menu -->
    <app-menu *ngIf="displayer.menuDisplay" [timer]="positionTimer" [markertimer]="MarkerTimer"
      [menuDisplay]="displayer.menuDisplay" (closeMenu)="displayToggle('menu')"
      (removeAllMarkers)="removeAllMarkers()"></app-menu>
    <!-- end menu -->
    <app-affluence *ngIf="displayer.affluenceDisplay" [affluenceDisplay]="displayer.affluenceDisplay"
      (closeAffluence)="displayToggle('affluence')" (addAffluence)="addMarker('red', $event)"></app-affluence>
    <app-evenements *ngIf="displayer.evenementsDisplay" [evenementsDisplay]="displayer.evenementsDisplay"
      (closeEvenements)="displayToggle('evenements')" (submitEvent)="addMarker('event', $event)"></app-evenements>
    <app-status *ngIf="displayer.statusDisplay" [statusDisplay]="displayer.statusDisplay"
      (closeStatus)="displayToggle('status')" (validateStation)="addMarker('green',$event)"></app-status>
    <app-note *ngIf="displayer.noteDisplay" [noteDisplay]="displayer.noteDisplay" (closeNote)="displayToggle('note')"
      (submitNote)="addMarker('note',$event)"></app-note>
    <app-list-points *ngIf="displayer.listPointDisplay" [listPointsDisplay]="displayer.listPointDisplay"
      (closelistPoints)="displayToggle('list-points')"></app-list-points>
    <app-delete-confirmation *ngIf="displayer.deletePointConfirmation" [content]="confirmationContent"
      [selectedPointId]="selectedpointId" [pointType]="selectedPointType"
      (closeConfirmation)="displayToggle('delete-confirmation')"
      (deleteItem)="deletePoint($event)"></app-delete-confirmation>
    <app-sos *ngIf="displayer.sosDisplay" [sosDisplay]="displayer.sosDisplay" (closeSos)="displayToggle('sos')"
      (validateSos)="addMarker('jaune',$event)" [editMode]="pointToEdit"></app-sos>
    <app-edit-confirmation *ngIf="displayer.editPointConfirmation" [selectedPointId]="selectedPointId"
      [pointType]="selectedPointType" [originalPoint]="pointToEdit"
      (closeConfirmation)="displayToggle('edit-confirmation')" (saveEdit)="updatePoint($event)">
    </app-edit-confirmation>

    <!-- Note Overlay - Notebook Style UI -->
    <div *ngIf="displayer.noteOverlayDisplay" class="note-overlay-container">
      <!-- Background overlay -->
      <div class="note-overlay-backdrop" (click)="closeNoteOverlay()"></div>
      
      <!-- Notebook UI -->
      <div class="notebook-container">
        <!-- Notebook Header -->
        <div class="notebook-header">
          <div class="notebook-rings">
            <div class="ring"></div>
            <div class="ring"></div>
            <div class="ring"></div>
            <div class="ring"></div>
          </div>
          <h3 class="notebook-title">ðŸ“” Mes Notes</h3>
          <button class="close-notebook-btn" (click)="closeNoteOverlay()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <!-- Notebook Content -->
        <div class="notebook-content">
          <!-- Ruled lines background -->
          <div class="notebook-lines"></div>
          
          <!-- Notes list -->
          <div class="notes-list">
            <div class="note-item" *ngFor="let note of objectblueMarkers; let i = index">
              <div class="note-header">
                <span class="note-number">{{ i + 1 }}.</span>
                <span class="note-date">{{ note.created_at | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
              <div class="note-content">
                <p class="note-text">{{ note.description || note.commentaire || 'Note sans contenu' }}</p>
                <div class="note-location" *ngIf="note.lieu">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                  </svg>
                  <span>{{ note.lieu }}</span>
                </div>
              </div>
              <div class="note-actions">
                <button class="note-action-btn edit-btn" (click)="editNote(note)">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                  </svg>
                </button>
                <button class="note-action-btn delete-btn" (click)="deleteNote(note)">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                  </svg>
                </button>
                <button class="note-action-btn map-btn" (click)="goToNoteLocation(note)">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z" />
                  </svg>
                </button>
              </div>
            </div>

            <!-- Empty state -->
            <div class="empty-notes" *ngIf="objectblueMarkers.length === 0">
              <div class="empty-icon">ðŸ“</div>
              <h4>Aucune note</h4>
              <p>Vos notes apparaÃ®tront ici une fois crÃ©Ã©es sur la carte.</p>
            </div>
          </div>

          <!-- Add new note button -->
          <div class="add-note-section">
            <button class="add-note-btn" (click)="displayToggle('note'); closeNoteOverlay()">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
              </svg>
              Ajouter une nouvelle note
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- -------------------- end models ---------------------- -->
  </div>
</ion-content>

### END Ionic-project\src\app\map\map.page.html ###

### BEGIN Ionic-project\src\app\map\map.page.scss ###
// Import Mapbox GL CSS
@import '~mapbox-gl/dist/mapbox-gl.css';

ion-content {
  --background: transparent;
}

// Map container styling for Mapbox
#map {
  width: 100vw !important;
  height: 100vh !important;
  z-index: 0;
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  box-sizing: border-box;
  
  // Mapbox container
  .mapboxgl-map {
    width: 100vw !important;
    height: 100vh !important;
    background: #f8f9fa;
    outline: none;
    font-family: 'Helvetica Neue', Arial, Helvetica, sans-serif;
  }
  
  // Mapbox canvas - force full screen dimensions
  .mapboxgl-canvas {
    width: 100vw !important;
    height: 100vh !important;
    max-width: 100vw !important;
    max-height: 100vh !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
  }
  
  // Navigation controls styling
  .mapboxgl-ctrl-top-right {
    top: 10px;
    right: 10px;
  }
  
  .mapboxgl-ctrl-group {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 4px;
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
  }
  
  .mapboxgl-ctrl-group button {
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    cursor: pointer;
    
    &:hover {
      background: rgba(0, 0, 0, 0.05);
    }
  }
  
  // Mapbox popup styling
  .mapboxgl-popup {
    .mapboxgl-popup-content {
      padding: 12px 16px;
      font-size: 14px;
      line-height: 1.4;
      border-radius: 8px;
      box-shadow: 0 3px 14px rgba(0, 0, 0, 0.2);
      max-width: 315px;
      min-width: 315px;
    }
    
    .mapboxgl-popup-close-button {
      background: transparent;
      border: none;
      font-size: 16px;
      padding: 5px;
      cursor: pointer;
      
      &:hover {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 50%;
      }
    }
  }
  
  // Attribution styling
  .mapboxgl-ctrl-attrib {
    background: rgba(255, 255, 255, 0.8) !important;
    font-size: 10px !important;
    padding: 2px 5px !important;
  }
}

// Search input container
.search-container {
  position: relative;
  z-index: 1000;
}

// Ensure top navigation buttons are clickable
.navbar-button {
  position: relative;
  z-index: 1001;
  cursor: pointer;
  
  &:hover {
    opacity: 0.8;
  }
  
  &:active {
    transform: scale(0.95);
  }
}

// Suggestions dropdown
.suggestions-dropdown {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid #ddd;
  border-top: none;
  border-radius: 0 0 8px 8px;
  max-height: 200px;
  overflow-y: auto;
  z-index: 1001;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  
  ul {
    list-style: none;
    margin: 0;
    padding: 0;
    
    li {
      padding: 12px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      font-size: 14px;
      line-height: 1.3;
      
      &:hover {
        background-color: #f5f5f5;
      }
      
      &:last-child {
        border-bottom: none;
      }
    }
  }
}

// Responsive adjustments
@media (max-width: 768px) {
  #map {
    .mapboxgl-ctrl-top-right {
      margin-top: 80px !important;
      margin-right: 10px !important;
    }
    
    .mapboxgl-ctrl-attrib {
      font-size: 8px !important;
      padding: 1px 3px !important;
    }
  }
}

// High DPI displays
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  #map {
    .mapboxgl-canvas {
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
    }
  }
}

// Dark mode support
@media (prefers-color-scheme: dark) {
  #map {
    .mapboxgl-map {
      background: #2d3748;
    }
    
    .mapboxgl-ctrl-group button {
      background: rgba(45, 55, 72, 0.9) !important;
      color: #fff !important;
      border-color: rgba(255, 255, 255, 0.1) !important;
      
      &:hover {
        background: rgba(45, 55, 72, 1) !important;
      }
    }
    
    .mapboxgl-ctrl-attrib {
      background: rgba(45, 55, 72, 0.8) !important;
      color: #fff !important;
    }
  }
}

// Animation for smooth map interactions
.map-loading {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 1000;
  
  .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #007bff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

// Performance optimizations
#map {
  transform: translateZ(0);
  will-change: transform;
  
  .mapboxgl-canvas {
    transform: translateZ(0);
  }
  
  .mapboxgl-map {
    transform: translateZ(0);
  }
}

// Note Overlay - Notebook Style
.note-overlay-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  box-sizing: border-box;
}

.note-overlay-backdrop {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(4px);
}

.notebook-container {
  position: relative;
  width: 90%;
  max-width: 500px;
  max-height: 80vh;
  background: #fdfcf8;
  border-radius: 12px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  overflow: hidden;
  animation: notebookSlideIn 0.3s ease-out;
}

@keyframes notebookSlideIn {
  from {
    opacity: 0;
    transform: scale(0.9) translateY(20px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

// Notebook Header
.notebook-header {
  position: relative;
  padding: 20px;
  background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
  color: white;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.notebook-rings {
  position: absolute;
  left: 20px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  gap: 8px;
  
  .ring {
    width: 12px;
    height: 12px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
  }
}

.notebook-title {
  flex: 1;
  text-align: center;
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  padding-left: 60px; // Space for rings
}

.close-notebook-btn {
  background: rgba(255, 255, 255, 0.1);
  border: none;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  cursor: pointer;
  transition: background 0.2s ease;
  
  &:hover {
    background: rgba(255, 255, 255, 0.2);
  }
}

// Notebook Content
.notebook-content {
  position: relative;
  max-height: 60vh;
  overflow-y: auto;
  background: #fdfcf8;
}

.notebook-lines {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 100%;
  background-image: repeating-linear-gradient(
    transparent,
    transparent 23px,
    #e2e8f0 23px,
    #e2e8f0 24px
  );
  background-position: 0 10px;
  pointer-events: none;
  opacity: 0.6;
}

// Notes List
.notes-list {
  position: relative;
  padding: 20px;
  z-index: 1;
}

.note-item {
  background: rgba(255, 255, 255, 0.8);
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  
  &:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }
}

.note-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  font-size: 12px;
  color: #64748b;
}

.note-number {
  font-weight: 600;
  color: #2d3748;
}

.note-date {
  font-style: italic;
}

.note-content {
  margin-bottom: 12px;
}

.note-text {
  margin: 0 0 8px 0;
  line-height: 1.5;
  color: #2d3748;
  font-size: 14px;
  font-family: 'Courier New', monospace;
}

.note-location {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
  color: #64748b;
  
  svg {
    color: #ef4444;
  }
}

// Note Actions
.note-actions {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
}

.note-action-btn {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
  
  &:hover {
    background: #f1f5f9;
    transform: scale(1.1);
  }
  
  &.edit-btn {
    color: #3b82f6;
    
    &:hover {
      background: #dbeafe;
      border-color: #3b82f6;
    }
  }
  
  &.delete-btn {
    color: #ef4444;
    
    &:hover {
      background: #fee2e2;
      border-color: #ef4444;
    }
  }
  
  &.map-btn {
    color: #10b981;
    
    &:hover {
      background: #d1fae5;
      border-color: #10b981;
    }
  }
}

// Empty State
.empty-notes {
  text-align: center;
  padding: 40px 20px;
  color: #64748b;
}

.empty-icon {
  font-size: 48px;
  margin-bottom: 16px;
}

.empty-notes h4 {
  margin: 0 0 8px 0;
  color: #374151;
}

.empty-notes p {
  margin: 0;
  font-size: 14px;
}

// Add Note Section
.add-note-section {
  padding: 20px;
  border-top: 1px solid #e2e8f0;
  background: #f8fafc;
}

.add-note-btn {
  width: 100%;
  background: #3b82f6;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 12px 16px;
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  cursor: pointer;
  transition: background 0.2s ease;
  
  &:hover {
    background: #2563eb;
  }
  
  &:active {
    transform: scale(0.98);
  }
}

// Mobile Responsive
@media (max-width: 768px) {
  .notebook-container {
    width: 95%;
    max-height: 85vh;
  }
  
  .notebook-title {
    font-size: 16px;
    padding-left: 50px;
  }
  
  .notebook-rings .ring {
    width: 10px;
    height: 10px;
  }
  
  .notes-list {
    padding: 15px;
  }
  
  .note-item {
    padding: 12px;
  }
}

/* Ensure marker transitions work smoothly */
.leaflet-marker-icon {
  transition: opacity 1s ease-in-out !important;
}

/* Ensure fading markers are visible during transition */
.leaflet-marker-icon.fading {
  transition: opacity 1s ease-in-out !important;
}

/* Debug styles for development */
.debug-marker {
  border: 2px dashed red !important;
  background-color: rgba(255, 0, 0, 0.2) !important;
}

/* Optional: Add a subtle pulsing effect for high-level affluence points */
.leaflet-marker-icon.high-affluence {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7);
  }
  70% {
    box-shadow: 0 0 0 10px rgba(255, 0, 0, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
  }
}

/* Add this to the end of the file */
.polyline-dot-icon {
    background-color: rgba(128, 128, 128, 0.8);
    border-radius: 50%;
    border: 1px solid white;
    box-shadow: 0 0 5px rgba(0,0,0,0.5);
}
### END Ionic-project\src\app\map\map.page.scss ###

### BEGIN Ionic-project\src\app\map\map.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { MapPage } from './map.page';

describe('MapPage', () => {
  let component: MapPage;
  let fixture: ComponentFixture<MapPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(MapPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\map\map.page.spec.ts ###

### BEGIN Ionic-project\src\app\map\map.page.ts ###
import { Component, OnInit, OnDestroy, ElementRef, ViewChild } from '@angular/core';
import axios from 'axios';
import * as L from 'leaflet';

import { NavController, Platform, ModalController } from '@ionic/angular';
import { presentToast } from '../utiles/component/notification';
import { ProfilService } from '../utiles/services/profil/profil.service';
import { ListPointsService } from '../utiles/services/points/list-points.service';
import { ParticipationService } from '../utiles/services/participation/participation.service';
import { QueueService, UserPosition } from '../utiles/services/queue/queue.service';
import { Router } from '@angular/router';
import { LongPressDirective } from '../utiles/directives/longpress/long-press.directive';





@Component({
  selector: 'app-map',
  templateUrl: './map.page.html',
  styleUrls: ['./map.page.scss'],
})
export class MapPage implements OnInit, OnDestroy {
  @ViewChild('map', { static: false }) mapContainer!: ElementRef;
  @ViewChild(LongPressDirective) longPressDirective!: LongPressDirective;

  map!: L.Map | undefined;
  input: any;
  checker: boolean = true;
  searchinput: string = "";
  suggestions: Array<any> = [];


  // enableAffect:boolean=false;

  eventListenerToDelete: any;

  grayMarker: any;
  positionTimeout: any;  // Pour arrÃªter aprÃ¨s 5 minutes
  positionUpdateInterval: any; // Pour mettre Ã  jour toutes les X secondes
  markergray = false;

  isClockActive: boolean = false;
  timeValue: {hour: string, min: string} = {
    hour: '07',
    min: '00'
  };
  showTimePickerModal: boolean = false;
  currentTime: string = "";
  displayer: any = {
    menuDisplay: false,
    horlogDisplay: false,
    affluenceDisplay: false,
    evenementsDisplay: false,
    statusDisplay: false,
    noteDisplay: false,
    sosDisplay: false,
    autreDisplay: false,
    listPointDisplay: false,
    onboarding: false,
    showPub: false,
    listPoints: false,
    deletePointConfirmation: false,
    editPointConfirmation: false,
  };

  // list of all point type
  markers: any = [];
  blueMarkers: any[] = [];
  purpleMarkers: any[] = [];
  redMarkers: any[] = [];
  greenMarkers: any[] = [];
  jauneMarkers: any[] = [];
  marinMarkers: any[] = []; // for premium position
  markerToUnactivate: any[] = [];
  // list of all point type

  // list of all object of all points type
  objectblueMarkers: any[] = [];
  objectgreenMarkers: any[] = [];
  private affluenceTimers: { [pointId: number]: any } = {};
  objectjauneMarkers: any[] = [];
  objectpurpleMarkers: any[] = [];
  objectredMarkers: any[] = [];
  objectmarinMarkers: any[] = []; // for premium position

  // polylines for drawing
  polylines: { id: string, polyline: L.Polyline }[] = [];

  // list of all object of all points type
  oldPosition: { lat: number; lon: number } = {
    lat: 0,
    lon: 0,
  };

  // No API key needed for OpenStreetMap with Leaflet!

  conteurPub: number = 5;

  position: { lat: number; long: number } = {
    lat: +localStorage.getItem('lat')! || 48.8647569,
    long: +localStorage.getItem('long')! || 2.2481023,
  };
  myPosition!: L.Marker | undefined;

  selectedBtn: any = {
    event: false,
    affluence: false,
    note: false,
    autre: false,
    sos: false,
    station: false,
  };

  transparent: any = {
    event: false,
    affluence: false,
    note: false,
    autre: false,
    sos: false,
    station: false
  };

  showOnboarding: string | null = null;
  skipedPub: string | null = '0';

  // gps part
  userPosition: { lat: string | number; long: string | number } = {
    lat: '',
    long: '',
  };

  getPossitionStatus: boolean = false;

  selectedPointType: string = '';


  private currentMarker: L.Marker | null = null;
  private heldMarker: L.Marker | null = null;
  private isDrawingPolyline: boolean = false;

  selectedPoint: any;
  selectedLevel: string = '';

  // eventContent:{lieu:string, type:string, date:string, heureDebut:string, heureFin:string, level:string} = {
  //   lieu:'',
  //   type:'',
  //   date:'',
  //   heureDebut:'',
  //   heureFin:'',
  //   level:''
  // };

  addPointRes: boolean = false;
  newSelectedLvl: string | undefined;

  confirmationContent: string = '';
  selectedpointId: number | undefined;

  positionTimer: any;
  MarkerTimer: any;
  selectedPosi?: { lat: number; lng: number };
  authenticatedUser: any;
  isTrialExpired: boolean = false;
  constructor(
    private router: Router,
    private authService: ProfilService,
    private pointService: ListPointsService,
    private queueService: QueueService,
    private participationService: ParticipationService,
    private platform: Platform,
    private navController: NavController
  ) { }

  // --- State for Queue Visualization ---
  private activeQueueStationId: number | null = null;
  private locationBroadcastInterval: any = null;
  private queueVisualizerInterval: any = null;
  private greenProgressLine: L.Polyline | null = null;

  async ngOnInit(): Promise<void> {
    this.countDownSkipBtn();
    this.platform.ready().then(() => {
      this.platform.pause.subscribe(() => { this.onPause(); });
      this.platform.resume.subscribe(() => { this.onResume(); });
      
      // Initialize map after platform is ready
      setTimeout(() => {
        this.loadMap();
      }, 500);
    });

    if (this.authenticatedUser) {
      this.checkTrialPeriod();
    }
    this.savePolylines();
  }

  async ionViewWillEnter(): Promise<void> {
    // --- LOGIN GUARD ---
    const token = localStorage.getItem('apiToken');
    if (!token) {
      console.log("No token found, redirecting to login.");
      this.router.navigate(['/sign-in']);
      return; // Stop execution if not authenticated
    }
    // --- END LOGIN GUARD ---

    try {
      if (this.skipedPub === '1') {
        this.skipedPub = localStorage.getItem('skipPub');
        console.log(this.skipedPub);
      }
      this.displayer.menuDisplay = false;
      this.showOnboarding = localStorage.getItem('onpoarding');

      // Fetch profile first to ensure user info is available for marker rendering.
      const user = await this.profil();

      // Now fetch points.
      this.getAllPoint();

      if (user && user.pointDuration > 0) {
        console.log("point duration is bigger than 0");
        // Ensure we don't create multiple timers. Clear the old one first.
        if (this.MarkerTimer) clearInterval(this.MarkerTimer);
        this.MarkerTimer = setInterval(() => this.getAllPoint(), 300000); // 5 minutes
      }

      if (this.authenticatedUser) {
        this.checkTrialPeriod();
      }
    } catch (error) {
      console.error("An error occurred in ionViewWillEnter:", error);
    }
  }




  gotopage(page: any) {
    this.navController.navigateForward(page);
  }

  // ngAfterViewInit() {
  //   this.initialaizemap();
  // }

  ionViewDidEnter() {
    this.initializeMap();
  }

  async initializeMap(): Promise<void> {
    if (!this.map) {
      await this.profil();
      this.loadMap();
      this.myLocation();
      setTimeout(() => {
        if (this.map) {
          this.map.invalidateSize();
        }
        console.log('after timeout invalidate size');
      }, 600);
    }
  }

  // Map initialization with Mapbox
  loadMap() {
    if (this.map) {
      this.map.remove();
      this.map = undefined;
    }

    if (this.mapContainer?.nativeElement) {
      try {
        this.map = L.map(this.mapContainer.nativeElement).setView([this.position.lat, this.position.long], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(this.map);

        this.map.on('load', () => {
          console.log('Map loaded successfully');
          this.getAllPoint();
        });

        this.map.on('contextmenu', (e: L.LeafletMouseEvent) => this.onMapHold(e));
        this.map.on('click', (e: L.LeafletMouseEvent) => this.onMapClick(e));

        // Trigger load event manually for Leaflet as it doesn't have a direct equivalent of Mapbox's 'load'
        setTimeout(() => {
          if (this.map) {
            this.map.fire('load');
          }
        }, 200);

      } catch (error) {
        console.error('Error initializing map:', error);
        setTimeout(() => this.loadMap(), 1000);
      }
    } else {
      setTimeout(() => this.loadMap(), 100);
    }
  }


  dragStart = () => {
    this.checker = false;

    if (this.eventListenerToDelete) {
      // This was for Google Maps, no longer needed.
      this.eventListenerToDelete = undefined;
    }
  };

  DragEnd = () => {
    this.checker = true;

  };

  deleteMap = () => {
    if (this.map) {
      this.map.remove();
      this.map = undefined;
    }
    document.getElementById('map')?.remove();
  };

  detectedEventListener = (evenement: any) => {
    this.eventListenerToDelete = evenement;
  };

  /*USer Info */

  async userMarker() {
    // Remove existing user marker if it exists
    if (this.myPosition) {
      this.myPosition.remove();
      this.myPosition = undefined;
    }

    // Create Mapbox marker for user position
    const userIcon = L.icon({
      iconUrl: '../../assets/icon/orangeCarWithcircle.svg',
      iconSize: [44, 44],
      iconAnchor: [22, 44],
      popupAnchor: [0, -44]
    });

    this.myPosition = L.marker([this.position.lat, this.position.long], { icon: userIcon }).addTo(this.map!);

    //this.removeAllMarkers();
    this.makeObjectMarker();
  }

  searchTimeout: any;

  async onAddressInput() {
    clearTimeout(this.searchTimeout);
    const query = this.searchinput.trim();

    if (query.length > 3) {
      this.searchTimeout = setTimeout(async () => {
        try {
          const response = await axios.get(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&addressdetails=1&limit=5&accept-language=fr&countrycodes=fr`);
          this.suggestions = response.data;
          console.log("OSM API content:", JSON.stringify(this.suggestions));
        } catch (error: any) {
          console.error('Error fetching address suggestions:', error);
        }
      }, 400); // 500ms debounce delay
    } else {
      this.suggestions = [];
    }
  }

  goToLocation(suggestion: any) {
    const lat = suggestion.lat;
    const lon = suggestion.lon;

    if (this.map) {
      // This function should ONLY move the map. It should not create any markers.
      // The marker creation logic has been removed.
      this.map.flyTo([lat, lon], 15);
      this.suggestions = [];
      this.searchinput = suggestion.display_name || suggestion.address;
    }
  }



  // onMapHold for Mapbox
  private onMapHold(e: L.LeafletMouseEvent) {
    this.markergray = true

    console.log('this. marker gray', this.markergray)

    const latlng = e.latlng;
    console.log('Held at: Lat ' + latlng.lat + ', Lng ' + latlng.lng);
    this.selectedPosi = {
      lat: latlng.lat,
      lng: latlng.lng,
    };

    // Remove the previous marker if it exists
    if (this.heldMarker) {
      this.heldMarker.remove();
    }

    if (this.map) {
      const grayIcon = L.icon({
        iconUrl: '../../assets/icon/markerGray.png',
        iconSize: [50, 50],
        iconAnchor: [25, 50],
        popupAnchor: [0, -50]
      });

      this.heldMarker = L.marker([latlng.lat, latlng.lng], { icon: grayIcon }).addTo(this.map);
    } else {
      console.error('Map instance is undefined');
    }
  }

  // Method to handle simple click and remove the marker
  private onMapClick(e: L.LeafletMouseEvent) {
    // Remove the existing held marker on simple click
    this.markergray = false
    console.log('this. marker gray', this.markergray)

    if (this.heldMarker) {
      this.heldMarker.remove();
      console.log('Marker removed');
    }
  }

  // Helper function to create Mapbox markers
  private createLeafletMarker(iconUrl: string, latLng: [number, number], size: { width: number, height: number } = { width: 44, height: 44 }): L.Marker {
    const customIcon = L.icon({
      iconUrl: iconUrl,
      iconSize: [size.width, size.height],
      iconAnchor: [size.width / 2, size.height],
      popupAnchor: [0, -size.height]
    });

    return L.marker(latLng, { icon: customIcon });
  }

  pubClick() {
    this.conteurPub = 5;
    localStorage.setItem('skipPub', '0');
    this.skipedPub = localStorage.getItem('skipPub');
    this.countDownSkipBtn();
  }

  displayToggle(element: string) {
    switch (element) {
      case 'menu':
        this.displayer.menuDisplay = !this.displayer.menuDisplay;
        break;

      case 'note':
        this.displayer.noteDisplay = !this.displayer.noteDisplay;
        break;

      case 'horloge':
        this.displayer.horlogDisplay = !this.displayer.horlogDisplay;
        this.isClockActive = this.displayer.horlogDisplay;
        if (this.isClockActive) {
          this.myLocation();
        } else {
          if (this.positionUpdateInterval) {
            clearInterval(this.positionUpdateInterval);
          }
          if (this.positionTimeout) {
            clearTimeout(this.positionTimeout);
          }
          if (this.map) {
            this.map.stopLocate();
          }
        }
        break;

      case 'affluence':
        this.displayer.affluenceDisplay = !this.displayer.affluenceDisplay;
        // this.enableAffect=false;
        // }else{
        //   presentToast('Veuillez sÃ©lectionner un point gris avant de crÃ©er une affluence.', 'bottom', 'danger');
        // }
        break;

      case 'evenements':
        this.displayer.evenementsDisplay = !this.displayer.evenementsDisplay;
        break;


      case 'status':
        // This modal should ONLY open if a gray pin has been placed on the map.
        if (this.heldMarker) {
          this.displayer.statusDisplay = !this.displayer.statusDisplay;
        } else {
          // This message reinforces the correct workflow for the user.
          presentToast("Veuillez d'abord faire un appui long sur la carte pour placer un point.", 'bottom', 'warning');
        }
        break;

     case 'sos':
       const lat = parseFloat(localStorage.getItem('lat') || '');
       const long = parseFloat(localStorage.getItem('long') || '');

       if (this.markergray === true) {
         presentToast('Le point SOS peut Ãªtre ajoutÃ© selon la gÃ©olocalisation', 'bottom', 'danger');
       }

       if (lat !== undefined && long !== undefined && this.markergray === false) {
         this.displayer.sosDisplay = !this.displayer.sosDisplay;
         console.log("sosDisplay aprÃ¨s toggle:", this.displayer.sosDisplay);
       } else {
         presentToast('Le point SOS peut Ãªtre ajoutÃ© selon la gÃ©olocalisation', 'bottom', 'danger');
       }
       break;

      case 'autre':
        this.displayer.autreDisplay = !this.displayer.autreDisplay;
        break;

      case 'list-points':
        this.displayer.listPointDisplay = !this.displayer.listPointDisplay;
        if (this.displayer.listPoints == true)
          this.displayer.listPoints = !this.displayer.listPoints;
        break;

      case 'onboarding':
        this.displayer.onboarding = !this.displayer.onboarding;
        break;
      case 'delete-confirmation':
        this.displayer.deletePointConfirmation =
          !this.displayer.deletePointConfirmation;
        break;
      case 'edit-confirmation':
        this.displayer.editPointConfirmation = !this.displayer.editPointConfirmation;
        break;
      default:
        console.log('action not exist !');
        break;
    }
  }

  showTimePicker() {
    this.showTimePickerModal = !this.showTimePickerModal;
  }

  formaTime(getvalue: string) {
    const date = new Date(getvalue);
    const hours = ('0' + date.getHours()).slice(-2);
    const minutes = ('0' + date.getMinutes()).slice(-2);
    return {hour: hours, min: minutes}
  }

  setValue(newValue: string) {
    this.timeValue = this.formaTime(newValue);
    console.log('( heureDebut ) outside of the component : ' + this.timeValue.hour + ":" + this.timeValue.min);
    this.showTimePickerModal = false;
  }

  updateTimeValue(newValue: string) {
    this.currentTime = newValue;
    console.log(this.currentTime);
  }

  submitTime() {
    if(this.currentTime == '') {
      let date = new Date();
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      const seconds = String(date.getSeconds()).padStart(2, '0');
      
      const formattedDate = `${year}-${month}-${day}T${hours}:${minutes}:${seconds}`;
      this.currentTime = formattedDate;
    }
    this.timeValue = this.formaTime(this.currentTime);
    console.log('( heureDebut ) outside of the component : ' + this.timeValue.hour + ":" + this.timeValue.min);
    this.showTimePickerModal = false;
  }

  closeTimePicker() {
    this.showTimePickerModal = false;
  }

  ignorePub() {
    this.displayer.showPub = false;
    this.displayer.onboarding = true;
    localStorage.setItem('skipPub', '1');
    this.skipedPub = localStorage.getItem('skipPub');
    setTimeout(() => {
      // this.autocomplete();
    }, 1000);
  }

  // // remove markers (openStreetMap)
  removeMarker(): void {
    if (this.currentMarker) {
      this.currentMarker.remove();
      this.currentMarker = null;
    }
  }

  countDownSkipBtn() {
    const interval = setInterval(() => {
      this.conteurPub--;
      if (this.conteurPub == 0) {
        clearInterval(interval);
      }
    }, 1000);
  }

  // // clear Map (openStreetMap)
  clearMap() {
    console.log("Start clearing the map");
    let markers = [
      ...this.blueMarkers,
      ...this.redMarkers,
      ...this.purpleMarkers,
      ...this.jauneMarkers,
      ...this.marinMarkers,
    ];
    markers.forEach((marker) => {
      marker.remove();
    });
    this.blueMarkers = [];
    this.redMarkers = [];
    this.purpleMarkers = [];
    this.jauneMarkers = [];
    this.marinMarkers = [];
  }

  handlingLongClick(btn: string) {
    const isCurrentlySelected = this.selectedBtn[btn];

    // If the button pressed is the one already active, we turn it off.
    if (isCurrentlySelected) {
      this.selectedBtn[btn] = false;
      this.transparent[btn] = false;
    } else {
      // First, turn off all other filters.
      Object.keys(this.selectedBtn).forEach(key => {
        this.selectedBtn[key] = false;
        this.transparent[key] = false;
      });
      // Then, turn on the new one.
      this.selectedBtn[btn] = true;
      this.transparent[btn] = true;
    }

    this.makeObjectMarker();
    this.setMarkersOpacity();
  }

  private setMarkersOpacity() {
    const hasSelectedCategory = Object.values(this.selectedBtn).some(selected => selected);
    if (!hasSelectedCategory) {
      this.allMarkers.forEach(marker => {
        const el = marker.getElement();
        if (el) {
          el.style.opacity = '1';
          el.style.pointerEvents = 'auto';
        }
      });
      return;
    }

    const markerCategories = [
      { markers: this.objectpurpleMarkers, category: 'event' },
      { markers: this.objectredMarkers, category: 'affluence' },
      { markers: this.objectgreenMarkers, category: 'station' },
      { markers: this.objectblueMarkers, category: 'note' },
      { markers: this.objectjauneMarkers, category: 'sos' }
    ];

    markerCategories.forEach(({ markers, category }) => {
      const isSelected = this.selectedBtn[category];
      markers.forEach(markerObj => {
        if (markerObj.object) {
          const el = markerObj.object.getElement();
          if (el) {
            if (isSelected) {
              el.style.opacity = '1';
              el.style.pointerEvents = 'auto';
            } else {
              el.style.opacity = '0.2';
              el.style.pointerEvents = 'none';
            }
          }
        }
      });
    });
  }

  getAllPoint(keepView: boolean = false) {
    this.redMarkers = [];// affluence points
    this.purpleMarkers = [];//events points
    this.greenMarkers = [];//station points
    this.blueMarkers = [];//note points
    this.jauneMarkers = []; //sos points
    this.clearMarker();
    this.pointService.$getPoints().subscribe(
      (data: any) => {
        console.log('data all points', data);
        this.redMarkers = data.red;
        this.greenMarkers = data.green;
        this.blueMarkers = data.note;
        this.jauneMarkers = data.sos;
        this.purpleMarkers = data.event;
        // this.removeAllMarkers();

        this.loadPolylines(); // Load polylines AFTER the station data is available
        this.makeObjectMarker(keepView);

      },
      (err) => {
        console.error('Error fetching all points:', JSON.stringify(err, null, 2));
      }
    );
    console.log("")
  }

  savePoint(content: any, newMarker: any, type: string) {
    console.log('content', content);
    console.log('newMarker',newMarker);

    let json;

    if (type === 'red') {
      json = {
        typePoint: type,
        name: content.name.lieu,
        address: content.address,
        lat: content.lat,
        lng: content.lng,
        level: content.level,
        like: content.like,
        dislike: content.dislike,
        userId: content.userId,
        username: content.username,
        role: content.role,
      };
      // Award points based on affluence level
      switch(content.level) {
        case 0:
          this.participationService.rewardAffluenceLevel0();
          break;
        case 1:
          this.participationService.rewardAffluenceLevel1();
          break;
        case 2:
          this.participationService.rewardAffluenceLevel2();
          break;
        case 3:
          this.participationService.rewardAffluenceLevel3();
          break;
        case 4:
          this.participationService.rewardAffluenceLevel4();
          break;
      }
    }
    if (type === 'note') {
      json = {
        typePoint: type,
        name: content.name,
        address: content.address,
        lat: content.lat,
        lng: content.lng,
        lieu: content.lieu,
        type:content.type,
        level: content.level,
        like: content.like,
        dislike: content.dislike,
        userId: content.userId,
        username: content.username,
        role: content.role,
      };
      console.log("type => ")
      // Award points for airport wait/queue
      this.participationService.rewardAirportWait();
      console.log("is this note ? ", json.lieu);

    }
    if (type === 'green') {
      json = {
        typePoint: type,
        name: content.name,
        address: content.address,
        lat: content.lat,
        lng: content.lng,
        level: content.level,
        like: content.like,
        dislike: content.dislike,
        userId: content.userId,
        username: content.username,
        role: content.role,
        createDate: new Date(),
      };
      // Award points for station creation
      this.participationService.rewardAirportWait();
      console.log("is this station ? ", json.typePoint);
    }
    if (type === 'jaune') {
      json = {
        typePoint: type,
        name: content.name,
        msg: content.msg,
        numeroTel: content.numeroTel,
        address: content.address,
        lat: content.lat,
        lng: content.lng,
        level: content.level,
        like: content.like,
        dislike: content.dislike,
        userId: content.userId,
        username: content.username,
        role: content.role,
        createDate: new Date(),
      };
             // Award points for SOS creation
             this.participationService.rewardAirportWait();
             console.log("is this station ? ", json.typePoint);
    } else {
      json = {
        typePoint: type,
        name: content.name,
        address: content.address,
        lieu: content.lieu,
        type: content.type,
        date: content.date,
        heureDebut: content.heureDebut,
        heureFin: content.heureFin,
        lat: content.lat,
        lng: content.lng,
        level: content.level,
        like: content.like,
        dislike: content.dislike,
        userId: content.userId,
        username: content.username,
        role: content.role,
        createDate: new Date(),
      };
      // Award points for event creation
      this.participationService.rewardEvent();
      console.log("is this event ? ", json.typePoint);
    }
  console.log('Sending to backend:', json);
  this.pointService.$savePoint(json).subscribe(
    (data: any) => {
      console.log('Backend response:', data);
      if (data.done) {
        this.addPointRes = data.done;
        content.id = data.id;
        
        // Update content with real backend time data
        content.isLoading = false;
        const now = new Date();
        const day = String(now.getDate()).padStart(2, '0');
        const month = String(now.getMonth() + 1).padStart(2, '0'); // Fix: +1 for correct month
        const year = now.getFullYear();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        
        content.date = `${day}-${month}-${year}`;
        content.heure = `${hours}:${minutes}`;
        
        this.getAllPoint(true); // Re-fetch points but keep the current map view

        setTimeout(() => {

          this.infowindowMethod(content, newMarker, type);
          
          // Update popup content immediately with real backend time
          const indexMarker = this.getIndexMarker(type, content);
          if (indexMarker !== -1) {
            const updatedContentString = this.widgetContent(
              type,
              this.authService.$userinfo.id,
              indexMarker,
              0,
              0,
              content
            );
            newMarker.setPopupContent(updatedContentString);
          }
          
          newMarker.openPopup();

          // ðŸ”¥ RÃ©cupÃ©rer l'index aprÃ¨s infowindowMethod
          if (indexMarker !== -1) {

            this.handleBtnClick(indexMarker, type, content);
          } else {
            console.error("indexMarker not found!");
          }
        }, 50);
      }
    },
    (err) => {
      console.error('Error saving point:', JSON.stringify(err, null, 2));
    }
  );
  }
getIndexMarker(type: string, object: any): number {
  switch (type) {
    case 'red': return this.redMarkers.indexOf(object);
    case 'green': return this.greenMarkers.indexOf(object);
    case 'jaune': return this.jauneMarkers.indexOf(object);
    case 'note': return this.marinMarkers.indexOf(object);
    case 'event': return this.purpleMarkers.indexOf(object);
    default: return -1;
  }
}


  infowindowMethod(object: any, newMarker: any, type: string) {
    if (this.addPointRes) {
      let indexMarker: number | null = null;
      if (type == 'red') {
        this.redMarkers.push(object);
        indexMarker = this.redMarkers.indexOf(object);
      }
      if (type == 'green') {
        this.greenMarkers.push(object);
        indexMarker = this.greenMarkers.indexOf(object);
      }
      if (type == 'jaune') {
        this.jauneMarkers.push(object);
        indexMarker = this.jauneMarkers.indexOf(object);
      }
      if (type == 'note') {
        this.marinMarkers.push(object);
        indexMarker = this.marinMarkers.indexOf(object);
      }  if (type == 'event') {
        this.purpleMarkers.push(object);
        indexMarker = this.purpleMarkers.indexOf(object);
      }

      if (indexMarker != null) {
        let contentString = this.widgetContent(
          type,
          this.authService.$userinfo.id,
          indexMarker,
          0,
          0,
          object
        );

        newMarker.bindPopup(contentString, { maxWidth: 315 }).openPopup();
        newMarker.on('click', () => {
          this.checker = false;
          newMarker.togglePopup();
          setTimeout(() => {
            this.handleBtnClick(indexMarker!, type, object);
          }, 500);
        });

        //this.getAllPoint();
      } else {
        presentToast(
          'opss! index marker is not selected check infowindowMethod method',
          'bottom',
          'danger'
        );
      }
    } else {
      presentToast('opss!', 'bottom', 'danger');
    }

    this.addPointRes = false;
  }

  addMarker(type: string, choice: any): void {

    if (this.authService.$userinfo !== null) {
      let currentMarker: any = null;

      switch (type) {
        case 'red':
          console.log('selectedPoint for red value =>: ', this.selectedPoint);
          // console.log(choice);
          const iconUrl = this.markerLevel(
            type,
            choice.toString(),
            this.authService.$userinfo.id,
            this.authService.$userinfo.role.role_name
          );

          if (this.selectedPosi?.lat != undefined && this.selectedPosi?.lng != undefined) {
            console.log('red=> lat : ' + this.selectedPosi.lat + ' lng : ' + this.selectedPosi.lng);
            this.selectedPoint = {
              option: true,
              position: {
                lat: this.selectedPosi.lat,
                lng: this.selectedPosi.lng,
              },

            };
            // break;
          } else {
            // presentToast('merci de pointer sur une position', 'top', 'danger')
            let userLat = localStorage.getItem('lat');
            let userLng = localStorage.getItem('long');

            if (userLat != undefined && userLng != undefined) {
              this.selectedPoint = {
                option: true,
                position: {
                  lat: userLat,
                  lng: userLng,
                },
              };

              // console.log(" lat : " + this.selectedPoint.position.lat + " lng : " +  this.selectedPoint.position.lng);
            }
          }

          let newMarkerR = this.createLeafletMarker(
            iconUrl,
            [this.selectedPoint.position.lat, this.selectedPoint.position.lng]
          ).addTo(this.map!);

          let objectR = {
            id: undefined,
            name: 'point rouge',
            address: '----',
            lat: this.selectedPoint.position.lat,
            lng: this.selectedPoint.position.lng,
            level: choice,
            like: 0,
            dislike: 0,
            object: newMarkerR,
            userID: this.authService.$userinfo.id,
            username:
              this.authService.$userinfo.firstName +
              ' ' +
              this.authService.$userinfo.lastName,
            role: this.authService.$userinfo.role.role_name,
            date: null, // Will be set from backend response
            heure: null, // Will be set from backend response
            isLoading: true // Flag to show shimmer
          };

          if (this.selectedPoint?.option == undefined) {
            this.selectedPoint.remove();
            this.selectedPoint = undefined;
          }
          this.savePoint(objectR, newMarkerR, type);

          break;
        case 'location':
          const locationIcon = L.icon({
            iconUrl: '../../assets/icon/mylocationGreen.svg',
            iconSize: [44, 44],
            iconAnchor: [22, 44],
            popupAnchor: [0, -44]
          });

          const lat = localStorage.getItem('lat') ? parseFloat(localStorage.getItem('lat')!) : (choice?.position?.lat || 0);
          const long = localStorage.getItem('long') ? parseFloat(localStorage.getItem('long')!) : (choice?.position?.long || 0);

          // Check if position is set, if not use default values or retrieve from choice
          if (lat && long) {
            this.selectedPoint = {
              option: true,
              position: {
                lat: lat,
                long: long,
              },
            };
          } else {
            // Handle the case where lat/long are not available
            console.warn('Latitude and Longitude are missing!');
          }


          if (this.currentMarker) {
            this.currentMarker.remove();
          }

          currentMarker = L.marker([this.selectedPoint.position.lat, this.selectedPoint.position.long], { icon: locationIcon })
            .addTo(this.map!);

          this.currentMarker = currentMarker;


          // this.savePoint(locationObject, newMarkerLocation, type);
          break;
        case 'jaune':
          console.log('selectedPoint for jaune value =>: ', this.selectedPoint);

          const jauneIcon = L.icon({
            iconUrl: '../../assets/icon/markjaune.svg',
            iconSize: [44, 44],
            iconAnchor: [22, 44],
            popupAnchor: [0, -44]
          });

          if (this.position.lat != undefined && this.position.long != undefined) {
            this.selectedPoint = {
              option: true,
              position: {
                lat: parseFloat(localStorage.getItem('lat') || '0'),
                long: parseFloat(localStorage.getItem('long') || '0'),
              },
            };
          }

          console.log('this.selectedPoint ', this.selectedPoint);


          if (this.selectedPoint) {
            let newMarkerJaune = L.marker([this.selectedPoint.position.lat, this.selectedPoint.position.long], { icon: jauneIcon })
              .addTo(this.map!);
            this.removeMarker();




            let dateInii = new Date();


            let userLat = this.selectedPoint.position.lat;
            let userLng = this.selectedPoint.position.long;
            let objectJaune = {
              name: 'point de sos',
              address: '----',
              lat: userLat,
              lng: userLng,
              msg: choice.msg,
              numeroTel: choice.numeroTel,
              like: 0,
              dislike: 0,
              object: newMarkerJaune,
              userID: this.authService.$userinfo.id,
              username: this.authService.$userinfo.firstName + ' ' + this.authService.$userinfo.lastName,
              role: this.authService.$userinfo.role.role_name,
              date: dateInii.getDate() + '-' + dateInii.getMonth() + '-' + dateInii.getFullYear(),
              heure: dateInii.getHours() + ':' + dateInii.getMinutes(),
            };
            this.savePoint(objectJaune, newMarkerJaune, type);
          }

          break;
        case 'green':
          const greenIcon = L.icon({
            iconUrl: '../../assets/icon/markgreen.svg', // Using the final green icon immediately
            iconSize: [44, 44],
            iconAnchor: [22, 44],
            popupAnchor: [0, -44]
          });

          if (!this.heldMarker) {
            presentToast('Erreur: Aucun point gris n\'a Ã©tÃ© placÃ©.', 'bottom', 'danger');
            return;
          }
          const stationPosition = this.heldMarker.getLatLng();

          let newMarkerGr = L.marker([stationPosition.lat, stationPosition.lng], { icon: greenIcon })
            .addTo(this.map!);
          
          this.heldMarker.remove();
          this.heldMarker = null;


          let dateIni = new Date();
          let formattedDate = dateIni.getFullYear() + '-' + (dateIni.getMonth() + 1).toString().padStart(2, '0') + '-' + dateIni.getDate().toString().padStart(2, '0');
          let formattedTime = dateIni.getHours().toString().padStart(2, '0') + ':' + dateIni.getMinutes().toString().padStart(2, '0');

          let objectS = {
            level: 'point de station',
            lat: stationPosition.lat,
            lng: stationPosition.lng,
            name: choice,
            like: 0,
            dislike: 0,
            object: newMarkerGr,
            userID: this.authService.$userinfo.id,
            username:
              this.authService.$userinfo.firstName +
              ' ' +
              this.authService.$userinfo.lastName,
            role: this.authService.$userinfo.role.role_name,
            date: formattedDate,
            heure: formattedTime,
          };

          this.savePoint(objectS, newMarkerGr, type);
          // Close the status modal after creation
          this.displayer.statusDisplay = false;

          break;

        case 'note':
          console.log('content of note', choice);

          const blueIcon = L.icon({
            iconUrl: '../../assets/icon/markblue.svg',
            iconSize: [44, 44],
            iconAnchor: [22, 44],
            popupAnchor: [0, -44]
          });

          let newMarkerBl = L.marker([choice.lat, choice.lg], { icon: blueIcon })
            .addTo(this.map!);
          this.removeMarker();
          let dateIn = new Date();

          let objectN = {
            level: 'point de note marine',
            address: '----',
            lat: choice.lat,
            lng: choice.lg,
            lieu:choice.lieu,
            type: choice.type,
            name: choice.destination,
            like: 0,
            dislike: 0,
            object: newMarkerBl,
            userId: this.authService.$userinfo.id, // FIX: Changed userID to userId for consistency
            username:
              this.authService.$userinfo.firstName +
              ' ' +
              this.authService.$userinfo.lastName,
            role: this.authService.$userinfo.role.role_name,
            heureDebut: choice.heure,

            date:
              dateIn.getDate() +
              '-' +
              dateIn.getMonth() +
              '-' +
              dateIn.getFullYear(),
            heure: dateIn.getHours() + ':' + dateIn.getMinutes(),
          };
          this.savePoint(objectN, newMarkerBl, type);

          break;

        case 'event':
          console.log('selected choice ', choice);
          let accepted = this.checkDates(choice, 'create');

          if (accepted) {
            let level =
              this.authService.$userinfo.role.role_name == 'chauffeur'
                ? '1'
                : '';

            const eventIcon = L.icon({
              iconUrl: this.markerLevel(
                type,
                level,
                this.authService.$userinfo.id,
                this.authService.$userinfo.role.role_name
              ),
              iconSize: [44, 44],
              iconAnchor: [22, 44],
              popupAnchor: [0, -44]
            });

            // if (this.selectedPoint?.position?.lat == undefined) {
            // presentToast('merci de pointer sur une position', 'top', 'danger')
            let userLat = choice?.lat;
            let userLng = choice?.lg;

            this.selectedPoint = {
              option: true,
              position: {
                lat: userLat,
                lng: userLng,
              },
            };

            // console.log(" lat : " + this.selectedPoint.position.lat + " lng : " +  this.selectedPoint.position.lng);
            // }

            let displayIt = this.checkDates(choice, 'none');
            let newMarkerV;
            if (displayIt && this.map) {
              newMarkerV = L.marker([
                this.selectedPoint.position.lat,
                this.selectedPoint.position.lng,
              ], { icon: eventIcon }).addTo(this.map);
            } else {
              newMarkerV = L.marker([
                this.selectedPoint.position.lat,
                this.selectedPoint.position.lng,
              ], { icon: eventIcon });
            }
            // console.log(this.selectedPoint);

            let objectV = {
              name: "point d'evenement",
              address: '---',
              lieu: choice.lieu,
              type: choice.type,
              date: choice.date,
              heureDebut: choice.heureDebut,
              heureFin: choice.heureFin,
              lat: this.selectedPoint.position.lat,
              lng: this.selectedPoint.position.lng,
              level: level,
              like: 0,
              dislike: 0,
              object: newMarkerV,
              userID: this.authService.$userinfo.id,
              role: this.authService.$userinfo.role.role_name,
              createDate: new Date(),
            };

            if (this.selectedPoint?.option == undefined) {
              if (this.selectedPoint && typeof this.selectedPoint.remove === 'function') {
                this.selectedPoint.remove();
              }
              this.selectedPoint = undefined;
            }

            this.savePoint(objectV, newMarkerV, type);
          } else {
            presentToast('cet Ã©vÃ©nement est dÃ©jÃ  fait !', 'bottom', 'danger');
          }
          break;

        default:
          break;
      }
    }
  }

  async myLocation() {
    if (!this.map) {
      presentToast('Map is not initialized', 'bottom', 'danger');
      return;
    }

    this.map.locate({ 
      watch: true, 
      setView: true, 
      maxZoom: 16, 
      enableHighAccuracy: true,
      timeout: 30000,        // 30 seconds timeout instead of default 10s
      maximumAge: 300000     // 5 minutes cache for position
    });

    const onLocationFound = (e: L.LocationEvent) => {
      const { lat: latitude, lng: longitude } = e.latlng;
      console.log('Updated Location:', latitude, longitude);

      localStorage.setItem('lat', latitude.toString());
      localStorage.setItem('long', longitude.toString());

      this.addMarker('location', { position: { lat: latitude, long: longitude } });
    }

    const onLocationError = (e: L.ErrorEvent) => {
      console.error('Location error:', e.message);
      presentToast('Erreur de localisation', 'bottom', 'danger');
    }

    this.map.on('locationfound', onLocationFound);
    this.map.on('locationerror', onLocationError);

    // Mettre Ã  jour la position toutes les 30 secondes (moins agressif)
    this.positionUpdateInterval = setInterval(() => {
      console.log("Mise Ã  jour de la position en cours...");
      this.map?.locate({
        enableHighAccuracy: true,
        timeout: 30000,        // 30 seconds timeout
        maximumAge: 300000     // 5 minutes cache
      });
    }, 30000); // 30 secondes au lieu de 10

    // ArrÃªter les mises Ã  jour aprÃ¨s 5 minutes
    this.positionTimeout = setTimeout(() => {
      this.map?.stopLocate();
      this.map?.off('locationfound', onLocationFound);
      this.map?.off('locationerror', onLocationError);
      clearInterval(this.positionUpdateInterval);
      console.log("Mise Ã  jour arrÃªtÃ©e aprÃ¨s 5 minutes.");
      presentToast('Localisation dÃ©sactivÃ©e aprÃ¨s 5 minutes', 'bottom', 'danger');
    }, 300000); // 300000 ms = 5 minutes
  }

  async locateCurrentPosition() {
    if (!this.map) {
      presentToast('Map is not initialized', 'bottom', 'danger');
      return;
    }

    // Always try to get fresh GPS location when user clicks GPS button
    presentToast('Localisation en cours...', 'bottom', 'primary');
    
    this.map.locate({
      setView: false,        // Handle view manually for better control
      enableHighAccuracy: true,
      timeout: 30000,        // 30 seconds timeout
      maximumAge: 60000      // Use 1 minute cache for manual location requests
    });

    // Set up one-time event handlers for this location request
    const onLocationFound = (e: L.LocationEvent) => {
      const { lat: latitude, lng: longitude } = e.latlng;
      console.log('Manual location found:', latitude, longitude);
      localStorage.setItem('lat', latitude.toString());
      localStorage.setItem('long', longitude.toString());
      
      // Manually fly to the location with proper zoom
      this.map?.flyTo([latitude, longitude], 17);
      this.addMarker('location', { position: { lat: latitude, long: longitude } });
      presentToast('Position mise Ã  jour', 'bottom', 'success');
      
      // Remove event listeners after successful location
      this.map?.off('locationfound', onLocationFound);
      this.map?.off('locationerror', onLocationError);
    };

    const onLocationError = (e: L.ErrorEvent) => {
      console.error('Manual location error:', e.message);
      presentToast('Erreur de localisation. VÃ©rifiez vos paramÃ¨tres GPS.', 'bottom', 'danger');
      
      // Fallback to stored coordinates if available
      const lat = localStorage.getItem('lat');
      const lng = localStorage.getItem('long');
      if (lat && lng) {
        const latitude = parseFloat(lat);
        const longitude = parseFloat(lng);
        if (!isNaN(latitude) && !isNaN(longitude)) {
          this.map?.flyTo([latitude, longitude], 17);
          this.addMarker('location', { position: { lat: latitude, long: longitude } });
          presentToast('Position prÃ©cÃ©dente utilisÃ©e', 'bottom', 'warning');
        }
      }
      
      // Remove event listeners after error
      this.map?.off('locationfound', onLocationFound);
      this.map?.off('locationerror', onLocationError);
    };

    this.map.on('locationfound', onLocationFound);
    this.map.on('locationerror', onLocationError);
  }

  markerLevel(type: string, level: string, id: string, role: string): string {
    // Protective guard clause: If user info isn't loaded yet, return a default or empty icon path.
    if (!this.authService.$userinfo) {
      return ''; // Or a path to a default placeholder icon
    }

    if (type == 'red') {
      if (role == 'chauffeur') {
        if (id == this.authService.$userinfo.id) {
          switch (level) {
            case '0':
              return '../../assets/icon/markerRed0Own.svg';
            case '1':
              return '../../assets/icon/markerRed1Own.svg';
            case '2':
              return '../../assets/icon/markerRed2Own.svg';
            case '3':
              return '../../assets/icon/markerRed3Own.svg';
            case '4':
              return '../../assets/icon/markerRed4Own.svg';
          }
        } else {
          switch (level) {
            case '0':
              return '../../assets/icon/markerRed0.svg';
            case '1':
              return '../../assets/icon/markerRed1.svg';
            case '2':
              return '../../assets/icon/markerRed2.svg';
            case '3':
              return '../../assets/icon/markerRed3.svg';
            case '4':
              return '../../assets/icon/markerRed4.svg';
          }
        }
      } else {
        if (id == this.authService.$userinfo.id) {
          switch (level) {
            case '0':
              return '../../assets/icon/markerRed0OrgOwn.svg';
            case '1':
              return '../../assets/icon/markerRed1OrgOwn.svg';
            case '2':
              return '../../assets/icon/markerRed2OrgOwn.svg';
            case '3':
              return '../../assets/icon/markerRed3OrgOwn.svg';
            case '4':
              return '../../assets/icon/markerRed4OrgOwn.svg';
          }
        } else {
          switch (level) {
            case '0':
              return '../../assets/icon/markerRed0Org.svg';
            case '1':
              return '../../assets/icon/markerRed1Org.svg';
            case '2':
              return '../../assets/icon/markerRed2Org.svg';
            case '3':
              return '../../assets/icon/markerRed3Org.svg';
            case '4':
              return '../../assets/icon/markerRed4Org.svg';
          }
        }
      }
    } else if (type == 'event') {
      return '../../assets/icon/markerEvent1.svg';
    } else if (type == 'jaune') {
      return '../../assets/icon/markjaune.svg'
    } else if (type == 'location') {
      return '../../assets/icon/mylocationGreen.svg'
    } else if (type == 'green') {
      return '../../assets/icon/markgreen.svg'
    } else if (type == 'note' || type == 'blue') {
      return '../../assets/icon/markblue.svg'
    }
    return 'no image to show';
  }

  widgetContent(
    type: string,
    id: string,
    index: number,
    like: number,
    dislike: number,
    content?: any
  ): string {
    if (type == 'red') {
      // --- HARD LOGGING ---
      console.log(`[Popup Auth Check] Type: ${type}, Point Owner: ${content.userId}, Current User: ${this.authService.$userinfo.id}`);
      if (content.userId == this.authService.$userinfo.id) {
        console.log('[Popup Auth Check] Verdict: Rendering OWNER view.');
        const dateTimeContent = !content.created_at
          ? `<div class="shimmer-container">
               <div class="shimmer-line" style="width: 120px; height: 14px; margin: 2px 0;"></div>
             </div>`
          : (() => {
              const displayDate = new Date(content.created_at);
              return `<span>${displayDate.toLocaleDateString('fr-FR')} Ã  ${displayDate.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}</span>`;
            })();

        return `<div class="bg-white ring-gray-900/5">
            <div class="mx-auto flex flex-col">
              <label class="py-1 font-light">Mise Ã  jour par  <span>${this.authService.$userinfo.firstName
          } ${this.authService.$userinfo.lastName}</span></label> 
              <label class="py-1 font-light">Date: : ${dateTimeContent}</label>
            </div>
            <ion-button id="${'supprimer' + index
          }" class="mt-2" size="small" fill="outline" style="--border-color:#EB2F06; --color:#EB2F06; text-transform: none;">Supprimer</ion-button>
            <style>
              .shimmer-container {
                display: inline-block;
              }
              .shimmer-line {
                background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
                background-size: 200% 100%;
                animation: shimmer 1.5s infinite;
                border-radius: 4px;
                display: inline-block;
              }
              @keyframes shimmer {
                0% { background-position: -200% 0; }
                100% { background-position: 200% 0; }
              }
            </style>
          </div>`;
      } else {
        console.log('[Popup Auth Check] Verdict: Rendering OTHER USER view.');
        return `<div class="bg-white ring-gray-900/5">
        <div class="mx-auto flex flex-col">
          <label class="py-1 text-center">Est ce encore d'actualitÃ© ?</label>
          <div class="flex">
            <div id="user-1-${index}" class="border-4 border-[#B3B3B3] rounded p-3">
              <img src="../../assets/icon/redUser.svg" width="20">
            </div>
            <div id="user-2-${index}" class="border-4 border-[#B3B3B3] rounded py-3 px-2 mx-1">
              <img src="../../assets/icon/twoRedUsers.svg" width="30">
            </div>
            <div id="user-3-${index}" class="border-4 border-[#B3B3B3] rounded py-3 px-1">
              <img src="../../assets/icon/threeUser.svg" width="40">
            </div>
            <div id="user-4-${index}" class="border-4 border-[#B3B3B3] rounded py-3 px-2 mx-1">
              <img src="../../assets/icon/fourUser.svg" width="30">
            </div>
            <div id="user-0-${index}" class="border-4 border-[#B3B3B3] rounded p-3">
              <img src="../../assets/icon/darkUser.svg" width="20">
            </div>
          </div>
        </div>
        <div class="flex justify-between">
          <div class="flex mt-2">
            <span id="${'like-' + index}" class="flex items-center mr-2">
              <img src="../../assets/icon/thumGreen.svg" width="30" class="mr-2" /> <span>${like}</span>
            </span>
            <span id="${'dislike-' + index}" class="flex items-center mr-2">
              <img src="../../assets/icon/thumRed.svg" width="30" class="mr-2" /> <span>${dislike}</span>
            </span>
          </div>
          <div>
            <ion-button id="${'btnValider-' + index
          }" class="mt-2" size="small" style="--background:#1D4999; --color:#FFFFFF; text-transform: none;">Valider</ion-button>
          </div>
        </div>
      </div>`;
      }
    } else if (type == 'event') {
      // --- HARD LOGGING ---
      console.log(`[Popup Auth Check] Type: ${type}, Point Owner: ${content.userId}, Current User: ${this.authService.$userinfo.id}`);
      if (content.userId == this.authService.$userinfo.id) {
        console.log('[Popup Auth Check] Verdict: Rendering OWNER view.');
        return `<div class="bg-white ring-gray-900/5">
          <div class="mx-auto flex flex-col">
            <label class="py-1 font-light">Lieu : <span>${content.lieu
          }</span></label>
            <label class="py-1 font-light">Type : <span>${content.type
          }</span></label>
            <label class="py-1 font-light">Date: : <span>${
              content.date
            } de ${content.heureDebut} ${
              content.heureFin
            ? 'a ' + content.heureFin
            : +content.heureDebut.split(':')[0] +
              1 +
              ':' +
              content.heureDebut.split(':')[1]
          }</span></label>
          </div>
          <ion-button id="${'supprimerEvent' + index
                    }" class="mt-2" size="small" fill="outline" style="--border-color:#EB2F06; --color:#EB2F06; text-transform: none;">Supprimer</ion-button>
          <ion-button id="${'btnUpdateEvent' + index
          }" class="mt-2" size="small" fill="outline" style="--border-color:#A259FF; --color:#A259FF; text-transform: none;">Modifier</ion-button>

        </div>`;
      } else {
        console.log('[Popup Auth Check] Verdict: Rendering OTHER USER view.');
        return `<div class="bg-white ring-gray-900/5">
          <div class="mx-auto flex flex-col">
            <label class="py-1 font-light">Lieu : <span>${content.lieu
          }</span></label>
            <label class="py-1 font-light">Type : <span>${
              content.type
            }</span></label>
            <label class="py-1 font-light">Date: : <span>${
              content.date
            } de ${content.heureDebut} ${
              content.heureFin != null
            ? 'Ã  ' + content.heureFin
            : +content.heureDebut.split(':')[0] +
            1 +
            ':' +
            content.heureDebut.split(':')[1]
          }</span></label>
          </div>
          <div class="flex mt-2">
            <span id="${'like-' + index}" class="flex items-center mr-2">
              <img src="../../assets/icon/thumGreen.svg" width="30" class="mr-2" /> <span>${like}</span>
            </span>
            <span id="${'dislike-' + index}" class="flex items-center mr-2">
              <img src="../../assets/icon/thumRed.svg" width="30" class="mr-2" /> <span>${dislike}</span>
            </span>
          </div>
        </div>`;
      }
    } else if (type == 'jaune') {
      // --- HARD LOGGING ---
      console.log(`[Popup Auth Check] Type: ${type}, Point Owner: ${content.userId}, Current User: ${this.authService.$userinfo.id}`);
      if (content.userId == this.authService.$userinfo.id) {
        console.log('[Popup Auth Check] Verdict: Rendering OWNER view.');
        return `<div class="bg-white ring-gray-900/5">
          <div class="mx-auto flex flex-col">
            <label class="py-1 font-bold">Mon alerte SOS</label>
            <p class="py-1 font-light">Message: <br><strong>${content.msg}</strong></p>
            <p class="py-1 font-light">NumÃ©ro: <strong>${content.numeroTel}</strong></p>
          </div>
          <ion-button id="${'btnUpdateSos' + index
          }" class="mt-2" size="small" fill="fill" style="--background:#1D4999;--background-activated:#173d84; text-transform: none;" class="mr-1 h-[40px] w-full border-2 border-[#1D4999] rounded-xl bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white">Modifier</ion-button>
          <ion-button id="${'supprimerSos' + index
          }" class="mt-2" size="small" fill="outline" style="--border-color:#EB2F06; --color:#EB2F06; text-transform: none;">Supprimer</ion-button>
        </div>`;
      } else {
        console.log('[Popup Auth Check] Verdict: Rendering OTHER USER view.');
        return `<div class="bg-white ring-gray-900/5">
          <div class="mx-auto flex flex-col">
             <label class="py-1 text-center font-bold text-yellow-500">ALERTE SOS</label>
             <p class="py-1 font-light">Message: <br><strong>${content.msg}</strong></p>
             <p class="py-1 font-light">NumÃ©ro de contact: <strong>${content.numeroTel}</strong></p>
          </div>
        <div class="flex justify-between">
          <div class="flex mt-2">
            <span id="${'like-' + index}" class="flex items-center mr-2">
              <img src="../../assets/icon/thumGreen.svg" width="30" class="mr-2" /> <span>${like}</span>
            </span>
            <span id="${'dislike-' + index}" class="flex items-center mr-2">
              <img src="../../assets/icon/thumRed.svg" width="30" class="mr-2" /> <span>${dislike}</span>
            </span>
          </div>
          <div>
          </div>
        </div>
      </div>`;
      }
    }
    if (type == 'green') {
      // --- HARD LOGGING ---
      console.log(`[Popup Auth Check] Type: ${type}, Point Owner: ${content.userId}, Current User: ${this.authService.$userinfo.id}`);
      if (content.userId == this.authService.$userinfo.id) {
        console.log('[Popup Auth Check] Verdict: Rendering OWNER view.');
        return `<div class="bg-white ring-gray-900/5 rounded-lg p-4 shadow-md">
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">
              Lieu: <span class="font-bold text-black">${content.name}</span>
            </label>
            <label class="block text-gray-700 font-light mb-1">
              <input type="radio" name="stationOptions${index}" class="mr-2" id="incorrectLocation${index}"> 
              L'emplacement n'est pas correct
            </label>
            <label class="block text-gray-700 font-light mb-1">
              <input type="radio" name="stationOptions${index}" class="mr-2" id="stationDoesNotExist${index}"> 
              La station n'existe plus
            </label>
            <label class="block text-gray-700 font-light mb-1">
              <input type="radio" name="stationOptions${index}" class="mr-2" id="modifyQueue${index}"> 
              Modifier la file
            </label>
          </div>
          <div class="flex justify-between">
            <ion-button
              id="updateStation${index}"
              class="h-10 w-full rounded-md bg-[#1D4999] text-white font-semibold text-sm"
              style="--background: #1D4999; --background-activated: #173d84; text-transform: none;">
              Modifier
            </ion-button>
          </div>
        </div>`;
      } else {
        // View for other users: Join/Leave Queue and Like/Dislike
        const isInThisQueue = this.activeQueueStationId === content.id;
        const buttonText = isInThisQueue ? "Quitter la file" : "Rejoindre la file";
        const buttonColor = isInThisQueue ? "#EB2F06" : "#1D4999"; // Red for Leave, Blue for Join

        return `<div class="bg-white ring-gray-900/5 p-4 shadow-md">
          <div class="mx-auto flex flex-col">
            <label class="block text-gray-700 font-medium mb-2">
              Station: <span class="font-bold text-black">${content.name}</span>
            </label>
            <p class="text-sm text-gray-500">CrÃ©Ã© par: ${content.username}</p>
          </div>
          <div class="flex justify-between items-center mt-3">
            <div class="flex mt-2">
              <span id="${'like-' + index}" class="flex items-center mr-4 cursor-pointer">
                <img src="../../assets/icon/thumGreen.svg" width="30" class="mr-2" /> <span>${like}</span>
              </span>
              <span id="${'dislike-' + index}" class="flex items-center cursor-pointer">
                <img src="../../assets/icon/thumRed.svg" width="30" class="mr-2" /> <span>${dislike}</span>
              </span>
            </div>
            <div>
              <ion-button
                id="joinQueueBtn-${index}"
                class="h-10 rounded-md text-white font-semibold text-sm"
                style="--background: ${buttonColor}; --background-activated: #173d84; text-transform: none;">
                ${buttonText}
              </ion-button>
            </div>
          </div>
        </div>`;
      }
    }
   if (type == 'note' || type=='blue') {
        // --- HARD LOGGING ---
        console.log(`[Popup Auth Check] Type: ${type}, Point Owner: ${content.userId}, Current User: ${this.authService.$userinfo.id}`);
        if (content.userId == this.authService.$userinfo.id) {
          console.log('[Popup Auth Check] Verdict: Rendering OWNER view.');
          return `
          <div class="bg-white ring-gray-900/5">
            <div class="mx-auto flex flex-col">
              <label class="py-1 font-bold">Ma Note</label>
              <p class="py-1 font-light">Lieu: <strong>${content.lieu}</strong></p>
              <p class="py-1 font-light">Destination: <strong>${content.name}</strong></p>
              <p class="py-1 font-light">Heure: <strong>${content.heureDebut}</strong></p>
            </div>
            <div class="flex justify-between">
              <ion-button
                id="${'updateNote' + index}"
                class="h-10 w-full rounded-md bg-[#1D4999] text-white font-semibold text-sm"
                style="--background: #1D4999; --background-activated: #173d84; text-transform: none;">
                Modifier
              </ion-button>
              <ion-button id="${'supprimerNote' + index}" class="mt-2" size="small" fill="outline" style="--border-color:#EB2F06; --color:#EB2F06; text-transform: none;">Supprimer</ion-button>
            </div>
          </div>`;
        } else {
          return `<div class="bg-white ring-gray-900/5 p-4 shadow-md">
            <div class="mx-auto flex flex-col">
              <label class="block text-gray-700 font-medium mb-2">
                Note: <span class="font-bold text-black">${content.name}</span>
              </label>
              <p class="text-sm text-gray-500">CrÃ©Ã© par: ${content.username}</p>
              <p class="text-sm text-gray-600 mt-1">Lieu: ${content.lieu}</p>
              <p class="text-sm text-gray-600">Heure: ${content.heureDebut}</p>
            </div>
            <div class="flex justify-between items-center mt-4">
              <div class="flex mt-2">
                <span id="${'like-' + index}" class="flex items-center mr-4 cursor-pointer">
                  <img src="../../assets/icon/thumGreen.svg" width="30" class="mr-2" /> <span>${like}</span>
                </span>
                <span id="${'dislike-' + index}" class="flex items-center cursor-pointer">
                  <img src="../../assets/icon/thumRed.svg" width="30" class="mr-2" /> <span>${dislike}</span>
                </span>
              </div>
              <div>
                <!-- Optional: Add a button for other users if needed in the future -->
              </div>
            </div>
          </div>`;
        }
      }
    else {
      return '';
    }
  }
  displayModify(index: any) { }

  onPause = () => {
    if (this.MarkerTimer) {
      clearInterval(this.MarkerTimer);
    }
    if (this.allMarkers.length > 0) {
      this.allMarkers.forEach((el: L.Marker) => {
        el.remove();
      });
      this.allMarkers = [];
    }
  };

  // This method is now enhanced and moved to line 1726

  displayBlueMarker() {
    console.log("show bluemarkers", this.blueMarkers)
    this.blueMarkers.forEach((el, index) => {
      let mapObject: any = {
        id: el.id,
        object: null,
      };

      console.log('el', el)
      let accepted = this.checkDates(el, 'none');
      console.log("this.checkDates(el, 'none'),this.checkDates(el, 'none')",)

      if (accepted) {
        const iconUrl = this.markerLevel('note', el.level, el.userId, el.role);

        // Create a Leaflet marker
        mapObject.object = this.createLeafletMarker(iconUrl, [el.lat, el.lng])
          .addTo(this.map!);

        // Create the content string for the popup
        const contentString = this.widgetContent(
          'note',
          el.userId,
          index,
          el.like,
          el.dislike,
          el
        );

        // Create a Leaflet popup
        mapObject.object.bindPopup(contentString, { maxWidth: 315 });

        mapObject.object.on('click', () => {
          setTimeout(() => {
            this.handleBtnClick(index, 'note', el);
            this.handleLikesAndDislikes(index, 'note', el);
          }, 500);
        });

        this.objectblueMarkers.push(mapObject);
        this.allMarkers.push(mapObject.object);
      } else {
        this.markerToUnactivate.push(el.id);
      }
    });

    if (this.markerToUnactivate.length > 0) {
      let json = {
        ids: this.markerToUnactivate,
      };

      this.pointService.$disablePoints(json).subscribe((data: any) => {
        if (data.data) {
          this.markerToUnactivate = [];
          this.getAllPoint();
        } else {
          presentToast('error: ' + data.message, 'bottom', 'danger');
        }
      });
    }
  }
  displayGreenMarker() {
    this.greenMarkers.forEach((el, index) => {
      let mapObject: any = {
        id: el.id,
        object: null,
      };

      const iconUrl = this.markerLevel('green', el.level, el.userId, el.role);

      if (this.map) { // Assurez-vous que la carte est initialisÃ©e
        mapObject.object = this.createLeafletMarker(iconUrl, [el.lat, el.lng])
          .addTo(this.map!);

        const contentString = this.widgetContent(
          'green',
          el.userId,
          index,
          el.like,
          el.dislike,
          el
        );

        mapObject.object.bindPopup(contentString, { maxWidth: 315 });

        mapObject.object.on('click', () => {
          this.checker = false;
          setTimeout(() => {
            this.handleBtnClick(index, 'green', el);
            this.handleLikesAndDislikes(index, 'green', el);
          }, 500);
        });

        this.objectgreenMarkers.push(mapObject);
        this.allMarkers.push(mapObject.object);
      } else {
        this.markerToUnactivate.push(el.id);
      }
    });

    if (this.markerToUnactivate.length > 0) {
      let json = {
        ids: this.markerToUnactivate,
      };

      this.pointService.$disablePoints(json).subscribe((data: any) => {
        if (data.data) {
          this.markerToUnactivate = [];
          this.getAllPoint();
        } else {
          presentToast('error: ' + data.message, 'bottom', 'danger');
        }
      });
    }
  }

  displayJauneMarker() {
    this.jauneMarkers.forEach((el, index) => {
      let mapObject: any = {
        id: el.id,
        object: null,
      };

      const iconUrl = this.markerLevel('jaune', el.level, el.userId, el.role);

      if (this.map) { // Assurez-vous que la carte est initialisÃ©e
        mapObject.object = this.createLeafletMarker(iconUrl, [el.lat, el.lng])
          .addTo(this.map!);

        const contentString = this.widgetContent(
          'jaune',
          el.userId,
          index,
          el.like,
          el.dislike,
          el
        );

        mapObject.object.bindPopup(contentString, { maxWidth: 315 });

        mapObject.object.on('click', () => {
          this.checker = false;
          setTimeout(() => {
            this.handleBtnClick(index, 'jaune', el);
            this.handleLikesAndDislikes(index, 'jaune', el);
          }, 500);
        });

        this.objectjauneMarkers.push(mapObject);
        this.allMarkers.push(mapObject.object);
      } else {
        this.markerToUnactivate.push(el.id);
      }
    });

    if (this.markerToUnactivate.length > 0) {
      let json = {
        ids: this.markerToUnactivate,
      };

      this.pointService.$disablePoints(json).subscribe((data: any) => {
        if (data.data) {
          this.markerToUnactivate = [];
          this.getAllPoint();
        } else {
          presentToast('error: ' + data.message, 'bottom', 'danger');
        }
      });
    }

  }

  displayRedMarker() {
    this.redMarkers.forEach((el, index) => {
      let mapObject: any = {
        id: el.id,
        object: null,
      };

      const iconUrl = this.markerLevel('red', el.level, el.userId, el.role);
 if (this.map) { // Assurez-vous que la carte est initialisÃ©e
        mapObject.object = this.createLeafletMarker(iconUrl, [el.lat, el.lng])
          .addTo(this.map!);

        const contentString = this.widgetContent(
          'red',
          el.userId,
          index,
          el.like,
          el.dislike,
          el
        );

        mapObject.object.bindPopup(contentString, { maxWidth: 315 });

        mapObject.object.on('click', () => {
          this.checker = false;
          setTimeout(() => {
            this.handleBtnClick(index, 'red', el);
            this.handleLikesAndDislikes(index, 'red', el);
          }, 500);
        });

        this.objectredMarkers.push(mapObject);
        this.allMarkers.push(mapObject.object);
      } else {
        this.markerToUnactivate.push(el.id);
      }
    });

    if (this.markerToUnactivate.length > 0) {
      let json = {
        ids: this.markerToUnactivate,
      };

      this.pointService.$disablePoints(json).subscribe((data: any) => {
        if (data.data) {
          this.markerToUnactivate = [];
          this.getAllPoint();
        } else {
          presentToast('error: ' + data.message, 'bottom', 'danger');
        }
      });
    }
  }

  removeRedMarkers() {
    if (this.objectredMarkers.length > 0) {
      this.objectredMarkers.forEach((el) => {
        if (el.object != null) {
          el.object.remove();
          el.object = null;
        }
      });

      if (this.objectredMarkers.length > 0) this.objectredMarkers = [];
    }
  }

  findObjectByPointId(pointId: number, type: string): any {
    if (type == 'red') {
      return this.objectredMarkers.find((el) => el.id == pointId);
    }
    else if (type == 'jaune') {
      return this.objectjauneMarkers.find((el) => el.id == pointId);
    }
    else if (type == 'event') {
      return this.objectpurpleMarkers.find((el) => el.id == pointId);
    } else if (type == 'green') {
      return this.objectgreenMarkers.find((el) => el.id == pointId);
    }
  }

  datePlusOneHour(date: string) {
    let oldDate = new Date(date);
    let datePlusHour = oldDate.setHours(oldDate.getHours() + 1);
    const newDateTime = this.dateStructor('timestemp', datePlusHour);
    this.dateStructor('timestemp', datePlusHour);
    return newDateTime;
  }

  checkDates(element: any, action: string) {
    // const date = new Date();
    // const year = date.getFullYear();
    // const month = String(date.getMonth() + 1).padStart(2, '0');
    // const day = String(date.getDate()).padStart(2, '0');
    // const hours = String(date.getHours()).padStart(2, '0');
    // const minutes = String(date.getMinutes()).padStart(2, '0');
    // const seconds = String(date.getSeconds()).padStart(2, '0');

    // const currentDate:string = `${day}/${month}/${year}`;
    // const currentDateTime = `${year}-${month}-${day}T${hours}:${minutes}:${seconds}`;

    const currentDate: string = this.dateStructor('date');
    const currentDateTime = this.dateStructor('timestemp');

    if (!element?.date) {
      console.error("Error: element.date is null or undefined.");
      return false;
    }

    const dates: any = element.date.split(' - ');

    let valide = false;

    if (action == 'create') {
      return true;
    }

    dates.forEach((date: string) => {
      if (date == currentDate) {
        let dateToSplet = date.split('/');
        const DateTimeBegin = `${dateToSplet[2]}-${dateToSplet[1]}-${dateToSplet[0]}T${element.heureDebut}:00`;
        console.log('date debut : ' + DateTimeBegin);

        if (element.heureFin) {
          const DateTimeEnd = `${dateToSplet[2]}-${dateToSplet[1]}-${dateToSplet[0]}T${element.heureFin}:00`;
          console.log('date fin : ' + DateTimeEnd);

          if (this.isDateBetween(currentDateTime, DateTimeBegin, DateTimeEnd)) {
            valide = true;
          }
        } else {
          const newDateTime = this.datePlusOneHour(DateTimeBegin);
          console.log('date fin : ' + newDateTime);

          if (this.isDateBetween(currentDateTime, DateTimeBegin, newDateTime)) {
            valide = true;
          }
        }
      }
    });
    return valide;
  }

  isDateBetween(date: string, startDate: string, endDate: string) {
    const currentDate = new Date(date);
    const DateBegin = new Date(startDate);
    const Dateend = new Date(endDate);
    return currentDate >= DateBegin && currentDate <= Dateend;
  }

  displayEventMarkers() {
    console.log('events markers ', this.purpleMarkers)
    this.purpleMarkers.forEach((el, index) => {
      let mapObject: any = {
        id: el.id,
        object: null,
      };



      // Create a custom icon
      let beachFlagImgUrl = this.markerLevel('event', el.level, el.userId, el.role);
      let iconSize = [44, 44];

      // Create a Leaflet marker
      mapObject.object = this.createLeafletMarker(beachFlagImgUrl, [el.lat, el.lng], { width: iconSize[0], height: iconSize[1] });
      if (this.map) {
        mapObject.object.addTo(this.map);
      }

      // Create the content string for the popup
      const contentString = this.widgetContent(
        'event',
        el.userId,
        index,
        el.like,
        el.dislike,
        el
      );

      // Create a Leaflet popup
      mapObject.object.bindPopup(contentString, { maxWidth: 315 });

      // Add a click event listener to the marker to open the popup
      mapObject.object.on('click', () => {
        setTimeout(() => {
          this.handleBtnClick(index, 'event', el);
          this.handleLikesAndDislikes(index, 'event', el);
        }, 500);
      });

      this.objectpurpleMarkers.push(mapObject);
      this.allMarkers.push(mapObject.object);
    });
  }

  removeEventMarkers() {
    if (this.objectpurpleMarkers.length > 0) {
      this.objectpurpleMarkers.forEach((el) => {
        if (el.object != null) {
          el.object.remove();
          el.object = null;
        }
      });
      if (this.objectpurpleMarkers.length > 0) this.objectpurpleMarkers = [];
    }
  }

  removeAllMarkers() {
    this.removeRedMarkers();
    this.removeEventMarkers();

  }

  private allMarkers: L.Marker[] = []; // Stocke tous les marqueurs pour pouvoir les retirer facilement
  

  private getCategoryForType(type: string): string {
    switch (type) {
      case 'red': return 'affluence';
      case 'event': return 'event';
      case 'green': return 'station';
      case 'blue': return 'note';
      case 'jaune': return 'sos';
      default: return '';
    }
  }

  makeObjectMarker(keepView: boolean = false) {
    this.clearMarker();
  
    const hasSelectedCategory = Object.values(this.selectedBtn).some(selected => selected);
  
    // 1. Always render all markers
    this.addMarkers(this.purpleMarkers, 'event');
    this.addMarkers(this.redMarkers, 'red');
    this.addMarkers(this.greenMarkers, 'green');
    this.addMarkers(this.blueMarkers, 'blue');
    this.addMarkers(this.jauneMarkers, 'jaune');
  
    if (hasSelectedCategory) {
      // 4. Navigate to fit the bounds of the selected category's markers
      let selectedMarkers: any[] = [];
      const selectedCategoryName = Object.keys(this.selectedBtn).find(key => this.selectedBtn[key]);
  
      if (selectedCategoryName) {
        switch (selectedCategoryName) {
          case 'event':     selectedMarkers = this.purpleMarkers; break;
          case 'affluence': selectedMarkers = this.redMarkers;   break;
          case 'station':   selectedMarkers = this.greenMarkers;  break;
          case 'note':      selectedMarkers = this.blueMarkers;  break;
          case 'sos':       selectedMarkers = this.jauneMarkers;  break;
        }
        this.calculateAndNavigateToCenter(selectedMarkers, selectedCategoryName);
      }
    } else if (!keepView) {
      // If no filter is active, reset the view
      this.map?.setView([this.position.lat, this.position.long], 12);
    }
  }

  private calculateAndNavigateToCenter(markers: any[], type: string): boolean {
    // Filter out any markers with invalid or null coordinates before calculating the center.
    const validMarkers = markers.filter(marker => {
      const lat = parseFloat(marker.lat);
      const lng = parseFloat(marker.lng);
      // A simple check for [0, 0] or non-numeric values.
      return !isNaN(lat) && !isNaN(lng) && (lat !== 0 || lng !== 0);
    });

    if (validMarkers.length === 0) {
      presentToast(`Aucun point '${type}' Ã  afficher.`, 'bottom', 'warning');
      return false;
    }

    // Create an array of Leaflet LatLng objects from the valid markers.
    const latLngs = validMarkers.map(marker => L.latLng(parseFloat(marker.lat), parseFloat(marker.lng)));

    // Create a bounds object from the coordinates.
    const bounds = L.latLngBounds(latLngs);

    // Use fitBounds to automatically set the best center and zoom level.
    // The padding option ensures markers aren't right at the edge of the screen.
    this.map?.fitBounds(bounds, { padding: [50, 50], maxZoom: 12 });
    return true;
  }

  /**
   * Enhanced addMarkers method with better fading integration
   */
  private addMarkers(markerList: any[], type: string) {
    const hasSelectedCategory = Object.values(this.selectedBtn).some(selected => selected);
    const buttonCategory = this.getCategoryForType(type);
    const isThisCategorySelected = this.selectedBtn[buttonCategory];
  
    markerList.forEach((markerData, index) => {
      const iconUrl = this.getIconForType(type, markerData);
      if (!iconUrl) return;
  
      const newMarker = this.createLeafletMarker(iconUrl, [markerData.lat, markerData.lng])
        .addTo(this.map!);
  
      // 2 & 3. Set opacity based on filter selection
      const markerElement = newMarker.getElement();
      if (markerElement) {
        if (hasSelectedCategory && !isThisCategorySelected) {
          // This marker is not in the selected category, make it transparent
          markerElement.style.opacity = '0.2';
          markerElement.style.pointerEvents = 'none'; // Make transparent markers non-interactive
        } else {
          // This marker is in the selected category or no category is selected, make it opaque
          markerElement.style.opacity = '1';
          markerElement.style.pointerEvents = 'auto';
        }
        markerElement.style.transition = 'opacity 0.3s ease-in-out';
      }
  
      this.bindPopupToMarker(newMarker, { ...markerData, index }, type);
      this.allMarkers.push(newMarker);
  
      // Special handling for affluence points to start their fading timer
      if (type === 'red') {
        this.startFadingForPoint(newMarker, markerData);
      }
    });
  }

  /**
   * Starts the fading process for a given affluence point marker.
   * The duration and fading logic are determined by the point's 'level'.
   * @param marker The Leaflet marker instance on the map.
   * @param pointData The data associated with the affluence point.
   */
  private startFadingForPoint(marker: L.Marker, pointData: any) {
    // Fading and expiration logic removed as per request.
  }

  private clearMarker() {
    console.log('Clearing all markers and timers');
    
    // Remove all markers from map
    this.allMarkers.forEach(marker => {
      try {
        marker.remove();
      } catch (error) {
        console.error('Error removing marker:', error);
      }
    });
    this.allMarkers = [];

    // Clear all affluence timers
    const timerCount = Object.keys(this.affluenceTimers).length;
    Object.keys(this.affluenceTimers).forEach(pointId => {
      clearInterval(this.affluenceTimers[parseInt(pointId)]);
    });
    this.affluenceTimers = {};
  }

  getIconForType(type: string, el: any): string {
    return this.markerLevel(type, el.level, el.userId, el.role);
  }

  bindPopupToMarker(marker: any, content: any, type: string) {
    const popupContent = this.widgetContent(type, content.userId, content.index, content.like, content.dislike, content);
    marker.bindPopup(popupContent, { maxWidth: 315 });

    // Use the 'popupopen' event to guarantee the popup's HTML content is in the DOM
    // before we try to attach event listeners to its buttons.
    marker.on('popupopen', () => {
      this.checker = false; // Keep this to manage UI state if needed
      this.handleBtnClick(content.index, type, content);
      this.handleLikesAndDislikes(content.index, type, content);
    });
  }

  // handling event click of infoWindow (red and event)

  openLocationUpdateModal(station: any) {
    console.log("Opening modal to update station location...");
  
    // Create the modal container
    const modal = document.createElement('div');
    modal.id = 'locationUpdateModal';
    modal.className = 'absolute top-0 left-0 right-0 bottom-0 flex justify-center items-center';
  
    modal.innerHTML = `
      <div class="flex w-[80vw] flex-col rounded bg-white px-7 py-10 z-30">
        <div class="px-4 text-center font-[Montserrat] font-bold text-[18px] leading-6">
          Modifier une <span class="font-bold text-[#0198D7]">Station</span>
        </div>
        
        <div class="mb-1 mt-6">
          <div>
            <label class="text-[12px] montserrat-700">Nom de la station</label>
            <label class="relative block text-[13px]">
              <span class="sr-only text-[#02263D]">Nom de la station</span>
              <input
                id="stationInput"
                class="block w-full rounded border border-[#00396542] bg-white py-2 p-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm"
                placeholder="Rechercher une adresse..."
                type="text"
                name="station"
                value="${station.name || ''}"
              />
              <ul id="suggestionsList" class="absolute z-50 bg-white border border-gray-300 rounded w-full mt-1"></ul>
            </label>
          </div>
        </div>
  
        <div class="mt-6 flex justify-between">
          <button id="cancelUpdate"
            class="h-[40px] w-full rounded-xl border-2 border-[#1D4999] bg-transparent text-[13px] font-bold tracking-wide text-[#1D4999]"
            style="--background:transparent; --background-activated:#3332; text-transform: none;">
            Annuler
          </button>
          
          <button id="confirmUpdate"
            class="mr-1 h-[40px] w-full border-2 border-[#1D4999] rounded-xl bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white"
            style="--background:#1D4999;--background-activated:#173d84; text-transform: none;">
            Valider
          </button>
        </div>
      </div>
  
      <div id="modalOverlay" class="absolute top-0 z-10 flex h-[100vh] w-full items-center justify-center bg-[#0005]"></div>
    `;
  
    document.body.appendChild(modal);
  
    // Event listeners
    document.getElementById("cancelUpdate")?.addEventListener("click", () => modal.remove());
    document.getElementById("modalOverlay")?.addEventListener("click", () => modal.remove());
  
    // Fetch station name input
    const stationInput = document.getElementById("stationInput") as HTMLInputElement;
    const suggestionsList = document.getElementById("suggestionsList") as HTMLUListElement;
  
    // Handle input and fetch address suggestions
    stationInput.addEventListener("input", async () => {
      const query = stationInput.value.trim();
      if (query.length > 2) {
        const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&addressdetails=1&limit=5&accept-language=fr&countrycodes=fr`);
        const results = await response.json();
  
        suggestionsList.innerHTML = "";
        results.forEach((result: any) => {
          const li = document.createElement("li");
          li.className = "p-2 hover:bg-gray-100 cursor-pointer";
          li.innerText = result.display_name;
          li.addEventListener("click", () => {
            stationInput.value = result.display_name;
            suggestionsList.innerHTML = ""; // Clear suggestions
            
            // Update station coordinates
            station.lat = parseFloat(result.lat);
            station.lng = parseFloat(result.lon);
            localStorage.setItem('positionStation', JSON.stringify({ lat: station.lat, lon: station.lng }));
  
            // Center map on new position
            if (this.map) {
              this.map.flyTo([station.lat, station.lng], 14);
              L.marker([station.lat, station.lng])
                .addTo(this.map)
                .bindPopup(result.display_name)
                .openPopup();
            }
          });
          suggestionsList.appendChild(li);
        });
      } else {
        suggestionsList.innerHTML = "";
      }
    });
  
    // Confirm update
    document.getElementById("confirmUpdate")?.addEventListener("click", () => {
      const newStationName = stationInput.value.trim();
      
      if (!newStationName) {
        alert("Veuillez entrer un nouveau nom de station.");
        return;
      }
  
      console.log("Updating station:", newStationName, station.lat, station.lng);
  
      // Update station data
      const updateData = {
        id: station.id,
        type: 'green',
        newData: { name: newStationName, lat: station.lat, lng: station.lng }
      };
  
      // Call update function
      this.updatePoint(updateData);
      this.getAllPoint();
  
      // Close modal
      modal.remove();
    });
  }
  
  
  
  // Function to delete the station
  deleteStation(index: number, object: any, action: string) {
    this.updateEventContent(index, 'green', object, action);
  }

  getStationPoint(index: number, content: any) {
    const iconUrl = this.markerLevel('green', content.level, content.userId, content.role);
    return this.createLeafletMarker(iconUrl, [content.lat, content.lng]);
  }

  // Function to enable polyline drawing
  loadPolylines() {
    console.log("Attempting to load polylines...");
    this.clearPolylines(); // Clear any existing polylines first

    if (!this.map) {
      setTimeout(() => this.loadPolylines(), 100);
      return;
    }

    // Now, we iterate through the station markers that have been loaded from the API
    this.greenMarkers.forEach(station => {
      if (station.polyline) {
        try {
          const coordinates = JSON.parse(station.polyline);
          const polyline = L.polyline(coordinates, { color: 'gray', weight: 3, dashArray: '5, 10' }).addTo(this.map!);
        } catch (e) {
          console.error("Error parsing polyline data for station:", station.id, e);
        }
      }
    });
  }

  savePolylines() {
    const polylineData = this.polylines.map(poly => {
      const leafletPoly = poly.polyline as any as L.Polyline;
      return { id: poly.id, latlngs: leafletPoly.getLatLngs() };
    });
    localStorage.setItem('savedPolylines', JSON.stringify(polylineData));
  }

    clearPolylines(): void {
        this.polylines.forEach(poly => {
            (poly.polyline as any as L.Polyline).remove();
        });
        this.polylines = [];
    }

    // --- Refactored Polyline Drawing Logic ---
    private polylinePoints: L.LatLng[] = [];
    private currentPolyline: L.Polyline | null = null;
    private polylineMarkers: L.Marker[] = [];
    private mapClickHandler: ((e: L.LeafletMouseEvent) => void) | null = null;
  enablePolylineDrawing(index: number, content: any) {
    console.log("Enable map click for polyline drawing, station:", index);
    if (this.isDrawingPolyline) return; // Prevent starting a new drawing session if one is active

    this.isDrawingPolyline = true;
    presentToast("Mode modification de file activÃ©. Cliquez sur la carte pour dessiner.", "bottom", "success");

    // Start the line from the station's location
    this.polylinePoints = [L.latLng(content.lat, content.lng)];

    this.mapClickHandler = (e: L.LeafletMouseEvent) => {
        const newPoint = e.latlng;
        this.polylinePoints.push(newPoint);

        // Add a small dot marker for the new point
        const dotIcon = L.divIcon({
            className: 'polyline-dot-icon',
            html: '',
            iconSize: [8, 8]
        });
        const dotMarker = L.marker(newPoint, { icon: dotIcon }).addTo(this.map!);
        this.polylineMarkers.push(dotMarker);

        // Remove the old polyline and draw the new one
        if (this.currentPolyline) {
            this.currentPolyline.remove();
        }
        this.currentPolyline = L.polyline(this.polylinePoints, { color: 'gray', weight: 3, dashArray: '5, 10' }).addTo(this.map!);
    };

    if (this.map) {
      this.map.on("click", this.mapClickHandler);
    }
  }

    finishPolylineDrawing() {
        console.log("Finishing polyline drawing.");
        if (this.map && this.mapClickHandler) {
            this.map.off("click", this.mapClickHandler);
            this.mapClickHandler = null;
        }

        // Clean up the small dot markers used for drawing
        this.polylineMarkers.forEach(marker => marker.remove());
        this.polylineMarkers = [];

        // Save the final polyline to the backend
        if (this.currentPolyline) {
            const coordinates = this.currentPolyline.getLatLngs();
            console.log("Final polyline coordinates:", coordinates);
            
            // Find the station point ID from the polyline's starting point
            const stationId = this.greenMarkers.find(s => s.lat == this.polylinePoints[0].lat && s.lng == this.polylinePoints[0].lng)?.id;

            if (stationId) {
                const updateData = { id: stationId, type: 'green', newData: { polyline: JSON.stringify(coordinates) } };
                this.updatePoint(updateData);
            }
        }

        // Reset state
        this.isDrawingPolyline = false;
        this.polylinePoints = [];
        this.currentPolyline = null;

        presentToast("File d'attente modifiÃ©e avec succÃ¨s.", "bottom", "success");
    }

  closeAllPopups() {
    if (this.map) {
      this.map.eachLayer(layer => {
        if (layer instanceof L.Popup) {
          this.map!.closePopup(layer);
        }
      });
    }
  }
  

 handleBtnClick(index: number, type: string, object: any) {
     this.checker = true;
     let btn;
     let btnjaune;
     let action = '';


     
  if (type === 'green') {
    console.log("Handling update for green station");

    // Fetch buttons
    const updateBtn = document.getElementById(`updateStation${index}`);

    // --- Handle Join/Leave Queue Button for other users ---
    const joinQueueBtn = document.getElementById(`joinQueueBtn-${index}`);
    if (joinQueueBtn) {
      joinQueueBtn.addEventListener('click', () => this.toggleQueue(object));
    }

    if (updateBtn) {

      console.log(object)
      updateBtn.addEventListener('click', () => {

        const incorrectLocation = (document.getElementById(`incorrectLocation${index}`) as HTMLInputElement).checked;
        const stationDoesNotExist = (document.getElementById(`stationDoesNotExist${index}`) as HTMLInputElement).checked;
        const modifyQueue = (document.getElementById(`modifyQueue${index}`) as HTMLInputElement).checked;

        if (incorrectLocation) {
          console.log("Opening modal to update station location...");
          this.openLocationUpdateModal(object);
        } 
        else if (stationDoesNotExist) {
          console.log("Deleting station...");
          this.deleteStation(index!,object,"delete");
        } 
        else if (modifyQueue) {
          console.log("User can select a new point to create a polyline...");
          this.closeAllPopups();
          this.enablePolylineDrawing(object.id,object);
        } 
        else {
          console.warn("No radio button selected. Please choose an option before modifying.");
          presentToast(
            "Veuillez sÃ©lectionner une option avant de modifier.",
            'bottom',
            'danger'
          );
          return;
        }

        const updateData = {
          id: object.id,
          type: 'green',
          newData: {
            name: object.name,
            object: 'test',
          },
        };

        this.updatePoint(updateData);
        this.getAllPoint();
      });
    }
  }

        if ( type=='note' || type=='blue') {
                  btn = document.getElementById(`${'updateNote' + index}`);
                  if (btn) {
                    btn.addEventListener('click', () => {
                      this.updateEventContent(index!, 'note', object, 'update');

                    });
                  }
                  btn = document.getElementById(`${'supprimerNote' + index}`);
                  action = 'delete';
                  if (btn) {
                    btn.addEventListener('click', () => {
                      this.updateEventContent(index!, 'note', object, action);
                    });
                  }
                }

     if (type == 'event') {
                      btn = document.getElementById(`${'btnUpdateEvent' + index}`);
                      if (btn) {
                        btn.addEventListener('click', () => {
                          this.updateEventContent(index!, type, object, 'update');

                        });
                      }
                      btn = document.getElementById(`${'supprimerEvent' + index}`);
                      action = 'delete';
                      if (btn) {
                        btn.addEventListener('click', () => {
                          this.updateEventContent(index!, 'note', object, action);
                        });
                      }
                    }if (type == 'jaune') {
       btn = document.getElementById(`${'btnUpdateSos' + index}`);

       if (btn) {
         btn.addEventListener('click', () => {
           this.updateEventContent(index!, type, object, 'update');

         });
       }

       btn = document.getElementById(`${'supprimerSos' + index}`);
       action = 'delete';
       if (btn) {
         btn.addEventListener('click', () => {
           this.updateEventContent(index!, type, object, action);



         });
       }
     } else if (type == 'red') {
       if (this.authService.$userinfo.id == object.userId) {
         btn = document.getElementById(`${'supprimer' + index}`);
         action = 'delete';
          if (btn) {
                  btn.addEventListener('click', () => {
                    this.updateEventContent(index!, type, object, action);

                  });
                }
       } else { 
         btn = document.getElementById(`${'btnValider-' + index}`);
         action = 'validate';
          if (btn) {
                  btn.addEventListener('click', () => {
                    this.updateEventContent(index!, type, object, action);
                  });
                }
       } 
     }

   }


  handleLikesAndDislikes(index: number, type: string, object: any) {
    let likeBtn = document.getElementById(`${'like-' + index}`);
    let dislikeBtn = document.getElementById(`${'dislike-' + index}`);

    if (likeBtn) {
      likeBtn.addEventListener('click', () => {
        this.addLikesAndDislikes(index!, type, object, 'like');
      });
    }

    if (dislikeBtn) {
      dislikeBtn.addEventListener('click', () => {
        this.addLikesAndDislikes(index!, type, object, 'dislike');
      });
    }

    if (type == 'red') {
      let use0Btn = document.getElementById(`user-0-${index}`);
      let use1Btn = document.getElementById(`user-1-${index}`);
      let use2Btn = document.getElementById(`user-2-${index}`);
      let use3Btn = document.getElementById(`user-3-${index}`);
      let use4Btn = document.getElementById(`user-4-${index}`);

      let elements = [
        { name: 'use0Btn', lvl: '0', value: use0Btn },
        { name: 'use1Btn', lvl: '1', value: use1Btn },
        { name: 'use2Btn', lvl: '2', value: use2Btn },
        { name: 'use3Btn', lvl: '3', value: use3Btn },
        { name: 'use4Btn', lvl: '4', value: use4Btn },
      ];

      elements.forEach((el) => {
        if (el.value) {
          el.value.addEventListener(
            'click',
            () => {
              this.selectNews(el.lvl, object, el, elements);
            },
            { once: true }
          );
        }
      });
    }
  }



updateEventContent(index: number, type: string, object: any, action: string) {

 if (action === 'delete') {
      let json = {
              name: object.name,
              address: object.address,
              lat: object.lat,
              lng: object.lng,
              level: object.level,
              like: object.like,
              dislike: object.dislike,
              userId: object.userId,
              username: object.username,
              role: object.role,
              createDate: new Date(),
            };
        this.confirmationContent = 'Ãªtes-vous sÃ»r de vouloir supprimer ce point ?';
        this.displayer.deletePointConfirmation = true;
        this.selectedpointId = object.id;

        if(type==='blue'){
          type='note'}
        this.selectedPointType = type;
        this.loadMap();
        this.goToLocation({ lat: json.lat, lon: json.lng, address: json.address });



      }

  if(type==='jaune'  ){
    if(action==='update'){
      clearInterval(this.positionTimer);
      this.router.navigate([`/update-sos/${object.id}`]);
      this.getAllPoint();
      }
      }
  if(type==='green'){
        if(action==='update'){
           const incorrectLocation = (document.getElementById(`incorrectLocation${index}`) as HTMLInputElement).checked;
                const stationDoesNotExist = (document.getElementById(`stationDoesNotExist${index}`) as HTMLInputElement).checked;
                const modifyQueue = (document.getElementById(`modifyQueue${index}`) as HTMLInputElement).checked;
                 // Build update data
                 if(incorrectLocation || stationDoesNotExist || modifyQueue){
                      const updateData = {
                        id: object.id,
                        type: 'green',
                        newData: {
                          name: object.name,
                          object:'test'
                        }
                      };
                      this.updatePoint(updateData);
          this.getAllPoint();
          }
    }}
  if (type === 'note') {
    if (action === 'update') {
      clearInterval(this.positionTimer);
      this.router.navigate([`/update-note/${object.id}`]);
      this.getAllPoint();
    }
  }
    if (type === 'red' || type === 'jaune') {
      if (action === 'validate') {
        if (this.newSelectedLvl != undefined) {
          this.updateLvl(object.id, this.newSelectedLvl);

         this.getAllPoint();
        } else {
          presentToast(
            "selectionner une valeur depuis l'interface",
            'bottom',
            'danger'
          );
        }
      }
    }  if (type === 'event' && action !== 'delete') {
      clearInterval(this.positionTimer);
      this.router.navigate([`/update-evenement/${object.id}`]);
      this.getAllPoint();
    }
  }

  addLikesAndDislikes(
    index: number,
    type: string,
    object: any,
    feedback: string
  ) {
    if (type == 'red') {
      this.sendFeedbackPoint(object, type, feedback);
    } else if (type == 'event') {
      if (object.userId == this.authService.$userinfo.id) {
        this.router.navigate([`/update-evenement/${object.id}`]);
      } else {
        this.sendFeedbackPoint(object, type, feedback);
      }
    } else {
      console.log('update method runed with index ' + index + ' of no type :(');
    }
  }

  selectNews(level: string, object: any, clickedElement: any, allHtmlElements: any[]) {
    const clickedButton = clickedElement.value as HTMLElement;
    const isAlreadySelected = clickedButton.classList.contains('border-[#EB2F06]');

    // First, reset all buttons to the default (unselected) state.
    allHtmlElements.forEach(el => {
      (el.value as HTMLElement).classList.remove('border-[#EB2F06]');
      (el.value as HTMLElement).classList.add('border-[#B3B3B3]');
    });

    if (isAlreadySelected) {
      // If the user clicked the same button again, deselect it.
      this.newSelectedLvl = undefined;
      console.log('Affluence level deselected.');
    } else {
      // Otherwise, select the new button.
      clickedButton.classList.remove('border-[#B3B3B3]');
      clickedButton.classList.add('border-[#EB2F06]');
      this.newSelectedLvl = level;
      console.log(`Affluence level ${level} selected.`);
    }
  }

  profil(): Promise<any> {
    return new Promise((resolve, reject) => {
      this.authService.$profil().subscribe(
        (data: any) => {
          this.authService.$userinfo = data;
          this.authenticatedUser = data;
          if (this.authenticatedUser) {
            this.checkTrialPeriod();
          }
          resolve(data); // Resolve the promise with user data
        },
        (err) => {
          console.error('Error fetching profile:', JSON.stringify(err, null, 2));
          reject(err); // Reject the promise on error
        }
      );
    });
  }
  // check free trail :
  checkTrialPeriod() {
    if (!this.authenticatedUser) {
      return;
    }

    const createdAt = new Date(this.authenticatedUser.created_at);
    console.log('created at auth user', createdAt);
    const trialEndDate = new Date(createdAt.setMonth(createdAt.getMonth() + 2));
    const currentDate = new Date(createdAt); // remove createdAt to test the trial period

    console.log('current date (system)', currentDate);
    this.isTrialExpired = currentDate > trialEndDate;

    const hasRedirected = localStorage.getItem('hasRedirected');
    console.log('hasRedirected => ', hasRedirected);
    if (this.isTrialExpired && hasRedirected !== 'true') {
      localStorage.setItem('hasRedirected', 'true');
      this.router.navigate(['/premium']);
    }
  }
  sendFeedbackPoint(object: any, type: string, feedback: string) {
    let json = {
      pointId: object.id,
      feedback: feedback,
    };

    this.pointService.$feedbackPoint(json).subscribe((data: any) => {
      if (data.data) {
        if (feedback == 'like') {
          if (object.dislike == 0) {
            object.like = object.like == 0 ? 1 : 0;
          } else {
            object.like = object.like == 0 ? 1 : 0;
            object.dislike = 0;
          }
        } else if (feedback == 'dislike') {
          if (object.like == 0) {
            object.dislike = object.dislike == 0 ? 1 : 0;
          } else {
            object.dislike = object.dislike == 0 ? 1 : 0;
            object.like = 0;
          }

          // run API to update the point.
        }

        this.getAllPoint();
        presentToast(data.message, 'bottom', 'success');
      } else {
        presentToast(data.message, 'bottom', 'danger');
      }
    });
  }

  deletePoint(deleteData: { id: number, type: string }) {
    const json = {
      pointId: deleteData.id,
      type: deleteData.type
    };
    this.clearMarker();
    this.pointService.$deletePoint(json).subscribe({
      next: (response: any) => {
        if (response.data) {
          this.confirmationContent = '';
          this.getAllPoint();
          presentToast(response.message, 'bottom', 'success');
        } else {
          presentToast(response.message, 'bottom', 'danger');
        }

      },
      error: (error) => {
        presentToast('Error deleting point: ' + error.message, 'bottom', 'danger');
      }
    });
  }


  /*Update point */

  updatePoint(updateData: { id: number, type: string, newData: any }) {
    const json = {
      pointId: updateData.id,
      type: updateData.type,
      ...updateData.newData
    };

    this.pointService.$updatePoint(json).subscribe({
      next: (response: any) => {
        if (response.success) {

          this.getAllPoint();
          presentToast(response.message, 'bottom', 'success');
          this.displayer.editPointConfirmation = false;
        } else {
          presentToast(response.message, 'bottom', 'danger');
        }
      },
      error: (error) => {
        presentToast('Error updating point: ' + error.message, 'bottom', 'danger');
      }
    });
  }


  updateLvl(id: number, lvl: string) {
    let json = {
      pointId: id,
      level: lvl,
    };

    this.pointService.$updateLvlPoint(json).subscribe((data: any) => {
      if (data.data) {
        this.getAllPoint();
        presentToast(data.message, 'bottom', 'success');
      } else {
        presentToast(data.message, 'bottom', 'danger');
      }
    });
  }
  setSelectedMarker(value: any) {
    this.selectedPoint = value?.marker;
    this.markers = value?.markers;
    /*
    if(this.markers){
      // this.enableAffect=true;
      // console.log('enableAffect',this.enableAffect)
        }
        else{
          this.enableAffect=false;
          console.log('enableAffect',this.enableAffect)

        }*/
    console.log(this.markers);
  }

  dateStructor(
    format: string,
    date: string | number | undefined = undefined
  ): string {
    const dateStructer = date != undefined ? new Date(date) : new Date();
    const year = dateStructer.getFullYear();
    const month = String(dateStructer.getMonth() + 1).padStart(2, '0');
    const day = String(dateStructer.getDate()).padStart(2, '0');
    const hours = String(dateStructer.getHours()).padStart(2, '0');
    const minutes = String(dateStructer.getMinutes()).padStart(2, '0');
    const seconds = String(dateStructer.getSeconds()).padStart(2, '0');

    // Format the date in the desired format
    const currentDate: string = `${day}/${month}/${year}`;
    const currentDateTime = `${year}-${month}-${day}T${hours}:${minutes}:${seconds}`;

    if (format == 'timestemp') {
      return currentDateTime;
    }
    return currentDate;
  }
  forceMapRefresh() {
    if (this.map) {
      this.map.invalidateSize();
      console.log('Map refreshed');
    }
  }





  /**
   * Method to manually refresh fading for existing points (useful when resuming app)
   */
  public refreshFading() {
    console.log('Refreshing fading for existing affluence points');
    
    // Clear existing timers
    Object.values(this.affluenceTimers).forEach(clearInterval);
    this.affluenceTimers = {};
    
    // Restart fading for all red markers currently on map
    this.redMarkers.forEach((pointData, index) => {
      const marker = this.findMarkerByPosition(pointData.lat, pointData.lng);
      if (marker) {
        this.startFadingForPoint(marker, pointData);
      }
    });
  }

  /**
   * Helper to find a marker in the allMarkers array by its coordinates.
   */
  private findMarkerByPosition(lat: number, lng: number): L.Marker | undefined {
    return this.allMarkers.find(m => {
      const pos = m.getLatLng();
      // Use a small tolerance for floating point comparison
      return Math.abs(pos.lat - lat) < 0.00001 && Math.abs(pos.lng - lng) < 0.00001;
    });
  }

  /**
   * Enhanced ngOnDestroy with better cleanup
   */
  ngOnDestroy(): void {
    console.log('MapPage destroying, cleaning up timers and intervals');
    
    // Clear position tracking
    if (this.positionUpdateInterval) {
      clearInterval(this.positionUpdateInterval);
    }
    if (this.positionTimeout) {
      clearTimeout(this.positionTimeout);
    }
    if (this.MarkerTimer) {
      clearInterval(this.MarkerTimer);
    }

    // Clear queue-related intervals
    if (this.locationBroadcastInterval) {
      clearInterval(this.locationBroadcastInterval);
    }
    if (this.queueVisualizerInterval) {
      clearInterval(this.queueVisualizerInterval);
    }
    
    // Remove green progress line
    if (this.greenProgressLine && this.map) {
      this.map.removeLayer(this.greenProgressLine);
    }

    // Clear all affluence fading timers
    Object.values(this.affluenceTimers).forEach(timer => clearInterval(timer));
    this.affluenceTimers = {};
  }

  /**
   * Enhanced onResume to handle fading when app comes back to foreground
   */
  onResume() {
    console.log('App resumed, refreshing points and fading');
    this.getAllPoint();
    
    // After points are loaded, refresh fading
    setTimeout(() => {
      this.refreshFading();
    }, 1000);
  }

  // --- Methods for Queue Visualization ---

  toggleQueue(station: any) {
    if (this.activeQueueStationId === station.id) {
      // User is already in this queue, so they want to leave.
      this.leaveActiveQueue();
    } else {
      // User wants to join a new queue.
      if (this.activeQueueStationId) {
        // If they are already in another queue, make them leave it first.
        this.leaveActiveQueue();
      }
      this.joinQueue(station);
    }
  }

  joinQueue(station: any) {
    console.log(`Joining queue for station ID: ${station.id}`);
    this.activeQueueStationId = station.id;
    presentToast(`Vous avez rejoint la file d'attente pour ${station.name}.`, 'bottom', 'success');

    // Start broadcasting location every 10 seconds
    this.locationBroadcastInterval = setInterval(() => {
      const lat = parseFloat(localStorage.getItem('lat') || '0');
      const lng = parseFloat(localStorage.getItem('long') || '0');
      if (lat !== 0 && lng !== 0 && this.activeQueueStationId) {
        console.log(`Broadcasting position for queue ${this.activeQueueStationId}: [${lat}, ${lng}]`);
        this.queueService.updatePosition(this.activeQueueStationId, lat, lng).subscribe();
      }
    }, 10000); // Broadcast every 10 seconds

    // Start queue visualization updates every 5 seconds
    this.queueVisualizerInterval = setInterval(() => {
      this.updateQueueVisualization();
    }, 5000); // Update visualization every 5 seconds

    // Force the popup to re-render to show the "Leave" button
    this.refreshPopupForMarker(station);
  }

  leaveActiveQueue() {
    if (!this.activeQueueStationId) return;

    console.log(`Leaving queue for station ID: ${this.activeQueueStationId}`);
    this.queueService.leaveQueue(this.activeQueueStationId).subscribe();
    
    // Clear intervals
    clearInterval(this.locationBroadcastInterval);
    clearInterval(this.queueVisualizerInterval);
    this.locationBroadcastInterval = null;
    this.queueVisualizerInterval = null;
    
    // Remove green progress line
    if (this.greenProgressLine) {
      this.map?.removeLayer(this.greenProgressLine);
      this.greenProgressLine = null;
    }
    
    const station = this.greenMarkers.find(s => s.id === this.activeQueueStationId);
    this.activeQueueStationId = null;
    presentToast("Vous avez quittÃ© la file d'attente.", 'bottom', 'primary');
    
    if (station) this.refreshPopupForMarker(station);
  }

  private refreshPopupForMarker(pointData: any) {
    const markerObject = this.allMarkers.find(m => {
        const pos = m.getLatLng();
        return Math.abs(pos.lat - pointData.lat) < 0.00001 && Math.abs(pos.lng - pointData.lng) < 0.00001;
    });

    if (markerObject && markerObject.isPopupOpen()) {
        const popupContent = this.widgetContent('green', pointData.userId, this.greenMarkers.indexOf(pointData), pointData.like, pointData.dislike, pointData);
        markerObject.setPopupContent(popupContent);
        // Re-bind the click listeners for the newly rendered popup
        setTimeout(() => {
            this.handleBtnClick(this.greenMarkers.indexOf(pointData), 'green', pointData);
            this.handleLikesAndDislikes(this.greenMarkers.indexOf(pointData), 'green', pointData);
        }, 100);
    }
  }

  private updateQueueVisualization() {
    if (!this.activeQueueStationId || !this.map) return;

    this.queueService.getPositions(this.activeQueueStationId).subscribe({
      next: (positions) => {
        if (positions.length === 0) return;

        // Remove existing green progress line
        if (this.greenProgressLine) {
          this.map?.removeLayer(this.greenProgressLine);
        }

        // Create array of lat/lng coordinates from positions
        const coordinates: L.LatLngTuple[] = positions.map(pos => [pos.lat, pos.lng]);

        // Add the station position as the endpoint
        const station = this.greenMarkers.find(s => s.id === this.activeQueueStationId);
        if (station) {
          coordinates.push([station.lat, station.lng]);
        }

        // Create green polyline to visualize queue progress
        this.greenProgressLine = L.polyline(coordinates, {
          color: '#27AE60', // Green color
          weight: 4,
          opacity: 0.8
        });

        // Add to map
        if (this.map) {
          this.greenProgressLine.addTo(this.map);
        }

        console.log(`Queue visualization updated with ${positions.length} positions`);
      },
      error: (err) => {
        console.error('Error fetching queue positions:', err);
      }
    });
  }

}
### END Ionic-project\src\app\map\map.page.ts ###

### BEGIN Ionic-project\src\app\mention-legal\mention-legal-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { MentionLegalPage } from './mention-legal.page';

const routes: Routes = [
  {
    path: '',
    component: MentionLegalPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class MentionLegalPageRoutingModule {}

### END Ionic-project\src\app\mention-legal\mention-legal-routing.module.ts ###

### BEGIN Ionic-project\src\app\mention-legal\mention-legal.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { MentionLegalPageRoutingModule } from './mention-legal-routing.module';

import { MentionLegalPage } from './mention-legal.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    MentionLegalPageRoutingModule
  ],
  declarations: [MentionLegalPage]
})
export class MentionLegalPageModule {}

### END Ionic-project\src\app\mention-legal\mention-legal.module.ts ###

### BEGIN Ionic-project\src\app\mention-legal\mention-legal.page.html ###
<div class="h-[13vh] w-full" style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%"></div>

<div class="h-[100vh] w-full overflow-auto bg-[#F3F4F7] px-6">
  <!-- head -->
  <div class="flex w-full py-5">
    <div (click)="goTo('map')" class="pt-1.5">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
    <div class="px-4 text-[15pt] font-bold leading-6">Conditions gÃ©nÃ©rales d'utilisation</div>
  </div>
  <!-- end head -->


  <!-- content -->
  <div class="w-full bg-gray-100 text-gray-800">

      <div class="max-w-3xl mx-auto p-6 bg-white rounded-lg shadow-md mt-10">
          <p class="text-gray-600">En vigueur au 30/06/2024</p>
          <p class="mt-4">Les prÃ©sentes conditions gÃ©nÃ©rales d'utilisation (dites Â« CGU Â») ont pour objet l'encadrement juridique des modalitÃ©s de mise Ã  disposition du site et des services par Milexi et de dÃ©finir les conditions dâ€™accÃ¨s et dâ€™utilisation des services par Â« l'Utilisateur Â».</p>
          <p class="mt-4">Les prÃ©sentes CGU sont accessibles sur le site Ã  la rubrique Â«CGUÂ».</p>

          <h2 class="text-base font-semibold mt-6 mb-2">Article 1 : Les mentions lÃ©gales</h2>
          <p>L'Ã©dition du site <strong>Cabsul.com</strong> est assurÃ©e par la SociÃ©tÃ© SASU Milexi au capital de 1000 euros immatriculÃ©e au RCS de CrÃ©teil sous le numÃ©ro 929222313 dont le siÃ¨ge social est situÃ© au 80 Rue Victor Hugo.</p>
          <p>NumÃ©ro de tÃ©lÃ©phone : __________</p>
          <p>Adresse e-mail : Contact@Cabsul.com</p>
          <p>Le Directeur de la publication est : Jiayi Xiang</p>
          <p>NumÃ©ro de TVA intracommunautaire : FR53929222313</p>

          <h2 class="text-base font-semibold mt-6 mb-2">Article 2 : AccÃ¨s au site</h2>
          <p>Le site <strong>Cabsul.com</strong> permet Ã  l'Utilisateur un accÃ¨s gratuit aux services suivants :</p>
          <ul class="list-disc ml-6">
              <li>Partage dâ€™informations entre chauffeurs de taxi</li>
          </ul>
          <p>Le site est accessible gratuitement en tout lieu Ã  tout Utilisateur ayant un accÃ¨s Ã  Internet. Tous les frais supportÃ©s par l'Utilisateur pour accÃ©der au service (matÃ©riel informatique, logiciels, connexion Internet, etc.) sont Ã  sa charge.</p>

          <h2 class="text-base font-semibold mt-6 mb-2">Article 3 : Collecte des donnÃ©es</h2>
          <p>Le site assure Ã  l'Utilisateur une collecte et un traitement d'informations personnelles dans le respect de la vie privÃ©e conformÃ©ment Ã  la loi nÂ°78-17 du 6 janvier 1978 relative Ã  l'informatique aux fichiers et aux libertÃ©s.</p>

          <h2 class="text-base font-semibold mt-6 mb-2">Article 4 : PropriÃ©tÃ© intellectuelle</h2>
          <p>Les marques, logos, signes ainsi que tous les contenus du site (textes, images, sonsâ€¦) font l'objet d'une protection par le Code de la propriÃ©tÃ© intellectuelle et plus particuliÃ¨rement par le droit d'auteur.</p>

          <h2 class="text-base font-semibold mt-6 mb-2">Article 5 : ResponsabilitÃ©</h2>
          <p>Les sources des informations diffusÃ©es sur le site <strong>Cabsul.com</strong> sont rÃ©putÃ©es fiables mais le site ne garantit pas quâ€™il soit exempt de dÃ©fauts, dâ€™erreurs ou dâ€™omissions.</p>

          <h2 class="text-base font-semibold mt-6 mb-2">Article 6 : Liens hypertextes</h2>
          <p>Des liens hypertextes peuvent Ãªtre prÃ©sents sur le site. Lâ€™Utilisateur est informÃ© quâ€™en cliquant sur ces liens, il sortira du site <strong>Cabsul.com</strong>. Ce dernier nâ€™a pas de contrÃ´le sur les pages web sur lesquelles aboutissent ces liens et ne saurait en aucun cas Ãªtre responsable de leur contenu.</p>

          <h2 class="text-base font-semibold mt-6 mb-2">Article 7 : Cookies</h2>
          <p>Lâ€™Utilisateur est informÃ© que lors de ses visites sur le site, un cookie peut sâ€™installer automatiquement sur son logiciel de navigation.</p>

          <h2 class="text-base font-semibold mt-6 mb-2">Article 8 : Publication par lâ€™Utilisateur</h2>
          <p>Le site permet aux membres de publier des contenus. Dans ses publications, le membre sâ€™engage Ã  respecter les rÃ¨gles de la Netiquette et les rÃ¨gles de droit en vigueur.</p>

          <h2 class="text-base font-semibold mt-6 mb-2">Article 9 : Droit applicable et juridiction compÃ©tente</h2>
          <p>La lÃ©gislation franÃ§aise s'applique au prÃ©sent contrat. En cas d'absence de rÃ©solution amiable d'un litige nÃ© entre les parties, les tribunaux franÃ§ais seront seuls compÃ©tents.</p>
      </div>
  </div>
  <!-- end content -->

  <div class="py-5">
    <span class="text-[13px]">Si vous nâ€™avez pas trouvÃ© de rÃ©ponse</span>
    <ion-button (click)="goTo('aide')" color="transparent" style="--border-radius:0.75rem; text-transform: none;" class="montserrat-700 my-1 h-10 w-full rounded-xl border-2 border-[#1D4999] text-[13px] tracking-wide text-[#1D4999]">Aide</ion-button>
  </div>


</div>

### END Ionic-project\src\app\mention-legal\mention-legal.page.html ###

### BEGIN Ionic-project\src\app\mention-legal\mention-legal.page.scss ###
p{
  font-weight: 400;
  font-size: 14px;
}

### END Ionic-project\src\app\mention-legal\mention-legal.page.scss ###

### BEGIN Ionic-project\src\app\mention-legal\mention-legal.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { MentionLegalPage } from './mention-legal.page';

describe('MentionLegalPage', () => {
  let component: MentionLegalPage;
  let fixture: ComponentFixture<MentionLegalPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(MentionLegalPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\mention-legal\mention-legal.page.spec.ts ###

### BEGIN Ionic-project\src\app\mention-legal\mention-legal.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';

@Component({
  selector: 'app-mention-legal',
  templateUrl: './mention-legal.page.html',
  styleUrls: ['./mention-legal.page.scss'],
})
export class MentionLegalPage implements OnInit {

  constructor(private router:Router) { }

  ngOnInit() {
  }


  goTo(destination: string){
    switch (destination) {
      case 'map':
        this.router.navigate(['/map']);
        break;

      case 'aide':
        this.router.navigate(['/aide']);
        break;

      default:
        break;
    }
  }

}

### END Ionic-project\src\app\mention-legal\mention-legal.page.ts ###

### BEGIN Ionic-project\src\app\onboarding\onboarding-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { OnboardingPage } from './onboarding.page';

const routes: Routes = [
  {
    path: '',
    component: OnboardingPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class OnboardingPageRoutingModule {}

### END Ionic-project\src\app\onboarding\onboarding-routing.module.ts ###

### BEGIN Ionic-project\src\app\onboarding\onboarding.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { OnboardingPageRoutingModule } from './onboarding-routing.module';

import { OnboardingPage } from './onboarding.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    OnboardingPageRoutingModule
  ],
  declarations: [OnboardingPage]
})
export class OnboardingPageModule {}

### END Ionic-project\src\app\onboarding\onboarding.module.ts ###

### BEGIN Ionic-project\src\app\onboarding\onboarding.page.html ###
<div *ngIf="nextbord == '0'" class="w-full h-[100vh] bg-[#112A59]">
  <div class=" h-[43%] flex justify-center items-center ">
    <img src="../../assets/images/Group_3869.png" width="230"/>
  </div>
  <div class="bg-white w-full h-[56vh] absolute bottom-0 rounded-t-2xl py-6 font-[Montserrat]">
    <div class="text-center flex flex-col items-center">
       <label class="text-[20px] text-[#003A65]  font-bold">Lorem <br> Ipsum</label>
       <p class="text-[12px] text-[#000] font-medium	 opacity-[50%] m-4">
          Dolor sit amet, consectetur adipiscing elit. Pharetra sit lorem praesent eu ac nec dignissim. At eget nisl ultrices integer. Hendrerit.
       </p>
       <div class="flex justify-between mt-8 mb-6 w-12">
         <div (click)="next('0')" class="bg-[#1D4898] w-4 h-2 rounded-lg"></div>
         <div (click)="next('1')" class="bg-[#A0D0EC] w-2.5 h-2 rounded-lg"></div>
         <div (click)="next('2')" class="bg-[#A0D0EC] w-2.5 h-2 rounded-lg"></div>
       </div>

       <button (click)="next('1')" class="bg-[#1D4898] text-white text-[13px] font-semibold w-60 h-9 rounded-lg mb-3">SUIVANT</button>
       <button (click)="next('3')" class=" text-[#003A65] text-[12px] font-medium w-60 h-9 rounded-lg">SAUTER</button>
    </div>
  </div>

</div>

<div *ngIf="nextbord == '1'" class="w-full h-[100vh] bg-[#112A59]">
  <div class=" h-[43%] flex justify-center items-center ">
    <img src="../../assets/images/Group_3869.png" width="230"/>
  </div>
  <div class="bg-white w-full h-[56vh] absolute bottom-0 rounded-t-2xl py-6 font-[Montserrat]">
    <div class="text-center flex flex-col items-center">
       <label class="text-[20px] text-[#003A65]  font-bold">Lorem <br> Ipsum</label>
       <p class="text-[12px] text-[#000] font-medium	 opacity-[50%] m-4">
          Dolor sit amet, consectetur adipiscing elit. Pharetra sit lorem praesent eu ac nec dignissim. At eget nisl ultrices integer. Hendrerit.
       </p>
       <div class="flex justify-between mt-8 mb-6 w-12">
         <div (click)="next('0')" class="bg-[#A0D0EC] w-2.5 h-2 rounded-lg"></div>
         <div (click)="next('1')" class="bg-[#1D4898] w-4 h-2 rounded-lg"></div>
         <div (click)="next('2')" class="bg-[#A0D0EC] w-2.5 h-2 rounded-lg"></div>
       </div>

       <button (click)="next('2')" class="bg-[#1D4898] text-white text-[13px] font-semibold w-60 h-9 rounded-lg mb-3">SUIVANT</button>
       <button (click)="next('3')" class=" text-[#003A65] text-[12px] font-medium w-60 h-9 rounded-lg">SAUTER</button>
    </div>
  </div>

</div>

<div *ngIf="nextbord == '2'" class="w-full h-[100vh] bg-[#112A59]">
  <div class=" h-[43%] flex justify-center items-center ">
    <img src="../../assets/images/Group_3869.png" width="230"/>
  </div>
  <div class="bg-white w-full h-[56vh] absolute bottom-0 rounded-t-2xl py-6 font-[Montserrat]">
    <div class="text-center flex flex-col items-center">
       <label class="text-[20px] text-[#003A65]  font-bold">Lorem <br> Ipsum</label>
       <p class="text-[12px] text-[#000] font-medium	 opacity-[50%] m-4">
          Dolor sit amet, consectetur adipiscing elit. Pharetra sit lorem praesent eu ac nec dignissim. At eget nisl ultrices integer. Hendrerit.
       </p>
       <div class="flex justify-between mt-8 mb-6 w-12">
         <div (click)="next('0')" class="bg-[#A0D0EC] w-2.5 h-2 rounded-lg"></div>
         <div (click)="next('1')" class="bg-[#A0D0EC] w-2.5 h-2 rounded-lg"></div>
         <div (click)="next('2')" class="bg-[#1D4898] w-4 h-2 rounded-lg"></div>
       </div>

       <button (click)="next('3')" class="bg-[#1D4898] text-white text-[13px] font-semibold w-60 h-9 rounded-lg mb-3">SUIVANT</button>
       <button (click)="next('3')" class=" text-[#003A65] text-[12px] font-medium w-60 h-9 rounded-lg">SAUTER</button>
    </div>
  </div>

</div>
### END Ionic-project\src\app\onboarding\onboarding.page.html ###

### BEGIN Ionic-project\src\app\onboarding\onboarding.page.scss ###
### END Ionic-project\src\app\onboarding\onboarding.page.scss ###

### BEGIN Ionic-project\src\app\onboarding\onboarding.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { OnboardingPage } from './onboarding.page';

describe('OnboardingPage', () => {
  let component: OnboardingPage;
  let fixture: ComponentFixture<OnboardingPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(OnboardingPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\onboarding\onboarding.page.spec.ts ###

### BEGIN Ionic-project\src\app\onboarding\onboarding.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';

@Component({
  selector: 'app-onboarding',
  templateUrl: './onboarding.page.html',
  styleUrls: ['./onboarding.page.scss'],
})
export class OnboardingPage implements OnInit {

  nextbord:string = '0';

  constructor(private router:Router) { }

  ngOnInit() {
  }

  next(number:string) {
    switch (number) {
      case '0':
        this.nextbord = number;
        break;
      case '1':
        this.nextbord = number;
        break;
      case '2':
        this.nextbord = number;
        break;
      case '3':
        this.router.navigate(["/map"]);
        break;
    
      default:
        break;
    }
  }
}

### END Ionic-project\src\app\onboarding\onboarding.page.ts ###

### BEGIN Ionic-project\src\app\premum\premium\premium-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { PremiumPage } from './premium.page';

const routes: Routes = [
  {
    path: '',
    component: PremiumPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class PremiumPageRoutingModule {}

### END Ionic-project\src\app\premum\premium\premium-routing.module.ts ###

### BEGIN Ionic-project\src\app\premum\premium\premium.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { PremiumPageRoutingModule } from './premium-routing.module';

import { PremiumPage } from './premium.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    PremiumPageRoutingModule
  ],
  declarations: [PremiumPage]
})
export class PremiumPageModule {}

### END Ionic-project\src\app\premum\premium\premium.module.ts ###

### BEGIN Ionic-project\src\app\premum\premium\premium.page.html ###
<div class="h-[13vh] w-full" style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%"></div>

<div class="h-[100vh] w-full overflow-auto bg-[#F3F4F7] px-6">
  <!-- head -->
  <div class="flex w-full py-5">
    <div (click)="goMap()" class="pt-1.5">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
    <div class="px-4 text-[15pt] font-bold leading-6">Passer Ã  la version
      Premium</div>
  </div>
  <!-- end head -->

  <!-- subscription pack -->

  <div>
    <!-- pack 1 -->
    <div class=" flex flex-col px-3 py-5 my-4 rounded-md" [ngClass]="{'bg-[#0B1E41] text-white':selectedPack == '1', 'bg-white text-[#0B1E41] border-2 border-[#0B1E41]':selectedPack != '1', }">
      <div class="flex justify-between w-full">
          <label>Abonnement 1</label>
          <input checked type="radio" name="abonnement" class="w-5 h-5" value="1"  #pack1 (change)="selectPack(pack1.value)" />
      </div>
      <span class="text-[11px] montserrat-300">Avantages</span>
      <div class="my-3">
        <div class="flex items-center py-1">
          <img src="../../assets/icon/lightbluePlus.svg" class="pr-2" alt="">
          <span class="text-[11px] montserrat-300">Automatisation du calcul de lâ€™attente</span>
        </div>
        <div class="flex items-center py-1">
          <img src="../../assets/icon/lightbluePlus.svg" class="pr-2" alt="">
          <span class="text-[11px] montserrat-300">AccÃ¨s aux notes</span>
        </div>
      </div>

      <div class="my-3">
        <div class="flex items-center py-1">
          <span class="text-[20px] montserrat-300"><span class="text-[24px] font-bold">3 â‚¬</span>/mois</span>
        </div>
        <div class="flex items-center">
          <span class="text-[11px] montserrat-300">* Avec un engagement de 1 an</span>
        </div>
      </div>
      <span class="text-[11px] montserrat-300">ðŸŽ  Les deux premiers mois sont offerts aux 
        <b>nouveaux inscrits</b></span>
    </div>
    <!-- end pack 1 -->

     <!-- pack 2 -->
     <div class="flex flex-col px-3 py-5 my-4 rounded-md" [ngClass]="{'bg-[#0B1E41] text-white':selectedPack == '2', 'bg-white text-[#0B1E41] border-2 border-[#0B1E41]':selectedPack != '2', }">
      <div class="flex justify-between w-full">
          <label>Abonnement 2</label>
          <input type="radio" name="abonnement" class="w-5 h-5" value="2" #pack2 (change)="selectPack(pack2.value)" />
      </div>
      <span class="text-[11px] montserrat-400">Avantages</span>
      <div class="my-3">
        <div class="flex items-center py-1">
          <img src="../../assets/icon/lightbluePlus.svg" class="pr-2" alt="">
          <span class="text-[11px] montserrat-400">Automatisation du calcul de lâ€™attente</span>
        </div>
        <div class="flex items-center py-1">
          <img src="../../assets/icon/lightbluePlus.svg" class="pr-2" alt="">
          <span class="text-[11px] montserrat-400">AccÃ¨s aux notes</span>
        </div>
      </div>

      <div class="my-3">
        <div class="flex items-center py-1">
          <span class="text-[20px] montserrat-400"><span class="text-[24px] font-bold">4,99 â‚¬</span>/mois</span>
        </div>
        <div class="flex items-center">
          <span class="text-[11px] montserrat-400">* Sans engagement</span>
        </div>
      </div>
      <span class="text-[11px] montserrat-400">ðŸŽ  Les deux premiers mois sont offerts aux 
        <b>nouveaux inscrits</b></span>
    </div>
    <!-- end pack 2 -->    
  </div>
  <!-- end subscription pack -->

  <div class="flex flex-col items-center py-5">
    <ion-button (click)="continue()" color="transparent" style="--border-radius:0.75rem; text-transform: none;" class="montserrat-600 my-1 h-9 w-full rounded-xl bg-[#1D4999] text-[13px] tracking-wide text-white">Continuer</ion-button>
    <ion-button (click)="goMap()" color="transparent" style="--border-radius:0.75rem; text-transform: none;" class="montserrat-700 my-1 h-9 w-full rounded-xl border-2 border-[#1D4999] text-[13px] tracking-wide text-[#1D4999]">Annuler</ion-button>
  </div>


</div>

### END Ionic-project\src\app\premum\premium\premium.page.html ###

### BEGIN Ionic-project\src\app\premum\premium\premium.page.scss ###
### END Ionic-project\src\app\premum\premium\premium.page.scss ###

### BEGIN Ionic-project\src\app\premum\premium\premium.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { PremiumPage } from './premium.page';

describe('PremiumPage', () => {
  let component: PremiumPage;
  let fixture: ComponentFixture<PremiumPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(PremiumPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\premum\premium\premium.page.spec.ts ###

### BEGIN Ionic-project\src\app\premum\premium\premium.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';

@Component({
  selector: 'app-premium',
  templateUrl: './premium.page.html',
  styleUrls: ['./premium.page.scss'],
})
export class PremiumPage implements OnInit {

  constructor(private router:Router) { }

  selectedPack:string = '1'

  ngOnInit() {
  }

  goMap() {
    this.router.navigate(["/map"])
  }

  continue(){
    this.router.navigate(['/premium-confirmation'])
  }

  selectPack(choice:string){
    this.selectedPack = choice;
  }

}

### END Ionic-project\src\app\premum\premium\premium.page.ts ###

### BEGIN Ionic-project\src\app\premum\premium-confirmation\premium-confirmation-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { PremiumConfirmationPage } from './premium-confirmation.page';

const routes: Routes = [
  {
    path: '',
    component: PremiumConfirmationPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class PremiumConfirmationPageRoutingModule {}

### END Ionic-project\src\app\premum\premium-confirmation\premium-confirmation-routing.module.ts ###

### BEGIN Ionic-project\src\app\premum\premium-confirmation\premium-confirmation.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { PremiumConfirmationPageRoutingModule } from './premium-confirmation-routing.module';

import { PremiumConfirmationPage } from './premium-confirmation.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    PremiumConfirmationPageRoutingModule
  ],
  declarations: [PremiumConfirmationPage]
})
export class PremiumConfirmationPageModule {}

### END Ionic-project\src\app\premum\premium-confirmation\premium-confirmation.module.ts ###

### BEGIN Ionic-project\src\app\premum\premium-confirmation\premium-confirmation.page.html ###
<div class="h-[13vh] w-full" style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%"></div>

<div class="h-[100vh] w-full overflow-auto bg-[#F3F4F7] px-6">
  <!-- head -->
  <div class="flex w-full py-5">
    <div (click)="goTo('map')" class="pt-1.5">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
    <div class="px-4 text-[15pt] font-bold leading-6">Confirmation</div>
  </div>
  <!-- end head -->
  <span class="montserrat-500 text-[12px]">DÃ©tails</span>
  <!-- inputs -->
  <div class="my-4">
    <div>
      <label class="montserrat-600 text-[13px]">Adresse <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Adresse</span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 px-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Adresse" type="text" name="username" />
      </label>
    </div>

    <div class="mt-2">
      <label class="montserrat-600 text-[13px]">Pays <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Pays</span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 px-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Pays" type="text" name="username" />
      </label>
    </div>

    <div class="mt-2">
      <label class="montserrat-600 text-[13px]">Ville <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Ville</span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 px-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Ville" type="text" name="username" />
      </label>
    </div>

    <div class="mt-2">
      <label class="montserrat-600 text-[13px]">Code postale <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Code postale</span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 px-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Code postale" type="text" name="username" />
      </label>
    </div>

    <div class="mt-2">
      <label class="montserrat-600 text-[13px]">Code de rÃ©duction <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Code de rÃ©duction</span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 px-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Saisir le code de rÃ©duction" type="text" name="username" />
      </label>
    </div>

    <div class="mt-5">
      <label class="montserrat-500 text-[11px]">Choisir votre mode de paiement</label>
      <div class="montserrat-700 flex h-11 items-center justify-between rounded border-2 border-[#1D4999] bg-white text-[13px] tracking-wide text-[#1D4999]">
        <div class="flex items-center px-2">
          <img src="../../assets/icon/creditCard.svg" class="mr-2 w-5 h-5" alt="" />
          <span>Carte de credit</span>
        </div>

        <div class="flex items-center px-5">
          <ion-radio checked name="paiment" class="h-4 w-4"></ion-radio>
        </div>
      </div>
    </div>

    <div class="flex flex-col items-center py-5">
      <ion-button (click)="goTo('thanks')" color="transparent" style="--border-radius:0.75rem; text-transform: none;" class="montserrat-600 my-1 h-9 w-full rounded-xl bg-[#1D4999] text-[13px] tracking-wide text-white">Terminer</ion-button>

      <ion-button (click)="goTo('back')" color="transparent" style="--border-radius:0.75rem; text-transform: none;" class="montserrat-700 my-1 h-9 w-full rounded-xl border-2 border-[#1D4999] text-[13px] tracking-wide text-[#1D4999]">PrÃ©cedent</ion-button>
    </div>
  </div>
  <!-- end inputs -->
</div>

### END Ionic-project\src\app\premum\premium-confirmation\premium-confirmation.page.html ###

### BEGIN Ionic-project\src\app\premum\premium-confirmation\premium-confirmation.page.scss ###
### END Ionic-project\src\app\premum\premium-confirmation\premium-confirmation.page.scss ###

### BEGIN Ionic-project\src\app\premum\premium-confirmation\premium-confirmation.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { PremiumConfirmationPage } from './premium-confirmation.page';

describe('PremiumConfirmationPage', () => {
  let component: PremiumConfirmationPage;
  let fixture: ComponentFixture<PremiumConfirmationPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(PremiumConfirmationPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\premum\premium-confirmation\premium-confirmation.page.spec.ts ###

### BEGIN Ionic-project\src\app\premum\premium-confirmation\premium-confirmation.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';

@Component({
  selector: 'app-premium-confirmation',
  templateUrl: './premium-confirmation.page.html',
  styleUrls: ['./premium-confirmation.page.scss'],
})
export class PremiumConfirmationPage implements OnInit {
  
  constructor(private router:Router) { }

  ngOnInit() {
  }

  goTo(page:string){
    switch (page) {
      case 'back':
        this.router.navigate(['/premium'])
        break;
    
      case 'map':
        this.router.navigate(['/map'])
        break;

      case 'thanks':
        this.router.navigate(['/thanks-page'])
        break;
    
      default:
        break;
    }
  }

}

### END Ionic-project\src\app\premum\premium-confirmation\premium-confirmation.page.ts ###

### BEGIN Ionic-project\src\app\premum\thanks-page\thanks-page-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { ThanksPagePage } from './thanks-page.page';

const routes: Routes = [
  {
    path: '',
    component: ThanksPagePage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class ThanksPagePageRoutingModule {}

### END Ionic-project\src\app\premum\thanks-page\thanks-page-routing.module.ts ###

### BEGIN Ionic-project\src\app\premum\thanks-page\thanks-page.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { ThanksPagePageRoutingModule } from './thanks-page-routing.module';

import { ThanksPagePage } from './thanks-page.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    ThanksPagePageRoutingModule
  ],
  declarations: [ThanksPagePage]
})
export class ThanksPagePageModule {}

### END Ionic-project\src\app\premum\thanks-page\thanks-page.module.ts ###

### BEGIN Ionic-project\src\app\premum\thanks-page\thanks-page.page.html ###
<div class="h-[13vh] w-full" style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%"></div>
<div class="w-full h-[100vh] bg-[#F3F4F7] py-10 px-6 overflow-auto">

  <div class="mb-4 w-full">
    <div>
      <img src="../../assets/images/endOfPaymant.png" alt="">
      <div class="w-full text-center ">
        <div class="text-[18px] text-[#1D4999] pt-5 montserrat-700">Merci de votre commande</div>
        <div class="text-[13px] my-5 leading-[15px] text-[#02263D] montserrat-600">
          Merci pour votre achat ! Nous vous enverrons bientÃ´t un rÃ©capitulatif de votre commande par e-mail. Restez Ã  l'affÃ»t !
        </div>
      </div>
    </div>
    <div class="flex items-center pt-5">
      <button (click)="goHome()" style="text-transform: none;" class="h-9 w-full rounded-xl bg-[#1D4999] text-[13px] montserrat-600 tracking-wide text-white">Retour Ã  l'accueil</button>
    </div>
  </div>

</div>
### END Ionic-project\src\app\premum\thanks-page\thanks-page.page.html ###

### BEGIN Ionic-project\src\app\premum\thanks-page\thanks-page.page.scss ###
### END Ionic-project\src\app\premum\thanks-page\thanks-page.page.scss ###

### BEGIN Ionic-project\src\app\premum\thanks-page\thanks-page.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ThanksPagePage } from './thanks-page.page';

describe('ThanksPagePage', () => {
  let component: ThanksPagePage;
  let fixture: ComponentFixture<ThanksPagePage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(ThanksPagePage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\premum\thanks-page\thanks-page.page.spec.ts ###

### BEGIN Ionic-project\src\app\premum\thanks-page\thanks-page.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';

@Component({
  selector: 'app-thanks-page',
  templateUrl: './thanks-page.page.html',
  styleUrls: ['./thanks-page.page.scss'],
})
export class ThanksPagePage implements OnInit {

  constructor(private router:Router) { }

  ngOnInit() {
  }

  goHome(){
    this.router.navigate(['/map'])
  }

}

### END Ionic-project\src\app\premum\thanks-page\thanks-page.page.ts ###

### BEGIN Ionic-project\src\app\profile\gestion-amis\gestion-amis-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { GestionAmisPage } from './gestion-amis.page';

const routes: Routes = [
  {
    path: '',
    component: GestionAmisPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class GestionAmisPageRoutingModule {}

### END Ionic-project\src\app\profile\gestion-amis\gestion-amis-routing.module.ts ###

### BEGIN Ionic-project\src\app\profile\gestion-amis\gestion-amis.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { GestionAmisPageRoutingModule } from './gestion-amis-routing.module';

import { GestionAmisPage } from './gestion-amis.page';
import { ShareModule } from 'src/app/utiles/share/share.module';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    GestionAmisPageRoutingModule,
    ShareModule
  ],
  declarations: [GestionAmisPage]
})
export class GestionAmisPageModule {}

### END Ionic-project\src\app\profile\gestion-amis\gestion-amis.module.ts ###

### BEGIN Ionic-project\src\app\profile\gestion-amis\gestion-amis.page.html ###
<!-- pub -->
<div class="w-full">
  <div class="h-[13vh] w-full" style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%"></div>
  <div class="w-full h-[87vh] bg-[#F3F4F7] px-6 overflow-auto">
    <!-- end pub -->
    <!-- head -->
    <div class="flex w-full py-5">
      <div (click)="back()" class="pt-1.5">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
        </svg>
      </div>
      <div class="px-4 text-[15pt] font-bold leading-6">Amis</div>
    </div>
    <!-- end head -->

    <!-- info -->
    <div class="w-full">

      <div class="mb-1">
        <label class=" montserrat-700 ">Ajouter un ami</label>
        <div class="mt-4">
          <label class="text-[13px] montserrat-600 text-[#02263D]">Adresse email ou pseudo : <span class="text-red-600">*</span></label>
          <label class="relative block text-[13px]">
            <span class="sr-only">Adresse email ou pseudo</span>
            <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
              <img src="../../assets/icon/email.svg" class="pr-1" alt="">
            </span>
            <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Email ou pseudo" type="text" name="emailOrPseudo" [(ngModel)]="emailOrPseudo"/>
          </label>
          <div class="flex flex-col">
            <span  *ngIf="error_messages[0].display" class="text-red-600 font-bold text-[10px]">{{error_messages[0].message}}</span>
            <span *ngIf="error_messages[1].display" class="text-red-600 font-bold text-[10px]">{{error_messages[1].message}}</span>
          </div>
        </div>
      </div>
      <div class="pb-5">
        <ion-button (click)="inviteUser()" style="text-transform: none;" color="transparent" class="h-[40px] w-full rounded-xl border-2 bg-[#1D4999] active:bg-transparent border-[#1D4999] text-[13px] montaserrat-700 tracking-wide text-white active:text-[#1D4999] mr-2">Envoyer</ion-button>
      </div>
      
      <hr />

      <div class="flex justify-between items-center my-4">
        <div>
          <label *ngIf="!shareNotesWith" class="text-[14px]">{{friendsList.length}} amis</label>
          <div *ngIf="shareNotesWith" class="flex items-center">
            <input (click)="selectAll($event)" type="checkbox" name="selectAll" value="all" class="w-4 h-4"><label class="px-2 text-[10px]">Tou(te)s les amis</label>
          </div>
        </div>
        <ion-button (click)="shareNotesWithFn()" style="text-transform: none;" color="transparent" class="h-[35px] rounded-xl border-2 border-[#1D4999] text-[10px] montaserrat-700 tracking-wide  mr-2" [ngClass]="{'text-[#1D4999]':!shareNotesWith, 'text-white bg-[#1D4999]':shareNotesWith}">Partager mes notes</ion-button>
      </div>

      <!-- amis -->
        <div>
          <table class="w-full border-separate border-spacing-y-3">
      
              <tr *ngFor="let amis of friendsList; let i = index">
                <td *ngIf="shareNotesWith" class="pr-5">
                  <input (click)="selectedFriends(amis.id,$event)" [id]="'relation-' + amis.id" [checked]="0" type="checkbox" class="w-4 h-4">
                </td>
                <td>
                  <div class=" w-[50px] h-[50px] rounded-full overflow-hidden flex items-center">
                    <img [src]="amis?.user?.image?.url? URL + 'storage/' + amis?.user?.image?.url : 'https://media.istockphoto.com/id/1327592506/vector/default-avatar-photo-placeholder-icon-grey-profile-picture-business-man.jpg?s=612x612&w=0&k=20&c=BpR0FVaEa5F24GIw7K8nMWiiGmbb8qmhfkpXcp1dhQg='" alt="">
                  </div>
                </td>
                <td class=" px-2 w-full">
                  <span class="text-[13px] montserrat-700 w-full">{{amis.user.firstName}} {{amis.user.lastName}}</span>
                </td>
                <td *ngIf="!shareNotesWith">
                  <div class="flex items-center ">
                    <span (click)="action('stop-sharing-notes', amis.id)"class="w-[35px] h-[35px] bg-[#DEE3EE] flex items-center justify-center rounded-full mx-[3px]" *ngIf="amis.share_note != 0"><img src="../../assets/icon/sentNote.svg" alt="" class="w-3.5"></span>
                    <span (click)="action('share-notes', amis.id)"class="w-[35px] h-[35px] bg-[#1D4999] flex items-center justify-center rounded-full mx-[3px]" *ngIf="amis.share_note == 0"><img src="../../assets/icon/note.svg" alt="" class="w-3.5"></span>
                    <span (click)="action('delete-friend', amis.id)" class="w-[35px] h-[35px] bg-[#F2E1E0] flex items-center justify-center rounded-full mx-[3px]"><img src="../../assets/icon/redtrush.svg" alt="" class="w-3.5"></span>
                  </div>
                </td>
              </tr>   

          </table>
        </div>
      <!-- end amis -->
    <!-- end info -->
  </div>
</div>

<app-confirmation *ngIf="confirmation" (closeConfirmation)="taggleModal()" (deleteFriend)="unfollowFiend()"></app-confirmation>
### END Ionic-project\src\app\profile\gestion-amis\gestion-amis.page.html ###

### BEGIN Ionic-project\src\app\profile\gestion-amis\gestion-amis.page.scss ###
### END Ionic-project\src\app\profile\gestion-amis\gestion-amis.page.scss ###

### BEGIN Ionic-project\src\app\profile\gestion-amis\gestion-amis.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { GestionAmisPage } from './gestion-amis.page';

describe('GestionAmisPage', () => {
  let component: GestionAmisPage;
  let fixture: ComponentFixture<GestionAmisPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(GestionAmisPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\profile\gestion-amis\gestion-amis.page.spec.ts ###

### BEGIN Ionic-project\src\app\profile\gestion-amis\gestion-amis.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';
import { NoteAmis } from '../../utiles/interface/note-amis';
import { ProfilService } from '../../utiles/services/profil/profil.service';
import { presentToast } from 'src/app/utiles/component/notification';
import { URL_BASE } from 'src/environments/environment';

@Component({
  selector: 'app-gestion-amis',
  templateUrl: './gestion-amis.page.html',
  styleUrls: ['./gestion-amis.page.scss'],
})
export class GestionAmisPage implements OnInit {
  URL = URL_BASE; // TO USE THE URL ON TEMPLATE

  friendsList:any = [];

  shareNotesWith:boolean = false;
  confirmation:boolean = false;
  selectedFriendToUnfollow:number = 0;
  friendToShareWhith:any = [];

  emailOrPseudo:string = '';
  error_messages:any = [
    {message:"Email/pseudo est Obligatoire.", display:false},
    {message:"l'utilisateur preudo n'existe pas, veuillez saisir l'email Ã  la place.", display:false},
 
  ];

  constructor(
    private router:Router,
    private profilService:ProfilService
  ) { }

  ngOnInit() {
    this.getListFriends();
    console.log(this.friendsList);
  }

  shareNotesWithFn(){
    this.shareNotesWith = !this.shareNotesWith;
    if(!this.shareNotesWith){
      console.log('note sent to selected friends!');
      this.sendNotes(this.friendToShareWhith);
    }else{
      this.friendToShareWhith = [];
    }
  }
  
  back() {
    this.router.navigate(["/profil"])
  }

  action(action: string,id: number) {
    switch (action) {
      case 'delete-friend':
        console.log("unfollowing friend ");
        this.selectedFriendToUnfollow = id;
        this.taggleModal();
        break;

      case 'share-notes':
        console.log("sharing notes with a friend/friends ");
        this.sendNotes([id]);
        break;

      case 'stop-sharing-notes':
        console.log("unsharing notes with a friend/friends ");
        break;       

      default:
        break;
    }
  }

  inviteUser(){
    this.error_messages.map((el:any) => el.display = false)
    let request:any = {
      content: this.emailOrPseudo,
      contentType:this.isEmail(this.emailOrPseudo)?'email':'pseudo'
    }

    if(request.content != ''){
      this.profilService.$inviteFriend(request).subscribe(
        (data) => {
          this.emailOrPseudo = '';
          console.log("api result : \n" + JSON.stringify(data));
          presentToast("votre invitation a ete envoyer avec succee!", 'bottom', 'success')
        },(err) => {
          if(err.status == 404){
            this.error_messages[1].display = true;
            return;
          }
          console.log("error : " + JSON.stringify(err));
          presentToast("Il y a une souci!"+JSON.stringify(err.error.error), 'bottom', 'danger')
          }
      );
      return;
    }
    this.error_messages[0].display = true;
  }

  isEmail(email: string): boolean {
    const pattern: RegExp = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    console.log(!pattern.test(email));
    return pattern.test(email);
  }

  unfollowFiend(){
    console.log('selected relationship : '+ this.selectedFriendToUnfollow);
    this.profilService.$unfollow(this.selectedFriendToUnfollow).subscribe(
      (data:any) =>{
        console.log('api result : ' + data);
        this.getListFriends();
        presentToast('l\'opÃ©ration de dÃ©sabonnement se fait avec succÃ¨s', 'bottom', 'success');
      },
      err => {
        console.log("erro : " + err.error.error); 
      }
    );
    this.selectedFriendToUnfollow = 0
    console.log('changed to : '+ this.selectedFriendToUnfollow);

    this.taggleModal();
  }

  taggleModal(){
    this.confirmation = !this.confirmation
  }

  async getListFriends(){
    this.profilService.$friends().subscribe(
      async (data:any)=>{
        console.log("friensd : "+ JSON.stringify(data));
        this.friendsList = await data.friends;
        this.profilService.$friendsList = await data.friends;
      },
      err => {
        console.log("error : " + JSON.stringify(err));
      }
    )
  }

  selectedFriends(relationshipId:number, value:any){
    let add = value.target.checked;
    if(add){
      this.friendToShareWhith.push(relationshipId);      
    }else{
      let id = this.friendToShareWhith.find((el:number) => el == relationshipId);
      this.friendToShareWhith.splice(this.friendToShareWhith.indexOf(id),1)
    }    
  }

  selectAll(value:any){
    console.log("value " + value.target.checked);
    if(value.target.checked){
      this.friendsList.forEach((el:any) => {
        let input = document.getElementById('relation-'+el.id) as HTMLInputElement
        input.checked = true;
        this.friendToShareWhith.push(el.id);
      });
      
    }else{
      this.friendsList.forEach((el:any) => {
        let input = document.getElementById('relation-'+el.id) as HTMLInputElement
        input.checked = false;
      });
      this.friendToShareWhith = [];
    }
  }
  
  sendNotes(riendList:Array<any>){
    let content = {'friends': riendList}
    this.profilService.$shareNoteswith(content).subscribe(
      (data:any) =>{
        console.log("api result : " + JSON.stringify(data));
        this.getListFriends();
      },
      err => {
        console.log('error : ' + JSON.stringify(err)); 
      }
    );
  }
}

### END Ionic-project\src\app\profile\gestion-amis\gestion-amis.page.ts ###

### BEGIN Ionic-project\src\app\profile\profil\profil-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { ProfilPage } from './profil.page';

const routes: Routes = [
  {
    path: '',
    component: ProfilPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class ProfilPageRoutingModule {}

### END Ionic-project\src\app\profile\profil\profil-routing.module.ts ###

### BEGIN Ionic-project\src\app\profile\profil\profil.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { ProfilPageRoutingModule } from './profil-routing.module';

import { ProfilPage } from './profil.page';
import { ShareModule } from 'src/app/utiles/share/share.module';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    ProfilPageRoutingModule,
    ShareModule
  ],
  declarations: [ProfilPage]
})
export class ProfilPageModule {}

### END Ionic-project\src\app\profile\profil\profil.module.ts ###

### BEGIN Ionic-project\src\app\profile\profil\profil.page.html ###
<ion-content>
  <div class="w-full ">
    <div class="h-[13vh] w-full"
      style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%">
    </div>
    <div class="w-full h-[87vh] bg-[#F3F4F7] px-4 overflow-auto">
      <!-- Header -->
      <div class="flex w-full py-5">
        <div (click)="goPage('map')" class="pt-1.5">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6"
            stroke="currentColor" class="h-5 w-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
          </svg>
        </div>
        <div class="px-4 text-[15pt] font-bold leading-6">Mon profil</div>
      </div>
      <!-- End Header -->

      <!-- Profile Info -->
      <div class="w-full">
        <!-- Profile Picture -->
        <div class="mt-1 w-full">
          <label class="montserrat-600 text-[13px]">Photo de profil</label>
          <div class="mt-1 flex items-center">
            <div class="w-[18vw]">
              <img class="rounded-2xl"
                [src]="profilInfo?.image?.url ? URL + 'storage/' + profilInfo?.image?.url : 'https://media.istockphoto.com/id/1327592506/vector/default-avatar-photo-placeholder-icon-grey-profile-picture-business-man.jpg?s=612x612&w=0&k=20&c=BpR0FVaEa5F24GIw7K8nMWiiGmbb8qmhfkpXcp1dhQg='" />
            </div>
            <div class="px-3">
              <div>
                <button
                  class="montserrat-700 flex h-9 w-[40vw] items-center justify-center rounded-md bg-[#808E9B1A] text-[13px] tracking-wide text-[#808E9B] active:bg-[#808e9b37]"
                  (click)="choiceModal('profil')">
                  <span class="px-1">
                    <img src="../../assets/icon/load.svg" class="pr-1" alt="" />
                  </span>
                  Changer
                </button>
              </div>
              <div>
                <span class="montserrat-400 text-[10px] font-light text-[#2D3748]">Largeur 300px â˜“ Hauteur 300px</span>
              </div>
            </div>
          </div>
        </div>
        <!-- End Profile Picture -->

        <!-- Profile Details -->
        <div class="py-4">
          <table class="text-[13px] border-separate border-spacing-y-2">
            <tr>
              <td class="montserrat-500 pr-5">Compte</td>
              <td *ngIf="profilInfo?.isSubscribe === 1" class="py-[1px] pl-1 montserrat-700">PREMIUM</td>
              <td *ngIf="profilInfo?.isSubscribe === 0" class="py-[1px] pl-1 montserrat-700">FREE</td>
            </tr>
            <tr>
              <td class="montserrat-500 pr-5">ID</td>
              <td class="py-[1px] pl-1 montserrat-700">{{ profilInfo?.id }}</td>
            </tr>

            <!-- Chauffeur Specific Info -->
            <tr *ngIf="profilInfo?.role.role_name === 'chauffeur'">
              <td class="montserrat-500 pr-5">Pseudo</td>
              <td class="py-[1px] pl-1 montserrat-700">{{ profilInfo?.chauffeur.pseudo }}</td>
            </tr>
            <tr *ngIf="profilInfo?.role.role_name !== 'organisateur'">
              <td class="montserrat-500 pr-5">VÃ©hicule</td>
              <td class="py-[1px] pl-1 montserrat-700">{{ profilInfo?.chauffeur.carBrind }}</td>
            </tr>
            <tr *ngIf="profilInfo?.role.role_name !== 'organisateur'">
              <td class="montserrat-500 pr-5">CatÃ©gorie</td>
              <td class="py-[1px] pl-1 montserrat-700">{{ profilInfo?.chauffeur.categorie }}</td>
            </tr>
            <tr *ngIf="profilInfo?.role.role_name !== 'organisateur'">
              <td class="montserrat-500 pr-5">NÂ° carte</td>
              <td class="py-[1px] pl-1 montserrat-700">{{ profilInfo?.chauffeur.numCardPro }}</td>
            </tr>
          </table>
        </div>
        <!-- End Profile Details -->

        <!-- Friends Section -->
        <hr />
        <div class="py-3 w-full">
          <label class="montserrat-500">Amis</label>
          <div class="mt-2 flex flex-wrap gap-2">
            <ng-container *ngFor="let amis of friendsList; let i = index">
              <div *ngIf="i < 7" class="h-[15vh] w-[27vw] flex flex-col items-center">
                <div class="flex items-center overflow-hidden rounded">
                  <a [routerLink]="'/profil/' + amis?.id">
                    <img
                      [src]="amis?.user?.image?.url ? URL + 'storage/' + amis?.user?.image?.url : 'https://media.istockphoto.com/default-avatar.jpg'"
                      alt="{{ amis?.user?.firstName }}" class="h-full w-full">
                  </a>
                </div>
                <div class="w-full text-center">
                  <a [routerLink]="'/profil/' + amis.id">
                    <label class="font-montserrat font-semibold">{{ amis?.user?.firstName }} {{ amis?.user?.lastName
                      }}</label>
                  </a>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
        <!-- End Friends Section -->

        <!-- Reactions -->
        <hr />
        <div class="my-4">
          <label class="montserrat-500">RÃ©actions</label>
          <div class="flex py-3">
            <div class="flex items-center px-2">
              <img class="pr-2" src="../../assets/icon/thumRed.svg" alt="" (click)="dislike()">
              <span class="text-[#02263D] Montserrat-900">{{ profilInfo?.dislikes }}</span>
            </div>
            <div class="flex items-center px-2">
              <img class="pr-2" src="../../assets/icon/thumGreen.svg" alt="" (click)="like()">
              <span class="text-[#02263D] Montserrat-900">{{ profilInfo?.likes }}</span>
            </div>
          </div>
        </div>
        <!-- End Reactions -->

        <!-- Participation -->
        <hr />
        <div class="my-4">
          <label class="montserrat-500">Participation ({{currentParticipationPoints}}/50 points)</label>
          <div class="w-full bg-[#D9D9D9] h-3 rounded-full mt-3">
            <div #progressBar class="py-1.5 bg-gradient-to-r from-[#EB2F06] to-[#06FF3D] rounded-full"
              [style.width.%]="participationProgress"></div>
          </div>
          <div *ngIf="participationProgress === 0" class="text-red-600 mt-2">
            Vous devez participer pour continuer Ã  utiliser les fonctionnalitÃ©s.
          </div>
          <div *ngIf="participationProgress > 0" class="text-green-600 mt-2 text-sm">
            Points perdus quotidiennement. Participez pour en gagner !
          </div>
        </div>
        <!-- End Participation -->

        <!-- Buttons -->
        <div class="pb-10 pt-5">
          <ion-button (click)="goTo('updateProfil')" color="transparent" style="text-transform: none;"
            class="h-[40px] w-full rounded-xl border-2 bg-[#1D4999] active:bg-transparent border-[#1D4999] text-[13px] montserrat-700 tracking-wide text-white active:text-[#1D4999]">Modifier</ion-button>
        </div>
      </div>
    </div>

    <app-image-source-modal *ngIf="sourceModal" (choice)="choiceMethod($event)"
      (closeModal)="choiceModal('')"></app-image-source-modal>
    <input type="file" (change)="onFileSelected($event)" hidden #fileInput />
  </div>
</ion-content>
### END Ionic-project\src\app\profile\profil\profil.page.html ###

### BEGIN Ionic-project\src\app\profile\profil\profil.page.scss ###
### END Ionic-project\src\app\profile\profil\profil.page.scss ###

### BEGIN Ionic-project\src\app\profile\profil\profil.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ProfilPage } from './profil.page';

describe('ProfilPage', () => {
  let component: ProfilPage;
  let fixture: ComponentFixture<ProfilPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(ProfilPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\profile\profil\profil.page.spec.ts ###

### BEGIN Ionic-project\src\app\profile\profil\profil.page.ts ###
import { ChangeDetectorRef, Component, ElementRef, OnInit, Renderer2, ViewChild } from '@angular/core';
import { Router } from '@angular/router';
import { Camera, CameraOptions } from '@awesome-cordova-plugins/camera/ngx';
import { NoteAmis } from '../../utiles/interface/note-amis';
import { ProfilService } from '../../utiles/services/profil/profil.service';
import { URL_BASE } from 'src/environments/environment';
import { presentToast } from 'src/app/utiles/component/notification';
import { NavController } from '@ionic/angular';
import { ListPointsService } from 'src/app/utiles/services/points/list-points.service';
import { ParticipationService } from 'src/app/utiles/services/participation/participation.service';

@Component({
  selector: 'app-profil',
  templateUrl: './profil.page.html',
  styleUrls: ['./profil.page.scss'],
})
export class ProfilPage implements OnInit {
  Math = Math;
  URL = URL_BASE; // TO USE THE URL ON TEMPLATE
  friendsList: Array<any> = []
  profilInfo: any;
  width: number = 0
  key: string = ''


  sourceModal: boolean = false
  sourceChoice: string = ''
  selectedFile: File | undefined;
  participationProgress!: number;
  currentParticipationPoints: number = 0;
  @ViewChild('fileInput') fileInput: ElementRef | undefined;


  error_messages_global = [
    /*0*/ { name: "image", message: "La taille d'image doit avoir 300px X 300px.", display: false, input: 'https://media.istockphoto.com/id//vector/default-avatar-photo-placeholder-icon-grey-profile-picture-business-man.jpg?s=612x612&w=0&k=20&c=BpR0FVaEa5F24GIw7K8nMWiiGmbb8qmhfkpXcp1dhQg=' },

  ]


  partisipation: any = { 'w-[0vw]': true };
  imageRecto: string = '';
  imageProfile: string = ''
  @ViewChild('progressBar', { static: false }) progressBar !: ElementRef;

  constructor(private router: Router, private camera: Camera, private navController: NavController,
    private profilService: ProfilService,
    private pointService: ListPointsService,
    private participationService: ParticipationService,
    private changeDetectorRef: ChangeDetectorRef,
    private renderer: Renderer2
  ) { }

  async ngOnInit() {
    await this.profil();
    this.profilInfo = this.profilService.$userinfo;
    // getUserByPoints() will be called from within profil() after we get the response
  }

  async ionViewDidEnter() {
    await this.profil();
    this.navController.navigateRoot(['/profil']);
    this.friendsList = this.profilService.$friendsList;
    // Don't call getUserByPoints again - it's already called in ngOnInit
  }

  ionViewWillEnter() {
    // Clear any existing views in the stack
  }
  ngAfterViewInit() {
    if (this.progressBar) {
      console.log('progressBar is defined');
    } else {
      console.log('progressBar is not defined');
    }
  }

  async getUserByPoints() {
    console.log('ðŸŽ¯ getUserByPoints called');
    console.log('ðŸ†” User ID:', this.profilInfo?.id);
    
    const userId = this.profilInfo?.id;
    if (userId) {
      console.log('âœ… Setting up participation service for user:', userId);
      
      // Only subscribe to points updates, don't trigger multiple API calls
      this.participationService.points$.subscribe(points => {
        console.log('ðŸ“Š Updated participation points:', points);
        // Ensure points is a valid number
        const validPoints = isNaN(points) ? 0 : Math.max(0, Math.min(50, points));
        this.participationProgress = (validPoints / 50) * 100;
        console.log('ðŸ“ˆ Progress calculated:', this.participationProgress);
        this.updateParticipationUI();
      });
      
      // Set user ID ONCE - this triggers the API call
      this.participationService.setUserId(userId);
    } else {
      console.log('âŒ No user ID found');
    }
  }

  updateParticipationUI() {
    console.log('ðŸŽ¨ UpdateUI - Progress:', this.participationProgress);
    
    if (this.progressBar && this.progressBar.nativeElement) {
      this.renderer.setStyle(this.progressBar.nativeElement, 'width', `${this.participationProgress}%`);
      this.changeDetectorRef.detectChanges();
    }
  }
  goPage(page: any) {
    this.navController.navigateForward(page)
  }

  //use api to add likes && dislikes later
  like() {
    this.profilInfo.likes = 1;
  }

  dislike() {
    this.profilInfo.dislikes = 1;
  }
  goTo(page: string) {

    switch (page) {
      case 'friends':
        this.router.navigate(["/gestion-amis"])
        break;

      case 'map':
        this.router.navigate(["/map"])
        break;

      case 'updateProfil':
        this.router.navigate(["/update-profil"])
        break;

      default:
        break;
    }
  }

  async profil() {
    console.log('ðŸ“ž Calling profil() method');
    this.profilService.$profil().subscribe(
      (data: any) => {
        console.log('ðŸ” Profile API Response:', data);
        console.log('ðŸŽ¯ Participation in response:', data.participation);
        this.profilService.$userinfo = data;
        this.profilInfo = this.profilService.$userinfo;
        
        // Now that we have profile data, set up participation
        if (data.participation_score !== undefined) {
          console.log('ðŸš€ Setting participation points from profile:', data.participation_score);
          const points = data.participation_score;
          this.participationService['pointsSubject'].next(points);
          this.currentParticipationPoints = points;
          this.participationProgress = (points / 50) * 100;
          this.updateParticipationUI();
        }
      },
      (err) => {
        console.log('error : ' + err);
      }
    );
  }

  // Profile image upload

  choiceModal(choice: string) {
    console.log('source modal initial', this.sourceModal)
    this.sourceModal = !this.sourceModal;
    console.log('source modal last', this.sourceModal)

    if (this.sourceModal) {
      this.sourceChoice = choice
    } else {
      this.sourceChoice = ''
    }

    console.log('from : ' + this.sourceChoice);

  }

  choiceMethod(choice: any) {
    console.log(choice + ' ------> ' + this.sourceChoice);

    switch (choice) {
      case 'takePic':
        this.takePhoto(this.sourceChoice);
        break;

      case 'getPic':
        this.getPhoto(this.sourceChoice);
        break;
      default:
        break;
    }
  }

  takePhoto(document: string) {
    const cameraOptions: CameraOptions = {
      quality: 30,
      destinationType: this.camera.DestinationType.DATA_URL,
      encodingType: this.camera.EncodingType.JPEG,
      mediaType: this.camera.MediaType.PICTURE,
      sourceType: this.camera.PictureSourceType.CAMERA,
      correctOrientation: true
    };

    this.camera.getPicture(cameraOptions)
      .then((imageData) => {
        const base64Image = 'data:image/jpeg;base64,' + imageData;
        if (document == 'profil') {
          this.error_messages_global[0].input = base64Image;
          this.uploadImages('profil', 'image');
        } else {
          presentToast('veuillez ajouter une image de profile', 'bottom', 'success');

        }

      })
      .catch((error) => {
        presentToast(JSON.stringify(error), 'bottom', 'danger');
      });
  }


  getPhoto(document: string) {
    const cameraOptions: CameraOptions = {
      quality: 30,
      destinationType: this.camera.DestinationType.DATA_URL,
      encodingType: this.camera.EncodingType.JPEG,
      mediaType: this.camera.MediaType.PICTURE,
      sourceType: this.camera.PictureSourceType.PHOTOLIBRARY,
      correctOrientation: true
    };

    this.camera.getPicture(cameraOptions)
      .then((imageData) => {
        console.log('this image data', imageData)
        const base64Image = 'data:image/jpeg;base64,' + imageData;

        if (document == 'profil') {
          this.error_messages_global[0].input = base64Image;
          this.uploadImages('profil', 'image');
        } else {
          presentToast('veuillez ajouter une image de profile', 'bottom', 'success');

        }

      })
      .catch((error) => {
        // alert(JSON.stringify(error));
        console.log('from backend', JSON.stringify(error))
        presentToast(JSON.stringify(error), 'bottom', 'danger');
      });
  }

  uploadImages(face: string, type: string) {
    let image;
    if (face == "profil") {
      image = this.error_messages_global[0].input
      console.log("profile image input", image)
    }

    let content = {
      image,
      type
    }
    this.profilService.$uploadImage(content).subscribe(
      async (data: any) => {
        console.log('Upload response:', data);
        this.imageProfile = data.image_id;
        console.log("the image id", this.imageProfile);
        console.log('image dataa', this.imageProfile)
        this.sourceModal = false
        presentToast('Image de profil uploadÃ©e avec succÃ¨s', 'bottom', 'success');
      },
      (err: any) => {
        presentToast('error : ' + JSON.stringify(err), 'bottom', 'danger')
      }
    );
    this.updateprofile()
  }

  updateprofile() {
    let content = {
      image: this.imageProfile,
    }
    this.profilService.$updatePrsonalInfo(content).subscribe((data: any) => {
      console.log('data from updating user info image', data)
      this.error_messages_global[0].input = data?.image;
      this.profilService.$userinfo = data;
      presentToast('vos informations personnelles ont Ã©tÃ© mises Ã  jour!', 'bottom', 'success')

    })
  }

}

### END Ionic-project\src\app\profile\profil\profil.page.ts ###

### BEGIN Ionic-project\src\app\profile\update-profil\update-profil-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { UpdateProfilPage } from './update-profil.page';

const routes: Routes = [
  {
    path: '',
    component: UpdateProfilPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class UpdateProfilPageRoutingModule {}

### END Ionic-project\src\app\profile\update-profil\update-profil-routing.module.ts ###

### BEGIN Ionic-project\src\app\profile\update-profil\update-profil.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { UpdateProfilPageRoutingModule } from './update-profil-routing.module';

import { UpdateProfilPage } from './update-profil.page';
import { ShareModule } from 'src/app/utiles/share/share.module';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    UpdateProfilPageRoutingModule,
    ShareModule
    
  ],
  declarations: [UpdateProfilPage]
})
export class UpdateProfilPageModule {}

### END Ionic-project\src\app\profile\update-profil\update-profil.module.ts ###

### BEGIN Ionic-project\src\app\profile\update-profil\update-profil.page.html ###
<div class="h-[13vh] w-full" style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%"></div>
<div class="w-full h-[100vh] bg-[#F3F4F7] p-6 overflow-auto">

  <!-- head -->
  <div class="flex w-full py-5">
    <div (click)="back()" class="pt-1">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
    <div class=" px-4 text-[24px] font-bold leading-6 montserrat-700">Modifier</div>
  </div>
  <!-- end head -->

  <!-- inputs -->
  <div class="mb-4 ">
    <div *ngIf="registerAs != 'chauffeur'" >
      <label class="text-[13px] montserrat-600">Nom de lâ€™Ã©tablissement <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Nom de lâ€™Ã©tablissement</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/user.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Nom de lâ€™Ã©tablissement" type="text" name="username" [(ngModel)]="error_messages_organizateur[0].input" />
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_organizateur[0].display" class="text-red-600 font-bold text-[10px]">{{error_messages_organizateur[0].message}}</span>
      </div>
    </div>

    <div *ngIf="registerAs == 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">Pseudo <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Pseudo</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/user.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Pseudo" type="text" name="username" [(ngModel)]="error_messages_chauffeur[0].input" />
      </label>
      <div class="flex flex-col">
        <span *ngIf="error_messages_chauffeur[0].display" class="text-red-600 font-bold text-[10px]">{{error_messages_chauffeur[0].message}}</span>
      </div>
    </div>

    <div class="mt-2">
      <label class="text-[13px] montserrat-600">Nom <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Nom</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/user.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Nom" type="text" name="nom" [(ngModel)]="this.error_messages_global[2].input" />
      </label>
      <div class="flex flex-col">
        <span *ngIf="error_messages_global[1].display" class="text-red-600 font-bold text-[10px]">{{error_messages_global[1].message}}</span>
      </div>
    </div>

    <div class="mt-2">
      <label class="text-[13px] montserrat-600">PrÃ©nom <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">PrÃ©nom</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/user.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="PrÃ©nom" type="text" name="prenom" [(ngModel)]="error_messages_global[1].input" />
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_global[2].display" class="text-red-600 font-bold text-[10px]">{{error_messages_global[2].message}}</span>
      </div>
    </div>

    <div *ngIf="registerAs == 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">VÃ©hicule <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">VÃ©hicule</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/car.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Marque, modÃ¨le" type="text" name="username" [(ngModel)]="error_messages_chauffeur[1].input" />
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_chauffeur[1].display" class="text-red-600 font-bold text-[10px]">{{error_messages_chauffeur[1].message}}</span>
      </div>
    </div>

    <div class="mt-2">
      <label class="text-[13px] montserrat-600">Email <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Email</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/email.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Email" type="text" name="username" [(ngModel)]="error_messages_global[3].input" />
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_global[3].display" class="text-red-600 font-bold text-[10px]">{{error_messages_global[3].message}}</span>
        <span *ngIf="error_messages_global[4].display" class="text-red-600 font-bold text-[10px]">{{error_messages_global[4].message}}</span>
      </div>
    </div>

    <div *ngIf="registerAs == 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">CatÃ©gories <span class="text-red-600">*</span></label>
      <div class="mt-1 flex h-10 w-full">
        <div class="mr-2 flex w-[45%] px-6 items-center rounded-3xl" [ngClass]="{'bg-[#1D4999] text-white': categorie == 'van', 'bg-[#02263d2d]': categorie != 'van'}">
          <input [checked]="categorie == 'van'" type="radio" name="operator" class="h-4 w-4" (change)="changeCategorie('van')" />
          <label class="pl-1 text-[11px] poppins-regular">Van</label>
        </div>
        <div class="flex w-[45%] px-6 items-center rounded-3xl bg-[#02263d2d]" [ngClass]="{'bg-[#1D4999] text-white': categorie == 'berline', 'bg-[#02263d2d]': categorie != 'berline'}">
          <input [checked]="categorie == 'berline'" type="radio" name="operator"  class="h-4 w-4" (change)="changeCategorie('berline')" />
          <span class="pl-1 text-[11px] poppins-regular">berline</span>
        </div>
      </div>
    </div>

    <div *ngIf="registerAs != 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">Adresse <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Adresse</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/mark.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Adresse" type="text" name="username" [(ngModel)]="error_messages_organizateur[1].input" />
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_organizateur[1].display" class="text-red-600 font-bold text-[10px]">{{error_messages_organizateur[1].message}}</span>
      </div>
    </div>

    <div class="flex items-center pt-5">
      <button (click)="updateProfil()" style="text-transform: none;" class="h-9 w-full rounded-xl bg-[#1D4999] text-[13px] montserrat-600 tracking-wide text-white">Modifier</button>
    </div>

    <div *ngIf="registerAs == 'chauffeur'" class="w-90 border border-[#00396542] my-8"></div>

    <div *ngIf="registerAs == 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">NumÃ©ro de la carte professionnelle <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">NumÃ©ro de la carte professionnelle</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/car.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="NÂ° de carte professionnelle" type="text" name="username" [(ngModel)]="error_messages_chauffeur[2].input" />
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_messages_chauffeur[2].display" class="text-red-600 font-bold text-[10px]">{{error_messages_chauffeur[2].message}}</span>
      </div>
    </div>

    <div *ngIf="registerAs == 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">Photo recto de carte professionnelle <span class="text-red-600">*</span></label>
       <button class="h-11 w-[65vw] rounded-xl bg-[#1d48991d] text-[13px]  montserrat-700 tracking-wide text-[#1D4999] flex items-center justify-center">
        <span class="px-2">
          <img src="../../assets/icon/upload.svg" class="pr-1" alt="">
          </span>Charger une photo recto
        </button>
    </div>

    <div *ngIf="registerAs == 'chauffeur'" class="mt-2">
      <label class="text-[13px] montserrat-600">Photo verso de carte professionnelle <span class="text-red-600">*</span></label>
       <button class="h-11 w-[65vw] rounded-xl bg-[#1d48991d] text-[13px] montserrat-700 tracking-wide text-[#1D4999] flex items-center justify-center" >
        <span class="px-2">
          <img src="../../assets/icon/upload.svg" class="pr-1" alt="">
        </span>Charger une photo verso
        </button>
    </div>

    <div *ngIf="registerAs == 'chauffeur'" class="flex items-center pt-5">
      <button (click)="validationProfessionalInfo()" style="text-transform: none;" class="h-9 w-full rounded-xl bg-[#1D4999] text-[13px] montserrat-600 tracking-wide text-white">Valider</button>
    </div>

    <div class="w-90 border border-[#00396542] my-8"></div>

    <div class="mt-2">
      <label class="pt-1 text-[13px] montserrat-600">Mot de passe actuel <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Mot de passe actuel</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/lock.svg" class="pr-1" alt="">
        </span>
        <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Mot de passe actuel" type="password" name="password" [(ngModel)]="error_message_password[0].input"/>
        <span class="absolute inset-y-0 right-0 flex items-center pr-3 text-[#879EA4]">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
          </svg>
        </span>
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_message_password[0].display" class="text-red-600 font-bold text-[10px]">{{error_message_password[0].message}}</span>
      </div>
    </div>

    <div class="mt-2">
      <label class="pt-1 text-[13px] montserrat-600">Mot de passe <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Mot de passe</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
                    <img src="../../assets/icon/lock.svg" class="pr-1" alt="">
        </span>
        <input id="password" class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Mot de passe" type="password" name="password" [(ngModel)]="error_message_password[1].input" />
        <span class="absolute inset-y-0 right-0 flex items-center pr-3 text-[#879EA4]">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
          </svg>
        </span>
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_message_password[1].display" class="text-red-600 font-bold text-[10px]">{{error_message_password[1].message}}</span>
      </div>
    </div>

    <div class="mt-2">
      <label class="pt-1 text-[13px] montserrat-600">Confirmation de mot de passe <span class="text-red-600">*</span></label>
      <label class="relative block text-[13px]">
        <span class="sr-only">Confirmation de mot de passe</span>
        <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
          <img src="../../assets/icon/lock.svg" class="pr-1" alt="">
        </span>
        <input id="confirm" class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Mot de passe" type="password" name="password" [(ngModel)]="error_message_password[2].input"/>
        <span  class="absolute inset-y-0 right-0 flex items-center pr-3 text-[#879EA4]">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
          </svg>
        </span>
      </label>
      <div class="flex flex-col">
        <span  *ngIf="error_message_password[2].display" class="text-red-600 font-bold text-[10px]">{{error_message_password[2].message}}</span>
        <span  *ngIf="error_message_password[3].display" class="text-red-600 font-bold text-[10px]">{{error_message_password[3].message}}</span>
      </div>
    </div>


    <div class="flex items-center pt-5">
      <button (click)="submiteUpdatePassword()" style="text-transform: none;" class="h-9 w-full rounded-xl bg-[#1D4999] text-[13px] montserrat-600 tracking-wide text-white">Modifier Mot de passe</button>
    </div>
  </div>
  <!-- end inputs -->
</div>

<app-warning-update-proffessional-info *ngIf="displayModal.warningUpdateProffissionalInfo" (closeConfirmation)="showModal('warning')" (updatingInfo)="showModal('update-prof-info')"></app-warning-update-proffessional-info>
### END Ionic-project\src\app\profile\update-profil\update-profil.page.html ###

### BEGIN Ionic-project\src\app\profile\update-profil\update-profil.page.scss ###
### END Ionic-project\src\app\profile\update-profil\update-profil.page.scss ###

### BEGIN Ionic-project\src\app\profile\update-profil\update-profil.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { UpdateProfilPage } from './update-profil.page';

describe('UpdateProfilPage', () => {
  let component: UpdateProfilPage;
  let fixture: ComponentFixture<UpdateProfilPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(UpdateProfilPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\profile\update-profil\update-profil.page.spec.ts ###

### BEGIN Ionic-project\src\app\profile\update-profil\update-profil.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';
import { presentToast } from 'src/app/utiles/component/notification';
import { ProfilService } from 'src/app/utiles/services/profil/profil.service';

@Component({
  selector: 'app-update-profil',
  templateUrl: './update-profil.page.html',
  styleUrls: ['./update-profil.page.scss'],
})
export class UpdateProfilPage implements OnInit {

  registerAs:string = "chauffeur";
  categorie:string = "van";
  currentNumberCard:string = "";
  role:string = "";

  userinfo:any = {
    firstName: '',
    lastName: '',
    email: '',
    pseudo: '',
    carBrind: '',
    categorie: '',
    numCardPro: '',
    organization: '',
    address: ''
  };
  
  error_messages_chauffeur:any = [
    /*0*/ {name: "pseudo",message:"Pseudo est Obligatoire.", display:false, input:''},
    /*1*/ {name: "brand",message:"La vehicule information est Obligatoire.", display:false, input:''},
    /*3*/ {name: "cart",message:"Numero de la cart est Obligatoire.", display:false, input:''},
    /*2*/ {name: "recto",message:"la taille d'image doit etre .", display:false, input:'1'},
    /*4*/ {name: "verso",message:"La photo verso de la cart est Obligatoire.", display:false, input:'2'},
  ];

  error_messages_organizateur:any = [
    /*0*/ {name: "organization",message:"Le nom d'Ã©tablissement est Obligatoire.", display:false, input:''},
    /*1*/ {name: "address",message:"L'adresse d'Ã©tablissement est Obligatoire.", display:false, input:''},
  ];

  error_messages_global = [
    /*0*/ {name: "image",message:"La taille d'image doit avoir 300px X 300px.", display:false, input:'https://media.licdn.com/dms/image/D4E03AQGM7EaPKzXbrQ/profile-displayphoto-shrink_800_800/0/1696715017288?e=1717632000&v=beta&t=BN6rQ6RK5UQ0wSkXtEeHRiDSSEa2ez6FsMHcW1NmMXA'},
    /*1*/ {name: "lastname",message:"Le nom est Obligatoire.", display:false, input:''},
    /*2*/ {name: "firstname",message:"Le prenom est Obligatoire.", display:false, input:''},
    /*3*/ {name: "email",message:"L'email est Obligatoire", display:false, input:''},
    /*4*/ {name: "emailformat",message:"veuillez entrer le format d'e-mail correct !", display:false, input:'email format'},

  ];

  error_message_password = [
    /*0*/ {name: "currentpassword",message:"Mot de passe actuel est Obligatoire.", display:false, input:''},
    /*1*/ {name: "password",message:"Mot de passe est Obligatoire.", display:false, input:''},
    /*2*/ {name: "passConfirm",message:"Mot de passe Confirmation est Obligatoire.", display:false, input:''},
    /*3*/ {name: "passMatching",message:"les mots de passe ne correspondent pas ! ", display:false, input:'mating password'},
  ];

  displayModal:any = {
    warningUpdateProffissionalInfo:false
  }

  constructor(
    private router:Router,
    private profileService:ProfilService
  ) { }

  ngOnInit() {
  }

  ionViewWillEnter(){
    this.profil();
  }

  changeRegisterAs(value:any){
    this.registerAs = value.value;
  }

  profil(){
    this.profileService.$profil().subscribe(
      (data:any) => {
        this.registerAs = data.role.role_name;
        this.error_messages_global[1].input = data?.lastName
        this.error_messages_global[2].input = data?.firstName;
        this.error_messages_global[3].input = data?.email;
        this.role = data?.role?.role_name;
        if(this.registerAs == 'chauffeur'){
          this.error_messages_chauffeur[0].input = data?.chauffeur?.pseudo
          this.error_messages_chauffeur[1].input = data?.chauffeur?.carBrind;
          this.error_messages_chauffeur[2].input = data?.chauffeur?.numCardPro;
          this.currentNumberCard = data?.chauffeur?.numCardPro;
          this.categorie = data?.chauffeur?.categorie;
        }else if(this.registerAs == 'organisateur'){
          this.error_messages_organizateur[0].input = data?.organisateur?.organization
          this.error_messages_organizateur[1].input = data?.organisateur?.address;
        }
        this.profileService.$userinfo = data
      },
      err => {
        console.log('error : '+ err.error.message);
      }
    );
  }

  changeCategorie(value:any){
    console.log('categorie : ' + value);
    
    this.categorie = value;
  }

  updateProfil(){ 
    if(this.validationPersonnalInfo()){
      this.updatePersonalInfo();
    }  
  }

  updateProfessionnalInfo(){
    let content = {
      "numCardPro": this.error_messages_chauffeur[2].input
    }

    this.profileService.$updateProffessionalInfo(content).subscribe(
      (data:any) => {
        console.log('api result : ' + JSON.stringify(data));
        this.showModal('warning');
        this.logout();
      },
      (err) => {
        console.log('error : ' + JSON.stringify(err));

      }
    );
  }

  updatePersonalInfo(){
    let content = {
      pseudo: this.error_messages_chauffeur[0].input,
      lastName: this.error_messages_global[1].input ,
      firstName: this.error_messages_global[2].input ,
      carBrind: this.error_messages_chauffeur[1].input,
      email: this.error_messages_global[3].input,
      categorie: this.categorie,
      role: this.role
    }

    this.profileService.$updatePrsonalInfo(content).subscribe(
      (data:any) => {
        console.log('api result : ' + JSON.stringify(data));
        this.registerAs = data.role.role_name;
        this.error_messages_global[1].input = data?.lastName
        this.error_messages_global[2].input = data?.firstName;
        this.error_messages_global[3].input = data?.email;
        this.role = data?.role?.role_name;
        if(this.registerAs == 'chauffeur'){
          this.error_messages_chauffeur[0].input = data?.chauffeur?.pseudo
          this.error_messages_chauffeur[1].input = data?.chauffeur?.carBrind;
          this.error_messages_chauffeur[2].input = data?.chauffeur?.numCardPro;
          this.currentNumberCard = data?.chauffeur?.numCardPro;
          this.categorie = data?.chauffeur?.categorie;
        }else if(this.registerAs == 'organisateur'){
          this.error_messages_organizateur[0].input = data?.organisateur?.organization
          this.error_messages_organizateur[1].input = data?.organisateur?.address;
        }
        this.profileService.$userinfo = data;
        presentToast('vos informations personnelles ont Ã©tÃ© mises Ã  jour!', 'bottom', 'success')
      },
      (err) => {
        console.log('error : ' + JSON.stringify(err));

      }
    );
  }

  validationPersonnalInfo(){
    this.error_messages_chauffeur.map((el:any) => el.display = false);
    this.error_messages_global.map((el:any) => el.display = false);
    this.error_messages_organizateur.map((el:any) => el.display = false);
    if(this.registerAs == "chauffeur"){
     
      for(let i=0; i < this.error_messages_chauffeur.length-3; i++){
        if(this.error_messages_chauffeur[i].input == ""){
          this.error_messages_chauffeur[i].display = true;
        }
      }

    }else if(this.registerAs == 'organisateur'){
      for(let i=0; i < this.error_messages_organizateur.length; i++){
        if(this.error_messages_organizateur[i].input == ""){
          this.error_messages_organizateur[i].display = true;
        }
      }
    }

    for(let i=0; i<=this.error_messages_global.length-6;i++){
      if(i==3){
        if(this.error_messages_global[i].input != "" && this.isNotEmail(this.error_messages_global[i].input)){
          this.error_messages_global[i+1].display = true;
        }
      }
      
    }
    const allEqual = (arr:any) => arr.every((error:any) => !error.display );
    if(this.registerAs == "chauffeur"){     
      return allEqual(this.error_messages_chauffeur) && allEqual(this.error_messages_global);
    }else if(this.registerAs == 'organisateur'){
      return allEqual(this.error_messages_organizateur) && allEqual(this.error_messages_global);
    }

  }

  validationProfessionalInfo(){
    this.error_messages_chauffeur.map((el:any) => el.display = false);
    this.error_messages_global.map((el:any) => el.display = false);
    this.error_messages_organizateur.map((el:any) => el.display = false);
    
    if(this.error_messages_chauffeur[2].input == ""){
      this.error_messages_chauffeur[2].display = true;
    }else if(this.error_messages_chauffeur[2].input != "" && this.error_messages_chauffeur[2].input != this.currentNumberCard){
      this.showModal('warning');
    }
   
  }

  validationPassword(){
    this.error_messages_chauffeur.map((el:any) => el.display = false);
    this.error_messages_global.map((el:any) => el.display = false);
    this.error_messages_organizateur.map((el:any) => el.display = false);
    this.error_message_password.map((el:any) => el.display = false);
  
    for (let i = 0; i < this.error_message_password.length-1; i++) {
      if(this.error_message_password[i].input == ''){
        this.error_message_password[i].display = true
        console.log('element : '+ JSON.stringify(this.error_message_password[i]));
      }
    }

    if(this.error_message_password[1].input != this.error_message_password[2].input){
      this.error_message_password[3].display = true;
    }
      
    const allEqual = (arr:any) => arr.every((error:any) => error.input != '' );
    return allEqual( this.error_message_password);
  }

  submiteUpdatePassword(){
    if(this.validationPassword()){
      this.changePassword()
    }
  }

  changePassword(){
   
   let content = {
      password: this.error_message_password[0].input,
      newPassword: this.error_message_password[1].input  
   }

    this.profileService.$updatePassword(content).subscribe(
      (data:any) => {
        console.log('api result : ' + JSON.stringify(data));
        this.error_message_password.forEach((el:any, index) =>{
          if(index <= 2){
            el.input = '';
          }
        });
        presentToast('vos password a Ã©tÃ© mises Ã  jour!', 'bottom', 'success')
      },
      (err) => {
        console.log('error : ' + JSON.stringify(err));
        if(err.status == 401){
          presentToast(err.error.message, 'bottom', 'danger')
        }
      }
    );
  }

  showModal(modal:string){
    switch (modal) {
      case "warning":
        this.displayModal.warningUpdateProffissionalInfo = !this.displayModal.warningUpdateProffissionalInfo
        break;
      case 'update-prof-info':
        this.updateProfessionnalInfo();
        break;
      default:
        break;
    }
  }



  isNotEmail(email: string): boolean {
    const pattern: RegExp = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    console.log(!pattern.test(email));
    return !pattern.test(email);
  }

  back(){
    this.router.navigate(['/profil'])
  }

  logout(){
    this.profileService.$logout().subscribe(
      (date:any) =>{
        if(date.message == 'ok'){
          (window as any).user = undefined
          localStorage.setItem('apiToken', '');
          this.profileService.$friendsList = [];
          this.router.navigate(['/sign-in']);
        }
      },
      err =>  presentToast('error \n '+err.error.message, 'bottom', 'danger')
    )
  }

}

### END Ionic-project\src\app\profile\update-profil\update-profil.page.ts ###

### BEGIN Ionic-project\src\app\pub\pub-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { PubPage } from './pub.page';

const routes: Routes = [
  {
    path: '',
    component: PubPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class PubPageRoutingModule {}

### END Ionic-project\src\app\pub\pub-routing.module.ts ###

### BEGIN Ionic-project\src\app\pub\pub.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { PubPageRoutingModule } from './pub-routing.module';

import { PubPage } from './pub.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    PubPageRoutingModule
  ],
  declarations: [PubPage]
})
export class PubPageModule {}

### END Ionic-project\src\app\pub\pub.module.ts ###

### BEGIN Ionic-project\src\app\pub\pub.page.html ###
<div class="h-[100vh] w-full" style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat;  background-size: cover; background-position:55% 100%">
  <!-- head -->
  <div class="flex h-[30vh] w-full py-5 p-6 bg-gradient-to-b from-white via-[#ffffffbc] to-[#fff0]">
    <div class="w-[200px] py-6 text-[15pt] font-bold leading-6">PUB</div>
  </div>
  <!-- end head -->

    <!-- buttons -->
  <div class="absolute w-full h-5/12 bg-gradient-to-t from-white via-[#ffffffbc] to-[#fff0] flex items-end bottom-0 text-[12px] font-[Montserrat] font-bold">
    
    <div class="flex flex-col justify-end w-full h-[25vh] p-4 text-white">
      <!-- ignore pub -->
      <div class=" w-full h-[20vh] flex justify-end items-center my-8">
        <div *ngIf="conteurPub > 0" class="bg-[#0000009a] px-7 py-2">
          <span >{{conteurPub}} secondes</span>
        </div>
        <div *ngIf="conteurPub == 0" (click)="redirectPub()" class="bg-[#0000009a] px-7 py-2">
          <span >ignorer lâ€™annonce</span>
        </div>
      </div>
      <!-- ignore pub -->

      <div class="flex justify-around">
        <div *ngIf="displayer.autreDisplay" class="bg-[#6A89CC] w-[40vw] h-[45px] m-1 flex items-center justify-center rounded-lg">
          <span class="px-2 ">
            <img src="../../assets/icon/station.svg" class="pr-1 w-6 h-6" alt="">
          </span><label class="text-[13px]"> Station</label>
        </div>
        <div *ngIf="!displayer.autreDisplay" class="w-[40vw] h-[45px] m-1 flex items-center justify-center rounded-lg">
          <span class="px-2 ">
          </span>
        </div>
        <!-- GPS -->
        <div class=" w-[42vw] h-[45px] flex justify-end px-1" style="visibility: hidden;">
          <div class="w-[45px] h-[45px] text-black bg-white flex justify-center items-center rounded-full drop-shadow-md border  ">
            <img src="../../assets/icon/gps.svg" class="w-7 h-7" alt="">

          </div>
        </div>
        <!-- end GPS -->
      </div>
      <div class="flex justify-around">
        <div  class="bg-purple-500 w-[40vw] h-[45px] m-1 flex items-center justify-center rounded-lg">
          <span class="px-1">
            <img src="../../assets/icon/tickette.svg" class="pr-1 w-6 h-6" alt="">
          </span>
          <label  class="text-[13px]">Ã‰vÃ¨nement</label>
        </div>
        <div (click)="displayer.autreDisplay = !displayer.autreDisplay" class="bg-[#1ABCFE] w-[40vw] h-[45px] m-1 flex items-center justify-center rounded-lg"><span></span><label class="text-[13px]">Autre</label></div>
      </div>
      <div class="flex justify-around">
        <div  class="bg-[#EB2F06] w-[40vw] h-[45px] m-1 flex items-center justify-center rounded-lg">
          <span class="px-1">
            <img src="../../assets/icon/groupPub.svg" class="pr-1 w-6 h-6" alt="">
          </span> <label class="text-[13px]">Affluence</label>
        </div>
        <div class="bg-[#1D4999] w-[40vw] h-[45px] m-1 flex items-center justify-center rounded-lg">
          <span class="px-1">
            <img src="../../assets/icon/note.svg" class="pr-1 w-4 h-4" alt="">
          </span>Note
        </div>
      </div>
    </div>
  </div>
  <!-- end buttons -->
</div>
### END Ionic-project\src\app\pub\pub.page.html ###

### BEGIN Ionic-project\src\app\pub\pub.page.scss ###
### END Ionic-project\src\app\pub\pub.page.scss ###

### BEGIN Ionic-project\src\app\pub\pub.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { PubPage } from './pub.page';

describe('PubPage', () => {
  let component: PubPage;
  let fixture: ComponentFixture<PubPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(PubPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\pub\pub.page.spec.ts ###

### BEGIN Ionic-project\src\app\pub\pub.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';

@Component({
  selector: 'app-pub',
  templateUrl: './pub.page.html',
  styleUrls: ['./pub.page.scss'],
})
export class PubPage implements OnInit {
  displayer = {
    autreDisplay:false
  }

  conteurPub:number = 5;

  constructor(private router:Router) { }

  ngOnInit() {
  }

  ionViewDidEnter(){
    
    const interval = setInterval(()=>{
        this.conteurPub--;
        console.log(this.conteurPub)
        if(this.conteurPub == 0){
          clearInterval(interval)
        }
      }, 1000)
  }

  redirectPub(){
    this.router.navigate(["/onboarding"])
  }

}

### END Ionic-project\src\app\pub\pub.page.ts ###

### BEGIN Ionic-project\src\app\services\api.service.spec.ts ###
import { TestBed } from '@angular/core/testing';

import { ApiService } from './api.service';

describe('ApiService', () => {
  let service: ApiService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(ApiService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});

### END Ionic-project\src\app\services\api.service.spec.ts ###

### BEGIN Ionic-project\src\app\services\api.service.ts ###
import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Observable } from 'rxjs';
import { URL } from 'src/environments/environment';

@Injectable({
  providedIn: 'root',
})
export class ApiService {
  private apiUrl = URL;

  constructor(private http: HttpClient) {}

  private getAuthHeaders(): HttpHeaders {
    const token = localStorage.getItem('apiToken');
    return new HttpHeaders({
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    });
  }

  getAirports(): Observable<any> {
    return this.http.get<any>(`${this.apiUrl}airports`, { headers: this.getAuthHeaders() });
  }

  updateAirport(id: number, data: any): Observable<any> {
    return this.http.post<any>(`${this.apiUrl}airports/${id}`, data, { headers: this.getAuthHeaders() });
  }

  // Participation API endpoints
  getUserParticipation(userId: string): Observable<any> {
    return this.http.get<any>(`${this.apiUrl}participation/${userId}`, {
      headers: this.getAuthHeaders()
    });
  }

  updateUserPoints(userId: string, points: number, action: string): Observable<any> {
    return this.http.post<any>(`${this.apiUrl}participation/${userId}/points`, {
      points,
      action,
      reason: `User action: ${action}`,
      timestamp: new Date().toISOString()
    }, {
      headers: this.getAuthHeaders()
    });
  }

  initializeUserParticipation(userId: string): Observable<any> {
    return this.http.post<any>(`${this.apiUrl}participation/${userId}/initialize`, {
      initialPoints: 40,
      createdAt: new Date().toISOString()
    }, {
      headers: this.getAuthHeaders()
    });
  }

  processDailyReduction(userId: string): Observable<any> {
    return this.http.post<any>(`${this.apiUrl}participation/${userId}/daily-reduction`, {
      timestamp: new Date().toISOString()
    }, {
      headers: this.getAuthHeaders()
    });
  }

  getParticipationHistory(userId: string): Observable<any> {
    return this.http.get<any>(`${this.apiUrl}participation/${userId}/history`, {
      headers: this.getAuthHeaders()
    });
  }
}

### END Ionic-project\src\app\services\api.service.ts ###

### BEGIN Ionic-project\src\app\setting\setting-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { SettingPage } from './setting.page';

const routes: Routes = [
  {
    path: '',
    component: SettingPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class SettingPageRoutingModule {}

### END Ionic-project\src\app\setting\setting-routing.module.ts ###

### BEGIN Ionic-project\src\app\setting\setting.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { SettingPageRoutingModule } from './setting-routing.module';

import { SettingPage } from './setting.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    SettingPageRoutingModule
  ],
  declarations: [SettingPage]
})
export class SettingPageModule {}

### END Ionic-project\src\app\setting\setting.module.ts ###

### BEGIN Ionic-project\src\app\setting\setting.page.html ###
<div class="h-[13vh] w-full" style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%"></div>

<div class="h-[100vh] w-full overflow-auto bg-[#F3F4F7] px-6">
  <!-- head -->
  <div class="flex w-full py-5">
    <div (click)="goTo('map')" class="pt-1.5">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
    <div class="px-4 text-[15pt] font-bold leading-6">ParamÃ¨tres</div>
  </div>
  <!-- end head -->
  
  <!-- content -->
  <div class="w-full my-4">
    <span class="montserrat-600 text-[15px]">Afficher rayon de distance autour du vÃ©hicule ?</span>
    <ion-range mode="ios" style="--bar-height: 8px; --bar-background: white; --bar-border-color:#D2DBEB;" [pin]="true" [ticks]="true" [snaps]="true" [step]="100" [min]="0" [max]="1000" [(ngModel)]="ray"></ion-range>
  </div>

  <hr/>

  <div class="w-full my-6">
    <label class="text-[15px] montserrat-600">VisibilitÃ© de sa position par les autres ?</label>
    <div class="flex my-1 flex-wrap items-center">
      <div class=" mx-1 flex items-center rounded-full px-3 py-2 m-1" [ngClass]="{'bg-[#E6EAEC] ': visibilitySelector != tous.value, 'bg-[#1D4999] text-white':  visibilitySelector == tous.value}">
        <input [checked]="visibilitySelector == tous.value" type="radio" name="visibility" value="tous" class="h-4 w-4" #tous (change)="selectSelectorVisibilities(tous.value)" />
        <span class="px-2 text-[11px] montserrat-500">Tous</span>
      </div>

      <div class="mx-1 flex my-1  items-center rounded-full px-3 py-2 m-1 text-white" [ngClass]="{'bg-[#E6EAEC] ': visibilitySelector != amis.value, 'bg-[#1D4999] text-white':  visibilitySelector == amis.value}">
        <input [checked]="visibilitySelector == amis.value" type="radio" name="visibility" value="amis" class="h-4 w-4" #amis (change)="selectSelectorVisibilities(amis.value)" />
        <span class="px-2 text-[11px] montserrat-500">Amis</span>
      </div>

      <div class="mx-1 flex my-1  items-center rounded-full px-3 py-2 m-1 text-white" [ngClass]="{'bg-[#E6EAEC] ': visibilitySelector != perso.value, 'bg-[#1D4999] text-white':  visibilitySelector == perso.value}">
        <input [checked]="visibilitySelector == perso.value" type="radio" name="visibility" value="personne" class="h-4 w-4" #perso (change)="selectSelectorVisibilities(perso.value)" />
        <span class="px-2 text-[11px] montserrat-500">Personne</span>
      </div>
    </div>
  </div>

  <hr/>

  <div class=" my-6">
    <label class="text-[15px] montserrat-600">Recevoir des notifications ?</label>
    <div class="flex w-full items-center mt-2 flex-wrap">
      <!-- this is cames from dayList array -->
      <div *ngFor="let item of notificationList" class="flex items-center rounded-full px-3 py-2 m-1" [ngClass]="{'bg-[#1D4999] text-white':item.activated , 'bg-[#E6EAEC] text-[#02263D]': !item.activated}" >
        <input (change)="selectNotification(item, $event)" type="checkbox" [checked]="item.activated" name="notification" class="w-4 h-4"/>
        <span class="px-2 text-[11px] montserrat-500" >{{item.name}}</span>
      </div>
    </div>
  </div>

  <hr/>
  
  <div class="my-6">
    
    <label class="text-[13px] montserrat-600">Horaires de services <span class="text-red-600">*</span></label>
    <label class="relative block text-[13px]">
      <span class="sr-only">Horaires de services</span>
      <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
        <img src="../../assets/icon/calendar.svg" class="pr-1" alt="">
      </span>
      <input class="raleway-500 block w-full rounded border border-[#00396542] bg-white py-3 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Horaires de services" type="text" />
    </label>
  </div>

  <hr/>

  <div class="w-full my-4">
    <span class="montserrat-600 text-[15px]">DÃ©lai dâ€™apparition et de disparition des notes :</span>
    <ion-range mode="ios" style="--bar-height: 8px; --bar-background: white; --bar-border-color:#D2DBEB" [pin]="true" [ticks]="true" [snaps]="true" [step]="5" [min]="0" [max]="50" [(ngModel)]="appearanceDuration"></ion-range>
  </div>
  <!-- end content -->
  
  <div class="flex py-5">
    <ion-button (click)="save()" color="transparent" style="--border-radius:0.75rem; text-transform: none;" class="montserrat-700 my-1 h-10 w-full rounded-xl border-2 border-[#1D4999] text-[13px] bg-[#1D4999] active:bg-transparent tracking-wide text-white active:text-[#1D4999]">Valider</ion-button>
    <ion-button (click)="goTo('map')" color="transparent" style="--border-radius:0.75rem; text-transform: none;" class="montserrat-700 my-1 h-10 w-full rounded-xl border-2 border-[#1D4999] text-[13px] tracking-wide text-[#1D4999]">Annuler</ion-button>
  </div>

</div>


### END Ionic-project\src\app\setting\setting.page.html ###

### BEGIN Ionic-project\src\app\setting\setting.page.scss ###
### END Ionic-project\src\app\setting\setting.page.scss ###

### BEGIN Ionic-project\src\app\setting\setting.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { SettingPage } from './setting.page';

describe('SettingPage', () => {
  let component: SettingPage;
  let fixture: ComponentFixture<SettingPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(SettingPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\setting\setting.page.spec.ts ###

### BEGIN Ionic-project\src\app\setting\setting.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';
import { presentToast } from '../utiles/component/notification';
import { ProfilService } from '../utiles/services/profil/profil.service';

@Component({
  selector: 'app-setting',
  templateUrl: './setting.page.html',
  styleUrls: ['./setting.page.scss'],
})
export class SettingPage implements OnInit {

  notificationList:Array<any> = [
    {id: 1, name: "Non", activated: false},
    {id: 2, name: "Toutes", activated: false},
    {id: 3, name: "Niv 3 et 4", activated: false},
    {id: 4, name: "Direct", activated: false},
  ];

  selectedNotificationArray: Array<any> = [];
  visibilitySelector:string = "personne";
  ray:string = '300';
  notificationSelector:string = 'Niv 3 et 4,Direct';
  appearanceDuration:string = '15'
  seeNotePoint:number = 1 
  
  constructor(private router:Router, private profileService:ProfilService) { }

  ngOnInit() {}

  ionViewWillEnter(){
    this.profil();

  }

  ionViewDidEnter(){

  }

  getNotifData(){
    console.log(this.notificationSelector);
    
    let array = this.notificationSelector.split(',');
    if (array.length > 0) {
      array.map(el => this.checkOruncheck(el))
    }
  }

  // select notification from form
  selectNotification(selectednotif:any, event:any){
    let status = event.target.checked
    if(status){
      this.checkOruncheck(selectednotif.name)
    }else{
      this.checkOruncheck(selectednotif.name)
    }
  }

  // searsh for notification 
  findNotificationElement(name:string){
    let element = this.notificationList.find(el => el.name == name)
    if(element){
      return element;
    }
    return {id:0, name:'', activated:false};
  }

   // this method for notification check / uncheck
   checkOruncheck(notificationTitle:string){
    let notificationEement = this.findNotificationElement(notificationTitle);
    if(notificationEement.id != 0){
      if(notificationEement.name != 'Non'){
        this.notificationList.find(el =>el.name == 'Non').activated = false
           
        if(!notificationEement.activated){
          if(this.notificationSelector == '' || this.notificationSelector.includes('Non')){
            this.notificationSelector = notificationEement.name
          }else if(!this.notificationSelector.includes(notificationEement.name)){
            this.notificationSelector += ',' + notificationEement.name

          }
          notificationEement.activated = true;
          // console.log(this.notificationSelector);
          
        }else if(notificationEement.activated){
          notificationEement.activated = false;
          this.rmNotification(notificationEement.name);
          // console.log(this.notificationSelector);
        }
      }else{
        this.notificationList.map(el =>el.name == 'Non'? el.activated = true:el.activated = false)
        this.notificationSelector = 'Non'
      }
      
      // console.log("----------------------------- data --------------------------\n " + this.notificationSelector);
      // console.log("switch checker is done !!!");
    }else{
      console.error("switch checker isn't done !!!, the notification Title not found (find NotificationElement Method take name not find in notificationList array! ");
    }
   }

  goTo(destination:string){
    this.router.navigate(['/map']);
  }

  // select visibility
  selectSelectorVisibilities(value:string){
    this.visibilitySelector = value;
  }

  save(){
    let content = {
      ray:this.ray,
      visibility:this.visibilitySelector,
      notification:this.notificationSelector,
      pointDuration:this.appearanceDuration,
      seeNotesPoint:true
    }

    console.log(content); 
    this.profileService.$updateSetting(content).subscribe(
      (data:any) => {
        console.log(JSON.stringify(data));
        
        if(data.status == 200){
          presentToast("the modification has been saved!","bottom","success");
        }
      },
      err => {
        console.log("error :" + err.error.message);
        presentToast("error :" + err.error.messag,"bottom","danger");
      }
    );
  }


  // drop notification categorie
  rmNotification(content:string){
    let array = this.notificationSelector.split(',');
    array.splice(array.indexOf(content),1);
    this.notificationSelector = ''
    array.map(el => this.notificationSelector += el)   
  }

  profil(){
    this.profileService.$profil().subscribe(
      (data:any) => {
        this.profileService.$userinfo = data;
        this.ray = data.ray;
        this.appearanceDuration = data.pointDuration;
        this.visibilitySelector = data.visibility;
        this.notificationSelector = data.notification;
        this.seeNotePoint = data.seeNotesPoint;
       
        console.log(JSON.stringify(this.notificationList));
        const allEqual = (arr:any) => arr.every((el:any) => !el.activated );
        
        if( allEqual(this.notificationList)){
          this.getNotifData();
        }
      },
      err => {
        console.log('error : '+ err.error.message);
      }
    );
  }

}

### END Ionic-project\src\app\setting\setting.page.ts ###

### BEGIN Ionic-project\src\app\sos\sos-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { SosPage } from './sos.page';

const routes: Routes = [
  {
    path: '',
    component: SosPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class SosPageRoutingModule {}

### END Ionic-project\src\app\sos\sos-routing.module.ts ###

### BEGIN Ionic-project\src\app\sos\sos.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { IonicModule } from '@ionic/angular';
import { SosPageRoutingModule } from './sos-routing.module';
import { SosPage } from './sos.page';

@NgModule({
imports: [
CommonModule,
FormsModule,
IonicModule,
SosPageRoutingModule
],
declarations: [SosPage]
})
export class SosPageModule {}

### END Ionic-project\src\app\sos\sos.module.ts ###

### BEGIN Ionic-project\src\app\sos\sos.page.html ###
<ion-content>
  <!-- Bouton SOS -->
  <div (click)="openSosModal()" class="flex items-center">
    <span class="px-1">
      <img src="../../assets/icon/sos.png" class="pr-1 w-6 h-6" alt="SOS">
    </span>
    <label class="text-sm">SOS</label>
  </div>

  <!-- Modal SOS -->
  <ion-modal [isOpen]="isSosModalOpen" (didDismiss)="closeSosModal()">
    <ng-template>
      <app-sos></app-sos>
    </ng-template>
  </ion-modal>
</ion-content>

### END Ionic-project\src\app\sos\sos.page.html ###

### BEGIN Ionic-project\src\app\sos\sos.page.scss ###
ion-content {
  --background: #f8f9fa;
}

ion-header {
  --background: #007bff;
  --color: white;
}

### END Ionic-project\src\app\sos\sos.page.scss ###

### BEGIN Ionic-project\src\app\sos\sos.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { SosPage } from './sos.page';

describe('SosPage', () => {
  let component: SosPage;
  let fixture: ComponentFixture<SosPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(SosPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\sos\sos.page.spec.ts ###

### BEGIN Ionic-project\src\app\sos\sos.page.ts ###
import { Component } from '@angular/core';
import { ModalController } from '@ionic/angular';

@Component({
selector: 'app-sos',
templateUrl: './sos.page.html',
styleUrls: ['./sos.page.scss'],
})
export class SosPage {
constructor(private modalController: ModalController) {}

  dismiss() {
    this.modalController.dismiss(); // Ferme le modal
  }
}

### END Ionic-project\src\app\sos\sos.page.ts ###

### BEGIN Ionic-project\src\app\splash-screen\splash-screen-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { SplashScreenPage } from './splash-screen.page';

const routes: Routes = [
  {
    path: '',
    component: SplashScreenPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class SplashScreenPageRoutingModule {}

### END Ionic-project\src\app\splash-screen\splash-screen-routing.module.ts ###

### BEGIN Ionic-project\src\app\splash-screen\splash-screen.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { SplashScreenPageRoutingModule } from './splash-screen-routing.module';

import { SplashScreenPage } from './splash-screen.page';
import { MapComponent } from '../utiles/component/map/map.component';
import { ShareModule } from '../utiles/share/share.module';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    SplashScreenPageRoutingModule,
    ShareModule
  ],
  declarations: [SplashScreenPage,
    MapComponent
  ]
})
export class SplashScreenPageModule {}

### END Ionic-project\src\app\splash-screen\splash-screen.module.ts ###

### BEGIN Ionic-project\src\app\splash-screen\splash-screen.page.html ###
<!-- <div class="w-full h-[100vh] bg-gradient-to-b from-[#112c5b] to-[#1e4998] flex justify-center items-center flex-col">
  <img src="../../assets/images/icon.png" class="w-[30vh]" alt="">
  <ion-spinner name="circular" color="light"></ion-spinner>
  
</div> -->
<app-map></app-map>
### END Ionic-project\src\app\splash-screen\splash-screen.page.html ###

### BEGIN Ionic-project\src\app\splash-screen\splash-screen.page.scss ###
### END Ionic-project\src\app\splash-screen\splash-screen.page.scss ###

### BEGIN Ionic-project\src\app\splash-screen\splash-screen.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { SplashScreenPage } from './splash-screen.page';

describe('SplashScreenPage', () => {
  let component: SplashScreenPage;
  let fixture: ComponentFixture<SplashScreenPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(SplashScreenPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\splash-screen\splash-screen.page.spec.ts ###

### BEGIN Ionic-project\src\app\splash-screen\splash-screen.page.ts ###
import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';

@Component({
  selector: 'app-splash-screen',
  templateUrl: './splash-screen.page.html',
  styleUrls: ['./splash-screen.page.scss'],
})
export class SplashScreenPage implements OnInit {

  constructor(private router:Router) { }

  ngOnInit() {
    // setTimeout(()=>{
    //   this.router.navigate(['/sign-up'])
    // }, 5000)
  }


}

### END Ionic-project\src\app\splash-screen\splash-screen.page.ts ###

### BEGIN Ionic-project\src\app\src\app\utiles\directives.directive.spec.ts ###
import { DirectivesDirective } from './directives.directive';

describe('DirectivesDirective', () => {
  it('should create an instance', () => {
    const directive = new DirectivesDirective();
    expect(directive).toBeTruthy();
  });
});

### END Ionic-project\src\app\src\app\utiles\directives.directive.spec.ts ###

### BEGIN Ionic-project\src\app\src\app\utiles\directives.directive.ts ###
import { Directive } from '@angular/core';

@Directive({
  selector: '[mapEventDirective]'
})
export class DirectivesDirective {

  constructor() { }

}

### END Ionic-project\src\app\src\app\utiles\directives.directive.ts ###

### BEGIN Ionic-project\src\app\update-evenement\update-evenement-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { UpdateEvenementPage } from './update-evenement.page';

const routes: Routes = [
  {
    path: '',
    component: UpdateEvenementPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class UpdateEvenementPageRoutingModule {}

### END Ionic-project\src\app\update-evenement\update-evenement-routing.module.ts ###

### BEGIN Ionic-project\src\app\update-evenement\update-evenement.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { UpdateEvenementPageRoutingModule } from './update-evenement-routing.module';

import { UpdateEvenementPage } from './update-evenement.page';
import { ShareModule } from '../utiles/share/share.module';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    UpdateEvenementPageRoutingModule,
    ShareModule,

  ],
  declarations: [UpdateEvenementPage]
})
export class UpdateEvenementPageModule {}

### END Ionic-project\src\app\update-evenement\update-evenement.module.ts ###

### BEGIN Ionic-project\src\app\update-evenement\update-evenement.page.html ###
<div>
  <!-- En-tÃªte avec image -->
  <div
    class="w-full h-[13vh]"
    style="background-image:url(../../assets/images/Rectangle_39873.png); background-repeat:no-repeat; background-size:cover;background-position:100%"
  ></div>

  <!-- Contenu principal -->
  <div class="h-[89vh] w-full bg-[#F3F4F7] px-6 overflow-auto">
    <!-- En-tÃªte de la page -->
    <div class="flex w-full py-5">
      <div (click)="close()" class="pt-1.5">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.6"
          stroke="currentColor"
          class="h-5 w-5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"
          />
        </svg>
      </div>
      <div class="px-4 text-[15pt] font-bold leading-6">Ã‰vÃ©nement NÂ° {{ pointId }}</div>
    </div>
    <!-- Fin de l'en-tÃªte -->

    <!-- Formulaire -->
    <div class="w-full">
      <!-- Champ "Lieu" -->
      <div>
        <label class="text-[12px] montserrat-700 text-[#02263D]">Lieu</label>
        <input
          [(ngModel)]="lieu"
          class="block w-full rounded border border-[#00396542] bg-white py-2 pl-3 pr-3 shadow-sm"
          placeholder="Exemple : SDF, OpÃ©ra Garnier, ..."
        />
      </div>

      <!-- Champ "Type" -->
      <div>
        <label class="text-[12px] montserrat-700 text-[#02263D]">Type</label>
        <input
          [(ngModel)]="type"
          class="block w-full rounded border border-[#00396542] bg-white py-2 pl-3 pr-3 shadow-sm"
          placeholder="Exemple : ThÃ©Ã¢tre, SoirÃ©e"
        />
      </div>

      <!-- Champ "Date" -->
      <div>
        <label class="text-[12px] montserrat-700 text-[#02263D]">Date</label>
        <input
          (click)="toggaleModal('date')"
          [value]="date || 'Non dÃ©finie'"
          readonly
          class="block w-full rounded border border-[#00396542] bg-white py-2 pl-3 pr-3 shadow-sm"
        />
        <app-datetime-picker
          *ngIf="displayModal.displayDate"
          [multiDate]="true"
          (closeDateTime)="toggaleModal('date')"
          (valueChange)="setValue($event, 'date')"
        ></app-datetime-picker>
      </div>

      <!-- Heures DÃ©but et Fin -->
      <div class="flex">
        <!-- Heure DÃ©but -->
        <div class="pr-2">
          <label class="text-[12px] montserrat-700 text-[#02263D]">Heure DÃ©but</label>
          <input
            (click)="toggaleModal('time-begin')"
            [value]="heureDebut"
            readonly
            class="block w-full rounded border border-[#00396542] bg-white py-2 pl-3 pr-3 shadow-sm"
          />
          <app-time-picker
            *ngIf="displayModal.displayTimeBegin"
            (closeDateTime)="toggaleModal('time-begin')"
            (valueChange)="setValue($event, 'timeBegin')"
          ></app-time-picker>
        </div>

        <!-- Heure Fin -->
        <div>
          <label class="text-[12px] montserrat-700 text-[#02263D]">Heure Fin</label>
          <input
            (click)="toggaleModal('time-end')"
            [value]="heureFin"
            readonly
            class="block w-full rounded border border-[#00396542] bg-white py-2 pl-3 pr-3 shadow-sm"
          />
          <app-time-picker
            *ngIf="displayModal.displayTimeEnd"
            (closeDateTime)="toggaleModal('time-end')"
            (valueChange)="setValue($event, 'timeEnd')"
          ></app-time-picker>
        </div>
      </div>

      <!-- Boutons -->
      <div class="mt-4 flex justify-between">
        <ion-button
          (click)="close()"
          style="--background:transparent; --background-activated:#3332; text-transform: none;"
          class="h-[40px] w-full rounded-xl border-2 border-[#1D4999] bg-transparent text-[13px] font-bold tracking-wide text-[#1D4999]"
        >
          Annuler
        </ion-button>
        <ion-button
          (click)="updatePoint()"
          style="--background:#1D4999;--background-activated:#173d84; text-transform: none;"
          class="mr-1 h-[40px] w-full border-2 border-[#1D4999] rounded-xl bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white"
        >
          Valider
        </ion-button>
      </div>
    </div>
    <!-- Fin du formulaire -->
  </div>
</div>

### END Ionic-project\src\app\update-evenement\update-evenement.page.html ###

### BEGIN Ionic-project\src\app\update-evenement\update-evenement.page.scss ###
### END Ionic-project\src\app\update-evenement\update-evenement.page.scss ###

### BEGIN Ionic-project\src\app\update-evenement\update-evenement.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { UpdateEvenementPage } from './update-evenement.page';

describe('UpdateEvenementPage', () => {
  let component: UpdateEvenementPage;
  let fixture: ComponentFixture<UpdateEvenementPage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(UpdateEvenementPage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\update-evenement\update-evenement.page.spec.ts ###

### BEGIN Ionic-project\src\app\update-evenement\update-evenement.page.ts ###
import { Component, OnInit } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import axios from 'axios';
import { ListPointsService } from '../utiles/services/points/list-points.service';
import { presentToast } from '../utiles/component/notification';

@Component({
  selector: 'app-update-evenement',
  templateUrl: './update-evenement.page.html',
  styleUrls: ['./update-evenement.page.scss'],
})
export class UpdateEvenementPage implements OnInit {
  displayModal: any = {
    displayDate: false,
    displayTimeBegin: false,
    displayTimeEnd: false,
  };
  lieu: string = '';
  type: string = '';
  date: string = 'Non dÃ©finie'; // Par dÃ©faut
  heureDebut: string = '00:00'; // Par dÃ©faut
  heureFin: string = '00:00'; // Par dÃ©faut

  suggestions: Array<any> = [];
  focusInput: boolean = false;
  selectedposition: { name: string; display_name: string; lat: number; lon: number } = {
    name: '',
    display_name: '',
    lat: 0,
    lon: 0,
  };

  pointId: string | null = '';

  constructor(
    private router: Router,
    private route: ActivatedRoute,
    private pointsService: ListPointsService
  ) {}

  ngOnInit() {
    this.route.paramMap.subscribe((param) => {
      this.pointId = param.get('id');
      console.log('Point ID :', this.pointId);
      this.getDetailPoint(this.pointId);
    });
  }

  getDetailPoint(id: string | null) {
    if (id != null) {
      const json = {
        pointId: id,
      };

      this.pointsService.$getPointDetails(json).subscribe((data: any) => {
        console.log('DonnÃ©es reÃ§ues depuis l\'API :', data);

        this.lieu = data.event.lieu || '';
        this.type = data.event.type || '';
        this.date = data.event.dates || 'Non dÃ©finie';
        /*
          data.event.dateDebut && data.event.dateFin
            ? this.formatDateAndTime(data.event.dateDebut, 'date') +
              ' - ' +
              this.formatDateAndTime(data.event.dateFin, 'date')
            : 'Non dÃ©finie'; // DÃ©finit si la date est manquante*/
        this.heureDebut = data.event.heureDebut || '00:00';
        this.heureFin = data.event.heureFin || '00:00';

        console.log('Date formatÃ©e :', this.date);
        console.log('Heure dÃ©but :', this.heureDebut, 'Heure fin :', this.heureFin);
      });
    } else {
      console.log('ID nul : impossible de rÃ©cupÃ©rer les dÃ©tails.');
    }
  }

  toggaleModal(modal: string) {
    switch (modal) {
      case 'date':
        this.displayModal.displayDate = !this.displayModal.displayDate;
        break;
      case 'time-begin':
        this.displayModal.displayTimeBegin = !this.displayModal.displayTimeBegin;
        break;
      case 'time-end':
        this.displayModal.displayTimeEnd = !this.displayModal.displayTimeEnd;
        break;
      default:
        break;
    }
  }

  close() {
    this.router.navigate(['/list-evenement']);
  }

  updatePoint() {
    const content = {
      pointId: this.pointId,
      lieu: this.lieu,
      type: 'event',
      date: this.date,
      heureDebut: this.heureDebut,
      heureFin: this.heureFin,
    };

    console.log('Contenu mis Ã  jour :', content);

    this.pointsService.$updatePoint(content).subscribe((data: any) => {
      if (data && data.success === true) {

        presentToast("L'Ã©vÃ©nement a Ã©tÃ© modifiÃ© avec succÃ¨s !", 'bottom', 'success');
        this.router.navigate(['list-evenement']);
      }
    });
  }

  setValue(newValue: string[] | string, input: string) {
    console.log('Valeur reÃ§ue :', newValue);

    if (Array.isArray(newValue) && newValue.length >= 2) {
      const [dateDebut, dateFin] = newValue;
      this.date =
        this.formatDateAndTime(dateDebut, 'date') + ' - ' + this.formatDateAndTime(dateFin, 'date');
    } else if (typeof newValue === 'string') {
      this.date = this.formatDateAndTime(newValue, 'date');
    }

    switch (input) {
      case 'timeBegin':
        this.heureDebut = this.formatDateAndTime(newValue as string, 'time');
        break;
      case 'timeEnd':
        this.heureFin = this.formatDateAndTime(newValue as string, 'time');
        break;
      default:
        break;
    }
  }

  formatDateAndTime(getvalue: string, format: string): string {
    const date = new Date(getvalue);
    if (isNaN(date.getTime())) {
      console.log('Date invalide reÃ§ue :', getvalue);
      return 'Non dÃ©finie'; // Retourne "Non dÃ©finie" si la date est invalide
    }

    switch (format) {
      case 'date':
        return date.toLocaleDateString('fr-FR', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
        });
      case 'time':
        return `${date.getHours().toString().padStart(2, '0')}:${date
          .getMinutes()
          .toString()
          .padStart(2, '0')}`;
      default:
        return '';
    }
  }

  async onAddressInput() {
    if (this.lieu.length > 3) {
      try {
        const response = await axios.get(
          `https://nominatim.openstreetmap.org/search?q=${this.lieu}&format=json`
        );
        this.suggestions = response.data;
        console.log('Suggestions d\'adresse :', this.suggestions);
      } catch (error: any) {
        console.error('Erreur lors de la rÃ©cupÃ©ration des suggestions :', error);
      }
    } else {
      this.suggestions = [];
    }
  }

  onSelectAddress(selectedAddress: any) {
    console.log('Adresse sÃ©lectionnÃ©e :', selectedAddress);
    this.selectedposition = {
      name: selectedAddress.name,
      display_name: selectedAddress.display_name,
      lat: selectedAddress.lat,
      lon: selectedAddress.lon,
    };

    this.lieu = selectedAddress.display_name;
  }

  blurInput() {
    setTimeout(() => {
      this.focusInput = false;
    }, 100);
  }
}

### END Ionic-project\src\app\update-evenement\update-evenement.page.ts ###

### BEGIN Ionic-project\src\app\update-note\update-note-routing.module.ts ###
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { UpdateNotePage } from './update-note.page';

const routes: Routes = [
  {
    path: '',
    component: UpdateNotePage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class UpdateNotePageRoutingModule {}

### END Ionic-project\src\app\update-note\update-note-routing.module.ts ###

### BEGIN Ionic-project\src\app\update-note\update-note.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

import { IonicModule } from '@ionic/angular';

import { UpdateNotePageRoutingModule } from './update-note-routing.module';

import { UpdateNotePage } from './update-note.page';
import { ShareModule } from '../utiles/share/share.module';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    UpdateNotePageRoutingModule,
    ShareModule
  ],
  declarations: [UpdateNotePage]
})
export class UpdateNotePageModule {}

### END Ionic-project\src\app\update-note\update-note.module.ts ###

### BEGIN Ionic-project\src\app\update-note\update-note.page.html ###
<div>
  <!-- En-tÃªte -->
  <div class="w-full h-[13vh] bg-cover bg-center" style="background-image:url(../../assets/images/Rectangle_39873.png);"></div>

  <!-- Contenu principal -->
  <div class="h-[89vh] w-full bg-[#F3F4F7] px-6 overflow-auto">
    <!-- En-tÃªte de la page -->
    <div class="flex w-full py-5">
      <div (click)="close()" class="pt-1.5">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.6"
          stroke="currentColor"
          class="h-5 w-5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"
          />
        </svg>
      </div>
      <div class="px-4 text-[15pt] font-bold leading-6">Modifier une note</div>
    </div>
    <!-- Fin de l'en-tÃªte -->

    <!-- Formulaire -->
    <div class="w-full">
      <!-- Champ "Adresse" -->
      <div class="mb-4">
        <label class="text-[12px] montserrat-700">Adresse</label>
        <label class="relative block text-[13px]">
          <span class="sr-only text-[#02263D]">Adresse</span>
          <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
            <img src="../../../assets/icon/gpsInput.svg" alt="">
          </span>

          <!-- ----------------- For openSteetMap ----------------- -->
          <!-- (keyup)="onAddressInput()" -->
          <!-- (focus)="focusInput = true" -->
          <!-- (blur)="blurInput()" -->
          <!-- ----------------- For openSteetMap ----------------- -->

          <input  class="block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="ex : Tour eiffel,.." type="text" [(ngModel)]="lieu" (keyup)="onAddressInput()" (focus)="focusInput = true" (blur)="blurInput()"/>
        </label>
        <!-- ----------------- For openSteetMap (autocomplete) ----------------- -->
        <div *ngIf="suggestions.length > 0 && focusInput" class="absolute left-12 bg-white border border-[#00396542] w-2/3 max-h-[40vh] overflow-x-auto z-10">
          <ul>
            <li *ngFor="let suggestion of suggestions" (click)="onSelectAddress(suggestion)" class="p-1 text-[11px] border-b-1 border">{{suggestion.display_name}}</li>
          </ul>
        </div>
        <!-- ----------------- For openSteetMap (autocomplete) ----------------- -->

      </div>

      <!-- Champ "Jour" -->
      <div class="mb-4">
        <label class="text-[12px] montserrat-700 text-[#02263D]">Jour</label>
        <div class="flex flex-wrap w-full items-center">
          <div *ngFor="let item of dayList" class="flex h-[25px] w-[60px] my-1 items-center rounded-full px-2 py-0.5 mr-1" [ngClass]="{'bg-[#1D4999] text-white':item.activated , 'bg-[#E6EAEC] text-[#02263D]': !item.activated}">
            <input (change)="selectDay(item, $event)" type="checkbox" name="days"/>
            <span class="break-normal px-1 text-[11px]">{{item.name}}</span>
          </div>
        </div>
      </div>

      <!-- Champ "Heure" -->
      <div class="mb-4">
        <label class="text-[12px] montserrat-700 text-[#02263D]">Heure</label>
        <input (click)="toggaleModal('time-begin')" readonly [value]="heureDebut" class="block w-full rounded border border-[#00396542] bg-white px-3 py-2 shadow-sm" placeholder="19:00"/>
        <app-time-picker *ngIf="displayModal.displayTimeBegin" (closeDateTime)="toggaleModal('time-begin')" (valueChange)="setValue($event, 'timeBegin')"></app-time-picker>
      </div>

      <!-- Champ "Type" -->
      <div class="mb-4">
        <label class="text-[12px] montserrat-700 text-[#02263D]">Type</label>
        <input [(ngModel)]="Type" name="Type" required class="block w-full rounded border border-[#00396542] bg-white py-2 px-3 shadow-sm" placeholder="Ex: Entreprise, hÃ´tel, particulier..."/>
      </div>

      <!-- Champ "Destination" -->
      <div class="mb-4">
        <label class="text-[12px] montserrat-700 text-[#02263D]">Destination</label>
        <input [(ngModel)]="destination" name="destination" required class="block w-full rounded border border-[#00396542] bg-white py-2 px-3 shadow-sm" placeholder="Ex: Paris"/>
      
        <div class="relative flex h-[30px] w-full flex-row items-center overflow-y-hidden px-1">
          <div class="flex">
            <div class="text-[#1D4999]] mr-1 flex h-[25px] w-[120px] items-center rounded-full px-2 py-0.5" [ngClass]="{'bg-[#E6EAEC] ': friendsSelector != tous.value, 'bg-[#1D4999] text-white':  friendsSelector == tous.value}">
              <input  type="radio" name="type" value="all" class="h-4 w-4" #tous (change)="selectSelectorFiends(tous.value)" />
              <span class="px-1 text-[11px]">Tous les amis</span>
            </div>

            <div class="flex h-[25px] w-[100px] items-center rounded-full px-2 py-0.5 text-white" [ngClass]="{'bg-[#E6EAEC] ': friendsSelector != perso.value, 'bg-[#1D4999] text-white':  friendsSelector == perso.value}">
              <input checked type="radio" name="type" value="personne" class="h-4 w-4" #perso (change)="selectSelectorFiends(perso.value)" />
              <span class="px-1 text-[11px]">Personne</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Champ "Commentaire" -->
      <div class="mb-4">
        <label class="text-[12px] montserrat-700 text-[#02263D]">Commentaire</label>
        <textarea [(ngModel)]="commentaire" name="commentaire" class="block w-full rounded border border-[#00396542] bg-white px-3 py-2 shadow-sm" placeholder="Ã‰crire..." type="text"></textarea>
      </div>

      <!-- Boutons -->
      <div class="mt-4 flex flex-col gap-2">
        <button (click)="close()" class="h-[40px] rounded-xl border-2 border-[#1D4999] bg-transparent text-[13px] font-bold tracking-wide text-[#1D4999]">
          Annuler
        </button>
        <button (click)="updatePoint()" class="h-[40px] rounded-xl border-2 border-[#1D4999] bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white">
          Valider
        </button>
      </div>
    </div>
    <!-- Fin du formulaire -->
  </div>
</div>

### END Ionic-project\src\app\update-note\update-note.page.html ###

### BEGIN Ionic-project\src\app\update-note\update-note.page.scss ###
### END Ionic-project\src\app\update-note\update-note.page.scss ###

### BEGIN Ionic-project\src\app\update-note\update-note.page.spec.ts ###
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { UpdateNotePage } from './update-note.page';

describe('UpdateNotePage', () => {
  let component: UpdateNotePage;
  let fixture: ComponentFixture<UpdateNotePage>;

  beforeEach(async(() => {
    fixture = TestBed.createComponent(UpdateNotePage);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\update-note\update-note.page.spec.ts ###

### BEGIN Ionic-project\src\app\update-note\update-note.page.ts ###
import { Component, OnInit } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import axios from 'axios';
import { ListPointsService } from '../utiles/services/points/list-points.service';
import { presentToast } from '../utiles/component/notification';
import { Day } from '../utiles/interface/day-list';
import { Keyboard } from '@capacitor/keyboard';

@Component({
  selector: 'app-update-note',
  templateUrl: './update-note.page.html',
  styleUrls: ['./update-note.page.scss'],
})
export class UpdateNotePage implements OnInit {
  dayList:Array<Day> = [
      {index: 1, name: "Lun", activated: false},
      {index: 2, name: "Mar", activated: false},
      {index: 3, name: "Mer", activated: false},
      {index: 4, name: "Jeu", activated: false},
      {index: 5, name: "Ven", activated: false},
      {index: 6, name: "Sam", activated: false},
      {index: 7, name: "Dim", activated: false},
    ];
  
    lieu:string="";
    selectedDays:Array<string> = [];
    heure:string = "";
    Type:string = "" // ex : Entreprise, hotel, particulier...
    destination: string = ""; // ex : Paris
    friendsSelector:string = "personne"; // tous les amis, personne
  
  
    // autocomplete variables
    suggestions: Array<any> = [];
    focusInput:boolean = false;
    selectedposition:{name:string, display_name:string, lat:number, lon:number} = {
      name:'',
      display_name:'',
      lat:0,
      lon:0
    };
    // autocomplete variables
  
    displayModal:any = {
      displayDate: false,
      displayTimeBegin: false,
      displayTimeEnd: false,
    }
    heureDebut: string = '';
  
  pointId: string | null = '';

  makeBoxFullHeight:boolean = false;
  constructor(
    private router: Router,
    private route: ActivatedRoute,
    private pointsService: ListPointsService
  ) {}

  ngOnInit() {
    Keyboard.addListener('keyboardWillShow', () => {
      this.makeBoxFullHeight = true;
    });

    Keyboard.addListener('keyboardWillHide', () => {
      this.makeBoxFullHeight = false;
    });
    
    this.route.paramMap.subscribe((param) => {
      this.pointId = param.get('id');
      console.log('Point ID :', this.pointId);
      this.getDetailPoint(this.pointId);
    });
  }
  
  getDayOfWeek(dateStr: string): string {
    const [day, month, year] = dateStr.split('-').map(Number);
    const date = new Date(year, month , day);
    const days = ["Dim", "Lun", "Mar", "Mer", "Jeu", "Ven", "Sam"];
    
    return days[date.getDay()];
  }

  close() {
    this.router.navigate(['map']);
  }
  getDetailPoint(id: string | null) {
    if (id != null) {
      const json = {
        pointId: id,
      };
  
      this.pointsService.$getPoints().subscribe((data: any) => {
        console.log('DonnÃ©es reÃ§ues depuis l\'API :', data);
        const notePoint = data.note?.find((point: any) => point.id == id);
        
        if (notePoint) {
          this.lieu = notePoint.lieu || '';
          this.heureDebut = notePoint.heureDebut || '00:00';
          this.Type = notePoint.type || ''
          this.destination = notePoint.name || ''
          
          const dayName = this.getDayOfWeek(notePoint.date || '');

          // Find the day in dayList and activate it
          const selectedDay = this.dayList.find(d => d.name === dayName);
          if (selectedDay) {
            selectedDay.activated = true;
          }
          // console.log('Message :', this.message, 'NumÃ©ro de tÃ©lÃ©phone :', this.phoneNumber);
        } else {
          console.log('No note data found with the provided ID.');
        }
      });
    } else {
      console.log('ID nul : impossible de rÃ©cupÃ©rer les dÃ©tails.');
    }
  }
  
  updatePoint() {
    let dateIn = new Date();
    const content = {
      pointId: this.pointId,
      lieu: this.lieu,
      lat:this.selectedposition.lat,
      lg:this.selectedposition.lon,
      date:
              dateIn.getDate() +
              '-' +
              dateIn.getMonth() +
              '-' +
              dateIn.getFullYear()
              ,
      heureDebut: this.heureDebut,
      type: this.Type,
      destination: this.destination,
      friendsSelector: this.friendsSelector
    };

    console.log('Contenu mis Ã  jour :', content);

    this.pointsService.$updatePoint(content).subscribe((data: any) => {
      if (data && data.success === true) {
        presentToast('Note a Ã©tÃ© modifiÃ© avec succÃ¨s !', 'bottom', 'success');
        this.router.navigate(['map']);
      }
    });
  }
  selectDay(selectedday:any, event:any){
    let status = event.target.checked

    if(status){
      console.log("checked form : "+selectedday.name);
      this.checkOruncheck(selectedday.name)

      this.selectedDays.push(selectedday);

    }else{
      console.log("uncheckedform : "+selectedday);
      this.checkOruncheck(selectedday.name)
      this.selectedDays.splice(this.selectedDays.indexOf(selectedday),1)
    }
    console.log("list : "+ this.selectedDays);
  }

  selectSelectorFiends(type:string){
    console.log("this is the selected type : "+type);

    this.friendsSelector = type
  }

  findDayElement(name:string):Day{

    let element = this.dayList.find(el => el.name == name)
    if(element){
      console.log("this is the result of search : " + JSON.stringify(element));
      return element;
    }
    console.log("this is the result of search : " + JSON.stringify({index:0, name:'', activated:false}));
    return {index:0, name:'', activated:false};
  }

  // this method for days section
  checkOruncheck(dayName:string){
   let dayElement = this.findDayElement(dayName);
   if(dayElement.index != 0){
     dayElement.activated = !dayElement.activated
     console.log("switch checker is done !!!");
   }else{
     console.error("switch checker isn't done !!!, the dayName not find (findDayElement Method take name not find in dayList array! ");
   }
  }

  toggaleModal(modal:string) {
    switch (modal) {
     case 'date':
       this.displayModal.displayDate = !this.displayModal.displayDate;
       break;

     case 'time-begin':
       this.displayModal.displayTimeBegin = !this.displayModal.displayTimeBegin;
       break;

     case 'time-end':
       this.displayModal.displayTimeEnd = !this.displayModal.displayTimeEnd;
       break;

     default:
       break;
    }
   }

   setValue(newValue: string, input:string){
    console.log("this is the new vavlue : "+ newValue);

    switch (input) {

      case 'timeBegin':
         this.heureDebut = this.formatDateAndTime(newValue, 'time')
        console.log('( heureDebut ) outside of the component : ' + this.heureDebut);
          break;

      default:
        break;
    }
  }

  formatDateAndTime(getvalue:string, format:string) :string {
    const date = new Date(getvalue);
    switch (format) {
      case 'date':
        return date.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }).replace(/\//g, '/');

      case 'time':
        const hours = ('0' + date.getHours()).slice(-2);
        const minutes = ('0' + date.getMinutes()).slice(-2);
        return `${hours}:${minutes}`;

      default:
        return '';
    }

  }

   async onAddressInput() {
    if (this.lieu.length > 3) { // Adjust the minimum length as per your requirement
      try {
        const response = await axios.get(`https://nominatim.openstreetmap.org/search?q=${this.lieu}&format=json`);
        this.suggestions = response.data;
        console.log("this is the content of api OSM : " + JSON.stringify(this.suggestions));

      } catch (error:any) {
        console.error('Error fetching address suggestions:', error);
      }
    } else {
      this.suggestions = [];
    }
    console.log("called!! " + this.lieu);

  }

   onSelectAddress(selectedAddress: any) {
    // Handle the selected address, update your form or model accordingly
    console.log('Selected Address:', selectedAddress);
    this.selectedposition.name = selectedAddress.name;
    this.selectedposition.display_name = selectedAddress.display_name;
    this.selectedposition.lat = selectedAddress.lat;
    this.selectedposition.lon = selectedAddress.lon;

    this.lieu = selectedAddress.display_name
  }

  blurInput(){
    setTimeout(()=>{
      this.focusInput=false
    },100)
  }

  
}

### END Ionic-project\src\app\update-note\update-note.page.ts ###

### BEGIN Ionic-project\src\app\update-sos\update-sos-routing.module.ts ###
import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';
import { UpdateSosPage } from './update-sos.page';

const routes: Routes = [
  {
    path: '',
    component: UpdateSosPage
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class UpdateSosPageRoutingModule {}

### END Ionic-project\src\app\update-sos\update-sos-routing.module.ts ###

### BEGIN Ionic-project\src\app\update-sos\update-sos.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { IonicModule } from '@ionic/angular';

import { UpdateSosPageRoutingModule } from './update-sos-routing.module';
import { UpdateSosPage } from './update-sos.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    UpdateSosPageRoutingModule
  ],
  declarations: [UpdateSosPage]
})
export class UpdateSosPageModule {}

### END Ionic-project\src\app\update-sos\update-sos.module.ts ###

### BEGIN Ionic-project\src\app\update-sos\update-sos.page.html ###
<div>
  <!-- En-tÃªte -->
  <div class="w-full h-[13vh] bg-cover bg-center" style="background-image:url(../../assets/images/Rectangle_39873.png);"></div>

  <!-- Contenu principal -->
  <div class="h-[89vh] w-full bg-[#F3F4F7] px-6 overflow-auto">
    <!-- En-tÃªte de la page -->
    <div class="flex w-full py-5">
      <div (click)="close()" class="pt-1.5">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.6"
          stroke="currentColor"
          class="h-5 w-5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"
          />
        </svg>
      </div>
      <div class="px-4 text-[15pt] font-bold leading-6">Modifier SOS</div>
    </div>
    <!-- Fin de l'en-tÃªte -->

    <!-- Formulaire -->
    <div class="w-full">
      <!-- Champ "Message du SOS" -->
      <div class="mb-4">
        <label class="text-[12px] montserrat-700 text-[#02263D]">Message du SOS</label>
        <input
          [(ngModel)]="message"
          name="message"
          required
          class="block w-full rounded border border-[#00396542] bg-white py-2 pl-3 pr-3 shadow-sm"
          placeholder="Exemple : Urgent, besoin d'aide..."
        />
      </div>

      <!-- Champ "NumÃ©ro de tÃ©lÃ©phone" -->
      <div class="mb-4">
        <label class="text-[12px] montserrat-700 text-[#02263D]">NumÃ©ro de tÃ©lÃ©phone</label>
        <input
          [(ngModel)]="phoneNumber"
          name="phoneNumber"
          required
          class="block w-full rounded border border-[#00396542] bg-white py-2 pl-3 pr-3 shadow-sm"
          placeholder="Exemple : +1234567890"
        />
      </div>

      <!-- Boutons -->
      <div class="mt-4 flex flex-col gap-2">
        <button
          (click)="close()"
          class="h-[40px] rounded-xl border-2 border-[#1D4999] bg-transparent text-[13px] font-bold tracking-wide text-[#1D4999]">
          Annuler
        </button>
        <button
          (click)="updatePoint()"
          class="h-[40px] rounded-xl border-2 border-[#1D4999] bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white">
          Valider
        </button>
      </div>
    </div>
    <!-- Fin du formulaire -->
  </div>
</div>

### END Ionic-project\src\app\update-sos\update-sos.page.html ###

### BEGIN Ionic-project\src\app\update-sos\update-sos.page.scss ###
### END Ionic-project\src\app\update-sos\update-sos.page.scss ###

### BEGIN Ionic-project\src\app\update-sos\update-sos.page.ts ###
import { Component, OnInit } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import axios from 'axios';
import { ListPointsService } from '../utiles/services/points/list-points.service';
import { presentToast } from '../utiles/component/notification';

@Component({
  selector: 'app-update-sos',
  templateUrl: './update-sos.page.html',
  styleUrls: ['./update-sos.page.scss'],
})
export class UpdateSosPage implements OnInit {
  message: string = '';
  phoneNumber: string = '';
  pointId: string | null = '';

  constructor(
    private router: Router,
    private route: ActivatedRoute,
    private pointsService: ListPointsService
  ) {}

  ngOnInit() {
    this.route.paramMap.subscribe((param) => {
      this.pointId = param.get('id');
      console.log('Point ID :', this.pointId);
      this.getDetailPoint(this.pointId);
    });
  }

  getDetailPoint(id: string | null) {
    if (id != null) {
      const json = {
        pointId: id,
      };
  
      this.pointsService.$getPoints().subscribe((data: any) => {
        console.log('DonnÃ©es reÃ§ues depuis l\'API :', data);
        const jaunePoint = data.sos?.find((point: any) => point.id == id);

        if (jaunePoint) {
          this.message = jaunePoint.msg || '';
          this.phoneNumber = jaunePoint.numeroTel || '';
  
          console.log('Message :', this.message, 'NumÃ©ro de tÃ©lÃ©phone :', this.phoneNumber);
        } else {
          console.log('No SOS data found with the provided ID.');
        }
      });
    } else {
      console.log('ID nul : impossible de rÃ©cupÃ©rer les dÃ©tails.');
    }
  }
  
  
  
  close() {
    this.router.navigate(['/map']);
  }

  updatePoint() {
    const content = {
      pointId: this.pointId,
      msg: this.message,
      type: 'jaune',
      numeroTel: this.phoneNumber,
    };

    console.log('Contenu mis Ã  jour :', content);

    this.pointsService.$updatePoint(content).subscribe((data: any) => {
      if (data && data.success === true) {
        presentToast('Le SOS a Ã©tÃ© modifiÃ© avec succÃ¨s !', 'bottom', 'success');
        this.router.navigate(['/map']);
      }
    });
  }

  
}

### END Ionic-project\src\app\update-sos\update-sos.page.ts ###

### BEGIN Ionic-project\src\app\utiles\getLocalisation.ts ###
import { Router } from "@angular/router";

export let position:{lat:string, long:string} = {
    lat: '',
    long: ''
};

const router = new Router();
const goMap = () => {
    router.navigate(['/map']);
} 

export const getGeolocalisation = () => {

    var onSuccess = (position:any) => {
      // alert('Latitude: '          + position.coords.latitude          + '\n' +
      //       'Longitude: '         + position.coords.longitude         + '\n' +
      //       'Altitude: '          + position.coords.altitude          + '\n' +
      //       'Accuracy: '          + position.coords.accuracy          + '\n' +
      //       'Altitude Accuracy: ' + position.coords.altitudeAccuracy  + '\n' +
      //       'Heading: '           + position.coords.heading           + '\n' +
      //       'Speed: '             + position.coords.speed             + '\n' +
      //       'Timestamp: '         + position.timestamp                + '\n');

      localStorage.setItem('lat', position.coords.latitude);
      localStorage.setItem('long', position.coords.longitude);
    //   position.let = await localStorage.getItem('lat');
    //   position.long = await localStorage.getItem('long');
      goMap();
  };

  // onError Callback receives a PositionError object
  //
  var onError = (error:any) => {
      // alert('code: '    + error.code    + '\n' +
      //       'message: ' + error.message + '\n');
  }
    navigator.geolocation.getCurrentPosition(onSuccess, onError)
  }
### END Ionic-project\src\app\utiles\getLocalisation.ts ###

### BEGIN Ionic-project\src\app\utiles\IonicGestureConfig.ts ###
import { Injectable } from "@angular/core";
import { HammerGestureConfig } from "@angular/platform-browser";

/**
 * @hidden
 * This class overrides the default Angular gesture config.
 */
@Injectable()
export class IonicGestureConfig extends HammerGestureConfig {
  override buildHammer(element: HTMLElement) {
    const mc = new (<any>window).Hammer(element);

    for (const eventName in this.overrides) {
      if (eventName) {
        mc.get(eventName).set(this.overrides[eventName]);
      }
    }

    return mc;
  }
}
### END Ionic-project\src\app\utiles\IonicGestureConfig.ts ###

### BEGIN Ionic-project\src\app\utiles\component\notification.ts ###
import { ToastController } from "@ionic/angular";

let toastController = new ToastController();

export  let  presentToast = async (message:string, position: 'top' | 'middle' | 'bottom' = 'bottom', color: 'primary' | 'secondary' | 'tertiary' | 'success' | 'warning' | 'danger' | 'light' | 'medium' | 'dark' = 'secondary') => {
    const toast = await toastController.create({
      message,
      duration: 5000,
      position: position,
      color,
      
    });

    await toast.present();
  }
### END Ionic-project\src\app\utiles\component\notification.ts ###

### BEGIN Ionic-project\src\app\utiles\component\accordion\accordion.component.html ###
<div (click)="accordionToggle($event.target)" class="bg-white my-2 p-4 border-[0.89px] border-[#D2DBEB] mb-4">
  <div size="10" class=" flex justify-between">
    <span class="text-[13px] montserrat-700">{{content.title}}</span>
    <img *ngIf="isOpened" src="../../assets/icon/arrowUp.svg" class="px-2" alt="">
    <img *ngIf="!isOpened" src="../../assets/icon/arrowDown.svg" class="px-2" alt="">
  </div>
  <div class="text-[13px] montserrat-600 mt-4 overflow-hidden" [ngClass]="{'hidden':!isOpened}">
    {{content.message}}
  </div>
</div>
### END Ionic-project\src\app\utiles\component\accordion\accordion.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\accordion\accordion.component.scss ###
### END Ionic-project\src\app\utiles\component\accordion\accordion.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\accordion\accordion.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { AccordionComponent } from './accordion.component';

describe('AccordionComponent', () => {
  let component: AccordionComponent;
  let fixture: ComponentFixture<AccordionComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ AccordionComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(AccordionComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\accordion\accordion.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\accordion\accordion.component.ts ###
import { Component, OnInit, Input } from '@angular/core';

@Component({
  selector: 'app-accordion',
  templateUrl: './accordion.component.html',
  styleUrls: ['./accordion.component.scss'],
})
export class AccordionComponent  implements OnInit {

  @Input() content:{title:string, message:string} = {title:"", message:""};

  isOpened:boolean = false;
  constructor() { }

  ngOnInit() {}

  accordionToggle(element:any){
    this.isOpened = !this.isOpened;
    
  }

}

### END Ionic-project\src\app\utiles\component\accordion\accordion.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\address-input\address-input.component.html ###
<label class="relative block pb-1 text-[13px]">
  <span class="sr-only">Lieu</span>
  <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
    <img src="../../../assets/icon/gpsInput.svg" alt="">
  </span>
  <input (keyup)="onAddressInput()" (focus)="focusInput = true" (blur)="focusInput=false" class="block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="ex : SDF, OpÃ©ra garnier,.." type="text" name="username" [(ngModel)]="lieu" />
</label>
<div *ngIf="isLoading && focusInput" class="absolute left-0 bg-white border border-[#00396542] max-h-[40vh] overflow-x-auto z-10">
  <p class="p-2 text-center text-[13px] text-gray-500">Chargement...</p>
</div>


  <ul>
    <li *ngFor="let suggestion of suggestions" (click)="onSelectAddress(suggestion)" class="p-1 text-[13px] border-b-1 border " title="Casablanca, Maroc">{{suggestion.display_name}}</li>
  </ul>

### END Ionic-project\src\app\utiles\component\address-input\address-input.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\address-input\address-input.component.scss ###
### END Ionic-project\src\app\utiles\component\address-input\address-input.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\address-input\address-input.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { AddressInputComponent } from './address-input.component';

describe('AddressInputComponent', () => {
  let component: AddressInputComponent;
  let fixture: ComponentFixture<AddressInputComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ AddressInputComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(AddressInputComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\address-input\address-input.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\address-input\address-input.component.ts ###
import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';
import { Subject } from 'rxjs';
import axios from 'axios';

@Component({
  selector: 'app-address-input',
  templateUrl: './address-input.component.html',
  styleUrls: ['./address-input.component.scss'],
})
export class AddressInputComponent  implements OnInit {

  @Input() lieu:string = "";
  @Output() selectedAddress = new EventEmitter();
  @Input() focusInput:boolean = false;
  
  suggestions: any[] = [];
  private searchSubject: Subject<string> = new Subject<string>();

  constructor() { }

  ngOnInit() {}

  onAddressChange() {
    this.searchSubject.next(this.lieu);
  }
  isLoading: boolean = false;

  async onAddressInput() {
    if (this.lieu.length > 3) {
      this.isLoading = true; // Activer la barre de chargement
      this.suggestions = []; // RÃ©initialiser les suggestions
      try {
        const response = await axios.get(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(this.lieu)}&format=json&addressdetails=1&limit=5&accept-language=fr&countrycodes=fr`);
        this.suggestions = response.data as Array<{ name: string, display_name: string, lat: string, lon: string }>;
      } catch (error: any) {
        console.error('Erreur lors de la rÃ©cupÃ©ration des suggestions d\'adresses :', error);
      } finally {
        this.isLoading = false; // DÃ©sactiver la barre de chargement
      }
    } else {
      this.suggestions = [];
    }
  }
  

  

  onSelectAddress(selectedAddress: any) {
    console.log('Adresse sÃ©lectionnÃ©e :', selectedAddress);
    this.selectedAddress.emit(selectedAddress); // Ã‰met l'adresse sÃ©lectionnÃ©e au parent
    this.lieu = selectedAddress.display_name; // Met Ã  jour le champ d'entrÃ©e avec l'adresse sÃ©lectionnÃ©e
    this.suggestions = []; // Efface les suggestions aprÃ¨s la sÃ©lection
  }
  
}

### END Ionic-project\src\app\utiles\component\address-input\address-input.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\affluence\affluence.component.html ###
<div class="absolute top-0 left-0 right-0 bottom-0 flex justify-center items-center">
  <div
    (click)="close()"
    class="absolute top-0 flex h-[100vh] w-full items-center justify-center bg-[#0005] z-10"
  ></div>
  <div
    class="items-center justify-center z-30 flex w-[80vw] flex-col bg-white px-7 py-10 rounded"
  >
    <div class="px-4 text-center font-[Montserrat] text-[18px] leading-6">
      CrÃ©er une
      <span class="text-[#EB2F06] font-bold">affluence</span>
      <div class="text-center font-[Montserrat] text-[13px] leading-6">
        Annuler ou Varier une intensitÃ©
      </div>
    </div>
    <div class="mb-1 mt-4 flex justify-center ">
      <div
        (click)="selectChoice(1)"
        [ngClass]="{
          'border-[#EB2F06] animate-fade': choice === 1,
          'border-[#00000032]': choice !== 1
        }"
        class="h-[13vh] flex flex-col items-center justify-center rounded border-2 px-1 py-5 w-[120px] mr-2"
      >
        <div>
          <img class="mb-3" src="../../../assets/icon/redUser.svg" alt="" />
        </div>
        <span class="text-[12px]">1 Ã  5 clients</span>
      </div>
      <div
        (click)="selectChoice(2)"
        [ngClass]="{
          'border-[#EB2F06] animate-fade': choice === 2,
          'border-[#00000032]': choice !== 2
        }"
        class="h-[13vh] flex flex-col items-center justify-center rounded border-2 px-1 py-5 w-[120px]"
      >
        <div>
          <img class="mb-3" src="../../../assets/icon/twoRedUsers.svg" alt="" />
        </div>
        <span class="text-[12px]">6 Ã  20 clients</span>
      </div>
    </div>

    <div class="my-1 flex justify-center">
      <div
        (click)="selectChoice(3)"
        [ngClass]="{
          'border-[#EB2F06] animate-fade': choice === 3,
          'border-[#00000032]': choice !== 3
        }"
        class="h-[13vh] flex flex-col items-center justify-center rounded border-2 px-1 py-5 w-[120px] mr-2"
      >
        <div>
          <img class="mb-3" src="../../../assets/icon/threeUser.svg" alt="" />
        </div>
        <span class="text-[12px]">21 Ã  100 clients</span>
      </div>
      <div
        (click)="selectChoice(4)"
        [ngClass]="{
          'border-[#EB2F06] animate-fade': choice === 4,
          'border-[#00000032]': choice !== 4
        }"
        class="h-[13vh] flex flex-col items-center justify-center rounded border-2 px-1 py-5 w-[120px]"
      >
        <div>
          <img class="mb-1" src="../../../assets/icon/fourUser.svg" alt="" />
        </div>
        <span class="text-[12px]">+ 100 clients</span>
      </div>
    </div>

    <div class="my-1 flex justify-center">
      <div
        (click)="selectChoice(0)"
        [ngClass]="{
          'border-[#EB2F06] animate-fade': choice === 0,
          'border-[#00000032]': choice !== 0
        }"
        class="h-[13vh] flex flex-col items-center justify-center rounded border-2 px-1 py-5 w-[120px] mr-2"
      >
        <div>
          <img class="mb-3" src="../../../assets/icon/darkUser.svg" alt="" />
        </div>
        <span class="text-[12px]">pas de clients</span>
      </div>
    </div>

    <div class="mt-2 flex justify-center">
      <ion-button
        (click)="close()"
        style="--background:transparent; --background-activated:#3332 ;text-transform: none;"
        class="h-[40px] w-full rounded-xl border-2 border-[#1D4999] bg-transparent text-[13px] font-bold tracking-wide text-[#1D4999]"
        >Annuler</ion-button
      >
      <ion-button
        (click)="valider()"
        [disabled]="choice === null"
        style="--background:#1D4999;--background-activated:#173d84; text-transform: none;"
        class="mr-1 h-[40px] w-full border-2 border-[#1D4999] rounded-xl bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white"
        >Valider</ion-button
      >
    </div>
  </div>
</div>

### END Ionic-project\src\app\utiles\component\affluence\affluence.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\affluence\affluence.component.scss ###
### END Ionic-project\src\app\utiles\component\affluence\affluence.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\affluence\affluence.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { AffluenceComponent } from './affluence.component';

describe('AffluenceComponent', () => {
  let component: AffluenceComponent;
  let fixture: ComponentFixture<AffluenceComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ AffluenceComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(AffluenceComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\affluence\affluence.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\affluence\affluence.component.ts ###
import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';

@Component({
  selector: 'app-affluence',
  templateUrl: './affluence.component.html',
  styleUrls: ['./affluence.component.scss'],
})
export class AffluenceComponent  implements OnInit {
  @Input() affluenceDisplay:any;
  @Output() closeAffluence =new EventEmitter()
  @Output() addAffluence =new EventEmitter()

  choice:number|null = null
  constructor() { }

  ngOnInit() {}

  close(){
    this.closeAffluence.emit();
  }

  valider(){
    if(this.choice != null){
      this.addAffluence.emit(this.choice)
      this.closeAffluence.emit();
    }
  }

  selectChoice(selectedChoice:number){
    this.choice = selectedChoice;
    console.log('selected choice',this.choice)
  }
  deleteAffluence() {
    this.choice = null;
    console.log('Affluence deleted');
  }
}

### END Ionic-project\src\app\utiles\component\affluence\affluence.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\confirmation\confirmation.component.html ###
<div class="absolute flex justify-center items-center top-0 left-0 right-0 bottom-0">
  <div (click)="close()" class="absolute top-0 h-[100vh] w-full bg-[#0005] "></div>
  <div class=" flex w-[80vw] flex-col rounded bg-white px-7 py-8 z-30 relative">
    <div class="px-4 text-center font-[Montserrat] text-[18px] leading-6">Confermation</div>
    <div class="mb-1 mt-4">
     <p class="text-[12px] text-center my-4">Do you really want to unfollow <b>Ayman Fadli</b> ?</p>
    </div>
    <div class="mt-2 flex justify-between">
      <ion-button (click)="close()" data style="--background:transparent; --background-activated:#3332; text-transform: none;" class="h-[40px] w-full rounded-xl border-2 border-[#1D4999] bg-transparent text-[13px] font-bold tracking-wide text-[#1D4999]">Annuler</ion-button>
      <ion-button (click)="deleteFriendMethod()" style="--background:#1D4999;--background-activated:#173d84; text-transform: none;" class="mr-1 h-[40px] w-full border-2 border-[#1D4999] rounded-xl bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white">Confirmer</ion-button>
    </div>
  </div>
</div>
### END Ionic-project\src\app\utiles\component\confirmation\confirmation.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\confirmation\confirmation.component.scss ###
### END Ionic-project\src\app\utiles\component\confirmation\confirmation.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\confirmation\confirmation.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { ConfirmationComponent } from './confirmation.component';

describe('ConfirmationComponent', () => {
  let component: ConfirmationComponent;
  let fixture: ComponentFixture<ConfirmationComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ ConfirmationComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(ConfirmationComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\confirmation\confirmation.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\confirmation\confirmation.component.ts ###
import { Component, OnInit, Output, EventEmitter } from '@angular/core';

@Component({
  selector: 'app-confirmation',
  templateUrl: './confirmation.component.html',
  styleUrls: ['./confirmation.component.scss'],
})
export class ConfirmationComponent  implements OnInit {
  @Output() closeConfirmation = new EventEmitter();
  @Output() deleteFriend = new EventEmitter();
  constructor() { }

  ngOnInit() {}

  close(){
    this.closeConfirmation.emit();
  }

  deleteFriendMethod(){
    this.deleteFriend.emit();
  }

}

### END Ionic-project\src\app\utiles\component\confirmation\confirmation.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\dateTime\datetime-picker\datetime-picker.component.html ###
<div class="absolute w-full top-0 bottom-0 left-0 right-0 flex items-center">
  <div class="absolute p-5 w-[100vw] bg-[#F4F5F8]  rounded-lg z-30 ">
    <ion-datetime id="datePicker" presentation="date"  [multiple]="multiDate" [(ngModel)]="date" [min]="minDate"></ion-datetime>
    <ion-button (click)="updateValue()" style="--background:#1D4999;--background-activated:#173d84; text-transform: none;" class="mt-5 h-[40px] w-full border-2 border-[#1D4999] rounded-xl bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white">Valider</ion-button>
  </div>
  <div (click)="close()" class="bg-[#0000003d] absolute top-0 bottom-0 left-0 right-0"></div>
</div>
### END Ionic-project\src\app\utiles\component\dateTime\datetime-picker\datetime-picker.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\dateTime\datetime-picker\datetime-picker.component.scss ###
### END Ionic-project\src\app\utiles\component\dateTime\datetime-picker\datetime-picker.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\dateTime\datetime-picker\datetime-picker.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { DatetimePickerComponent } from './datetime-picker.component';

describe('DatetimePickerComponent', () => {
  let component: DatetimePickerComponent;
  let fixture: ComponentFixture<DatetimePickerComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ DatetimePickerComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(DatetimePickerComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\dateTime\datetime-picker\datetime-picker.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\dateTime\datetime-picker\datetime-picker.component.ts ###
import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';
import { presentToast } from '../../notification';

@Component({
  selector: 'app-datetime-picker',
  templateUrl: './datetime-picker.component.html',
  styleUrls: ['./datetime-picker.component.scss'],
})
export class DatetimePickerComponent  implements OnInit {
  @Output() valueChange = new EventEmitter();
  @Output() closeDateTime = new EventEmitter();
  @Input() multiDate = false;
  date:string[] | string = ''
  minDate:string = "";

  currentYear(){
    const today = new Date();
    const year = today.getFullYear();
    const month = ('0' + (today.getMonth() + 1)).slice(-2);
    const day = ('0' + today.getDate()).slice(-2);
    this.date = `${year}-${month}-${day}`;
    this.minDate = `${year}-01-01`; // Set min date to the start of the current year
  }
  constructor() { }

  ngOnInit() {
    this.currentYear();
  }

  close() {  
    this.closeDateTime.emit(this.date);
  }

  updateValue(){
    if(typeof this.date == "object"){
      console.log(this.date);
      this.valueChange.emit(this.date);
      this.close()
    }else {
      console.log(this.date);
      this.date = [this.date];
      console.log(this.date);
      this.valueChange.emit(this.date);
      this.close()

    }
  }

}

### END Ionic-project\src\app\utiles\component\dateTime\datetime-picker\datetime-picker.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\dateTime\time-picker\time-picker.component.html ###
<div class="absolute h-[100vh] top-0 bottom-0 left-0 right-0 flex justify-center items-center">
  <div class="absolute p-5 w-[100vw] bg-[#F4F5F8] rounded-lg z-30">
    <ion-datetime presentation="time" (ngModelChange)="updateValue($event)" [(ngModel)]="time"></ion-datetime>
    <ion-button (click)="submit()" style="--background:#1D4999;--background-activated:#173d84; text-transform: none;" class="mt-5 h-[40px] w-full border-2 border-[#1D4999] rounded-xl bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white">Valider</ion-button>
  </div>
  <div (click)="close()" class="bg-[#0000003d] absolute top-0 bottom-0 left-0 right-0 z-10"></div>
</div>
### END Ionic-project\src\app\utiles\component\dateTime\time-picker\time-picker.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\dateTime\time-picker\time-picker.component.scss ###
### END Ionic-project\src\app\utiles\component\dateTime\time-picker\time-picker.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\dateTime\time-picker\time-picker.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { TimePickerComponent } from './time-picker.component';

describe('TimePickerComponent', () => {
  let component: TimePickerComponent;
  let fixture: ComponentFixture<TimePickerComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ TimePickerComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(TimePickerComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\dateTime\time-picker\time-picker.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\dateTime\time-picker\time-picker.component.ts ###
import { Component, OnInit, Output, Input, EventEmitter } from '@angular/core';
import { presentToast } from '../../notification';

@Component({
  selector: 'app-time-picker',
  templateUrl: './time-picker.component.html',
  styleUrls: ['./time-picker.component.scss'],
})
export class TimePickerComponent  implements OnInit {
  @Output() valueChange = new EventEmitter();
  @Output() closeDateTime = new EventEmitter();
  time:string = ""
 
  constructor() { }

  ngOnInit() {}

  close() {  
    setTimeout(() => {
      this.closeDateTime.emit();
    }, 100);
    
  }

  updateValue(newValue: string) {
    this.time = newValue;
    console.log(this.time);
  }

  submit(){
    if(this.time == ''){
      let date = new Date();
      let time = date.getTime()
      const date1 = new Date(time);

      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based
      const day = String(date.getDate()).padStart(2, '0');
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      const seconds = String(date.getSeconds()).padStart(2, '0');
      
      // Format the date in the desired format
      const formattedDate = `${year}-${month}-${day}T${hours}:${minutes}:${seconds}`;
      console.log(formattedDate);
      this.time = formattedDate
    }
      this.valueChange.emit(this.time);
      this.close()
    }

}

### END Ionic-project\src\app\utiles\component\dateTime\time-picker\time-picker.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\delete-confirmation\delete-confirmation.component.html ###
<div class="absolute flex justify-center items-center top-0 left-0 right-0 bottom-0">
  <div (click)="close()" class="absolute top-0 h-[100vh] w-full bg-[#0005] "></div>
  <div class=" flex w-[80vw] flex-col rounded bg-white px-7 py-8 z-30 relative">
    <div class="px-4 text-center font-[Montserrat] text-[18px] leading-6">Confirmation</div>
    <div class="mb-1 mt-4">
     <p class="text-[12px] text-center my-4">{{content}}</p>
    </div>
    <div class="mt-2 flex justify-between">
      <ion-button (click)="close()" data style="--background:transparent; --background-activated:#3332; text-transform: none;" class="h-[40px] w-full rounded-xl border-2 border-[#1D4999] bg-transparent text-[13px] font-bold tracking-wide text-[#1D4999]">Annuler</ion-button>
      <ion-button (click)="deleteItemMethod()" style="--background:#EB2F06;--background-activated:#EB2F06; text-transform: none;" class="mr-1 h-[40px] w-full border-2 border-[#EB2F06] rounded-xl bg-[#EB2F06] text-[13px] font-semibold tracking-wide text-white">Confirmer</ion-button>
    </div>
  </div>
</div>
### END Ionic-project\src\app\utiles\component\delete-confirmation\delete-confirmation.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\delete-confirmation\delete-confirmation.component.scss ###
### END Ionic-project\src\app\utiles\component\delete-confirmation\delete-confirmation.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\delete-confirmation\delete-confirmation.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { DeleteConfirmationComponent } from './delete-confirmation.component';

describe('DeleteConfirmationComponent', () => {
  let component: DeleteConfirmationComponent;
  let fixture: ComponentFixture<DeleteConfirmationComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ DeleteConfirmationComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(DeleteConfirmationComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\delete-confirmation\delete-confirmation.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\delete-confirmation\delete-confirmation.component.ts ###
import { Component, EventEmitter, OnInit, Output, Input } from '@angular/core';
import { presentToast } from '../notification';

@Component({
  selector: 'app-delete-confirmation',
  templateUrl: './delete-confirmation.component.html',
  styleUrls: ['./delete-confirmation.component.scss'],
})
export class DeleteConfirmationComponent  implements OnInit {

  @Input() content = "";
  @Input() selectedPointId:number|undefined;
  @Input() pointType: string = "";
  @Output() closeConfirmation = new EventEmitter();
  @Output() deleteItem = new EventEmitter();
  constructor() { }

  ngOnInit() {}

  close(){
    this.closeConfirmation.emit();
  }

  deleteItemMethod() {
    if (this.selectedPointId != undefined && this.pointType!=null) {
      this.deleteItem.emit({ id: this.selectedPointId, type: this.pointType });
      this.close();

    } else {
      presentToast('Missing ID or point type!', 'bottom', 'danger');
    }
  }

}

### END Ionic-project\src\app\utiles\component\delete-confirmation\delete-confirmation.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\evenements\evenements.component.html ###
<div class="absolute flex justify-center items-center top-0 left-0 right-0 bottom-0">
  <div (click)="close()" class="absolute top-0 z-10 h-[100vh] w-full bg-[#0005]"></div>
  <div class=" w-[80vw] flex-col rounded bg-white px-7 py-10 z-10">
    <div class="px-4 text-center font-[Montserrat] text-[18px] leading-6">
      CrÃ©er un <span class="font-bold text-[#A259FF]">Ã©venement</span>
      <!-- <div class="text-center font-[Montserrat] text-[13px] leading-6">Annulez ou Variez une intensitÃ©</div> -->
    </div>
    <div class="mb-1 mt-4">
      <div>
        <label class="text-[12px] montserrat-700 text-[#02263D] ">Lieu</label>
        <label class="relative block pb-1 text-[13px]">
          <span class="sr-only">Lieu</span>
          <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
            <img src="../../../assets/icon/gpsInput.svg" alt="">
          </span>
          <!-- openStreetMap attributes -->
          <!-- (keyup)="onAddressInput()" (focus)="focusInput = true" (blur)="blurInput()" -->
          <!-- openStreetMap attributes -->

          <input id="pac-input-event" class="block w-full rounded border border-[#00396542]
           bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm"
           placeholder="ex : SDF, OpÃ©ra garnier,.." type="text" [(ngModel)]="error_message[0].input" (keyup)="onAddressInput()" (focus)="focusInput = true" />
        </label>
        <div class="flex flex-col">
          <span  *ngIf="error_message[0].display" class="text-red-600 font-bold text-[10px]">{{error_message[0].message}}</span>
        </div>
         <!-- openStreetMap autocomplete -->
        <div *ngIf="suggestions.length > 0 && focusInput" class="absolute  bg-white border border-[#00396542] w-2/3 max-h-[40vh] overflow-x-auto z-10">
          <ul>
            <li *ngFor="let suggestion of suggestions" (click)="onSelectAddress(suggestion)" class="p-1 text-[11px] border-b-1 border">{{suggestion.display_name}}</li>
          </ul>
        </div>
         <!-- openStreetMap autocomplete -->
      </div>

      <div>
        <label class="text-[12px] montserrat-700 text-[#02263D] ">Type</label>
        <label class="relative block pb-1 text-[13px]">
          <span class="sr-only">Type</span>
          <input class="block w-full rounded border border-[#00396542] bg-white py-2 px-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="ex : thÃ©atre, soirÃ©e" type="text" [(ngModel)]="type" />
        </label>
      </div>

      <div>
        <label class="text-[12px] montserrat-700 text-[#02263D] ">Date</label>
        <label class="relative block pb-1 text-[13px]">
          <span class="sr-only">Date</span>
          <input (click)="toggaleModal('date')" [value]="this.error_message[1].input" readonly class="block w-full rounded border border-[#00396542] bg-white py-2 px-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="10/01/2024 - 22/01/2024" type="text" />
        </label>
        <app-datetime-picker *ngIf="displayModal.displayDate" [multiDate]="true" (closeDateTime)="toggaleModal('date')" (valueChange)="setValue($event, 'date')"></app-datetime-picker>
        <div class="flex flex-col">
          <span  *ngIf="error_message[1].display" class="text-red-600 font-bold text-[10px]">{{error_message[1].message}}</span>
        </div>
      </div>

      <div class="flex">
        <div class="pr-2">
          <label class="text-[12px] montserrat-700 text-[#02263D] ">Heure dÃ©but</label>
          <label class="relative block py-b 1ext-[13px]">
            <span class="sr-only">Heure dÃ©but</span>
            <input (click)="toggaleModal('time-begin')" readonly [value]="this.error_message[2].input" class="block w-full rounded border border-[#00396542] bg-white py-2 px-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="11:25" type="text" />
          </label>
          <app-time-picker *ngIf="displayModal.displayTimeBegin" (closeDateTime)="toggaleModal('time-begin')" (valueChange)="setValue($event, 'timeBegin')"></app-time-picker>
          <div class="flex flex-col">
            <span  *ngIf="error_message[2].display" class="text-red-600 font-bold text-[10px]">{{error_message[2].message}}</span>
          </div>
        </div>

        <div>
          <label class="text-[12px] montserrat-700 text-[#02263D] ">Heure Fin</label>
          <label class="relative block py-b 1ext-[13px]">
            <span class="sr-only">Heure Fin</span>
            <input (click)="toggaleModal('time-end')" readonly [value]="this.error_message[3].input" class="block w-full rounded border border-[#00396542] bg-white py-2 px-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="11:25" type="text" />
          </label>
          <app-time-picker *ngIf="displayModal.displayTimeEnd" (closeDateTime)="toggaleModal('time-end')" (valueChange)="setValue($event, 'timeEnd')"></app-time-picker>
          <!-- <div class="flex flex-col">
            <span  *ngIf="error_message[3].display" class="text-red-600 font-bold text-[10px]">{{error_message[3].message}}</span>
          </div> -->
        </div>
      </div>
    </div>
    <div class="mt-2 flex justify-between">
      <ion-button (click)="close()" style="--background:transparent; --background-activated:#3332; text-transform: none;" class="h-[40px] w-full rounded-xl border-2 border-[#1D4999] bg-transparent text-[13px] font-bold tracking-wide text-[#1D4999]">Annuler</ion-button>
      <ion-button (click)="validation()" style="--background:#1D4999;--background-activated:#173d84; text-transform: none;" class="mr-1 h-[40px] w-full border-2 border-[#1D4999] rounded-xl bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white">Valider</ion-button>
    </div>
  </div>
</div>

### END Ionic-project\src\app\utiles\component\evenements\evenements.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\evenements\evenements.component.scss ###
### END Ionic-project\src\app\utiles\component\evenements\evenements.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\evenements\evenements.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { EvenementsComponent } from './evenements.component';

describe('EvenementsComponent', () => {
  let component: EvenementsComponent;
  let fixture: ComponentFixture<EvenementsComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ EvenementsComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(EvenementsComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\evenements\evenements.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\evenements\evenements.component.ts ###
import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';
import axios from 'axios';
import { Subject } from 'rxjs';
import {distinctUntilChanged, debounceTime} from 'rxjs/operators';

@Component({
  selector: 'app-evenements',
  templateUrl: './evenements.component.html',
  styleUrls: ['./evenements.component.scss'],
})
export class EvenementsComponent  implements OnInit {

  @Input() evenementsDisplay:any;
  @Output() closeEvenements =new EventEmitter()
  @Output() submitEvent =new EventEmitter()

  type:string = "";
  selectedposition:{name:string, display_name:string, lat:number, lon:number} = {
    name:'',
    display_name:'',
    lat:0,
    lon:0
  };

  suggestions: Array<any> = [];
  private searchSubject: Subject<string> = new Subject<string>();
  focusInput:boolean = false;
  displayModal: any = {
    displayDate:false,
    displayTimebegin:false,
    displayTimeEnd:false
  };
  valide: boolean = true;

  error_message =  [
    /*0*/ {name: "lieu",message:"Lieu est obligatoire.", display:false, input:''},
    /*1*/ {name: "date",message:"Date est obligatoire.", display:false, input:''},
    /*2*/ {name: "heure debute",message:"Heure debute est obligatoire.", display:false, input:''},
    /*3*/ {name: "Heure fin",message:"Heure fin est obligatoire.", display:false, input:''}
  ];

  input:any;

  position:{lat:number, lng:number} = {
    lat:0,
    lng:0
  }

  constructor( ) {
    // ------------------- auto complate with openSreetMap --------------------------------
    this.searchSubject.pipe(
      debounceTime(500), // Adjust the debounce time as per your requirement (e.g., 1000ms = 1 second)
      distinctUntilChanged()
    ).subscribe(() => {
      this.onAddressInput();
    });
    // ------------------- auto complate with openSreetMap --------------------------------
   }

  ngOnInit() {
    // this.autocomplete();
  }



// -------------------------------- openSreetMap --------------------------------
  onAddressChange() {
    this.searchSubject.next(this.error_message[0].input);
  }
// -------------------------------- openSreetMap --------------------------------

// -------------------------------- openSreetMap --------------------------------
  // async onAddressInput() {
  //   if (this.error_message[0].input.length > 2) { // Adjust the minimum length as per your requirement
  //     try {
  //       const response = await axios.get(`https://nominatim.openstreetmap.org/search?q=${this.error_message[0].input}&format=json`);
  //       this.suggestions = response.data;
  //       console.log("this is the content of api OSM : " + JSON.stringify(this.suggestions));

  //     } catch (error:any) {
  //       console.error('Error fetching address suggestions:', error);
  //     }
  //   } else {
  //     this.suggestions = [];
  //   }
  //   console.log("called!! " + this.error_message[0].input);

  // }

searchTimeout: any;

async onAddressInput() {
  clearTimeout(this.searchTimeout);
  const query = this.error_message[0].input.trim();

  if (query.length > 3) {
    this.searchTimeout = setTimeout(async () => {
      try {
        const response = await axios.get(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&addressdetails=1&limit=5&accept-language=fr&countrycodes=fr`);
        this.suggestions = response.data;
        console.log("OSM API content:", JSON.stringify(this.suggestions));
      } catch (error: any) {
        console.error('Error fetching address suggestions:', error);
      }
    }, 400); // 500ms debounce delay
  } else {
    this.suggestions = [];
  }
}


// -------------------------------- openSreetMap --------------------------------

// -------------------------------- openSreetMap --------------------------------
  onSelectAddress(selectedAddress: any) {
    // Handle the selected address, update your form or model accordingly
    console.log('Selected Address:', selectedAddress);
    this.selectedposition.name = selectedAddress.name;
    this.selectedposition.display_name = selectedAddress.display_name;
    this.selectedposition.lat = selectedAddress.lat;
    this.selectedposition.lon = selectedAddress.lon;

    this.error_message[0].input = selectedAddress.display_name
    this.suggestions = [];

  }
// -------------------------------- openSreetMap --------------------------------

// -------------------------------- openSreetMap --------------------------------
  blurInput(){
    setTimeout(()=>{
      this.focusInput=false
    },100)
  }
// -------------------------------- openSreetMap --------------------------------


  // autocomplete(){
  //   // Create the search box and link it to the UI element.
  //   this.input = document.getElementById("pac-input-event") as HTMLInputElement;
  //   const searchBox = new google.maps.places.SearchBox(this.input);


  //   // Listen for the event fired when the user selects a prediction and retrieve
  //   // more details for that place.
  //   searchBox.addListener("places_changed", () => {
  //     const places = searchBox.getPlaces();

  //     if (places?.length == 0) {
  //       return;
  //     }

  //     places?.forEach((place) => {
  //       if (!place.geometry || !place.geometry.location) {
  //         console.log("Returned place contains no geometry");
  //         return;
  //       }
  //       console.log(place);

  //       if (place.formatted_address) {
  //         this.error_message[0].input = place.formatted_address!;
  //         this.position.lat = place.geometry.location.lat();
  //         this.position.lng = place.geometry.location.lng();
  //       }

  //     });

  //   });
  // }

  toggaleModal(modal:string) {
    switch (modal) {
     case 'date':
       this.displayModal.displayDate = !this.displayModal.displayDate;
       break;

     case 'time-begin':
       this.displayModal.displayTimeBegin = !this.displayModal.displayTimeBegin;
       break;

     case 'time-end':
       this.displayModal.displayTimeEnd = !this.displayModal.displayTimeEnd;
       break;

     default:
       break;
    }
   }

   setValue(newValue:any, input:string){
    console.log("this is the new vavlue : "+ newValue);
    console.log('date debut ' + newValue[0] + " date fin " + newValue[1]);

    switch (input) {
      case 'date':
          if(newValue.length == 1){
          this.error_message[1].input = this.formatDateAndTime(newValue[0], 'date');
          }else if(newValue.length > 1){
            this.error_message[1].input = ""
            newValue.forEach((date:string, index:number) => {
              if(index > 0 && index <= newValue.length - 1){
                this.error_message[1].input += ' - '
              }
              this.error_message[1].input += this.formatDateAndTime(date, 'date')
            });
          }
        // this.error_message[1].input = this.formatDateAndTime(newValue, 'date')
        console.log('( date ) outside of the component : ' +  this.error_message[1].input);
        break;
      case 'timeBegin':
         this.error_message[2].input = this.formatDateAndTime(newValue, 'time')
        console.log('( heureDebut ) outside of the component : ' + this.error_message[2].input);
          break;
      case 'timeEnd':
        this.error_message[3].input = this.formatDateAndTime(newValue, 'time')
        console.log('( heureEnd ) outside of the component : ' + this.error_message[3].input);
        break;
      default:
        break;
    }
  }

  formatDateAndTime(getvalue:string, format:string) :string {
    const date = new Date(getvalue);
    switch (format) {
      case 'date':
        return date.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }).replace(/\//g, '/');

      case 'time':
        const hours = ('0' + date.getHours()).slice(-2);
        const minutes = ('0' + date.getMinutes()).slice(-2);
        return `${hours}:${minutes}`;

      default:
        return '';
    }
  }


  validation(){
    if( this.error_message[0].input != '' &&
      this.error_message[1].input != '' &&
      this.error_message[2].input != ''){
      this.submit()

    }else{
      this.error_message.forEach(el => {
        console.log(el.input);

        if(el.input == '') {
          el.display = true
        }else {
          el.display = false;
        }
      })
    }
  }

  submit(){

    this.submitEvent.emit({
      lieu: this.error_message[0].input,
      lat:this.selectedposition.lat,
      lg:this.selectedposition.lon,
      type: this.type == '' ? '----' : this.type,
      date: this.error_message[1].input,
      heureDebut: this.error_message[2].input,
      heureFin: this.error_message[3].input,
      position: this.position
      });
      console.log('lieu ',this.error_message[0].input)
    this.close()
  }

  close(){
    this.closeEvenements.emit();
  }


}

### END Ionic-project\src\app\utiles\component\evenements\evenements.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\horloge\horloge.component.html ###
<div class="absolute top-0 left-0 bottom-0 right-0">
  <div class="mr-1 flex items-center justify-end relative z-30">
    <div (click)="toggaleModal()" class="flex h-[60px] w-[150px] items-center justify-evenly rounded-lg bg-white p-3">
      <div class="flex h-[50px] w-[50px] items-center justify-center border">{{timeValue.hour}}</div>
      <div class="flex h-[50px] w-[50px] items-center justify-center border">{{timeValue.min}}</div>
      <div class="rotate-45 right-[60px] absolute h-[10px] w-[10px] bg-white"></div>
      <app-time-picker *ngIf="displayTimeBegin" (valueChange)="setValue($event)"></app-time-picker>
    </div>
    <div (click)="close()" class="w-10 h-10 rounded-full bg-white flex justify-center items-center ml-3">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
      </svg>
    </div>
  </div>
</div>
<div (click)="close()" class="absolute right-0 bottom-0 left-0 top-0 flex items-center z-0"></div>
  

### END Ionic-project\src\app\utiles\component\horloge\horloge.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\horloge\horloge.component.scss ###
### END Ionic-project\src\app\utiles\component\horloge\horloge.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\horloge\horloge.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { HorlogeComponent } from './horloge.component';

describe('HorlogeComponent', () => {
  let component: HorlogeComponent;
  let fixture: ComponentFixture<HorlogeComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ HorlogeComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(HorlogeComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\horloge\horloge.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\horloge\horloge.component.ts ###
import { Component, OnInit, Input, Output, EventEmitter} from '@angular/core';

@Component({
  selector: 'app-horloge',
  templateUrl: './horloge.component.html',
  styleUrls: ['./horloge.component.scss'],
})
export class HorlogeComponent  implements OnInit {
  @Input() horlogeDisplay:any;
  @Output() closeHorloge= new EventEmitter();

  timeValue:{hour:string, min:string} = {
    hour:'07', 
    min:'00'
  }
  displayTimeBegin:boolean = false

  constructor() { }

  ngOnInit() {}

  close(){
    this.closeHorloge.emit();
  }

  toggaleModal() {
    this.displayTimeBegin = !this.displayTimeBegin;
  }

  formaTime(getvalue:string)  {
    const date = new Date(getvalue);
    const hours = ('0' + date.getHours()).slice(-2);
    const minutes = ('0' + date.getMinutes()).slice(-2);
    return {hour:hours,min: minutes}  
  }

  setValue(newValue: string){
    this.timeValue = this.formaTime(newValue)
    console.log('( heureDebut ) outside of the component : ' + this.timeValue.hour + ":"+this.timeValue.min);
  }

}
### END Ionic-project\src\app\utiles\component\horloge\horloge.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\image-source-modal\image-source-modal.component.html ###
<div class="absolute flex justify-center items-center top-0 left-0 right-0 bottom-0">
  <div (click)="close()" class="absolute top-0 h-[100vh] w-full bg-[#0005] "></div>
  <div class=" mx-1  w-[80vw] rounded bg-white px-7 py-6 z-30 ">
    <div class="mb-1 mt-4">
      <p class="text-[12px] text-center my-4">TÃ©lÃ©charger un Fichier</p>
     </div>
    <div class="flex justify-between mb-4">
      <div (click)="choiceMethod('takePic')" class="w-1/2 h-20 px-4 border-dotted border-2 border-gray-300 rounded-xl flex justify-center items-center">
        <ion-icon name="camera" size="large" color="medium"></ion-icon>
      </div>
      <div (click)="choiceMethod('getPic')" class="mx-1 w-1/2 h-20 px-4 border-dotted border-2 border-gray-300 rounded-xl flex justify-center items-center">
        <ion-icon name="images" size="large" color="medium"></ion-icon>
      </div>
    </div>
  </div>
</div>
### END Ionic-project\src\app\utiles\component\image-source-modal\image-source-modal.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\image-source-modal\image-source-modal.component.scss ###
### END Ionic-project\src\app\utiles\component\image-source-modal\image-source-modal.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\image-source-modal\image-source-modal.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { ImageSourceModalComponent } from './image-source-modal.component';

describe('ImageSourceModalComponent', () => {
  let component: ImageSourceModalComponent;
  let fixture: ComponentFixture<ImageSourceModalComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ ImageSourceModalComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(ImageSourceModalComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\image-source-modal\image-source-modal.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\image-source-modal\image-source-modal.component.ts ###
import { Component, EventEmitter, OnInit, Output } from '@angular/core';

@Component({
  selector: 'app-image-source-modal',
  templateUrl: './image-source-modal.component.html',
  styleUrls: ['./image-source-modal.component.scss'],
})
export class ImageSourceModalComponent  implements OnInit {

  @Output() choice = new EventEmitter();
  @Output() closeModal = new EventEmitter();
  constructor() { }

  ngOnInit() {}
  
  choiceMethod(value:string){
    this.choice.emit(value)
  }
  close(){
    this.closeModal.emit()
  }
}

### END Ionic-project\src\app\utiles\component\image-source-modal\image-source-modal.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\list-points\list-points.component.html ###

<div class="overflow-auto h-[80vh] absolute my-5 top-10 left-6 right-6 bottom-10 bg-white p-5 z-20">
  <!-- list events -->
    <div class="w-full">
       <!-- event -->
       <!-- <div *ngFor="let point of listPoints"> -->
        <div *ngFor="let point of listPoints">
          <div class="flex flex-col  bg-[#F3F4F7] border-[#1d48993b] text-[#16374D] border rounded-lg px-6 py-4 mb-2">
            <label class="w-full font-medium text-[12px] pb-1">NÂ° <span class="font-bold">{{point.refe}}</span></label>
            <table class="font-[Montserrat] text-[13px]">
              <tr>
                <td class="py-[2px] font-medium text-[12px]">Adresse :</td>
                <td class="py-[2px] font-bold pl-1">{{point.adresse}}</td>
              </tr>
              <tr>
                <td class="py-[2px] font-medium text-[12px]">Type :</td>
                <td class="py-[2px] font-bold pl-1">{{point.type}}</td>
              </tr>
              <tr>
              <td colspan="2" class="py-[3px] w-full font-bold text-[11px]">CrÃ©Ã© le {{point.date}}</td>
              </tr>
            </table>

            <div class="flex justify-center mt-2">
              <button class="h-9 m-0.5 rounded-lg bg-[#D4D4D4] active:bg-[#b9b7b7] text-[12px] font-semibold tracking-wide text-[#292929] flex justify-center items-center px-3">
                <span class="px-1">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                  </svg>
                </span>Modifier</button>
              <button class="h-9 m-0.5 rounded-lg bg-[#FBD5CD] active:bg-[#dfb4ac] text-[12px] font-semibold tracking-wide text-[#EB2F06] flex justify-center items-center px-3">
                <span class="px-1">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                  </svg>
                </span>Supprimer</button>
            </div>
          </div>
        </div>
      <!-- end event -->
    </div>
  <!-- end list events -->
</div>
<div (click)="close()" class="bg-[#00000048] top-0 left-0 right-0 bottom-0 absolute z-10"></div>




### END Ionic-project\src\app\utiles\component\list-points\list-points.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\list-points\list-points.component.scss ###
### END Ionic-project\src\app\utiles\component\list-points\list-points.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\list-points\list-points.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { ListPointsComponent } from './list-points.component';

describe('ListPointsComponent', () => {
  let component: ListPointsComponent;
  let fixture: ComponentFixture<ListPointsComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ ListPointsComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(ListPointsComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\list-points\list-points.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\list-points\list-points.component.ts ###
import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';
import { ListPointsService } from '../../services/points/list-points.service';

@Component({
  selector: 'app-list-points',
  templateUrl: './list-points.component.html',
  styleUrls: ['./list-points.component.scss'],
})
export class ListPointsComponent  implements OnInit {
  @Input() listPointsDisplay:any;
  @Output() closelistPoints= new EventEmitter();

  listPoints:any;

  constructor(private pointtsServeces:ListPointsService) { }

  ngOnInit() {
    this.listPoints = this.pointtsServeces.$listPoint;
  }



  close(){
    this.closelistPoints.emit();
  }
}

### END Ionic-project\src\app\utiles\component\list-points\list-points.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\map\map.component.html ###
<input id="pac-input" type="text">
<ion-row id="map" class="w-full h-[100vh]" longPress (executeLongClick)="check($event)" [mapEventDirective]="map"></ion-row>

### END Ionic-project\src\app\utiles\component\map\map.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\map\map.component.scss ###
### END Ionic-project\src\app\utiles\component\map\map.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\map\map.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { MapComponent } from './map.component';

describe('MapComponent', () => {
  let component: MapComponent;
  let fixture: ComponentFixture<MapComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ MapComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(MapComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\map\map.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\map\map.component.ts ###
import { Component, OnInit } from '@angular/core';

@Component({
  selector: 'app-map',
  templateUrl: './map.component.html',
  styleUrls: ['./map.component.scss'],
})
export class MapComponent  implements OnInit {
  
  map:any;
  markers:google.maps.Marker[] = []
  input:any;
 
  constructor() { }

  ngOnInit() {
    this.initAutocomplete();
  }

  
  check(event: google.maps.MapMouseEvent){
    console.log("hello from check methos");
    console.log(event);
    
    // console.log('Latitude: ', event?.latLng?.lat());
    // console.log('Longitude: ', event?.latLng?.lng());
  }

  checkMarkerPlacement(event: any) {
    console.log(event);
    
    // Extract coordinates or other relevant event data
    const lat = event.detail?.clientX; // Replace with appropriate property
    const lng = event.detail?.clientY; // Replace with appropriate property

   console.log(lat); // Replace with appropriate property
   console.log(lng); // Replace with appropriate property

    // Add marker logic using your map library (e.g., Google Maps, Leaflet)
    this.map.addMarker({ lat, lng });
  }

  

  initAutocomplete() {
    this.map = new google.maps.Map(
      document.getElementById("map") as HTMLElement,
      {
        center: { lat: -33.8688, lng: 151.2195 },
        zoom: 13,
        mapTypeId: "roadmap",
      }
    );
  
    // Create the search box and link it to the UI element.
    this.input = document.getElementById("pac-input") as HTMLInputElement;
    const searchBox = new google.maps.places.SearchBox(this.input);
  
    this.map.controls[google.maps.ControlPosition.TOP_LEFT].push(this.input);
  
    // Bias the SearchBox results towards current map's viewport.
    this.map.addListener("bounds_changed", () => {
      searchBox.setBounds(this.map.getBounds() as google.maps.LatLngBounds);
    });

  
    // Listen for the event fired when the user selects a prediction and retrieve
    // more details for that place.
    searchBox.addListener("places_changed", () => {
      const places = searchBox.getPlaces();
  
      if (places?.length == 0) {
        return;
      }
  
      // Clear out the old markers.
      this.markers.forEach((marker) => {
        marker.setMap(null);
      });
      this.markers = [];
  
      // For each place, get the icon, name and location.
      const bounds = new google.maps.LatLngBounds();
  
      places?.forEach((place) => {
        if (!place.geometry || !place.geometry.location) {
          console.log("Returned place contains no geometry");
          return;
        }
  
        const icon = {
          url: place.icon as string,
          size: new google.maps.Size(71, 71),
          origin: new google.maps.Point(0, 0),
          anchor: new google.maps.Point(17, 34),
          scaledSize: new google.maps.Size(25, 25),
        };
  
        // Create a marker for each place.
        this.markers.push(
          new google.maps.Marker({
            map: this.map,
            icon,
            title: place.name,
            position: place.geometry.location,
          })
        );
  
        if (place.geometry.viewport) {
          // Only geocodes have viewport.
          bounds.union(place.geometry.viewport);
        } else {
          bounds.extend(place.geometry.location);
        }
      });
      this.map.fitBounds(bounds);
    });
  }
  
  // declare global {
  //   interface Window {
  //     initAutocomplete: () => void;
  //   }
  // }
  // window.initAutocomplete = initAutocomplete;

}

### END Ionic-project\src\app\utiles\component\map\map.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\menu\menu.component.html ###
<!-- Menu -->
<div class="absolute bg-white top-0 bottom-0 left-0 w-[200px] z-30"
  style="box-shadow: #333 0px 0px 30px 0px; padding-left:20px">
  <!-- head -->
  <div class="flex h-20 w-full py-5">
    <div (click)="close()" class="pt-1">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor"
        class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
    <div class="w-[200px] px-4 text-[15pt] font-bold leading-6 font-[Montserrat]">Menu</div>
  </div>
  <!-- end head -->

  <!-- Profile -->
  <div (click)="goTo('profil')" class="w-full">
    <div class="flex items-center">
      <div class="w-[50px]">
        <img class="rounded-2xl"
          [src]="userinfo?.image?.url? URL + 'storage/' + userinfo?.image?.url : 'https://media.istockphoto.com/id/1327592506/vector/default-avatar-photo-placeholder-icon-grey-profile-picture-business-man.jpg?s=612x612&w=0&k=20&c=BpR0FVaEa5F24GIw7K8nMWiiGmbb8qmhfkpXcp1dhQg='" />
      </div>
      <div class="w-3/5 pl-3">
        <!-- <div *ngIf="userinfo?.role?.role_name == 'organisateur'" class="flex flex-col">
          <span class="font-[Montserrat] text-[10px] font-light text-[#2D3748]">Pseudo</span>
          <label class="text-[13px] font-semibold">Ayman Fadli</label>
        </div> -->
        <div class="flex flex-col">
          <span class="font-[Montserrat] text-[10px] font-light text-[#2D3748]">Pseudo</span>
          <label class="text-[13px] font-semibold">{{userinfo?.firstName}} {{userinfo?.lastName}}</label>
        </div>
      </div>
    </div>
  </div>
  <!-- end Profile -->

  <!-- Menu items  -->
  <div class="my-10 font-">
    <ul class="font-[Montserrat] font-semibold text-[13px]">
      <li class="my-4">
        <button class="flex justify-between items-center w-full text-left p-2 rounded-md hover:bg-gray-200"
          (click)="toggleSubMenu('aeroport')" style="background: transparent;">
          <span>AÃ©roport</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform transition-transform"
            [class.rotate-180]="activeMenu === 'aeroport'" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
        <!-- Submenu -->
        <ul *ngIf="activeMenu === 'aeroport'" class="mt-2 space-y-2 border-l-2 border-gray-300 pl-4">
          <li>
            <a (click)="goTo('aeroports')" class="block py-1 px-2 rounded-md hover:bg-blue-100">
              AÃ©roport DÃ©tail
            </a>
          </li>
          <li>
            <a (click)="goTo('aeroport-attente')" class="block py-1 px-2 rounded-md hover:bg-blue-100">
              Attente Total
            </a>
          </li>
        </ul>
      </li>

      <li class="my-4"><a (click)="goTo('list-evenement')">Liste des Ã©vÃ©nements</a></li>
      <li class="my-4"><a (click)="goTo('list-notes')">Liste des notes</a></li>
      <li class="my-4"><a (click)="save()">Agenda</a></li>
      <li class="my-4"><a (click)="goTo('premium')">Passer Ã  la version Pro</a></li>
      <li class="my-4"><a (click)="goTo('info')">Fil d'actualitÃ©</a></li> <!-- Nouvelle entrÃ©e -->
      <li class="my-4 mt-10"><a (click)="goTo('setting')">ParamÃ¨tres</a></li>
      <li class="my-4"><a (click)="goTo('faq')">Aide et FAQ</a></li>
      <li class="my-4"><a (click)="goTo('avis')">Suggestions et avis</a></li>
      <li class="my-4"><a (click)="goTo('mention-legal')">Conditions gÃ©nÃ©rales d'utilisation</a></li>
      <li class="my-4 mt-10">
        <div (click)="goTo('logout')">DÃ©connecter</div>
      </li>
    </ul>
  </div>

  <!-- end Menu items  -->
</div>
<div (click)="close()" class="bg-[#00000048] top-0 left-0 right-0 bottom-0 absolute z-10"></div>
<!-- end Menu -->
### END Ionic-project\src\app\utiles\component\menu\menu.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\menu\menu.component.scss ###
### END Ionic-project\src\app\utiles\component\menu\menu.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\menu\menu.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { MenuComponent } from './menu.component';

describe('MenuComponent', () => {
  let component: MenuComponent;
  let fixture: ComponentFixture<MenuComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ MenuComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(MenuComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\menu\menu.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\menu\menu.component.ts ###
import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';
import { Router } from '@angular/router';
import { presentToast } from '../notification';
import { ProfilService } from '../../services/profil/profil.service';
import { URL_BASE } from 'src/environments/environment';
import { NavController } from '@ionic/angular';

@Component({
selector: 'app-menu',
templateUrl: './menu.component.html',
styleUrls: ['./menu.style.css'],
})
export class MenuComponent implements OnInit {
userinfo: any;
URL = URL_BASE; // TO USE THE URL ON TEMPLATE

@Input() menuDisplay: any;
@Input() timer: any;
@Input() markertimer: any;
@Output() removeAllMarkers = new EventEmitter();
@Output() closeMenu = new EventEmitter();
activeMenu: string | null = null;
constructor(
    private router: Router,
    private authService: ProfilService,
    private navController: NavController
  ) {}

  ngOnInit() {
    this.profil();
    this.userinfo = this.authService.$userinfo;
    console.log(this.userinfo);
  }
 


  toggleSubMenu(menuName: string) {
    this.activeMenu = this.activeMenu === menuName ? null : menuName;
  }
  close() {
    this.closeMenu.emit();
  }

  goPage(page: any) {
    this.navController.navigateForward(page);
    console.log('goto page ', page);
  }

  goTo(page: string) {
    switch (page) {
      case 'profil':
        this.path(page);
        break;

      case 'aeroports':
        this.path(page);
        break;
      case 'aeroport-attente':
        this.path(page);
        break;
      case 'list-evenement':
        this.path(page);
        break;
      case 'list-notes':
        this.path(page);
        break;

      case 'premium':
        this.path(page);
        break;

      case 'setting':
        this.path(page);
        break;

      case 'faq':
        this.path(page);
        break;

      case 'avis':
        this.path(page);
        break;

      case 'mention-legal':
        this.path(page);
        break;

      case 'info': // Nouvelle route ajoutÃ©e
        this.path(page);
        break;

      case 'logout':
        this.logout();
        break;

      default:
        break;
    }
  }

  path(page: string) {
    if (this.timer) {
      clearInterval(this.timer);
      clearInterval(this.markertimer);
    }
    this.router.navigate(['/' + page]);
  }

  profil() {
    this.authService.$profil().subscribe(
      (data: any) => {
        this.userinfo = data;
        this.authService.$userinfo = data;
        this.authService.$friendsList = data.friends;
      },
      (err) => {
        console.log('error : ' + err.error.message);
      }
    );
  }

  logout() {
    if (this.timer) {
      clearInterval(this.timer);
      clearInterval(this.markertimer);
    }
    this.authService.$logout().subscribe(
      (date: any) => {
        if (date.message == 'ok') {
          this.removeAllMarkers.emit();
          localStorage.setItem('apiToken', '');
          this.authService.$friendsList = [];
          this.authService.$userinfo = undefined;
          this.router.navigate(['/sign-in'], { replaceUrl: true });
        }
      },
      (err) =>
        presentToast('error \n ' + err.error.message, 'bottom', 'danger')
    );
  }

  save() {
    presentToast('not developed yet!', 'bottom', 'danger');
  }
}

### END Ionic-project\src\app\utiles\component\menu\menu.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\menu\menu.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import {MatMenuModule} from "@angular/material/menu";
import { MenuComponent } from './menu.component';
import { MatExpansionModule } from '@angular/material/expansion';
import { MatButtonModule } from '@angular/material/button';


@NgModule({
  declarations: [MenuComponent],
  imports: [
    CommonModule,
    MatMenuModule,
    MatButtonModule,
    MatExpansionModule,
    MatButtonModule,
  ],
  exports: [MenuComponent]
})
export class MenuModule { }

### END Ionic-project\src\app\utiles\component\menu\menu.module.ts ###

### BEGIN Ionic-project\src\app\utiles\component\menu\menu.style.css ###
/* Add this to your global Tailwind styles or in a component-specific CSS file */
ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  button {
    @apply w-full text-left p-2 bg-gray-100 hover:bg-gray-200 rounded-md flex items-center justify-between;
  }
  
  ul ul {
    @apply ml-6 mt-2 space-y-2 border-l-2 border-gray-300 pl-4;
  }
  
  a {
    @apply block py-1 px-2 rounded-md hover:bg-blue-100;
  }
  
### END Ionic-project\src\app\utiles\component\menu\menu.style.css ###

### BEGIN Ionic-project\src\app\utiles\component\note\note.component.html ###
<div class="h-[100vh] absolute top-0 left-0 right-0 bottom-0 flex justify-center items-center">
  <div class=" w-[80vw] flex-col rounded bg-white px-7 py-5 z-30 overflow-auto" [ngClass]="{'h-[100vh]':makeBoxFullHeight}">
    <div class="px-4 text-center font-[Montserrat] text-[18px] font-bold leading-6">CrÃ©er une <span class="font-bold text-[#1D4999]">note</span></div>
    <div class="mb-1 mt-4 w-full">
      <div>
        <label class="text-[12px] montserrat-700">Adresse</label>
        <label class="relative block text-[13px]">
          <span class="sr-only text-[#02263D]">Adresse</span>
          <span class="absolute inset-y-0 left-0 flex items-center pl-2.5 text-[#879EA4]">
            <img src="../../../assets/icon/gpsInput.svg" alt="">
          </span>

          <!-- ----------------- For openSteetMap ----------------- -->
          <!-- (keyup)="onAddressInput()" -->
          <!-- (focus)="focusInput = true" -->
          <!-- (blur)="blurInput()" -->
          <!-- ----------------- For openSteetMap ----------------- -->

          <input  class="block w-full rounded border border-[#00396542] bg-white py-2 pl-9 pr-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="ex : Tour eiffel,.." type="text" [(ngModel)]="lieu" (keyup)="onAddressInput()" (focus)="focusInput = true" (blur)="blurInput()"/>
        </label>
        <!-- ----------------- For openSteetMap (autocomplete) ----------------- -->
        <div *ngIf="suggestions.length > 0 && focusInput" class="absolute left-12 bg-white border border-[#00396542] w-2/3 max-h-[40vh] overflow-x-auto z-10">
          <ul>
            <li *ngFor="let suggestion of suggestions" (click)="onSelectAddress(suggestion)" class="p-1 text-[11px] border-b-1 border">{{suggestion.display_name}}</li>
          </ul>
        </div>
        <!-- ----------------- For openSteetMap (autocomplete) ----------------- -->

      </div>

      <div>
        <label class="text-[12px] font-semibold">Jour</label>
        <div class="flex flex-wrap w-full items-center">
          <!-- this is cames from dayList array -->
          <div *ngFor="let item of dayList" class="flex h-[25px] w-[60px] my-1 items-center rounded-full px-2  py-0.5  mr-1" [ngClass]="{'bg-[#1D4999] text-white':item.activated , 'bg-[#E6EAEC] text-[#02263D]': !item.activated}" >
            <input (change)="selectDay(item, $event)" type="checkbox" name="days"/>
            <span class="break-normal px-1 text-[11px]" >{{item.name}}</span>
          </div>
        </div>
      </div>

      <div>
        <label class="text-[12px] font-semibold">Heure</label>
        <label class="relative block pb-2 text-[13px]">
          <span class="sr-only">Heure</span>
          <input (click)="toggaleModal('time-begin')" readonly [value]="heureDebut" class="block w-full rounded border border-[#00396542] bg-white px-3 py-2 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="19:00" type="text" />
        </label>
        <app-time-picker *ngIf="displayModal.displayTimeBegin" (closeDateTime)="toggaleModal('time-begin')" (valueChange)="setValue($event, 'timeBegin')"></app-time-picker>
      </div>

      <div>
        <label class="text-[12px] font-semibold">Type</label>
        <label class="relative block pb-2 text-[13px]">
          <span class="sr-only">Type</span>
          <input class="block w-full rounded border border-[#00396542] bg-white px-3 py-2 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="ex : Entreprise, hotel, particulier..." type="text" [(ngModel)]="Type"/>
        </label>
      </div>

      <div class="w-full">
        <label class="text-[12px] font-semibold">Destination</label>
        <label class="relative block pb-2 text-[13px]">
          <span class="sr-only">Destination</span>
          <input class="block w-full rounded border border-[#00396542] bg-white p-2 px-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Paris" type="text"  [(ngModel)]="destination"/>
        </label>
        <div class="relative flex h-[30px] w-full flex-row items-center overflow-y-hidden px-1">
          <div class="flex">
            <div class="text-[#1D4999]] mr-1 flex h-[25px] w-[120px] items-center rounded-full px-2 py-0.5" [ngClass]="{'bg-[#E6EAEC] ': friendsSelector != tous.value, 'bg-[#1D4999] text-white':  friendsSelector == tous.value}">
              <input  type="radio" name="type" value="all" class="h-4 w-4" #tous (change)="selectSelectorFiends(tous.value)" />
              <span class="px-1 text-[11px]">Tous les amis</span>
            </div>

            <div class="flex h-[25px] w-[100px] items-center rounded-full px-2 py-0.5 text-white" [ngClass]="{'bg-[#E6EAEC] ': friendsSelector != perso.value, 'bg-[#1D4999] text-white':  friendsSelector == perso.value}">
              <input checked type="radio" name="type" value="personne" class="h-4 w-4" #perso (change)="selectSelectorFiends(perso.value)" />
              <span class="px-1 text-[11px]">Personne</span>
            </div>
          </div>
        </div>
      </div>

      <div>
        <label class="text-[12px] font-semibold">Commentaire</label>
        <label class="relative block pb-2 text-[13px]">
          <span class="sr-only">Commentaire</span>
          <textarea class="block w-full rounded border border-[#00396542] bg-white px-3 py-2 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Ã©crire.." type="text"></textarea>
        </label>
      </div>

      <div class="mt-2 flex justify-between">
        <ion-button (click)="close()" style="--background:transparent; --background-activated:#3332; text-transform: none;" class="h-[40px] w-full rounded-xl border-2 border-[#1D4999] bg-transparent text-[13px] font-bold tracking-wide text-[#1D4999]">Annuler</ion-button>
        <ion-button (click)="submit()" style="--background:#1D4999;--background-activated:#173d84; text-transform: none;" class="mr-1 h-[40px] w-full border-2 border-[#1D4999] rounded-xl bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white">Valider</ion-button>
      </div>
    </div>
  </div>
  <div (click)="close()" class="absolute top-0 right-0 left-0 bottom-0 z-10 bg-[#0005]"></div>
</div>

### END Ionic-project\src\app\utiles\component\note\note.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\note\note.component.scss ###
### END Ionic-project\src\app\utiles\component\note\note.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\note\note.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { NoteComponent } from './note.component';

describe('NoteComponent', () => {
  let component: NoteComponent;
  let fixture: ComponentFixture<NoteComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ NoteComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(NoteComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\note\note.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\note\note.component.ts ###
import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';
import axios from 'axios';
import { Day } from 'src/app/utiles/interface/day-list';
import { presentToast } from '../notification';
import { Keyboard } from '@capacitor/keyboard';

@Component({
  selector: 'app-note',
  templateUrl: './note.component.html',
  styleUrls: ['./note.component.scss'],
})
export class NoteComponent  implements OnInit {

  @Input() noteDisplay:any;
  @Output() closeNote = new EventEmitter();
  @Output() submitNote = new EventEmitter();

  dayList:Array<Day> = [
    {index: 1, name: "Lun", activated: false}, // Monday
    {index: 2, name: "Mar", activated: false}, // Tuesday
    {index: 3, name: "Mer", activated: false}, // Wednesday
    {index: 4, name: "Jeu", activated: false}, // Thursday
    {index: 5, name: "Ven", activated: false}, // Friday
    {index: 6, name: "Sam", activated: false}, // Saturday
    {index: 0, name: "Dim", activated: false}, // Sunday
  ];

  lieu:string="";
  selectedDays:Array<string> = [];
  heure:string = "";
  Type:string = "" // ex : Entreprise, hotel, particulier...
  destination: string = ""; // ex : Paris
  friendsSelector:string = "personne"; // tous les amis, personne


  // autocomplete variables
  suggestions: Array<any> = [];
  focusInput:boolean = false;
  selectedposition:{name:string, display_name:string, lat:number, lon:number} = {
    name:'',
    display_name:'',
    lat:0,
    lon:0
  };
  // autocomplete variables

  displayModal:any = {
    displayDate: false,
    displayTimeBegin: false,
    displayTimeEnd: false,
  }
  heureDebut: string = '';

  makeBoxFullHeight:boolean = false;
  constructor() { }

  ngOnInit() {
    Keyboard.addListener('keyboardWillShow', () => {
      // Run your function here
      // presentToast("the keyboard is comming !!! value : "+this.makeBoxFullHeight, "top", 'success');
      this.makeBoxFullHeight = true;
    });

    Keyboard.addListener('keyboardWillHide', () => {
      // presentToast("the keyboard is leaving !!! value : "+this.makeBoxFullHeight, "bottom", 'success');
      this.makeBoxFullHeight = false;
    });
  }



  selectDay(selectedday:any, event:any){
    let status = event.target.checked

    if(status){
      console.log("checked form : "+selectedday.name);
      this.checkOruncheck(selectedday.name)
      // We now push the day's index (number) instead of the whole object
      this.selectedDays.push(selectedday.index);

    }else{
      console.log("uncheckedform : "+selectedday);
      this.checkOruncheck(selectedday.name)
      this.selectedDays.splice(this.selectedDays.indexOf(selectedday.index),1)
    }
    console.log("list : "+ this.selectedDays);
  }

  selectSelectorFiends(type:string){
    console.log("this is the selected type : "+type);

    this.friendsSelector = type
  }

  findDayElement(name:string):Day{

    let element = this.dayList.find(el => el.name == name)
    if(element){
      console.log("this is the result of search : " + JSON.stringify(element));
      return element;
    }
    console.log("this is the result of search : " + JSON.stringify({index:0, name:'', activated:false}));
    return {index:0, name:'', activated:false};
  }

  // this method for days section
  checkOruncheck(dayName:string){
   let dayElement = this.findDayElement(dayName);
   if(dayElement.index != 0){
     dayElement.activated = !dayElement.activated
     console.log("switch checker is done !!!");
   }else{
     console.error("switch checker isn't done !!!, the dayName not find (findDayElement Method take name not find in dayList array! ");
   }
  }

  toggaleModal(modal:string) {
    switch (modal) {
     case 'date':
       this.displayModal.displayDate = !this.displayModal.displayDate;
       break;

     case 'time-begin':
       this.displayModal.displayTimeBegin = !this.displayModal.displayTimeBegin;
       break;

     case 'time-end':
       this.displayModal.displayTimeEnd = !this.displayModal.displayTimeEnd;
       break;

     default:
       break;
    }
   }

   setValue(newValue: string, input:string){
    console.log("this is the new vavlue : "+ newValue);

    switch (input) {

      case 'timeBegin':
         this.heureDebut = this.formatDateAndTime(newValue, 'time')
        console.log('( heureDebut ) outside of the component : ' + this.heureDebut);
          break;

      default:
        break;
    }
  }

  formatDateAndTime(getvalue:string, format:string) :string {
    const date = new Date(getvalue);
    switch (format) {
      case 'date':
        return date.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }).replace(/\//g, '/');

      case 'time':
        const hours = ('0' + date.getHours()).slice(-2);
        const minutes = ('0' + date.getMinutes()).slice(-2);
        return `${hours}:${minutes}`;

      default:
        return '';
    }

  }

   async onAddressInput() {
    if (this.lieu.length > 3) { // Adjust the minimum length as per your requirement
      try {
        const response = await axios.get(`https://nominatim.openstreetmap.org/search?q=${this.lieu}&format=json`);
        this.suggestions = response.data;
        console.log("this is the content of api OSM : " + JSON.stringify(this.suggestions));

      } catch (error:any) {
        console.error('Error fetching address suggestions:', error);
      }
    } else {
      this.suggestions = [];
    }
    console.log("called!! " + this.lieu);

  }

   onSelectAddress(selectedAddress: any) {
    // Handle the selected address, update your form or model accordingly
    console.log('Selected Address:', selectedAddress);
    this.selectedposition.name = selectedAddress.name;
    this.selectedposition.display_name = selectedAddress.display_name;
    this.selectedposition.lat = selectedAddress.lat;
    this.selectedposition.lon = selectedAddress.lon;

    this.lieu = selectedAddress.display_name
  }

  blurInput(){
    setTimeout(()=>{
      this.focusInput=false
    },100)
  }


  submit(){
    
    const noteData = {
      lieu: this.lieu,
      lat:this.selectedposition.lat,
      lg:this.selectedposition.lon,
      selectedDays: this.selectedDays,
      heure: this.heureDebut,
      type: this.Type,
      destination: this.destination,
      friendsSelector: this.friendsSelector
    };
    // Log the data to the console before emitting it
    console.log("Data to be submitted:", noteData);
    // Emit the data
    this.submitNote.emit(noteData);

    // Close the note component
    this.close();
  }


  close(){
    this.closeNote.emit();
  }

}


### END Ionic-project\src\app\utiles\component\note\note.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\onboarding\onboarding.component.html ###
<div class="absolute top-0 left-0 right-0 bottom-0 z-30">
  <div *ngIf="nextbord == '0'" class="w-full h-[100vh] bg-[#112A59]">
    <div class=" h-[43%] flex justify-center items-center ">
      <img src="../../assets/images/Group_3869.png" width="230"/>
    </div>
    <div class="bg-white w-full h-[56vh] absolute bottom-0 rounded-t-2xl py-6 font-[Montserrat]">
      <div class="text-center flex flex-col items-center">
         <label class="text-[20px] text-[#003A65]  font-bold">Lorem <br> Ipsum</label>
         <p class="text-[12px] text-[#000] font-medium	 opacity-[50%] m-4">
            Dolor sit amet, consectetur adipiscing elit. Pharetra sit lorem praesent eu ac nec dignissim. At eget nisl ultrices integer. Hendrerit.
         </p>
         <div class="flex justify-between mt-8 mb-6 w-12">
           <div (click)="next('0')" class="bg-[#1D4898] w-4 h-2 rounded-lg"></div>
           <div (click)="next('1')" class="bg-[#A0D0EC] w-2.5 h-2 rounded-lg"></div>
           <div (click)="next('2')" class="bg-[#A0D0EC] w-2.5 h-2 rounded-lg"></div>
         </div>
  
         <button (click)="next('1')" class="bg-[#1D4898] text-white text-[13px] font-semibold w-60 h-9 rounded-lg mb-3">SUIVANT</button>
         <button (click)="next('3')" class=" text-[#003A65] text-[12px] font-medium w-60 h-9 rounded-lg">SAUTER</button>
      </div>
    </div>
  
  </div>
  
  <div *ngIf="nextbord == '1'" class="w-full h-[100vh] bg-[#112A59]">
    <div class=" h-[43%] flex justify-center items-center ">
      <img src="../../assets/images/Group_3869.png" width="230"/>
    </div>
    <div class="bg-white w-full h-[56vh] absolute bottom-0 rounded-t-2xl py-6 font-[Montserrat]">
      <div class="text-center flex flex-col items-center">
         <label class="text-[20px] text-[#003A65]  font-bold">Lorem <br> Ipsum</label>
         <p class="text-[12px] text-[#000] font-medium	 opacity-[50%] m-4">
            Dolor sit amet, consectetur adipiscing elit. Pharetra sit lorem praesent eu ac nec dignissim. At eget nisl ultrices integer. Hendrerit.
         </p>
         <div class="flex justify-between mt-8 mb-6 w-12">
           <div (click)="next('0')" class="bg-[#A0D0EC] w-2.5 h-2 rounded-lg"></div>
           <div (click)="next('1')" class="bg-[#1D4898] w-4 h-2 rounded-lg"></div>
           <div (click)="next('2')" class="bg-[#A0D0EC] w-2.5 h-2 rounded-lg"></div>
         </div>
  
         <button (click)="next('2')" class="bg-[#1D4898] text-white text-[13px] font-semibold w-60 h-9 rounded-lg mb-3">SUIVANT</button>
         <button (click)="next('3')" class=" text-[#003A65] text-[12px] font-medium w-60 h-9 rounded-lg">SAUTER</button>
      </div>
    </div>
  
  </div>
  
  <div *ngIf="nextbord == '2'" class="w-full h-[100vh] bg-[#112A59]">
    <div class=" h-[43%] flex justify-center items-center ">
      <img src="../../assets/images/Group_3869.png" width="230"/>
    </div>
    <div class="bg-white w-full h-[56vh] absolute bottom-0 rounded-t-2xl py-6 font-[Montserrat]">
      <div class="text-center flex flex-col items-center">
         <label class="text-[20px] text-[#003A65]  font-bold">Lorem <br> Ipsum</label>
         <p class="text-[12px] text-[#000] font-medium	 opacity-[50%] m-4">
            Dolor sit amet, consectetur adipiscing elit. Pharetra sit lorem praesent eu ac nec dignissim. At eget nisl ultrices integer. Hendrerit.
         </p>
         <div class="flex justify-between mt-8 mb-6 w-12">
           <div (click)="next('0')" class="bg-[#A0D0EC] w-2.5 h-2 rounded-lg"></div>
           <div (click)="next('1')" class="bg-[#A0D0EC] w-2.5 h-2 rounded-lg"></div>
           <div (click)="next('2')" class="bg-[#1D4898] w-4 h-2 rounded-lg"></div>
         </div>
  
         <button (click)="next('3')" class="bg-[#1D4898] text-white text-[13px] font-semibold w-60 h-9 rounded-lg mb-3">SUIVANT</button>
         <button (click)="next('3')" class=" text-[#003A65] text-[12px] font-medium w-60 h-9 rounded-lg">SAUTER</button>
      </div>
    </div>
  
  </div>
</div>
### END Ionic-project\src\app\utiles\component\onboarding\onboarding.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\onboarding\onboarding.component.scss ###
### END Ionic-project\src\app\utiles\component\onboarding\onboarding.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\onboarding\onboarding.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { OnboardingComponent } from './onboarding.component';

describe('OnboardingComponent', () => {
  let component: OnboardingComponent;
  let fixture: ComponentFixture<OnboardingComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ OnboardingComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(OnboardingComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\onboarding\onboarding.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\onboarding\onboarding.component.ts ###
import { Component, OnInit, Output, EventEmitter } from '@angular/core';

@Component({
  selector: 'app-onboarding',
  templateUrl: './onboarding.component.html',
  styleUrls: ['./onboarding.component.scss'],
})
export class OnboardingComponent  implements OnInit {
  @Output() displayer = new EventEmitter();
  nextbord:string = '0';
  
  constructor() { }

  ngOnInit() {}

  close(){
    this.displayer.emit();
  }

  next(number:string) {
    switch (number) {
      case '0':
        this.nextbord = number;
        break;
      case '1':
        this.nextbord = number;
        break;
      case '2':
        this.nextbord = number;
        break;
      case '3':
        localStorage.setItem('onpoarding', '1');
        this.close();
        break;
    
      default:
        break;
    }
  }

}

### END Ionic-project\src\app\utiles\component\onboarding\onboarding.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\sos\sos.component.html ###
<div class="absolute top-0 left-0 right-0 bottom-0 flex justify-center items-center">
  <div class="flex w-[80vw] flex-col rounded bg-white px-7 py-10 z-30">
    <div class="px-4 text-center font-[Montserrat] font-bold text-[18px] leading-6">
      CrÃ©er une <span class="font-bold text-[#0198D7]">Sos</span>
    </div>
    <div class="mb-1 mt-6">
      <div>
        <label class="text-[12px] montserrat-700">Message du Sos</label>
        <label class="relative block text-[13px]">
          <!-- <span class="sr-only text-[#02263D]">Nom de la station</span> -->
          <textarea [(ngModel)]="msg" class="block w-full rounded border border-[#00396542] bg-white py-2 p-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="Sos msg.." type="text" name="sos" ></textarea>
        </label>
        <label class="text-[12px] montserrat-700 mt-3">NumÃ©ro de tÃ©lÃ©phone</label>
        <label class="relative block text-[13px] ">
          <input [(ngModel)]="numeroTel" class="blsock w-full rounded border border-[#00396542] bg-white py-2 p-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm" placeholder="06.." type="tel" name="tel-sos" />
        </label>
      </div>
    </div>
    <div class="mt-6 flex justify-between">
      <ion-button (click)="close()" style="--background:transparent; --background-activated:#3332; text-transform: none;" class="h-[40px] w-full rounded-xl border-2 border-[#1D4999] bg-transparent text-[13px] font-bold tracking-wide text-[#1D4999]">Annuler</ion-button>
      <ion-button (click)="validate()" style="--background:#1D4999;--background-activated:#173d84; text-transform: none;" class="mr-1 h-[40px] w-full border-2 border-[#1D4999] rounded-xl bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white">Valider</ion-button>
    </div>
  </div>
  <div (click)="close()" class="absolute top-0 z-10 flex h-[100vh] w-full items-center justify-center bg-[#0005]"></div>
</div>


### END Ionic-project\src\app\utiles\component\sos\sos.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\sos\sos.component.scss ###
### END Ionic-project\src\app\utiles\component\sos\sos.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\sos\sos.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { SosComponent } from './sos.component';

describe('SosComponent', () => {
  let component: SosComponent;
  let fixture: ComponentFixture<SosComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ SosComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(SosComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\sos\sos.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\sos\sos.component.ts ###
import { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';

@Component({
  selector: 'app-sos',
  templateUrl: './sos.component.html',
  styleUrls: ['./sos.component.scss'],
})
export class SosComponent  implements OnInit {

  @Input() editMode: any; //values to edit of sos point
  @Input() sosDisplay:any;
  @Output() closeSos =new EventEmitter()
  @Output() validateSos  = new EventEmitter<any>();

  constructor() { }

  msg:string ='';
  numeroTel:string ='';

  ngOnInit() {
    if (this.editMode) {
      this.msg = this.editMode.msg || '';
      this.numeroTel = this.editMode.numeroTel || '';
    }
  }

  close() {
    this.closeSos.emit(); // Emit closeSos event
  }

  validate() {
    const SosData={
      msg:this.msg,
      numeroTel:this.numeroTel,
    }

    this.validateSos.emit(SosData);
    this.closeSos.emit();
  }

}

### END Ionic-project\src\app\utiles\component\sos\sos.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\status\status.component.html ###
<div class="absolute top-0 left-0 right-0 bottom-0 flex justify-center items-center">
  <div class="flex w-[80vw] flex-col rounded bg-white px-7 py-10 z-30">
    <div class="px-4 text-center font-[Montserrat] font-bold text-[18px] leading-6">
      CrÃ©er une <span class="font-bold text-[#0198D7]">Station</span>
    </div>
    <div class="mb-1 mt-6">
      <div>
        <label class="text-[12px] montserrat-700">Nom de la station</label>
        <label class="relative block text-[13px]">
          <span class="sr-only text-[#02263D]">Nom de la station</span>
          <input [(ngModel)]="station"
                 class="block w-full rounded border border-[#00396542] bg-white py-2 p-3 shadow-sm placeholder:text-[#879EA4] focus:border-[#112A59] focus:outline-none focus:ring-1 focus:ring-[#112A59] sm:text-sm"
                 placeholder="Nom de la station"
                 type="text"
                 name="station"
          />
        </label>
      </div>
    </div>
    <div class="mt-6 flex justify-between">
      <ion-button
        (click)="close()"
        style="--background:transparent; --background-activated:#3332; text-transform: none;"
        class="h-[40px] w-full rounded-xl border-2 border-[#1D4999] bg-transparent text-[13px] font-bold tracking-wide text-[#1D4999]"
        >Annuler</ion-button
      >
      <ion-button
        (click)="validate(); $event.stopPropagation()"
        style="--background:#1D4999;--background-activated:#173d84; text-transform: none;"
        class="mr-1 h-[40px] w-full border-2 border-[#1D4999] rounded-xl bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white"
        >Valider</ion-button
      >
    </div>
  </div>
  <div
    (click)="close()"
    class="absolute top-0 z-10 flex h-[100vh] w-full items-center justify-center bg-[#0005]"
  ></div>
</div>

### END Ionic-project\src\app\utiles\component\status\status.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\status\status.component.scss ###
### END Ionic-project\src\app\utiles\component\status\status.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\status\status.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { StatusComponent } from './status.component';

describe('StatusComponent', () => {
  let component: StatusComponent;
  let fixture: ComponentFixture<StatusComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ StatusComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(StatusComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\status\status.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\status\status.component.ts ###
import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';
import { presentToast } from '../notification';

@Component({
  selector: 'app-status',
  templateUrl: './status.component.html',
  styleUrls: ['./status.component.scss'],
})
export class StatusComponent implements OnInit {
  @Input() statusDisplay: any;
  @Output() closeStatus = new EventEmitter();
  @Output() validateStation = new EventEmitter<string>();

  station: string = ''; // Station name input
  constructor() { }

  ngOnInit(): void { }

  // Close the modal
  close(): void {
    this.closeStatus.emit();
  }

  // Validate the selected station
  validate(): void {
    if (this.station.trim()) {
      this.validateStation.emit(this.station.trim());
      this.close();
    } else {
      presentToast("Veuillez entrer un nom pour la station.", "bottom", "danger");
    }
  }

}

### END Ionic-project\src\app\utiles\component\status\status.component.ts ###

### BEGIN Ionic-project\src\app\utiles\component\warning-update-proffessional-info\warning-update-proffessional-info.component.html ###
<div class="absolute flex justify-center items-center top-0 left-0 right-0 bottom-0">
  <div (click)="close()" class="absolute top-0 h-[100vh] w-full bg-[#0005] "></div>
  <div class=" flex w-[80vw] flex-col rounded bg-white px-7 py-8 z-30 relative">
    <div class="px-4 text-center font-[Montserrat] text-[18px] leading-6 font-bold">Confermation</div>
    <div class="mb-1 mt-4">
     <p class="text-[12px] text-center mb-4">Ãªtes vous sÃ»r de vouloir<br/>
      modifier ? Le compte sera suspendu dans lâ€™attente dâ€™une vÃ©rification</p>
    </div>
    <div class="mt-2 flex justify-between">
      <ion-button (click)="close()" data style="--background:transparent; --background-activated:#3332; text-transform: none;" class="h-[40px] w-full rounded-xl border-2 border-[#1D4999] bg-transparent text-[13px] font-bold tracking-wide text-[#1D4999]">Annuler</ion-button>
      <ion-button (click)="updatingInfoMethod()" style="--background:#1D4999;--background-activated:#173d84; text-transform: none;" class="mr-1 h-[40px] w-full border-2 border-[#1D4999] rounded-xl bg-[#1D4999] text-[13px] font-semibold tracking-wide text-white">Confirmer</ion-button>
    </div>
  </div>
</div>
### END Ionic-project\src\app\utiles\component\warning-update-proffessional-info\warning-update-proffessional-info.component.html ###

### BEGIN Ionic-project\src\app\utiles\component\warning-update-proffessional-info\warning-update-proffessional-info.component.scss ###
### END Ionic-project\src\app\utiles\component\warning-update-proffessional-info\warning-update-proffessional-info.component.scss ###

### BEGIN Ionic-project\src\app\utiles\component\warning-update-proffessional-info\warning-update-proffessional-info.component.spec.ts ###
import { ComponentFixture, TestBed, waitForAsync } from '@angular/core/testing';
import { IonicModule } from '@ionic/angular';

import { WarningUpdateProffessionalInfoComponent } from './warning-update-proffessional-info.component';

describe('WarningUpdateProffessionalInfoComponent', () => {
  let component: WarningUpdateProffessionalInfoComponent;
  let fixture: ComponentFixture<WarningUpdateProffessionalInfoComponent>;

  beforeEach(waitForAsync(() => {
    TestBed.configureTestingModule({
      declarations: [ WarningUpdateProffessionalInfoComponent ],
      imports: [IonicModule.forRoot()]
    }).compileComponents();

    fixture = TestBed.createComponent(WarningUpdateProffessionalInfoComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  }));

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\component\warning-update-proffessional-info\warning-update-proffessional-info.component.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\component\warning-update-proffessional-info\warning-update-proffessional-info.component.ts ###
import { Component, EventEmitter, OnInit, Output } from '@angular/core';

@Component({
  selector: 'app-warning-update-proffessional-info',
  templateUrl: './warning-update-proffessional-info.component.html',
  styleUrls: ['./warning-update-proffessional-info.component.scss'],
})
export class WarningUpdateProffessionalInfoComponent  implements OnInit {
  @Output() closeConfirmation = new EventEmitter();
  @Output() updatingInfo = new EventEmitter();
  constructor() { }

  ngOnInit() {}

  close(){
    this.closeConfirmation.emit();
  }

  updatingInfoMethod(){
    this.updatingInfo.emit();
  }
}

### END Ionic-project\src\app\utiles\component\warning-update-proffessional-info\warning-update-proffessional-info.component.ts ###

### BEGIN Ionic-project\src\app\utiles\directives\longpress\long-press.directive.spec.ts ###
import { LongPressDirective } from './long-press.directive';

describe('LongPressDirective', () => {
  it('should create an instance', () => {
    const directive = new LongPressDirective();
    expect(directive).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\directives\longpress\long-press.directive.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\directives\longpress\long-press.directive.ts ###
import { Directive, ElementRef, Output, AfterViewInit, EventEmitter, Input, SimpleChanges } from '@angular/core';
import { GestureController } from '@ionic/angular';
import { ListPointsService } from '../../services/points/list-points.service';
import mapboxgl from 'mapbox-gl';

@Directive({
  selector: '[longPress]'
})
export class LongPressDirective implements AfterViewInit{

  @Output() latlng = new EventEmitter();
  @Output() eventListenerDetected = new EventEmitter();
  @Output() executeLongClick = new EventEmitter();
  @Input() mapEventDirective!:mapboxgl.Map ;
  @Input() checker!:boolean;
  private active:boolean = false
  private marker:mapboxgl.Marker | null = null;
  timer: any;
  markers:mapboxgl.Marker[] = [];
  eventListener:any;

  constructor(
    private el: ElementRef,
    private getstureCtrl: GestureController,
    private pointService: ListPointsService
  ) { }

  ngOnChanges(changes: SimpleChanges) {
    if (changes['checker']) {
      console.log('Checker value changed:', this.checker);
    }
  }

  ngAfterViewInit(): void {
    this.initGesture();
  }

  initGesture(){
    let gesture = this.getstureCtrl.create({
      el: this.el.nativeElement,
      gestureName: 'long-press',
      threshold: 0,
      onStart: () =>{
        this.active = true;
        if(this.marker != null){
          console.log('clear marker runing now!');
          console.log(this.markers);
          if(this.markers.length > 0){
            this.clearMarkers();
            this.markers = []
            console.log('list markers is got empty !');
            this.marker.remove();
            this.marker = null
            this.latlng.emit(undefined)
          }
        }
        this.logpresscheck()
      },
      onEnd: () => {
        this.active = false
      },
    }, true);

    gesture.enable();
  }

  logpresscheck() {
    if(this.timer){
      clearTimeout(this.timer)
    }

    this.timer = setTimeout(() => {

      if(this.active){
        // For button long press, emit the executeLongClick event
        if (!this.mapEventDirective) {
          console.log('ðŸ”¥ Long press detected on button - emitting executeLongClick');
          this.executeLongClick.emit();
          return;
        }

        // For map long press, handle the map interaction
        if (this.mapEventDirective instanceof mapboxgl.Map) {
          setTimeout(() => {
            if(this.checker){
              this.mapEventDirective.off('click', this.addMarker);

              console.log('111111 checker is false 1111111');
              this.mapEventDirective.once('click', (event: any) => this.addMarker(event));
              this.eventListenerDetected.emit('click');
            }
          }, 100)

        } else {
          console.error('mapEventDirective is not a Mapbox Map instance');
        }
      }
    }, 1000)
  }

  //  addMarker = async (event:any) =>{

  //   console.log('checker is ' + this.checker);


  //   if(this.checker){
  //     console.log("add marker method");
  //     console.log("this is marker " + this.marker);
  //     console.log('Map clicked at:', event.latLng.toJSON());
  //     if(this.marker == undefined){
  //       const beachFlagImg = document.createElement('img');
  //       beachFlagImg.src = '../../../../assets/icon/markerGray.png';


  //       const { AdvancedMarkerElement } = await google.maps.importLibrary("marker") as google.maps.MarkerLibrary;
  //       this.marker = new AdvancedMarkerElement({
  //         position: new google.maps.LatLng(event.latLng.lat(), event.latLng.lng()),
  //         content: beachFlagImg
  //       });

  //       this.markers.push(this.marker);
  //       console.log(this.markers);

  //       this.latlng.emit({marker:this.marker, markers:this.markers})
  //       this.marker.setMap(this.mapEventDirective);
  //     }else{
  //       if(this.eventListener){
  //         google.maps.event.removeListener(this.eventListener)
  //       }
  //     }

  //   }
  // }

  addMarker = async (event: any) => {
    console.log('checker is ' + this.checker);

    if (this.checker) {
      console.log("add marker method");

      if (!this.marker) {
        console.log('Map clicked at:', event.lngLat);

        // Create custom HTML element for marker
        const el = document.createElement('div');
        el.className = 'custom-marker';
        el.style.backgroundImage = 'url(../../../../assets/icon/markerGray.png)';
        el.style.width = '38px';
        el.style.height = '38px';
        el.style.backgroundSize = '100%';
        el.style.cursor = 'pointer';

        // Create a new Mapbox marker
        this.marker = new mapboxgl.Marker(el)
          .setLngLat([event.lngLat.lng, event.lngLat.lat])
          .addTo(this.mapEventDirective!);

        this.markers.push(this.marker);
        this.latlng.emit({ marker: this.marker, markers: this.markers });

        console.log(this.markers);

        // Emit the marker data
        this.latlng.emit({ marker: this.marker, markers: this.markers });
      } else {
        // Handle case if marker already exists
        console.log('Marker already exists.');
      }
    }

}

clearMarkers() {
  this.markers.forEach(marker => marker.remove());
  this.markers = [];
}

}

### END Ionic-project\src\app\utiles\directives\longpress\long-press.directive.ts ###

### BEGIN Ionic-project\src\app\utiles\enums\role.ts ###
export enum Role {
        CHAUFFEUR = 'chauffeur',
        ORGANISATEUR = 'organisateur',
}

### END Ionic-project\src\app\utiles\enums\role.ts ###

### BEGIN Ionic-project\src\app\utiles\interface\aeroport.ts ###
export interface Aeroport {
    id:number,
    name:string,
    shortName:string,
    nbFile:string,
    nbVan:string,
    attBAT:string,
    attTotal:string,
    tendance:string,
    leavethirty:string,
    enterthirty:string,
}
### END Ionic-project\src\app\utiles\interface\aeroport.ts ###

### BEGIN Ionic-project\src\app\utiles\interface\day-list.ts ###
export interface Day {
    index:number,
    name:string,
    activated:boolean
}

### END Ionic-project\src\app\utiles\interface\day-list.ts ###

### BEGIN Ionic-project\src\app\utiles\interface\note-amis.ts ###
export interface NoteAmis {
    id:number;
    image:string;
    name:string;
    isSent:boolean;
    deleted:boolean;
}

### END Ionic-project\src\app\utiles\interface\note-amis.ts ###

### BEGIN Ionic-project\src\app\utiles\services\aeroport\aeroport.service.spec.ts ###
import { TestBed } from '@angular/core/testing';

import { AeroportService } from './aeroport.service';

describe('AeroportService', () => {
  let service: AeroportService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(AeroportService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\services\aeroport\aeroport.service.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\services\aeroport\aeroport.service.ts ###
import { Injectable } from '@angular/core';
import { Aeroport } from '../../interface/aeroport';

@Injectable({
  providedIn: 'root'
})
export class AeroportService {
  $listAeropot:Array<Aeroport> = [
    {
      id:1,
      name:'AÃ©roport Charle de Gaulle',
      shortName:'CDG',
      nbFile:'1',
      nbVan:'1',
      attBAT:'1 min',
      attTotal:'20min',
      tendance:'bad',
      leavethirty:'45',
      enterthirty:'33',
    },
    {
      id:2,
      name:'AÃ©roport Orly',
      shortName:'ORLY',
      nbFile:'7,3G et 3P',
      nbVan:'6',
      attBAT:'1h20min',
      attTotal:'2h10min',
      tendance:'good',
      leavethirty:'22',
      enterthirty:'40',
    }
  ]

  constructor() { }

}
### END Ionic-project\src\app\utiles\services\aeroport\aeroport.service.ts ###

### BEGIN Ionic-project\src\app\utiles\services\event\events.service.spec.ts ###
import { TestBed } from '@angular/core/testing';

import { EventsService } from './events.service';

describe('EventsService', () => {
  let service: EventsService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(EventsService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\services\event\events.service.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\services\event\events.service.ts ###
import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root'
})
export class EventsService {


  constructor() { }
}

### END Ionic-project\src\app\utiles\services\event\events.service.ts ###

### BEGIN Ionic-project\src\app\utiles\services\feedback\feedback.service.spec.ts ###
import { TestBed } from '@angular/core/testing';

import { FeedbackService } from './feedback.service';

describe('FeedbackService', () => {
  let service: FeedbackService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(FeedbackService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\services\feedback\feedback.service.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\services\feedback\feedback.service.ts ###
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { URL } from 'src/environments/environment';

@Injectable({
  providedIn: 'root'
})
export class FeedbackService {

  urlSendMail:string = URL + 'sendmail';

  $Authorization = { 
    'Authorization': '',
    'Content-Type': 'application/json'
  }

  constructor(private http:HttpClient) { }

  $sendMail(content:any){
    this.$inicializeToken();
    return this.http.post(this.urlSendMail, content, {headers: this.$Authorization})
  }

  $inicializeToken(){
    this.$Authorization.Authorization = `Bearer ${localStorage.getItem('apiToken')}`
    console.log('this is the header ' + this.$Authorization.Authorization);
  }
}

### END Ionic-project\src\app\utiles\services\feedback\feedback.service.ts ###

### BEGIN Ionic-project\src\app\utiles\services\participation\participation.service.ts ###
import { Injectable } from '@angular/core';
import { ApiService } from '../../../services/api.service';
import { ProfilService } from '../profil/profil.service';
import { Observable, BehaviorSubject } from 'rxjs';
import { map, catchError } from 'rxjs/operators';

@Injectable({
  providedIn: 'root'
})
export class ParticipationService {
  private readonly INITIAL_POINTS = 40;
  private readonly MAX_POINTS = 50;
  private currentUserId: string | null = null;

  private pointsSubject = new BehaviorSubject<number>(0);
  public points$ = this.pointsSubject.asObservable();

  constructor(private apiService: ApiService, private profilService: ProfilService) {}

  setUserId(userId: string) {
    this.currentUserId = userId;
    this.loadUserParticipation(userId);
  }

  private checkDailyReduction() {
    if (this.currentUserId) {
      this.apiService.processDailyReduction(this.currentUserId).subscribe({
        next: (response: any) => {
          this.pointsSubject.next(response.currentPoints);
        },
        error: (error) => {
          console.error('Failed to process daily reduction:', error);
          this.pointsSubject.next(0);
        }
      });
    }
  }

  getCurrentPoints(): number {
    return this.pointsSubject.value;
  }

  private loadUserParticipation(userId: string) {
    // Use existing profile endpoint that now includes participation data
    this.profilService.$profil().subscribe({
      next: (response: any) => {
        console.log('Profile response with participation:', response);
        if (response.participation_score !== undefined) {
          this.pointsSubject.next(response.participation_score);
          this.checkDailyReduction();
        } else {
          this.initializeUserOnBackend(userId);
        }
      },
      error: (error) => {
        console.error('Failed to load participation from profile:', error);
        this.pointsSubject.next(0);
      }
    });
  }

  private initializeUserOnBackend(userId: string) {
    this.apiService.initializeUserParticipation(userId).subscribe({
      next: (response: any) => {
        this.pointsSubject.next(response.currentPoints);
      },
      error: (error) => {
        console.error('Failed to initialize user on backend:', error);
        this.pointsSubject.next(0);
      }
    });
  }

  addPoints(points: number): number {
    if (this.currentUserId) {
      this.apiService.updateUserPoints(this.currentUserId, points, 'add').subscribe({
        next: (response: any) => {
          this.pointsSubject.next(response.currentPoints);
        },
        error: (error) => {
          console.error('Failed to add points on server:', error);
        }
      });
    }
    return this.getCurrentPoints();
  }

  removePoints(points: number): number {
    if (this.currentUserId) {
      this.apiService.updateUserPoints(this.currentUserId, -points, 'remove').subscribe({
        next: (response: any) => {
          this.pointsSubject.next(response.currentPoints);
        },
        error: (error) => {
          console.error('Failed to remove points on server:', error);
        }
      });
    }
    return this.getCurrentPoints();
  }

  // Point rewards based on activity type
  rewardAffluenceLevel1(): number {
    return this.addPoints(1);
  }

  rewardAffluenceLevel2(): number {
    return this.addPoints(5);
  }

  rewardAffluenceLevel3(): number {
    return this.addPoints(10);
  }

  rewardAffluenceLevel4(): number {
    return this.addPoints(10);
  }

  rewardAffluenceLevel0(): number {
    return this.addPoints(10);
  }

  rewardEvent(): number {
    return this.addPoints(3);
  }

  rewardLike(): number {
    return this.addPoints(1);
  }

  rewardAirportWait(): number {
    return this.addPoints(10);
  }

  penalizeFalseReport(): number {
    return this.removePoints(20);
  }

  getParticipationPercentage(): number {
    return Math.min(100, (this.getCurrentPoints() / this.MAX_POINTS) * 100);
  }

  canUseFeatures(): boolean {
    return this.getCurrentPoints() > 0;
  }
}
### END Ionic-project\src\app\utiles\services\participation\participation.service.ts ###

### BEGIN Ionic-project\src\app\utiles\services\points\list-points.service.spec.ts ###
import { TestBed } from '@angular/core/testing';

import { ListPointsService } from './list-points.service';

describe('ListPointsService', () => {
  let service: ListPointsService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(ListPointsService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\services\points\list-points.service.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\services\points\list-points.service.ts ###
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { tap } from 'rxjs/operators';
import { URL } from 'src/environments/environment';

@Injectable({
  providedIn: 'root'
})
export class ListPointsService {


  $UrlPoints:string = URL + 'points/all';
  $UrlMyPoints:string = URL + 'points/my';
  $UrlSavePoint:string = URL + 'points/add';
  $UrlDetailPoint:string = URL + 'points/detail';
  $UrlUpdatePoint:string = URL + 'points/update';
  $UrlUpdateLvlPoint:string = URL + 'points/lvl/update';
  $UrlDeletePoint:string = URL + 'points/delete';
  $UrlFeedbackPoint:string = URL + 'points/feedback';
  $UrlDisablePoint:string = URL + 'points/disable';
  //{"done":true,"id":553,"type":"jaune"}
  $Authorization = {
    'Authorization': '',
    'Content-Type': 'application/json'
  }

  // Simple caching mechanism
  private myPointsCache: any = null;
  private forceRefresh = false;

  $checker:boolean = true;

  $listPoint:Array<any> = [
    {
      id:1,
      reference:523,
      adresse:"64 rue de Varenne, Paris",
      type:'CinÃ©ma',
      date:'03/04/22 Ã  14:15'
    }
  ];

  constructor(private http:HttpClient) { }

  $getPoints(){
    this.$inicializeToken();
    return this.http.get(this.$UrlPoints,{headers: this.$Authorization});
  }

  $getMyPoints(){
    // If a refresh is forced or there's no cache, fetch from the server
    if (this.forceRefresh || !this.myPointsCache) {
      this.forceRefresh = false; // Reset the flag
      this.$inicializeToken();
      return this.http.get(this.$UrlMyPoints, { headers: this.$Authorization }).pipe(
        tap(data => {
          this.myPointsCache = data; // Store the new data in the cache
        })
      );
    } else {
      // Otherwise, return the cached data immediately
      return new Observable((observer: { next: (arg0: any) => void; complete: () => void; }) => {
        observer.next(this.myPointsCache);
        observer.complete();
      });
    }
  }

  $savePoint(content:any){
    this.$inicializeToken();
    this.forceRefresh = true; // Set the flag to force a refresh on the next $getMyPoints call
    return this.http.post(this.$UrlSavePoint, content, {headers: this.$Authorization});
  }

  $getPointDetails(content:any){
    this.$inicializeToken();
    return this.http.post(this.$UrlDetailPoint, content, {headers: this.$Authorization});
  }

  $updatePoint(content:any){
    this.$inicializeToken();
    return this.http.post(this.$UrlUpdatePoint, content, {headers: this.$Authorization});
  }

  $updateLvlPoint(content:any){
    this.$inicializeToken();
    return this.http.post(this.$UrlUpdateLvlPoint, content, {headers: this.$Authorization});
  }

  $deletePoint(content:any){
    this.$inicializeToken();
    return this.http.post(this.$UrlDeletePoint, content, {headers: this.$Authorization});
  }

  $feedbackPoint(content:any){
    this.$inicializeToken();
    return this.http.post(this.$UrlFeedbackPoint, content, {headers: this.$Authorization});
  }

  $disablePoints(content:any){
    this.$inicializeToken();
    return this.http.post(this.$UrlDisablePoint, content, {headers: this.$Authorization});
  }

 $inicializeToken(){
    this.$Authorization.Authorization = `Bearer ${localStorage.getItem('apiToken')}`
    console.log('this is the header ' + this.$Authorization.Authorization);
  }
}

### END Ionic-project\src\app\utiles\services\points\list-points.service.ts ###

### BEGIN Ionic-project\src\app\utiles\services\profil\profil.service.spec.ts ###
import { TestBed } from '@angular/core/testing';

import { ProfilService } from './profil.service';

describe('ProfilService', () => {
  let service: ProfilService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(ProfilService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});

### END Ionic-project\src\app\utiles\services\profil\profil.service.spec.ts ###

### BEGIN Ionic-project\src\app\utiles\services\profil\profil.service.ts ###
import { HttpClient, HttpHandler, HttpHeaders } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { tap } from 'rxjs/operators';
import { NoteAmis } from 'src/app/utiles/interface/note-amis';
import { URL } from 'src/environments/environment';

@Injectable({
  providedIn: 'root'
})
export class ProfilService {

  UrlLogin:string = URL + 'login';
  UrlLogout:string = URL + 'logout';
  UrlRegister:string = URL + 'register';
  UrlProfile:string = URL + 'profile';
  UrlFriends:string = URL + 'friends';
  UrlInvite:string = URL + 'friends/invitation';
  UrlUnfollow:string = URL + 'friends/unfollow/';
  UrlUnfollowList:string = URL + 'friends/share';
  UrlUpdateProfInfo:string = URL + 'profile/professional_info/update';
  UrlUpdatePersoInfo:string = URL + 'profile/perosonal_info/update';
  UrlUpdateSetting:string = URL + 'profile/setting/update';
  UrlUpassword:string = URL + 'profile/password/update';
  UrlUpload:string = URL + 'upload';

  // $Authorization = {
  //   'Authorization': ``,
  //   'Content-Type': 'application/json',
  //   'Access-Control-Allow-Origin': '*'
  // }

  $friendsList:Array<any> = [];
  $userinfo!:any;

  constructor(private http:HttpClient) { }


    token = localStorage.getItem('apiToken');
   $Authorization = {
      'Authorization': `Bearer ${this.token}`,
      'Content-Type': 'application/json'
  }


  $login(email:string, password:string): Observable<any> {
    this.$inicializeToken();
    console.log('ðŸ” Login attempt:', {
      email,
      loginUrl: this.UrlLogin,
      URL_BASE: URL,
      windowLocation: window.location.href,
      protocol: window.location.protocol,
      hostname: window.location.hostname
    });
    return this.http.post(this.UrlLogin, {email,password}).pipe(
      tap((response: any) => {
        if (response && response.token) {
          console.log('Token received:', response.token);
          localStorage.setItem('apiToken', response.token);
          this.$inicializeToken(); // Re-initialize headers with the new token
        } else {
          console.error('Login response did not include a token.');
        }
      })
    );
  }

  $profil(){
    this.$inicializeToken();
    return this.http.get(this.UrlProfile,{headers: this.$Authorization});
  }

  $updateProffessionalInfo(content:any){
    this.$inicializeToken();
    return this.http.post(this.UrlUpdateProfInfo, content,{headers: this.$Authorization});
  }

  $updatePrsonalInfo(content:any){
    this.$inicializeToken();
    return this.http.post(this.UrlUpdatePersoInfo, content,{headers: this.$Authorization});
  }

  $updatePassword(content:any){
    this.$inicializeToken();
    return this.http.post(this.UrlUpassword, content,{headers: this.$Authorization});
  }

  $updateSetting(content:any){
    this.$inicializeToken();
    return this.http.post(this.UrlUpdateSetting, content, {headers: this.$Authorization});
  }

  $logout(){
    this.$inicializeToken()
    localStorage.setItem('hasRedirected', 'false');
    return this.http.get(this.UrlLogout, {headers: this.$Authorization});
  }

  $register(data:any){
    return this.http.post(this.UrlRegister, data).pipe(
      tap((response: any) => {
        if (response && response.token) {
          console.log('Token received from registration:', response.token);
          localStorage.setItem('apiToken', response.token);
          this.$inicializeToken(); // Re-initialize headers with the new token
        } else {
          console.error('Register response did not include a token.');
        }
      })
    );
  }

  $inviteFriend(content:string){
    this.$inicializeToken();
    return this.http.post(this.UrlInvite, content, {headers:this.$Authorization});
  }

  $unfollow(id:number){
    this.$inicializeToken();
    return this.http.post(this.UrlUnfollow+id, null,{headers:this.$Authorization});
  }

  $friends(){
    this.$inicializeToken();
    return this.http.get(this.UrlFriends,{headers:this.$Authorization});
  }

  $shareNoteswith(friendList:any){
    this.$inicializeToken();
    return this.http.post(this.UrlUnfollowList, friendList, {headers:this.$Authorization});
  }

  $uploadImage(content:any){
    this.$inicializeToken();
    return this.http.post(this.UrlUpload, content, {headers: this.$Authorization});
  }

  $inicializeToken(){
    this.$Authorization.Authorization = `Bearer ${localStorage.getItem('apiToken')}`
    console.log('this is the header ' + this.$Authorization.Authorization);
  }
}

### END Ionic-project\src\app\utiles\services\profil\profil.service.ts ###

### BEGIN Ionic-project\src\app\utiles\services\queue\queue.service.ts ###
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { URL } from 'src/environments/environment';

export interface UserPosition {
  user_id: string;
  lat: number;
  lng: number;
}

@Injectable({
  providedIn: 'root'
})
export class QueueService {
  private baseUrl = URL + 'queue/';
  private authorizationHeader = {
    'Authorization': '',
    'Content-Type': 'application/json'
  };

  constructor(private http: HttpClient) { }

  private initializeToken() {
    this.authorizationHeader.Authorization = `Bearer ${localStorage.getItem('apiToken')}`;
  }

  updatePosition(stationPointId: number, lat: number, lng: number): Observable<any> {
    this.initializeToken();
    const url = `${this.baseUrl}${stationPointId}/update`;
    return this.http.post(url, { lat, lng }, { headers: this.authorizationHeader });
  }

  getPositions(stationPointId: number): Observable<UserPosition[]> {
    this.initializeToken();
    const url = `${this.baseUrl}${stationPointId}/positions`;
    return this.http.get<UserPosition[]>(url, { headers: this.authorizationHeader });
  }

  leaveQueue(stationPointId: number): Observable<any> {
    this.initializeToken();
    const url = `${this.baseUrl}${stationPointId}/leave`;
    return this.http.post(url, {}, { headers: this.authorizationHeader });
  }
}
### END Ionic-project\src\app\utiles\services\queue\queue.service.ts ###

### BEGIN Ionic-project\src\app\utiles\share\share.module.ts ###
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { DatetimePickerComponent } from '../component/dateTime/datetime-picker/datetime-picker.component';
import { TimePickerComponent } from '../component/dateTime/time-picker/time-picker.component';
import { IonicModule } from '@ionic/angular';
import { FormsModule } from '@angular/forms';
import { LongPressDirective } from '../directives/longpress/long-press.directive';
import { Camera } from '@awesome-cordova-plugins/camera/ngx';
import { ConfirmationComponent } from '../component/confirmation/confirmation.component';
import { WarningUpdateProffessionalInfoComponent } from '../component/warning-update-proffessional-info/warning-update-proffessional-info.component';
import { ImageSourceModalComponent } from '../component/image-source-modal/image-source-modal.component';
import { DeleteConfirmationComponent } from '../component/delete-confirmation/delete-confirmation.component';



@NgModule({
  declarations: [
    DatetimePickerComponent,
    TimePickerComponent,
    LongPressDirective,
    ConfirmationComponent,
    WarningUpdateProffessionalInfoComponent,
    ImageSourceModalComponent,
    DeleteConfirmationComponent
  ],
  imports: [
    CommonModule,
    IonicModule,
    FormsModule,
    
  ],
  exports:[ DatetimePickerComponent,
    TimePickerComponent,
    LongPressDirective,
    ConfirmationComponent,
    WarningUpdateProffessionalInfoComponent,
    ImageSourceModalComponent,
    DeleteConfirmationComponent

  ],
  providers:[Camera]
  
})
export class ShareModule { }

### END Ionic-project\src\app\utiles\share\share.module.ts ###

### BEGIN Ionic-project\src\environments\environment.prod.ts ###
export const environment = {
  production: true,

  errorServeurMsg: 'âŒ Erreur au niveau du serveur. ',
  informationSauvegarde: 'âœ”ï¸ les renseignements sont bien enregistrÃ©s. ',
  SuccessMsg:'âœ”ï¸ Enregistrement effectuÃ© avec succÃ¨s',
};

export const URL_BASE = 'https://alik144.sg-host.com/api/';
export const URL = URL_BASE
export const SuperiseurEmail = 'contact@soorcin.technology'



// export const url = 'http://41.142.248.75:8080/lesieur/api/';
// export const urlWS = 'ws://41.142.248.75:8080/connection/websocket';
// export const dateRelease = '2024-02-13 17h22';

### END Ionic-project\src\environments\environment.prod.ts ###

### BEGIN Ionic-project\src\environments\environment.ts ###
// This file can be replaced during build by using the `fileReplacements` array.
// `ng build` replaces `environment.ts` with `environment.prod.ts`.
// The list of file replacements can be found in `angular.json`.

import { HttpHeaders } from "@angular/common/http";

export const environment = {
  production: false,

  errorServeurMsg: 'âŒ Erreur au niveau du serveur. ',
  informationSauvegarde: 'âœ”ï¸ les renseignements sont bien enregistrÃ©s. ',
  SuccessMsg:'âœ”ï¸ Enregistrement effectuÃ© avec succÃ¨s',
};

// dev - Laragon local development
// export const URL_BASE = 'http://cabsul.test/api/'
// export const URL_BASE = 'http://localhost:8000/api/'
// export const URL_BASE = 'http://192.168.1.143:8000/api/'

// Production - SiteGround
export const URL_BASE = 'https://alik144.sg-host.com/api/';
export const URL = URL_BASE
export const SuperiseurEmail = 'contact@soorcin.technology'
// export const url = 'http://10.131.84.51/visilog_dev/api/';
// export const urlWS = 'ws://10.131.84.51:8000/connection/websocket';
// export const dateRelease = 'v1.2.0 2024-04-30 10h18';


// export const httpOptions = {
//   headers: new HttpHeaders({
//     Authorization:
//       'Bearer ' + window.localStorage.getItem('visilog_lesieur_token'),
//   }),
// };

### END Ionic-project\src\environments\environment.ts ###

### BEGIN Ionic-project\src\theme\variables.scss ###
/** Ionic CSS Variables **/
:root {
  /** primary **/
  --ion-color-primary: #3880ff;
  --ion-color-primary-rgb: 56, 128, 255;
  --ion-color-primary-contrast: #ffffff;
  --ion-color-primary-contrast-rgb: 255, 255, 255;
  --ion-color-primary-shade: #3171e0;
  --ion-color-primary-tint: #4c8dff;

  /** secondary **/
  --ion-color-secondary: #3dc2ff;
  --ion-color-secondary-rgb: 61, 194, 255;
  --ion-color-secondary-contrast: #ffffff;
  --ion-color-secondary-contrast-rgb: 255, 255, 255;
  --ion-color-secondary-shade: #36abe0;
  --ion-color-secondary-tint: #50c8ff;

  /** tertiary **/
  --ion-color-tertiary: #5260ff;
  --ion-color-tertiary-rgb: 82, 96, 255;
  --ion-color-tertiary-contrast: #ffffff;
  --ion-color-tertiary-contrast-rgb: 255, 255, 255;
  --ion-color-tertiary-shade: #4854e0;
  --ion-color-tertiary-tint: #6370ff;

  /** success **/
  --ion-color-success: #2dd36f;
  --ion-color-success-rgb: 45, 211, 111;
  --ion-color-success-contrast: #ffffff;
  --ion-color-success-contrast-rgb: 255, 255, 255;
  --ion-color-success-shade: #28ba62;
  --ion-color-success-tint: #42d77d;

  /** warning **/
  --ion-color-warning: #ffc409;
  --ion-color-warning-rgb: 255, 196, 9;
  --ion-color-warning-contrast: #000000;
  --ion-color-warning-contrast-rgb: 0, 0, 0;
  --ion-color-warning-shade: #e0ac08;
  --ion-color-warning-tint: #ffca22;

  /** danger **/
  --ion-color-danger: #eb445a;
  --ion-color-danger-rgb: 235, 68, 90;
  --ion-color-danger-contrast: #ffffff;
  --ion-color-danger-contrast-rgb: 255, 255, 255;
  --ion-color-danger-shade: #cf3c4f;
  --ion-color-danger-tint: #ed576b;

  /** dark **/
  --ion-color-dark: #222428;
  --ion-color-dark-rgb: 34, 36, 40;
  --ion-color-dark-contrast: #ffffff;
  --ion-color-dark-contrast-rgb: 255, 255, 255;
  --ion-color-dark-shade: #1e2023;
  --ion-color-dark-tint: #383a3e;

  /** medium **/
  --ion-color-medium: #92949c;
  --ion-color-medium-rgb: 146, 148, 156;
  --ion-color-medium-contrast: #ffffff;
  --ion-color-medium-contrast-rgb: 255, 255, 255;
  --ion-color-medium-shade: #808289;
  --ion-color-medium-tint: #9d9fa6;

  /** light **/
  --ion-color-light: #f4f5f8;
  --ion-color-light-rgb: 244, 245, 248;
  --ion-color-light-contrast: #000000;
  --ion-color-light-contrast-rgb: 0, 0, 0;
  --ion-color-light-shade: #d7d8da;
  --ion-color-light-tint: #f5f6f9;

  /** visilog **/
  --ion-color-visilog: #4CAF50;
	--ion-color-visilog-rgb: 182,203,52;
	--ion-color-visilog-contrast: #000000;
	--ion-color-visilog-contrast-rgb: 0,0,0;
	--ion-color-visilog-shade: #409443;
	--ion-color-visilog-tint: #58cc5c;
}

.ion-color-visilog {
	--ion-color-base: var(--ion-color-visilog);
	--ion-color-base-rgb: var(--ion-color-visilog-rgb);
	--ion-color-contrast: var(--ion-color-visilog-contrast);
	--ion-color-contrast-rgb: var(--ion-color-visilog-contrast-rgb);
	--ion-color-shade: var(--ion-color-visilog-shade);
	--ion-color-tint: var(--ion-color-visilog-tint);
}

### END Ionic-project\src\theme\variables.scss ###

BACKEND FILE: app\Console\Kernel.php
BACKEND FILE: app\Enums\DocumentType.php
BACKEND FILE: app\Enums\Roles.php
BACKEND FILE: app\Enums\UserNotification.php
BACKEND FILE: app\Enums\UserStatus.php
BACKEND FILE: app\Enums\UserVisibility.php
BACKEND FILE: app\Exceptions\Handler.php
BACKEND FILE: app\Helpers\helpers.php
BACKEND FILE: app\Http\Kernel.php
BACKEND FILE: app\Http\Controllers\AbonnementController.php
BACKEND FILE: app\Http\Controllers\AirportController.php
BACKEND FILE: app\Http\Controllers\AuthController.php
BACKEND FILE: app\Http\Controllers\checkSession.php
BACKEND FILE: app\Http\Controllers\Controller.php
BACKEND FILE: app\Http\Controllers\DashboardController.php
BACKEND FILE: app\Http\Controllers\logout.php
BACKEND FILE: app\Http\Controllers\mailler.php
BACKEND FILE: app\Http\Controllers\ParticipationController.php
BACKEND FILE: app\Http\Controllers\PointController.php
BACKEND FILE: app\Http\Controllers\ProfileController.php
BACKEND FILE: app\Http\Controllers\PublicationController.php
BACKEND FILE: app\Http\Controllers\QueueController.php
BACKEND FILE: app\Http\Controllers\UserController.php
BACKEND FILE: app\Http\Controllers\Auth\AuthenticatedSessionController.php
BACKEND FILE: app\Http\Controllers\Auth\ConfirmablePasswordController.php
BACKEND FILE: app\Http\Controllers\Auth\EmailVerificationNotificationController.php
BACKEND FILE: app\Http\Controllers\Auth\EmailVerificationPromptController.php
BACKEND FILE: app\Http\Controllers\Auth\NewPasswordController.php
BACKEND FILE: app\Http\Controllers\Auth\PasswordController.php
BACKEND FILE: app\Http\Controllers\Auth\PasswordResetLinkController.php
BACKEND FILE: app\Http\Controllers\Auth\RegisteredUserController.php
BACKEND FILE: app\Http\Controllers\Auth\VerifyEmailController.php
BACKEND FILE: app\Http\Middleware\apiAuth.php
BACKEND FILE: app\Http\Middleware\Authenticate.php
BACKEND FILE: app\Http\Middleware\CorsMiddleware.php
BACKEND FILE: app\Http\Middleware\EncryptCookies.php
BACKEND FILE: app\Http\Middleware\PreventRequestsDuringMaintenance.php
BACKEND FILE: app\Http\Middleware\RedirectIfAuthenticated.php
BACKEND FILE: app\Http\Middleware\TrimStrings.php
BACKEND FILE: app\Http\Middleware\TrustHosts.php
BACKEND FILE: app\Http\Middleware\TrustProxies.php
BACKEND FILE: app\Http\Middleware\ValidateSignature.php
BACKEND FILE: app\Http\Middleware\VerifyCsrfToken.php
BACKEND FILE: app\Http\Requests\loginRequest.php
BACKEND FILE: app\Http\Requests\ProfileUpdateRequest.php
BACKEND FILE: app\Http\Requests\Auth\LoginRequest.php
BACKEND FILE: app\Livewire\AbonnementsBar.php
BACKEND FILE: app\Livewire\AbonnementsDonut.php
BACKEND FILE: app\Livewire\AlertComponent.php
BACKEND FILE: app\Livewire\PublicationsLines.php
BACKEND FILE: app\Livewire\SortPublicationTable.php
BACKEND FILE: app\Livewire\TableAbonnements.php
BACKEND FILE: app\Livewire\TablePublications.php
BACKEND FILE: app\Livewire\TableUsers.php
BACKEND FILE: app\Livewire\UsersDonut.php
BACKEND FILE: app\Livewire\UsersLines.php
BACKEND FILE: app\Mail\ExampleEmail.php
BACKEND FILE: app\Models\Abonnement.php
BACKEND FILE: app\Models\AffluencePoint.php
BACKEND FILE: app\Models\Airport.php
BACKEND FILE: app\Models\Chauffeur.php
BACKEND FILE: app\Models\EventPoint.php
BACKEND FILE: app\Models\Friend.php
BACKEND FILE: app\Models\Image.php
BACKEND FILE: app\Models\JaunePoint.php
BACKEND FILE: app\Models\NotePoint.php
BACKEND FILE: app\Models\OptionSub.php
BACKEND FILE: app\Models\Organisateur.php
BACKEND FILE: app\Models\Point.php
BACKEND FILE: app\Models\PointFeedback.php
BACKEND FILE: app\Models\Publication.php
BACKEND FILE: app\Models\PublicationMedia.php
BACKEND FILE: app\Models\PublicationUserView.php
BACKEND FILE: app\Models\QueueUserPosition.php
BACKEND FILE: app\Models\Role.php
BACKEND FILE: app\Models\StationPoint.php
BACKEND FILE: app\Models\User.php
BACKEND FILE: app\Providers\AppServiceProvider.php
BACKEND FILE: app\Providers\AuthServiceProvider.php
BACKEND FILE: app\Providers\BroadcastServiceProvider.php
BACKEND FILE: app\Providers\EventServiceProvider.php
BACKEND FILE: app\Providers\RouteServiceProvider.php
BACKEND FILE: app\Rules\UniqueFullName.php
BACKEND FILE: app\Services\ParticipationService.php
BACKEND FILE: app\View\Components\AppLayout.php
BACKEND FILE: app\View\Components\GuestLayout.php
BACKEND FILE: app\View\Components\ImageUpload.php
BACKEND FILE: bootstrap\app.php
BACKEND FILE: bootstrap\cache\config.php
BACKEND FILE: bootstrap\cache\packages.php
BACKEND FILE: bootstrap\cache\routes-v7.php
BACKEND FILE: bootstrap\cache\services.php
BACKEND FILE: config\app.php
BACKEND FILE: config\auth.php
BACKEND FILE: config\broadcasting.php
BACKEND FILE: config\cache.php
BACKEND FILE: config\cors.php
BACKEND FILE: config\database.php
BACKEND FILE: config\filesystems.php
BACKEND FILE: config\hashing.php
BACKEND FILE: config\logging.php
BACKEND FILE: config\mail.php
BACKEND FILE: config\queue.php
BACKEND FILE: config\sanctum.php
BACKEND FILE: config\services.php
BACKEND FILE: config\session.php
BACKEND FILE: config\view.php
BACKEND FILE: database\factories\UserFactory.php
BACKEND FILE: database\migrations\2014_10_12_000000_create_users_table.php
BACKEND FILE: database\migrations\2014_10_12_100000_create_password_reset_tokens_table.php
BACKEND FILE: database\migrations\2019_08_19_000000_create_failed_jobs_table.php
BACKEND FILE: database\migrations\2019_12_14_000001_create_personal_access_tokens_table.php
BACKEND FILE: database\migrations\2024_04_29_105058_create_cauffeurs_table.php
BACKEND FILE: database\migrations\2024_04_29_105844_create_images_table.php
BACKEND FILE: database\migrations\2024_04_29_111445_create_roles_table.php
BACKEND FILE: database\migrations\2024_04_29_113219_create_organisateurs_table.php
BACKEND FILE: database\migrations\2024_04_29_114101_create_abonnements_table.php
BACKEND FILE: database\migrations\2024_04_29_114603_create_option_subs_table.php
BACKEND FILE: database\migrations\2024_05_08_163300_create_friends_table.php
BACKEND FILE: database\migrations\2024_06_04_074144_create_points_table.php
BACKEND FILE: database\migrations\2024_06_04_074246_create_affluence_points_table.php
BACKEND FILE: database\migrations\2024_06_04_074302_create_event_points_table.php
BACKEND FILE: database\migrations\2024_06_12_143052_create_point_feedback_table.php
BACKEND FILE: database\migrations\2024_08_07_090410_create_publication_medias_table.php
BACKEND FILE: database\migrations\2024_08_07_090420_create_publications_table.php
BACKEND FILE: database\migrations\2024_08_07_124730_create_publication_user_views_table.php
BACKEND FILE: database\migrations\2024_09_05_100000_add_orly_fields_to_airports_table.php
BACKEND FILE: database\migrations\2025_07_02_122725_add_participation_score_to_users_table.php
BACKEND FILE: database\migrations\2025_07_02_122955_add_last_login_at_to_users_table.php
BACKEND FILE: database\migrations\2025_07_04_093148_create_station_points_table.php
BACKEND FILE: database\migrations\2025_07_04_094106_create_note_points_table.php
BACKEND FILE: database\migrations\2025_07_04_094116_create_jaune_points_table.php
BACKEND FILE: database\migrations\2025_07_04_100027_add_deleted_at_to_point_tables.php
BACKEND FILE: database\migrations\2025_07_04_115856_create_airports_table.php
BACKEND FILE: database\migrations\2025_07_26_120911_add_polyline_to_station_points_table.php
BACKEND FILE: database\migrations\2025_07_26_141047_create_queue_user_positions_table.php
BACKEND FILE: database\seeders\Abonnements.php
BACKEND FILE: database\seeders\AirportSeeder.php
BACKEND FILE: database\seeders\ChauffeurUserSeeder.php
BACKEND FILE: database\seeders\DatabaseSeeder.php
BACKEND FILE: database\seeders\Images.php
BACKEND FILE: database\seeders\Options.php
BACKEND FILE: database\seeders\PublicationUserViewSeeder.php
BACKEND FILE: database\seeders\Roles.php
BACKEND FILE: database\seeders\TestUserSeeder.php
BACKEND FILE: database\seeders\UserSeeder.php
BACKEND FILE: Ionic-project\node_modules\flatted\php\flatted.php
BACKEND FILE: public\index.php
BACKEND FILE: resources\views\dashboard.blade.php
BACKEND FILE: resources\views\welcome.blade.php
BACKEND FILE: resources\views\abonnement\abonnements.blade.php
BACKEND FILE: resources\views\abonnement\createAbonnement.blade.php
BACKEND FILE: resources\views\abonnement\editeAbonnement.blade.php
BACKEND FILE: resources\views\auth\confirm-password.blade.php
BACKEND FILE: resources\views\auth\forgot-password.blade.php
BACKEND FILE: resources\views\auth\login.blade.php
BACKEND FILE: resources\views\auth\register.blade.php
BACKEND FILE: resources\views\auth\reset-password.blade.php
BACKEND FILE: resources\views\auth\verify-email.blade.php
BACKEND FILE: resources\views\components\application-logo.blade.php
BACKEND FILE: resources\views\components\auth-session-status.blade.php
BACKEND FILE: resources\views\components\danger-button.blade.php
BACKEND FILE: resources\views\components\dropdown-link.blade.php
BACKEND FILE: resources\views\components\dropdown.blade.php
BACKEND FILE: resources\views\components\image-upload.blade.php
BACKEND FILE: resources\views\components\input-error.blade.php
BACKEND FILE: resources\views\components\input-label.blade.php
BACKEND FILE: resources\views\components\modal.blade.php
BACKEND FILE: resources\views\components\nav-link.blade.php
BACKEND FILE: resources\views\components\primary-button.blade.php
BACKEND FILE: resources\views\components\responsive-nav-link.blade.php
BACKEND FILE: resources\views\components\secondary-button.blade.php
BACKEND FILE: resources\views\components\text-input.blade.php
BACKEND FILE: resources\views\components\theme-button.blade.php
BACKEND FILE: resources\views\email\emailTemplate.blade.php
BACKEND FILE: resources\views\layouts\app.blade.php
BACKEND FILE: resources\views\layouts\guest.blade.php
BACKEND FILE: resources\views\layouts\navigation.blade.php
BACKEND FILE: resources\views\livewire\abonnements-bar.blade.php
BACKEND FILE: resources\views\livewire\abonnements-donut.blade.php
BACKEND FILE: resources\views\livewire\alert-component.blade.php
BACKEND FILE: resources\views\livewire\publications-lines.blade.php
BACKEND FILE: resources\views\livewire\sort-publication-table.blade.php
BACKEND FILE: resources\views\livewire\table-abonnements.blade.php
BACKEND FILE: resources\views\livewire\table-publications.blade.php
BACKEND FILE: resources\views\livewire\table-users.blade.php
BACKEND FILE: resources\views\livewire\users-donut.blade.php
BACKEND FILE: resources\views\livewire\users-lines.blade.php
BACKEND FILE: resources\views\profile\edit.blade.php
BACKEND FILE: resources\views\profile\partials\delete-user-form.blade.php
BACKEND FILE: resources\views\profile\partials\update-password-form.blade.php
BACKEND FILE: resources\views\profile\partials\update-profile-information-form.blade.php
BACKEND FILE: resources\views\publication\createPubication.blade.php
BACKEND FILE: resources\views\publication\editePublication.blade.php
BACKEND FILE: resources\views\publication\publications.blade.php
BACKEND FILE: resources\views\publication\sortPublication.blade.php
BACKEND FILE: resources\views\users\createUser.blade.php
BACKEND FILE: resources\views\users\editeUser.blade.php
BACKEND FILE: resources\views\users\users.blade.php
BACKEND FILE: routes\api.php
BACKEND FILE: routes\auth.php
BACKEND FILE: routes\channels.php
BACKEND FILE: routes\console.php
BACKEND FILE: routes\web.php
BACKEND FILE: storage\framework\views\2a5613990fb75592f2a0dfc81529f6de.php
BACKEND FILE: storage\framework\views\4aebf6190fd1f4bc087294c6f6561e56.php
BACKEND FILE: storage\framework\views\7923a87b8f4c8e59a899421df401afa3.php
BACKEND FILE: storage\framework\views\7cd0ff85e8073babd8ac4d67fc46e891.php
BACKEND FILE: storage\framework\views\ac8aa1afedce07d1f04118bf668da89e.php
BACKEND FILE: storage\framework\views\c26a41b3094dce71e7f6e0de7e537585.php
BACKEND FILE: storage\framework\views\ced61d406409a14ec88dda6b5bcf9de9.php
BACKEND FILE: storage\framework\views\df3d5b0a442247da022c14734778c14a.php
BACKEND FILE: tests\CreatesApplication.php
BACKEND FILE: tests\TestCase.php
BACKEND FILE: tests\Feature\ExampleTest.php
BACKEND FILE: tests\Feature\ProfileTest.php
BACKEND FILE: tests\Feature\Auth\AuthenticationTest.php
BACKEND FILE: tests\Feature\Auth\EmailVerificationTest.php
BACKEND FILE: tests\Feature\Auth\PasswordConfirmationTest.php
BACKEND FILE: tests\Feature\Auth\PasswordResetTest.php
BACKEND FILE: tests\Feature\Auth\PasswordUpdateTest.php
BACKEND FILE: tests\Feature\Auth\RegistrationTest.php
BACKEND FILE: tests\Unit\ExampleTest.php
